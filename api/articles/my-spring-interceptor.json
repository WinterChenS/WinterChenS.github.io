{"title":"spring中添加自定义的拦截器","slug":"my-spring-interceptor","date":"2018-05-09T08:48:00.000Z","updated":"2022-12-01T01:32:39.787Z","comments":true,"path":"api/articles/my-spring-interceptor.json","excerpt":" [Figure] 要想实现自定义的拦截器，我们不得不讲讲spring中的处理程序拦截器，那么什么是处理程序拦截器呢？","covers":["data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="],"cover":"https://images.unsplash.com/photo-1522199794616-8a62b541f762?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=71b5877630deb9ab5996f91cc61b43f7&auto=format&fit=crop&w=2104&q=80","content":"<p><img   class=\"lazyload\" data-original=\"https://images.unsplash.com/photo-1522199794616-8a62b541f762?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=71b5877630deb9ab5996f91cc61b43f7&auto=format&fit=crop&w=2104&q=80\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p>要想实现自定义的拦截器，我们不得不讲讲spring中的处理程序拦截器，那么什么是处理程序拦截器呢？</p>\n<a id=\"more\"></a>\n\n<h2 id=\"什么是spring中的处理程序拦截器？\"><a href=\"#什么是spring中的处理程序拦截器？\" class=\"headerlink\" title=\"什么是spring中的处理程序拦截器？\"></a>什么是spring中的处理程序拦截器？</h2><p>要想了解拦截器在spring中的作用，我们首先要了解一下HTTP的请求执行链。</p>\n<ol>\n<li><p>DispatcherServlet捕获每一个请求；</p>\n</li>\n<li><p>DispatcherServlet将接收到的URL和相应的Controller进行映射；</p>\n</li>\n<li><p>在请求到达相应的Controller之前<strong>拦截器</strong>会进行请求处理；</p>\n</li>\n<li><p>处理完成之后进行视图的解析；</p>\n</li>\n<li><p>返回视图。</p>\n</li>\n</ol>\n<p>在第3步中，也就是今天最重要的内容，在请求到达Controller之前，请求可以被拦截器处理，这些拦截器就像过滤器。只有当URL找到对应于它们的处理器时才会调用它们。在通过拦截器(拦截器预处理，其实也可以说前置处理)进行前置处理后，请求最终到达controller。之后，发送请求生成视图。但是在这之前，拦截器还是有可能来再次处理它(拦截器后置处理)。只有在最后一次操作之后，视图解析器才能捕获数据并输出视图。</p>\n<p>处理程序映射拦截器基于<code>org.springframework.web.servlet.HandlerInterceptor</code>接口。这个接口有三个方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">HandlerInterceptor</span> </span>&#123;<br><br>  <span class=\"hljs-comment\">//请求发送到Controller之前调用</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">preHandle</span><span class=\"hljs-params\">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span><br><span class=\"hljs-function\">            <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">true</span>;<br>    &#125;<br><br>    <span class=\"hljs-comment\">//请求发送到Controller之后调用</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">postHandle</span><span class=\"hljs-params\">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">            @Nullable ModelAndView modelAndView)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>    &#125;<br><br>    <span class=\"hljs-comment\">//完成请求的处理的回调方法</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">afterCompletion</span><span class=\"hljs-params\">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">            @Nullable Exception ex)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"编写自定义的拦截器\"><a href=\"#编写自定义的拦截器\" class=\"headerlink\" title=\"编写自定义的拦截器\"></a>编写自定义的拦截器</h2><p>要想编写自定义的拦截器，需要有两个步骤：</p>\n<ul>\n<li><p>实现<code>HandlerInterceptor</code>接口和方法；</p>\n</li>\n<li><p>将自定义拦截器添加到MVC中。</p>\n</li>\n</ul>\n<p>下面我们来实现一下代码：</p>\n<h3 id=\"首先我们创建一个类BaseInterceptor\"><a href=\"#首先我们创建一个类BaseInterceptor\" class=\"headerlink\" title=\"首先我们创建一个类BaseInterceptor\"></a>首先我们创建一个类<code>BaseInterceptor</code></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 实现HandlerInterceptor接口，自定义拦截器</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">BaseInterceptor</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">HandlerInterceptor</span> </span>&#123;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> Logger LOGGE = LoggerFactory.getLogger(BaseInterceptor<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br><br>      <span class=\"hljs-comment\">//实现前置方法</span><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">preHandle</span><span class=\"hljs-params\">(HttpServletRequest request, HttpServletResponse response, Object o)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>        String uri = request.getRequestURI();<br><br>        LOGGE.info(<span class=\"hljs-string\">\"UserAgent: &#123;&#125;\"</span>, request.getHeader(USER_AGENT));<br>        LOGGE.info(<span class=\"hljs-string\">\"用户访问地址: &#123;&#125;, 来路地址: &#123;&#125;\"</span>, uri, IPKit.getIpAddrByRequest(request));<br><br><br>      <span class=\"hljs-comment\">//拦截器处理用户权限</span><br>        <span class=\"hljs-keyword\">if</span> (uri.startsWith(<span class=\"hljs-string\">\"/admin\"</span>) &amp;&amp; !uri.startsWith(<span class=\"hljs-string\">\"/admin/login\"</span>)) &#123;<br>            response.sendRedirect(request.getContextPath() + <span class=\"hljs-string\">\"/admin/login\"</span>);<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>        &#125;<br><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">true</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">postHandle</span><span class=\"hljs-params\">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, ModelAndView modelAndView)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>        <span class=\"hljs-comment\">//这个方法可以往request中添加一些公共的工具类给前端页面进行调用</span><br><br>    &#125;<br><br><br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">afterCompletion</span><span class=\"hljs-params\">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, Exception e)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>        <span class=\"hljs-comment\">//当请求处理完成调用</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>以上的自定义拦截器实现类中，我们实现了<code>HandlerInterceptor</code>接口，并且实现了三个方法：<code>preHandle</code>、<code>postHandle</code>、<code>afterCompletion</code>。</p>\n<p>在实际的应用中呢，我们常常可以在请求处理的前置方法<code>preHandle</code>中进行权限的验证，<code>postHandle</code>后置方法在实际的使用当中可以往request中添加一些公共的工具类给前端页面进行调用。</p>\n<h3 id=\"创建一个类WebMvcConfig实现WebMvcConfigurer接口\"><a href=\"#创建一个类WebMvcConfig实现WebMvcConfigurer接口\" class=\"headerlink\" title=\"创建一个类WebMvcConfig实现WebMvcConfigurer接口\"></a>创建一个类<code>WebMvcConfig</code>实现<code>WebMvcConfigurer</code>接口</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 向MVC中添加自定义组件</span><br><span class=\"hljs-comment\"> * Created by Donghua.Chen on 2018/4/30.</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">WebMvcConfig</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">WebMvcConfigurer</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> BaseInterceptor baseInterceptor;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">addInterceptors</span><span class=\"hljs-params\">(InterceptorRegistry registry)</span> </span>&#123;<br>        registry.addInterceptor(baseInterceptor);<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>这个类的主要作用就是将我们刚才自定义的拦截器组件添加到MVC中去。</p>\n<p>以上我们就完成了自定义拦截器的全部过程，是不是很简单呢？</p>\n","more":"<h2 id=\"什么是spring中的处理程序拦截器？\"><a href=\"#什么是spring中的处理程序拦截器？\" class=\"headerlink\" title=\"什么是spring中的处理程序拦截器？\"></a>什么是spring中的处理程序拦截器？</h2><p>要想了解拦截器在spring中的作用，我们首先要了解一下HTTP的请求执行链。</p>\n<ol>\n<li><p>DispatcherServlet捕获每一个请求；</p>\n</li>\n<li><p>DispatcherServlet将接收到的URL和相应的Controller进行映射；</p>\n</li>\n<li><p>在请求到达相应的Controller之前<strong>拦截器</strong>会进行请求处理；</p>\n</li>\n<li><p>处理完成之后进行视图的解析；</p>\n</li>\n<li><p>返回视图。</p>\n</li>\n</ol>\n<p>在第3步中，也就是今天最重要的内容，在请求到达Controller之前，请求可以被拦截器处理，这些拦截器就像过滤器。只有当URL找到对应于它们的处理器时才会调用它们。在通过拦截器(拦截器预处理，其实也可以说前置处理)进行前置处理后，请求最终到达controller。之后，发送请求生成视图。但是在这之前，拦截器还是有可能来再次处理它(拦截器后置处理)。只有在最后一次操作之后，视图解析器才能捕获数据并输出视图。</p>\n<p>处理程序映射拦截器基于<code>org.springframework.web.servlet.HandlerInterceptor</code>接口。这个接口有三个方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">HandlerInterceptor</span> </span>&#123;<br><br>  <span class=\"hljs-comment\">//请求发送到Controller之前调用</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">preHandle</span><span class=\"hljs-params\">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span><br><span class=\"hljs-function\">            <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">true</span>;<br>    &#125;<br><br>    <span class=\"hljs-comment\">//请求发送到Controller之后调用</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">postHandle</span><span class=\"hljs-params\">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">            @Nullable ModelAndView modelAndView)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>    &#125;<br><br>    <span class=\"hljs-comment\">//完成请求的处理的回调方法</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">afterCompletion</span><span class=\"hljs-params\">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">            @Nullable Exception ex)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"编写自定义的拦截器\"><a href=\"#编写自定义的拦截器\" class=\"headerlink\" title=\"编写自定义的拦截器\"></a>编写自定义的拦截器</h2><p>要想编写自定义的拦截器，需要有两个步骤：</p>\n<ul>\n<li><p>实现<code>HandlerInterceptor</code>接口和方法；</p>\n</li>\n<li><p>将自定义拦截器添加到MVC中。</p>\n</li>\n</ul>\n<p>下面我们来实现一下代码：</p>\n<h3 id=\"首先我们创建一个类BaseInterceptor\"><a href=\"#首先我们创建一个类BaseInterceptor\" class=\"headerlink\" title=\"首先我们创建一个类BaseInterceptor\"></a>首先我们创建一个类<code>BaseInterceptor</code></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 实现HandlerInterceptor接口，自定义拦截器</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">BaseInterceptor</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">HandlerInterceptor</span> </span>&#123;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> Logger LOGGE = LoggerFactory.getLogger(BaseInterceptor<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br><br>      <span class=\"hljs-comment\">//实现前置方法</span><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">preHandle</span><span class=\"hljs-params\">(HttpServletRequest request, HttpServletResponse response, Object o)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>        String uri = request.getRequestURI();<br><br>        LOGGE.info(<span class=\"hljs-string\">\"UserAgent: &#123;&#125;\"</span>, request.getHeader(USER_AGENT));<br>        LOGGE.info(<span class=\"hljs-string\">\"用户访问地址: &#123;&#125;, 来路地址: &#123;&#125;\"</span>, uri, IPKit.getIpAddrByRequest(request));<br><br><br>      <span class=\"hljs-comment\">//拦截器处理用户权限</span><br>        <span class=\"hljs-keyword\">if</span> (uri.startsWith(<span class=\"hljs-string\">\"/admin\"</span>) &amp;&amp; !uri.startsWith(<span class=\"hljs-string\">\"/admin/login\"</span>)) &#123;<br>            response.sendRedirect(request.getContextPath() + <span class=\"hljs-string\">\"/admin/login\"</span>);<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>        &#125;<br><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">true</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">postHandle</span><span class=\"hljs-params\">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, ModelAndView modelAndView)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>        <span class=\"hljs-comment\">//这个方法可以往request中添加一些公共的工具类给前端页面进行调用</span><br><br>    &#125;<br><br><br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">afterCompletion</span><span class=\"hljs-params\">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, Exception e)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>        <span class=\"hljs-comment\">//当请求处理完成调用</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>以上的自定义拦截器实现类中，我们实现了<code>HandlerInterceptor</code>接口，并且实现了三个方法：<code>preHandle</code>、<code>postHandle</code>、<code>afterCompletion</code>。</p>\n<p>在实际的应用中呢，我们常常可以在请求处理的前置方法<code>preHandle</code>中进行权限的验证，<code>postHandle</code>后置方法在实际的使用当中可以往request中添加一些公共的工具类给前端页面进行调用。</p>\n<h3 id=\"创建一个类WebMvcConfig实现WebMvcConfigurer接口\"><a href=\"#创建一个类WebMvcConfig实现WebMvcConfigurer接口\" class=\"headerlink\" title=\"创建一个类WebMvcConfig实现WebMvcConfigurer接口\"></a>创建一个类<code>WebMvcConfig</code>实现<code>WebMvcConfigurer</code>接口</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 向MVC中添加自定义组件</span><br><span class=\"hljs-comment\"> * Created by Donghua.Chen on 2018/4/30.</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">WebMvcConfig</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">WebMvcConfigurer</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> BaseInterceptor baseInterceptor;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">addInterceptors</span><span class=\"hljs-params\">(InterceptorRegistry registry)</span> </span>&#123;<br>        registry.addInterceptor(baseInterceptor);<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>这个类的主要作用就是将我们刚才自定义的拦截器组件添加到MVC中去。</p>\n<p>以上我们就完成了自定义拦截器的全部过程，是不是很简单呢？</p>","categories":[{"name":"spring","path":"api/categories/spring.json"}],"tags":[{"name":"spring","path":"api/tags/spring.json"}]}