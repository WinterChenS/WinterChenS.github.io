{"title":"springboot集成Oozie实战","slug":"2020-12-01-springboot-oozie","date":"2020-12-01T11:43:00.000Z","updated":"2022-12-01T01:32:39.783Z","comments":true,"path":"api/articles/2020-12-01-springboot-oozie.json","excerpt":null,"covers":null,"cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046755978859.jpg","content":"<p>本文将以springboot调用Oozie的API实现workflow和coordinator等任务的提交停止</p>\n<h2 id=\"前提：\"><a href=\"#前提：\" class=\"headerlink\" title=\"前提：\"></a>前提：</h2><p>关于hadoop的集成，请参考另外一篇文章，这里就过多的赘述：</p>\n<p><a href=\"https://blog.winterchen.com/2020/12/01/2020-12-01-springboot-hadoop-hdfs-mapreduce/\">springboot集成hadoop实战</a></p>\n<h2 id=\"maven坐标\"><a href=\"#maven坐标\" class=\"headerlink\" title=\"maven坐标\"></a>maven坐标</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-common<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-streaming<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-yarn-common<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">exclusions</span>&gt;</span><br>             <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">exclusion</span>&gt;</span><br>                 <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.google.guava<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>                 <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>guava<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>             <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">exclusion</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">exclusions</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-distcp<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>provided<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-mapreduce-client-core<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-hdfs<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-mapreduce-client-jobclient<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>provided<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br>\t<span class=\"hljs-comment\">&lt;!-- oozie --&gt;</span><br>     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.oozie<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>oozie-client<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>4.3.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">hdfs:</span><br>  <span class=\"hljs-attr\">hdfsPath:</span> <span class=\"hljs-string\">hdfs://bigdata-master:8020</span><br>  <span class=\"hljs-attr\">hdfsName:</span> <span class=\"hljs-string\">bigdata-master</span><br><br><span class=\"hljs-attr\">oozie:</span><br>  <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">http://bigdata-master:11000/oozie</span><br>  <span class=\"hljs-attr\">wf:</span><br>    <span class=\"hljs-attr\">application:</span><br>      <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">hdfs://bigdata-master:9000/user/oozie/workflow/hiveserver2.xml</span><br>  <span class=\"hljs-attr\">use:</span><br>    <span class=\"hljs-attr\">system:</span><br>      <span class=\"hljs-attr\">libpath:</span> <span class=\"hljs-literal\">true</span><br>  <span class=\"hljs-attr\">libpath:</span> <span class=\"hljs-string\">hdfs://bigdata-master:8020/user/oozie/share/lib</span><br>  <span class=\"hljs-attr\">callback:</span><br>    <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">http://172.16.120.29:8080/label/oozie/callback?executeType=$1\\&amp;taskType=$2\\&amp;callbackId=$3</span><br>  <span class=\"hljs-attr\">jdbc:</span><br>    <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">jdbc:hive2://192.168.150.119:10000/default</span><br>    <span class=\"hljs-attr\">password:</span><br>  <span class=\"hljs-attr\">nameNode:</span> <span class=\"hljs-string\">hdfs://bigdata-master:8020</span><br>  <span class=\"hljs-attr\">resourceManager:</span> <span class=\"hljs-string\">hdfs://bigdata-master:8088</span><br>  <span class=\"hljs-attr\">queueName:</span> <span class=\"hljs-string\">default</span><br>  <span class=\"hljs-attr\">job-tracker:</span> <span class=\"hljs-string\">bigdata-master:8032</span><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.model;<br><br><span class=\"hljs-keyword\">import</span> lombok.AllArgsConstructor;<br><span class=\"hljs-keyword\">import</span> lombok.Data;<br><span class=\"hljs-keyword\">import</span> lombok.NoArgsConstructor;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Value;<br><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Component;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/19 7:21 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span></span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">OozieConfig</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.nameNode&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String nameNode;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.job-tracker&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String jobTracker;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.resourceManager&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String resourceManager;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.queueName&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String queueName;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.url&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String url;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.wf.application.path&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String oozieApplicationPath;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.libpath&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String oozieLibPath;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.use.system.libpath&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> oozieSystemLibPath;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.jdbc.url&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String jdbcUrl;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.jdbc.password&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String password;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.callback.url&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String callbackUrl;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"基础类\"><a href=\"#基础类\" class=\"headerlink\" title=\"基础类\"></a>基础类</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/23 2:23 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span></span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">OozieConstants</span> </span>&#123;<br><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String NAME_NODE= <span class=\"hljs-string\">\"nameNode\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String RESOURCE_MANAGER = <span class=\"hljs-string\">\"resourcemanager\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String QUEUE_NAME = <span class=\"hljs-string\">\"queueName\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String ROOT_DIR = <span class=\"hljs-string\">\"rootdir\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String JOB_TRACKER = <span class=\"hljs-string\">\"jobTracker\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String JOB_OUTPUT = <span class=\"hljs-string\">\"jobOutput\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String JDBC_URL = <span class=\"hljs-string\">\"jdbcUrl\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String PASSWORD = <span class=\"hljs-string\">\"password\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String SQL_INPUT = <span class=\"hljs-string\">\"sqlInput\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String USER_NAME = <span class=\"hljs-string\">\"user.name\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String TASK_TYPE = <span class=\"hljs-string\">\"taskType\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String SHELL_FILE_NAME = <span class=\"hljs-string\">\"shellFileName\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String SHELL_FILE_PATH = <span class=\"hljs-string\">\"shellFilePath\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String CALLBACK_ID = <span class=\"hljs-string\">\"callbackId\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String WORKFLOW_ROOT = <span class=\"hljs-string\">\"workflowRoot\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String START = <span class=\"hljs-string\">\"start\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String END = <span class=\"hljs-string\">\"end\"</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.model;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.enums.FrequencyTypeEnum;<br><span class=\"hljs-keyword\">import</span> io.swagger.annotations.ApiModel;<br><span class=\"hljs-keyword\">import</span> io.swagger.annotations.ApiModelProperty;<br><span class=\"hljs-keyword\">import</span> lombok.*;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/25 6:01 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span> 定时调度任务请求</span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@EqualsAndHashCode</span>(callSuper = <span class=\"hljs-keyword\">false</span>)<br><span class=\"hljs-meta\">@ToString</span><br><span class=\"hljs-meta\">@Builder</span><br><span class=\"hljs-meta\">@ApiModel</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CoordinatorRequest</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"定时调度任务名称\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String coordName;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"定时调度任务文件路径\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String coordPath;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"频率\"</span>)<br>    <span class=\"hljs-keyword\">private</span> FrequencyTypeEnum frequencyType;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"开始时间\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String startTime;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"结束时间\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String endTime;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"workflow名称\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String wfName;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"workflow路径\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String wfPath;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"回调编号\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String callbackId;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.model;<br><br><span class=\"hljs-keyword\">import</span> io.swagger.annotations.ApiModel;<br><span class=\"hljs-keyword\">import</span> io.swagger.annotations.ApiModelProperty;<br><span class=\"hljs-keyword\">import</span> lombok.*;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/25 5:33 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span> workflow任务请求</span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@EqualsAndHashCode</span>(callSuper = <span class=\"hljs-keyword\">false</span>)<br><span class=\"hljs-meta\">@ToString</span><br><span class=\"hljs-meta\">@Builder</span><br><span class=\"hljs-meta\">@ApiModel</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">WorkflowRequest</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"workflow名称\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String wfName;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"workflow路径\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String wfPath;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"执行的sql\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String sql;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"回调编号\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String callbackId;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"功能实现\"><a href=\"#功能实现\" class=\"headerlink\" title=\"功能实现\"></a>功能实现</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.service;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.enums.FrequencyTypeEnum;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.model.CoordinatorRequest;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.model.WorkflowRequest;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/23 2:06 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span></span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">OozieService</span> </span>&#123;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Author</span> winterchen</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Description</span> 提交workflow任务</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Date</span> 6:21 下午 2020/11/25</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Param</span> [workflowRequest]</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span> java.lang.String</span><br><span class=\"hljs-comment\">     **/</span><br>    <span class=\"hljs-function\">String <span class=\"hljs-title\">submitWorkflow</span><span class=\"hljs-params\">(WorkflowRequest workflowRequest)</span></span>;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Author</span> winterchen</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Description</span> 提交coordinator任务</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Date</span> 6:21 下午 2020/11/25</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Param</span> [coordinatorRequest]</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span> java.lang.String</span><br><span class=\"hljs-comment\">     **/</span><br>    <span class=\"hljs-function\">String <span class=\"hljs-title\">submitCoordinator</span><span class=\"hljs-params\">(CoordinatorRequest coordinatorRequest)</span></span>;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Author</span> winterchen</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Description</span> 创建并上传sql文件至hdfs</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Date</span> 6:21 下午 2020/11/25</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Param</span> [sql, sqlPath]</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span> java.lang.String 文件地址</span><br><span class=\"hljs-comment\">     **/</span><br>    <span class=\"hljs-function\">String <span class=\"hljs-title\">createSqlFileAndUpload</span><span class=\"hljs-params\">(String sql, String sqlPath)</span></span>;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Author</span> winterchen</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Description</span> 创建并上传workflow任务脚本文件至hdfs</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Date</span> 6:22 下午 2020/11/25</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Param</span> [wfName, wfPath, sqlPath, callbackId]</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span> String 文件地址</span><br><span class=\"hljs-comment\">     **/</span><br>    <span class=\"hljs-function\">String <span class=\"hljs-title\">createWfFileAndUpload</span><span class=\"hljs-params\">(String wfName, String wfPath, String sqlPath, String callbackId)</span></span>;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Author</span> winterchen</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Description</span> 创建并上传coordinator定时任务脚本文件至hdfs</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Date</span> 6:23 下午 2020/11/25</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Param</span> [coordName, coordPath, wfPath, frequencyType, callbackId]</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span> String 文件地址</span><br><span class=\"hljs-comment\">     **/</span><br>    <span class=\"hljs-function\">String <span class=\"hljs-title\">createCoordFileAndUpload</span><span class=\"hljs-params\">(String coordName, String coordPath, String wfPath, FrequencyTypeEnum frequencyType, String callbackId)</span></span>;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Author</span> winterchen</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Description</span> 创建shell脚本并上传</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Date</span> 6:41 下午 2020/11/25</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Param</span> [shellFileName, shellFilePath]</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span> String 文件地址</span><br><span class=\"hljs-comment\">     **/</span><br>    <span class=\"hljs-function\">String  <span class=\"hljs-title\">createShellFileAndUpload</span><span class=\"hljs-params\">(String shellFileName, String shellFilePath)</span></span>;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Author</span> winterchen</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Description</span> 处理回调</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Date</span> 6:24 下午 2020/11/25</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Param</span> [targetType, targetId]</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span> void</span><br><span class=\"hljs-comment\">     **/</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">executeCallback</span><span class=\"hljs-params\">(String executeType, String taskType, String callbackId)</span></span>;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Author</span> winterchen</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Description</span> 停止定时调度任务</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Date</span> 6:24 下午 2020/11/25</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Param</span> [jobId]</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span> void</span><br><span class=\"hljs-comment\">     **/</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">killCoordinatorJob</span><span class=\"hljs-params\">(String jobId)</span></span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.service.impl;<br><br><span class=\"hljs-keyword\">import</span> cn.hutool.core.date.DateUtil;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.constants.OozieConstants;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.enums.FrequencyTypeEnum;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.enums.TaskTypeEnum;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.model.CoordinatorRequest;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.model.OozieConfig;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.model.WorkflowRequest;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.service.OozieService;<br><span class=\"hljs-keyword\">import</span> lombok.extern.slf4j.Slf4j;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.fs.FileSystem;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.fs.Path;<br><span class=\"hljs-keyword\">import</span> org.apache.oozie.client.*;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Service;<br><span class=\"hljs-keyword\">import</span> org.springframework.util.StringUtils;<br><br><span class=\"hljs-keyword\">import</span> java.io.IOException;<br><span class=\"hljs-keyword\">import</span> java.io.OutputStreamWriter;<br><span class=\"hljs-keyword\">import</span> java.io.Writer;<br><span class=\"hljs-keyword\">import</span> java.util.Properties;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/23 2:06 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span></span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-meta\">@Slf</span>4j<br><span class=\"hljs-meta\">@Service</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">OozieServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">OozieService</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> FileSystem fileSystem;<br><br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">final</span> OozieConfig oozieConfig;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">OozieServiceImpl</span><span class=\"hljs-params\">(OozieConfig oozieConfig)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">this</span>.oozieConfig = oozieConfig;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">submitWorkflow</span><span class=\"hljs-params\">(WorkflowRequest workflowRequest)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            OozieClient oozieClient = <span class=\"hljs-keyword\">new</span> OozieClient(oozieConfig.getUrl());<br>            oozieClient.setDebugMode(<span class=\"hljs-number\">1</span>);<br>            Path appPath = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(), workflowRequest.getWfPath().concat(workflowRequest.getWfName()).concat(<span class=\"hljs-string\">\".xml\"</span>));<br>            <span class=\"hljs-comment\">// 创建相关文件</span><br><br>            <span class=\"hljs-comment\">// 创建并上传sql文件</span><br>            String sqlPath = workflowRequest.getWfPath().concat(<span class=\"hljs-string\">\"sql/\"</span>.concat(workflowRequest.getWfName()).concat(<span class=\"hljs-string\">\"-sql.q\"</span>));<br>            createSqlFileAndUpload(workflowRequest.getSql(), sqlPath);<br><br>            <span class=\"hljs-comment\">// 创建shell脚本</span><br>            String shellFileName = workflowRequest.getWfName() + <span class=\"hljs-string\">\"-shell.sh\"</span>;<br>            String shellFilePath = workflowRequest.getWfPath().concat(workflowRequest.getWfName()).concat(<span class=\"hljs-string\">\"/shell/\"</span>);<br>            String shellPath = createShellFileAndUpload(shellFileName, shellFilePath);<br><br>            <span class=\"hljs-comment\">// 创建并上传wf脚本文件</span><br>            createWfFileAndUpload(workflowRequest.getWfName(), workflowRequest.getWfPath(), sqlPath, workflowRequest.getCallbackId());<br><br>            <span class=\"hljs-comment\">// 创建脚本任务的配置</span><br>            Properties prop = oozieClient.createConfiguration();<br>            prop.setProperty(OozieClient.APP_PATH, appPath.toString());<br>            prop.setProperty(oozieClient.LIBPATH, oozieConfig.getOozieLibPath());<br>            prop.setProperty(oozieClient.USE_SYSTEM_LIBPATH, String.valueOf(oozieConfig.isOozieSystemLibPath()));<br><br>            <span class=\"hljs-comment\">/*Set Your Application Configuration*/</span><br>            prop.setProperty(OozieConstants.NAME_NODE, oozieConfig.getNameNode());<br>            prop.setProperty(OozieConstants.JOB_TRACKER,oozieConfig.getJobTracker());<br>            Path outputPath = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(), workflowRequest.getWfPath().concat(<span class=\"hljs-string\">\"output/\"</span>));<br>            prop.setProperty(OozieConstants.JOB_OUTPUT, outputPath.toString());<br>            prop.setProperty(OozieConstants.JDBC_URL, oozieConfig.getJdbcUrl());<br>            prop.setProperty(OozieConstants.PASSWORD, StringUtils.isEmpty(oozieConfig.getPassword()) ? <span class=\"hljs-string\">\"\"</span> : oozieConfig.getPassword());<br>            prop.setProperty(OozieConstants.SQL_INPUT,workflowRequest.getWfPath().concat(<span class=\"hljs-string\">\"sql/\"</span>));<br>            prop.setProperty(OozieConstants.USER_NAME,<span class=\"hljs-string\">\"admin\"</span>);<br>            prop.setProperty(OozieConstants.TASK_TYPE, TaskTypeEnum.WORKFLOW.name());<br>            prop.setProperty(OozieConstants.SHELL_FILE_NAME,shellFileName);<br>            prop.setProperty(OozieConstants.SHELL_FILE_PATH, shellPath);<br>            prop.setProperty(OozieConstants.CALLBACK_ID, workflowRequest.getCallbackId());<br>            prop.setProperty(OozieConstants.QUEUE_NAME, oozieConfig.getQueueName());<br><br>            String jobId = oozieClient.submit(prop);<br>            oozieClient.start(jobId);<br><br>            log.debug(<span class=\"hljs-string\">\"workflow job submitted, jobId = &#123;&#125;\"</span>, jobId);<br><br>            <span class=\"hljs-keyword\">return</span> jobId;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (OozieClientException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"workflow任务提交失败\"</span> ,e);<br>        &#125;<br><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">submitCoordinator</span><span class=\"hljs-params\">(CoordinatorRequest coordinatorRequest)</span> </span>&#123;<br><br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            OozieClient oozieClient = <span class=\"hljs-keyword\">new</span> OozieClient(oozieConfig.getUrl());<br>            oozieClient.setDebugMode(<span class=\"hljs-number\">1</span>);<br>            Path rootPath = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(), coordinatorRequest.getCoordPath());<br>            Path appPath = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(), coordinatorRequest.getCoordPath()<br>                    .concat(coordinatorRequest.getCoordName()).concat(<span class=\"hljs-string\">\".xml\"</span>));<br>            Path wf = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(), coordinatorRequest.getWfPath());<br>            <span class=\"hljs-comment\">// 创建相关文件</span><br>            <span class=\"hljs-comment\">// 创建并上传定时调度任务脚本</span><br>            createCoordFileAndUpload(coordinatorRequest.getCoordName(),coordinatorRequest.getCoordPath(),<br>                    wf.toString().concat(<span class=\"hljs-string\">\"/\"</span>).concat(coordinatorRequest.getWfName()).concat(<span class=\"hljs-string\">\".xml\"</span>),coordinatorRequest.getFrequencyType(), coordinatorRequest.getCallbackId());<br><br>            <span class=\"hljs-comment\">// 创建shell脚本</span><br>            String shellFileName = coordinatorRequest.getWfName() + <span class=\"hljs-string\">\"-shell.sh\"</span>;<br>            String shellFilePath = coordinatorRequest.getWfPath().concat(coordinatorRequest.getWfName()).concat(<span class=\"hljs-string\">\"/shell/\"</span>);<br>            String shellPath = createShellFileAndUpload(shellFileName, shellFilePath);<br><br>            <span class=\"hljs-comment\">// 创建脚本任务的配置</span><br>            Properties prop = oozieClient.createConfiguration();<br>            prop.setProperty(OozieClient.COORDINATOR_APP_PATH, appPath.toString());<br>            prop.setProperty(oozieClient.LIBPATH, oozieConfig.getOozieLibPath());<br>            prop.setProperty(oozieClient.USE_SYSTEM_LIBPATH, String.valueOf(oozieConfig.isOozieSystemLibPath()));<br>            prop.setProperty(OozieConstants.JOB_TRACKER,oozieConfig.getJobTracker());<br>            prop.setProperty(OozieConstants.USER_NAME,<span class=\"hljs-string\">\"admin\"</span>);<br>            prop.setProperty(OozieConstants.WORKFLOW_ROOT, rootPath.toString());<br>            String start = DateUtil.format(DateUtil.parse(coordinatorRequest.getStartTime(), <span class=\"hljs-string\">\"yyyy-MM-dd HH:mm:ss\"</span>), <span class=\"hljs-string\">\"yyyy-MM-dd'T'HH:mm'Z'\"</span>);<br>            prop.setProperty(OozieConstants.START, start);<br>            String end = DateUtil.format(DateUtil.parse(coordinatorRequest.getEndTime(), <span class=\"hljs-string\">\"yyyy-MM-dd HH:mm:ss\"</span>), <span class=\"hljs-string\">\"yyyy-MM-dd'T'HH:mm'Z'\"</span>);<br>            prop.setProperty(OozieConstants.END, end);<br>            Path outputPath = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(), coordinatorRequest.getWfPath().concat(<span class=\"hljs-string\">\"output/\"</span>));<br>            prop.setProperty(OozieConstants.JOB_OUTPUT, outputPath.toString());<br>            prop.setProperty(OozieConstants.JDBC_URL, oozieConfig.getJdbcUrl());<br>            prop.setProperty(OozieConstants.PASSWORD, StringUtils.isEmpty(oozieConfig.getPassword()) ? <span class=\"hljs-string\">\"\"</span> : oozieConfig.getPassword());<br>            prop.setProperty(OozieConstants.SQL_INPUT,coordinatorRequest.getWfPath().concat(<span class=\"hljs-string\">\"sql/\"</span>));<br>            prop.setProperty(OozieConstants.TASK_TYPE, TaskTypeEnum.COORDINATOR.name());<br>            prop.setProperty(OozieConstants.SHELL_FILE_NAME,shellFileName);<br>            prop.setProperty(OozieConstants.SHELL_FILE_PATH, shellPath);<br>            prop.setProperty(OozieConstants.CALLBACK_ID, coordinatorRequest.getCallbackId());<br>            prop.setProperty(OozieConstants.QUEUE_NAME, oozieConfig.getQueueName());<br><br>            <span class=\"hljs-comment\">/*Set Your Application Configuration*/</span><br>            prop.setProperty(OozieConstants.NAME_NODE, oozieConfig.getNameNode());<br><br>            String jobId = oozieClient.submit(prop);<br><br>            log.debug(<span class=\"hljs-string\">\"workflow job submitted, jobId = &#123;&#125;\"</span>, jobId);<br><br>            <span class=\"hljs-keyword\">return</span> jobId;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (OozieClientException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"workflow任务提交失败\"</span> ,e);<br>        &#125;<br><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">createSqlFileAndUpload</span><span class=\"hljs-params\">(String sql, String sqlPath)</span> </span>&#123;<br>        Writer writer = <span class=\"hljs-keyword\">null</span>;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Path sqlP = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(),sqlPath);<br>            writer = <span class=\"hljs-keyword\">new</span> OutputStreamWriter(fileSystem.create(sqlP));<br><br>            writer.write(sql);<br>            <span class=\"hljs-keyword\">return</span> sqlP.toString();<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"创建sql文件失败\"</span>, e);<br>        &#125; <span class=\"hljs-keyword\">finally</span> &#123;<br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != writer) &#123;<br>                <span class=\"hljs-keyword\">try</span> &#123;<br>                    writer.close();<br>                &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>                    log.error(<span class=\"hljs-string\">\"关闭流失败\"</span>, e);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">createWfFileAndUpload</span><span class=\"hljs-params\">(String wfName, String wfPath, String sqlFileName, String callbackId)</span> </span>&#123;<br>        Writer writer = <span class=\"hljs-keyword\">null</span>;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Path wf = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(),wfPath.concat(wfName).concat(<span class=\"hljs-string\">\".xml\"</span>));<br>            writer = <span class=\"hljs-keyword\">new</span> OutputStreamWriter(fileSystem.create(wf));<br>            String wfApp =<br>                    <span class=\"hljs-string\">\"&lt;workflow-app xmlns='uri:oozie:workflow:0.4' name='\"</span> + wfName + <span class=\"hljs-string\">\"'&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;start to='my-hive2-action'/&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;action name='my-hive2-action'&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"       &lt;hive2 xmlns='uri:oozie:hive2-action:0.1'&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"           &lt;name-node&gt;$&#123;nameNode&#125;&lt;/name-node&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"           &lt;prepare&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"               &lt;delete path='$&#123;jobOutput&#125;'/&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"           &lt;/prepare&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"           &lt;configuration&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                &lt;property&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                    &lt;name&gt;mapred.compress.map.output&lt;/name&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                    &lt;value&gt;true&lt;/value&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                &lt;/property&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"           &lt;/configuration&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"           &lt;jdbc-url&gt;$&#123;jdbcUrl&#125;&lt;/jdbc-url&gt;\\n\"</span> +<br><span class=\"hljs-comment\">//                            \"           &lt;password&gt;$&#123;password&#125;&lt;/password&gt;\\n\" +</span><br>                            <span class=\"hljs-string\">\"           &lt;script&gt;\"</span> + sqlFileName + <span class=\"hljs-string\">\"&lt;/script&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"           &lt;param&gt;InputDir=$&#123;sqlInput&#125;&lt;/param&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"           &lt;param&gt;OutputDir=$&#123;jobOutput&#125;&lt;/param&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"       &lt;/hive2&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;ok to='success-action'/&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;error to='error-action'/&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;/action&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;!-- 成功回调 --&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;action name='success-action'&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;shell xmlns=\\\"uri:oozie:shell-action:0.2\\\"&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;job-tracker&gt;$&#123;jobTracker&#125;&lt;/job-tracker&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;name-node&gt;$&#123;nameNode&#125;&lt;/name-node&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;configuration&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                &lt;property&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                  &lt;name&gt;mapred.job.queue.name&lt;/name&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                  &lt;value&gt;$&#123;queueName&#125;&lt;/value&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                &lt;/property&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;/configuration&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;exec&gt;$&#123;shellFileName&#125;&lt;/exec&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;argument&gt;$&#123;taskType&#125;&lt;/argument&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;argument&gt;OK&lt;/argument&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;argument&gt;$&#123;callbackId&#125;&lt;/argument&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;file&gt;$&#123;shellFilePath&#125;#$&#123;shellFilePath&#125;&lt;/file&gt; &lt;!--Copy the executable to compute node's current working directory --&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;/shell&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;ok to='end' /&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;error to='fail' /&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;/action&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"     \\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;!-- 失败回调 --&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;action name='error-action'&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;shell xmlns=\\\"uri:oozie:shell-action:0.2\\\"&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;job-tracker&gt;$&#123;jobTracker&#125;&lt;/job-tracker&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;name-node&gt;$&#123;nameNode&#125;&lt;/name-node&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;configuration&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                &lt;property&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                  &lt;name&gt;mapred.job.queue.name&lt;/name&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                  &lt;value&gt;$&#123;queueName&#125;&lt;/value&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                &lt;/property&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;/configuration&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;exec&gt;$&#123;shellFileName&#125;&lt;/exec&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;argument&gt;$&#123;taskType&#125;&lt;/argument&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;argument&gt;FAIL&lt;/argument&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;argument&gt;$&#123;callbackId&#125;&lt;/argument&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;file&gt;$&#123;shellFilePath&#125;#$&#123;shellFilePath&#125;&lt;/file&gt; &lt;!--Copy the executable to compute node's current working directory --&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;/shell&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;ok to='end' /&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;error to='fail' /&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;/action&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;kill name='fail'&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;message&gt;执行脚本失败&lt;/message&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;/kill&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;end name='end'/&gt;\\n\"</span>   +<br>                            <span class=\"hljs-string\">\"&lt;/workflow-app&gt;\"</span>;<br>            writer.write(wfApp);<br>            <span class=\"hljs-keyword\">return</span> wf.toString();<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"创建workflow文件失败\"</span>, e);<br>        &#125; <span class=\"hljs-keyword\">finally</span> &#123;<br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != writer) &#123;<br>                <span class=\"hljs-keyword\">try</span> &#123;<br>                    writer.close();<br>                &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>                    log.error(<span class=\"hljs-string\">\"关闭流失败\"</span>, e);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">createCoordFileAndUpload</span><span class=\"hljs-params\">(String coordName, String coordPath, String wfPath, FrequencyTypeEnum frequencyType, String callbackId)</span> </span>&#123;<br>        Writer writer = <span class=\"hljs-keyword\">null</span>;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Path coord = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(),coordPath.concat(coordName).concat(<span class=\"hljs-string\">\".xml\"</span>));<br>            writer = <span class=\"hljs-keyword\">new</span> OutputStreamWriter(fileSystem.create(coord));<br>            String frequency = FrequencyTypeEnum.getExpressionByName(frequencyType.name(), <span class=\"hljs-number\">1</span>);<br>            String wfApp =<br>                    <span class=\"hljs-string\">\"&lt;coordinator-app name='\"</span> + coordName + <span class=\"hljs-string\">\"' frequency='\"</span> + frequency + <span class=\"hljs-string\">\"' start='$&#123;start&#125;' end='$&#123;end&#125;' timezone='Asia/Shanghai'\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                 xmlns='uri:oozie:coordinator:0.4'&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;action&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;workflow&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;app-path&gt;\"</span> + wfPath + <span class=\"hljs-string\">\"&lt;/app-path&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;/workflow&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;/action&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"&lt;/coordinator-app&gt;\"</span>;<br>            writer.write(wfApp);<br>            <span class=\"hljs-keyword\">return</span> coordName.toString();<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"创建coordinator文件失败\"</span>, e);<br>        &#125; <span class=\"hljs-keyword\">finally</span> &#123;<br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != writer) &#123;<br>                <span class=\"hljs-keyword\">try</span> &#123;<br>                    writer.close();<br>                &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>                    log.error(<span class=\"hljs-string\">\"关闭流失败\"</span>, e);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">createShellFileAndUpload</span><span class=\"hljs-params\">(String shellFileName, String shellFilePath)</span> </span>&#123;<br>        Writer writer = <span class=\"hljs-keyword\">null</span>;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Path shellPath = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(),shellFilePath.concat(shellFileName));<br>            writer = <span class=\"hljs-keyword\">new</span> OutputStreamWriter(fileSystem.create(shellPath));<br>            String shell =<br>                    <span class=\"hljs-string\">\"#!/bin/bash\\n\"</span> +<br>                    <span class=\"hljs-string\">\"echo 'curl \"</span> + oozieConfig.getCallbackUrl() + <span class=\"hljs-string\">\"';\\n\"</span> +<br>                    <span class=\"hljs-string\">\"curl -X GET \"</span> + oozieConfig.getCallbackUrl();<br>            writer.write(shell);<br>            <span class=\"hljs-keyword\">return</span> shellPath.toString();<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"创建shell文件失败\"</span>, e);<br>        &#125; <span class=\"hljs-keyword\">finally</span> &#123;<br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != writer) &#123;<br>                <span class=\"hljs-keyword\">try</span> &#123;<br>                    writer.close();<br>                &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>                    log.error(<span class=\"hljs-string\">\"关闭流失败\"</span>, e);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">executeCallback</span><span class=\"hljs-params\">(String executeType, String taskType, String callbackId)</span> </span>&#123;<br>        <span class=\"hljs-comment\">// TODO</span><br>        log.info(<span class=\"hljs-string\">\"回调处理，executeType=&#123;&#125;, taskType=&#123;&#125;, callbackId=&#123;&#125;\"</span>, executeType, taskType, callbackId);<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">killCoordinatorJob</span><span class=\"hljs-params\">(String jobId)</span> </span>&#123;<br>        OozieClient oozieClient = <span class=\"hljs-keyword\">new</span> OozieClient(oozieConfig.getUrl());<br>        oozieClient.setDebugMode(<span class=\"hljs-number\">1</span>);<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            oozieClient.kill(jobId);<br>        &#125; <span class=\"hljs-keyword\">catch</span> (OozieClientException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"停止定时任务失败\"</span>, e);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>注意：上面调用的hdfs的接口是本文开头提到的前提条件，请到相应的文章集成hdfs，因为这是必须的，需要将脚本文件上传到hdfs才可以在oozie中引用到脚本文件。</p>\n<p>控制器</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.controller;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.model.CoordinatorRequest;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.model.WorkflowRequest;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.service.OozieService;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.utils.APIResponse;<br><span class=\"hljs-keyword\">import</span> io.swagger.annotations.Api;<br><span class=\"hljs-keyword\">import</span> io.swagger.annotations.ApiOperation;<br><span class=\"hljs-keyword\">import</span> io.swagger.annotations.ApiParam;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.web.bind.annotation.*;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/25 11:10 上午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span> TODO</span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-meta\">@Api</span>(tags = <span class=\"hljs-string\">\"oozie调度任务\"</span>)<br><span class=\"hljs-meta\">@RequestMapping</span>(<span class=\"hljs-string\">\"/oozie\"</span>)<br><span class=\"hljs-meta\">@RestController</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">OozieController</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> OozieService oozieService;<br><br>    <span class=\"hljs-meta\">@ApiOperation</span>(<span class=\"hljs-string\">\"提交workflow任务\"</span>)<br>    <span class=\"hljs-meta\">@PostMapping</span>(<span class=\"hljs-string\">\"/job/workflow\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> APIResponse&lt;String&gt; <span class=\"hljs-title\">submitWorkflowJob</span><span class=\"hljs-params\">(</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">        @RequestBody WorkflowRequest workflowRequest</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">    )</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> APIResponse.success(oozieService.submitWorkflow(workflowRequest));<br>    &#125;<br><br>    <span class=\"hljs-meta\">@ApiOperation</span>(<span class=\"hljs-string\">\"提交coordinator定时调度任务\"</span>)<br>    <span class=\"hljs-meta\">@PostMapping</span>(<span class=\"hljs-string\">\"/job/coordinator\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> APIResponse&lt;String&gt; <span class=\"hljs-title\">submitCoordJob</span><span class=\"hljs-params\">(</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">            @RequestBody CoordinatorRequest coordinatorRequest</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">            )</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> APIResponse.success(oozieService.submitCoordinator(coordinatorRequest));<br>    &#125;<br><br>    <span class=\"hljs-meta\">@ApiOperation</span>(<span class=\"hljs-string\">\"停止定时调度任务\"</span>)<br>    <span class=\"hljs-meta\">@DeleteMapping</span>(<span class=\"hljs-string\">\"/&#123;jobId&#125;\"</span>)<br>    <span class=\"hljs-keyword\">public</span> APIResponse&lt;?&gt; killCoordJob(<br>            <span class=\"hljs-meta\">@PathVariable</span>(<span class=\"hljs-string\">\"jobId\"</span>)<br>            String jobId<br>    ) &#123;<br>        oozieService.killCoordinatorJob(jobId);<br>        <span class=\"hljs-keyword\">return</span> APIResponse.success();<br>    &#125;<br><br>    <span class=\"hljs-meta\">@ApiOperation</span>(<span class=\"hljs-string\">\"处理回调\"</span>)<br>    <span class=\"hljs-meta\">@GetMapping</span>(<span class=\"hljs-string\">\"/callback\"</span>)<br>    <span class=\"hljs-keyword\">public</span> APIResponse&lt;?&gt; executeCallback(<br>            <span class=\"hljs-meta\">@ApiParam</span>(name = <span class=\"hljs-string\">\"executeType\"</span>, value = <span class=\"hljs-string\">\"处理类型\"</span>, required = <span class=\"hljs-keyword\">true</span>)<br>            <span class=\"hljs-meta\">@RequestParam</span>(name = <span class=\"hljs-string\">\"executeType\"</span>, required = <span class=\"hljs-keyword\">true</span>)<br>                    String executeType,<br>            <span class=\"hljs-meta\">@ApiParam</span>(name = <span class=\"hljs-string\">\"taskType\"</span>, value = <span class=\"hljs-string\">\"任务类型\"</span>, required = <span class=\"hljs-keyword\">true</span>)<br>            <span class=\"hljs-meta\">@RequestParam</span>(name = <span class=\"hljs-string\">\"taskType\"</span>, required = <span class=\"hljs-keyword\">true</span>)<br>                    String taskType,<br>            <span class=\"hljs-meta\">@ApiParam</span>(name = <span class=\"hljs-string\">\"callbackId\"</span>, value = <span class=\"hljs-string\">\"回调编号\"</span>, required = <span class=\"hljs-keyword\">true</span>)<br>            <span class=\"hljs-meta\">@RequestParam</span>(name = <span class=\"hljs-string\">\"callbackId\"</span>, required = <span class=\"hljs-keyword\">true</span>)<br>            String callbackId<br>    ) &#123;<br>        oozieService.executeCallback(executeType, taskType, callbackId);<br>        <span class=\"hljs-keyword\">return</span> APIResponse.success();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>上面实现的主要功能有：提交workflow和coordinator任务，停止任务等功能；</p>\n<p>处理回调并不是必须的，可以根据业务要求来实现各种个性化功能；</p>\n<h2 id=\"源码地址\"><a href=\"#源码地址\" class=\"headerlink\" title=\"源码地址:\"></a>源码地址:</h2><p><a href=\"https://github.com/WinterChenS/springboot-learning-experience/tree/master/spring-boot-hadoop\" target=\"_blank\" rel=\"noopener\">WinterChenS/springboot-learning-experience</a></p>\n<h2 id=\"参考文档：\"><a href=\"#参考文档：\" class=\"headerlink\" title=\"参考文档：\"></a>参考文档：</h2><ul>\n<li><a href=\"https://oozie-study.readthedocs.io/en/master/Official%20Document/02.%20Example/#java-api\" target=\"_blank\" rel=\"noopener\">https://oozie-study.readthedocs.io/en/master/Official Document/02. Example/#java-api</a></li>\n<li><a href=\"https://timepasstechies.com/oozie-workflow-example-shell-action-end-end-configuration/\" target=\"_blank\" rel=\"noopener\">https://timepasstechies.com/oozie-workflow-example-shell-action-end-end-configuration/</a></li>\n<li><a href=\"https://oozie.apache.org/docs/3.1.3-incubating/DG_CommandLineTool.html\" target=\"_blank\" rel=\"noopener\">https://oozie.apache.org/docs/3.1.3-incubating/DG_CommandLineTool.html</a></li>\n<li><a href=\"https://www.programcreek.com/java-api-examples/?api=org.apache.oozie.client.OozieClient\" target=\"_blank\" rel=\"noopener\">https://www.programcreek.com/java-api-examples/?api=org.apache.oozie.client.OozieClient</a></li>\n</ul>\n","more":"<p>本文将以springboot调用Oozie的API实现workflow和coordinator等任务的提交停止</p>\n<h2 id=\"前提：\"><a href=\"#前提：\" class=\"headerlink\" title=\"前提：\"></a>前提：</h2><p>关于hadoop的集成，请参考另外一篇文章，这里就过多的赘述：</p>\n<p><a href=\"https://blog.winterchen.com/2020/12/01/2020-12-01-springboot-hadoop-hdfs-mapreduce/\">springboot集成hadoop实战</a></p>\n<h2 id=\"maven坐标\"><a href=\"#maven坐标\" class=\"headerlink\" title=\"maven坐标\"></a>maven坐标</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-common<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-streaming<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-yarn-common<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">exclusions</span>&gt;</span><br>             <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">exclusion</span>&gt;</span><br>                 <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.google.guava<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>                 <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>guava<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>             <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">exclusion</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">exclusions</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-distcp<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>provided<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-mapreduce-client-core<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-hdfs<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-mapreduce-client-jobclient<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>provided<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br>\t<span class=\"hljs-comment\">&lt;!-- oozie --&gt;</span><br>     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.oozie<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>oozie-client<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>4.3.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">hdfs:</span><br>  <span class=\"hljs-attr\">hdfsPath:</span> <span class=\"hljs-string\">hdfs://bigdata-master:8020</span><br>  <span class=\"hljs-attr\">hdfsName:</span> <span class=\"hljs-string\">bigdata-master</span><br><br><span class=\"hljs-attr\">oozie:</span><br>  <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">http://bigdata-master:11000/oozie</span><br>  <span class=\"hljs-attr\">wf:</span><br>    <span class=\"hljs-attr\">application:</span><br>      <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">hdfs://bigdata-master:9000/user/oozie/workflow/hiveserver2.xml</span><br>  <span class=\"hljs-attr\">use:</span><br>    <span class=\"hljs-attr\">system:</span><br>      <span class=\"hljs-attr\">libpath:</span> <span class=\"hljs-literal\">true</span><br>  <span class=\"hljs-attr\">libpath:</span> <span class=\"hljs-string\">hdfs://bigdata-master:8020/user/oozie/share/lib</span><br>  <span class=\"hljs-attr\">callback:</span><br>    <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">http://172.16.120.29:8080/label/oozie/callback?executeType=$1\\&amp;taskType=$2\\&amp;callbackId=$3</span><br>  <span class=\"hljs-attr\">jdbc:</span><br>    <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">jdbc:hive2://192.168.150.119:10000/default</span><br>    <span class=\"hljs-attr\">password:</span><br>  <span class=\"hljs-attr\">nameNode:</span> <span class=\"hljs-string\">hdfs://bigdata-master:8020</span><br>  <span class=\"hljs-attr\">resourceManager:</span> <span class=\"hljs-string\">hdfs://bigdata-master:8088</span><br>  <span class=\"hljs-attr\">queueName:</span> <span class=\"hljs-string\">default</span><br>  <span class=\"hljs-attr\">job-tracker:</span> <span class=\"hljs-string\">bigdata-master:8032</span><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.model;<br><br><span class=\"hljs-keyword\">import</span> lombok.AllArgsConstructor;<br><span class=\"hljs-keyword\">import</span> lombok.Data;<br><span class=\"hljs-keyword\">import</span> lombok.NoArgsConstructor;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Value;<br><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Component;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/19 7:21 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span></span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">OozieConfig</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.nameNode&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String nameNode;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.job-tracker&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String jobTracker;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.resourceManager&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String resourceManager;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.queueName&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String queueName;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.url&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String url;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.wf.application.path&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String oozieApplicationPath;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.libpath&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String oozieLibPath;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.use.system.libpath&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> oozieSystemLibPath;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.jdbc.url&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String jdbcUrl;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.jdbc.password&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String password;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.callback.url&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String callbackUrl;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"基础类\"><a href=\"#基础类\" class=\"headerlink\" title=\"基础类\"></a>基础类</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/23 2:23 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span></span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">OozieConstants</span> </span>&#123;<br><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String NAME_NODE= <span class=\"hljs-string\">\"nameNode\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String RESOURCE_MANAGER = <span class=\"hljs-string\">\"resourcemanager\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String QUEUE_NAME = <span class=\"hljs-string\">\"queueName\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String ROOT_DIR = <span class=\"hljs-string\">\"rootdir\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String JOB_TRACKER = <span class=\"hljs-string\">\"jobTracker\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String JOB_OUTPUT = <span class=\"hljs-string\">\"jobOutput\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String JDBC_URL = <span class=\"hljs-string\">\"jdbcUrl\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String PASSWORD = <span class=\"hljs-string\">\"password\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String SQL_INPUT = <span class=\"hljs-string\">\"sqlInput\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String USER_NAME = <span class=\"hljs-string\">\"user.name\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String TASK_TYPE = <span class=\"hljs-string\">\"taskType\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String SHELL_FILE_NAME = <span class=\"hljs-string\">\"shellFileName\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String SHELL_FILE_PATH = <span class=\"hljs-string\">\"shellFilePath\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String CALLBACK_ID = <span class=\"hljs-string\">\"callbackId\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String WORKFLOW_ROOT = <span class=\"hljs-string\">\"workflowRoot\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String START = <span class=\"hljs-string\">\"start\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String END = <span class=\"hljs-string\">\"end\"</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.model;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.enums.FrequencyTypeEnum;<br><span class=\"hljs-keyword\">import</span> io.swagger.annotations.ApiModel;<br><span class=\"hljs-keyword\">import</span> io.swagger.annotations.ApiModelProperty;<br><span class=\"hljs-keyword\">import</span> lombok.*;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/25 6:01 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span> 定时调度任务请求</span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@EqualsAndHashCode</span>(callSuper = <span class=\"hljs-keyword\">false</span>)<br><span class=\"hljs-meta\">@ToString</span><br><span class=\"hljs-meta\">@Builder</span><br><span class=\"hljs-meta\">@ApiModel</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CoordinatorRequest</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"定时调度任务名称\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String coordName;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"定时调度任务文件路径\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String coordPath;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"频率\"</span>)<br>    <span class=\"hljs-keyword\">private</span> FrequencyTypeEnum frequencyType;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"开始时间\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String startTime;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"结束时间\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String endTime;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"workflow名称\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String wfName;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"workflow路径\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String wfPath;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"回调编号\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String callbackId;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.model;<br><br><span class=\"hljs-keyword\">import</span> io.swagger.annotations.ApiModel;<br><span class=\"hljs-keyword\">import</span> io.swagger.annotations.ApiModelProperty;<br><span class=\"hljs-keyword\">import</span> lombok.*;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/25 5:33 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span> workflow任务请求</span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@EqualsAndHashCode</span>(callSuper = <span class=\"hljs-keyword\">false</span>)<br><span class=\"hljs-meta\">@ToString</span><br><span class=\"hljs-meta\">@Builder</span><br><span class=\"hljs-meta\">@ApiModel</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">WorkflowRequest</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"workflow名称\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String wfName;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"workflow路径\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String wfPath;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"执行的sql\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String sql;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"回调编号\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String callbackId;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"功能实现\"><a href=\"#功能实现\" class=\"headerlink\" title=\"功能实现\"></a>功能实现</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.service;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.enums.FrequencyTypeEnum;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.model.CoordinatorRequest;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.model.WorkflowRequest;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/23 2:06 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span></span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">OozieService</span> </span>&#123;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Author</span> winterchen</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Description</span> 提交workflow任务</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Date</span> 6:21 下午 2020/11/25</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Param</span> [workflowRequest]</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span> java.lang.String</span><br><span class=\"hljs-comment\">     **/</span><br>    <span class=\"hljs-function\">String <span class=\"hljs-title\">submitWorkflow</span><span class=\"hljs-params\">(WorkflowRequest workflowRequest)</span></span>;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Author</span> winterchen</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Description</span> 提交coordinator任务</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Date</span> 6:21 下午 2020/11/25</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Param</span> [coordinatorRequest]</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span> java.lang.String</span><br><span class=\"hljs-comment\">     **/</span><br>    <span class=\"hljs-function\">String <span class=\"hljs-title\">submitCoordinator</span><span class=\"hljs-params\">(CoordinatorRequest coordinatorRequest)</span></span>;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Author</span> winterchen</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Description</span> 创建并上传sql文件至hdfs</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Date</span> 6:21 下午 2020/11/25</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Param</span> [sql, sqlPath]</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span> java.lang.String 文件地址</span><br><span class=\"hljs-comment\">     **/</span><br>    <span class=\"hljs-function\">String <span class=\"hljs-title\">createSqlFileAndUpload</span><span class=\"hljs-params\">(String sql, String sqlPath)</span></span>;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Author</span> winterchen</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Description</span> 创建并上传workflow任务脚本文件至hdfs</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Date</span> 6:22 下午 2020/11/25</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Param</span> [wfName, wfPath, sqlPath, callbackId]</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span> String 文件地址</span><br><span class=\"hljs-comment\">     **/</span><br>    <span class=\"hljs-function\">String <span class=\"hljs-title\">createWfFileAndUpload</span><span class=\"hljs-params\">(String wfName, String wfPath, String sqlPath, String callbackId)</span></span>;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Author</span> winterchen</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Description</span> 创建并上传coordinator定时任务脚本文件至hdfs</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Date</span> 6:23 下午 2020/11/25</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Param</span> [coordName, coordPath, wfPath, frequencyType, callbackId]</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span> String 文件地址</span><br><span class=\"hljs-comment\">     **/</span><br>    <span class=\"hljs-function\">String <span class=\"hljs-title\">createCoordFileAndUpload</span><span class=\"hljs-params\">(String coordName, String coordPath, String wfPath, FrequencyTypeEnum frequencyType, String callbackId)</span></span>;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Author</span> winterchen</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Description</span> 创建shell脚本并上传</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Date</span> 6:41 下午 2020/11/25</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Param</span> [shellFileName, shellFilePath]</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span> String 文件地址</span><br><span class=\"hljs-comment\">     **/</span><br>    <span class=\"hljs-function\">String  <span class=\"hljs-title\">createShellFileAndUpload</span><span class=\"hljs-params\">(String shellFileName, String shellFilePath)</span></span>;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Author</span> winterchen</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Description</span> 处理回调</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Date</span> 6:24 下午 2020/11/25</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Param</span> [targetType, targetId]</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span> void</span><br><span class=\"hljs-comment\">     **/</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">executeCallback</span><span class=\"hljs-params\">(String executeType, String taskType, String callbackId)</span></span>;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Author</span> winterchen</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Description</span> 停止定时调度任务</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Date</span> 6:24 下午 2020/11/25</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Param</span> [jobId]</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span> void</span><br><span class=\"hljs-comment\">     **/</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">killCoordinatorJob</span><span class=\"hljs-params\">(String jobId)</span></span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.service.impl;<br><br><span class=\"hljs-keyword\">import</span> cn.hutool.core.date.DateUtil;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.constants.OozieConstants;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.enums.FrequencyTypeEnum;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.enums.TaskTypeEnum;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.model.CoordinatorRequest;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.model.OozieConfig;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.model.WorkflowRequest;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.service.OozieService;<br><span class=\"hljs-keyword\">import</span> lombok.extern.slf4j.Slf4j;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.fs.FileSystem;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.fs.Path;<br><span class=\"hljs-keyword\">import</span> org.apache.oozie.client.*;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Service;<br><span class=\"hljs-keyword\">import</span> org.springframework.util.StringUtils;<br><br><span class=\"hljs-keyword\">import</span> java.io.IOException;<br><span class=\"hljs-keyword\">import</span> java.io.OutputStreamWriter;<br><span class=\"hljs-keyword\">import</span> java.io.Writer;<br><span class=\"hljs-keyword\">import</span> java.util.Properties;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/23 2:06 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span></span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-meta\">@Slf</span>4j<br><span class=\"hljs-meta\">@Service</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">OozieServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">OozieService</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> FileSystem fileSystem;<br><br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">final</span> OozieConfig oozieConfig;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">OozieServiceImpl</span><span class=\"hljs-params\">(OozieConfig oozieConfig)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">this</span>.oozieConfig = oozieConfig;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">submitWorkflow</span><span class=\"hljs-params\">(WorkflowRequest workflowRequest)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            OozieClient oozieClient = <span class=\"hljs-keyword\">new</span> OozieClient(oozieConfig.getUrl());<br>            oozieClient.setDebugMode(<span class=\"hljs-number\">1</span>);<br>            Path appPath = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(), workflowRequest.getWfPath().concat(workflowRequest.getWfName()).concat(<span class=\"hljs-string\">\".xml\"</span>));<br>            <span class=\"hljs-comment\">// 创建相关文件</span><br><br>            <span class=\"hljs-comment\">// 创建并上传sql文件</span><br>            String sqlPath = workflowRequest.getWfPath().concat(<span class=\"hljs-string\">\"sql/\"</span>.concat(workflowRequest.getWfName()).concat(<span class=\"hljs-string\">\"-sql.q\"</span>));<br>            createSqlFileAndUpload(workflowRequest.getSql(), sqlPath);<br><br>            <span class=\"hljs-comment\">// 创建shell脚本</span><br>            String shellFileName = workflowRequest.getWfName() + <span class=\"hljs-string\">\"-shell.sh\"</span>;<br>            String shellFilePath = workflowRequest.getWfPath().concat(workflowRequest.getWfName()).concat(<span class=\"hljs-string\">\"/shell/\"</span>);<br>            String shellPath = createShellFileAndUpload(shellFileName, shellFilePath);<br><br>            <span class=\"hljs-comment\">// 创建并上传wf脚本文件</span><br>            createWfFileAndUpload(workflowRequest.getWfName(), workflowRequest.getWfPath(), sqlPath, workflowRequest.getCallbackId());<br><br>            <span class=\"hljs-comment\">// 创建脚本任务的配置</span><br>            Properties prop = oozieClient.createConfiguration();<br>            prop.setProperty(OozieClient.APP_PATH, appPath.toString());<br>            prop.setProperty(oozieClient.LIBPATH, oozieConfig.getOozieLibPath());<br>            prop.setProperty(oozieClient.USE_SYSTEM_LIBPATH, String.valueOf(oozieConfig.isOozieSystemLibPath()));<br><br>            <span class=\"hljs-comment\">/*Set Your Application Configuration*/</span><br>            prop.setProperty(OozieConstants.NAME_NODE, oozieConfig.getNameNode());<br>            prop.setProperty(OozieConstants.JOB_TRACKER,oozieConfig.getJobTracker());<br>            Path outputPath = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(), workflowRequest.getWfPath().concat(<span class=\"hljs-string\">\"output/\"</span>));<br>            prop.setProperty(OozieConstants.JOB_OUTPUT, outputPath.toString());<br>            prop.setProperty(OozieConstants.JDBC_URL, oozieConfig.getJdbcUrl());<br>            prop.setProperty(OozieConstants.PASSWORD, StringUtils.isEmpty(oozieConfig.getPassword()) ? <span class=\"hljs-string\">\"\"</span> : oozieConfig.getPassword());<br>            prop.setProperty(OozieConstants.SQL_INPUT,workflowRequest.getWfPath().concat(<span class=\"hljs-string\">\"sql/\"</span>));<br>            prop.setProperty(OozieConstants.USER_NAME,<span class=\"hljs-string\">\"admin\"</span>);<br>            prop.setProperty(OozieConstants.TASK_TYPE, TaskTypeEnum.WORKFLOW.name());<br>            prop.setProperty(OozieConstants.SHELL_FILE_NAME,shellFileName);<br>            prop.setProperty(OozieConstants.SHELL_FILE_PATH, shellPath);<br>            prop.setProperty(OozieConstants.CALLBACK_ID, workflowRequest.getCallbackId());<br>            prop.setProperty(OozieConstants.QUEUE_NAME, oozieConfig.getQueueName());<br><br>            String jobId = oozieClient.submit(prop);<br>            oozieClient.start(jobId);<br><br>            log.debug(<span class=\"hljs-string\">\"workflow job submitted, jobId = &#123;&#125;\"</span>, jobId);<br><br>            <span class=\"hljs-keyword\">return</span> jobId;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (OozieClientException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"workflow任务提交失败\"</span> ,e);<br>        &#125;<br><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">submitCoordinator</span><span class=\"hljs-params\">(CoordinatorRequest coordinatorRequest)</span> </span>&#123;<br><br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            OozieClient oozieClient = <span class=\"hljs-keyword\">new</span> OozieClient(oozieConfig.getUrl());<br>            oozieClient.setDebugMode(<span class=\"hljs-number\">1</span>);<br>            Path rootPath = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(), coordinatorRequest.getCoordPath());<br>            Path appPath = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(), coordinatorRequest.getCoordPath()<br>                    .concat(coordinatorRequest.getCoordName()).concat(<span class=\"hljs-string\">\".xml\"</span>));<br>            Path wf = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(), coordinatorRequest.getWfPath());<br>            <span class=\"hljs-comment\">// 创建相关文件</span><br>            <span class=\"hljs-comment\">// 创建并上传定时调度任务脚本</span><br>            createCoordFileAndUpload(coordinatorRequest.getCoordName(),coordinatorRequest.getCoordPath(),<br>                    wf.toString().concat(<span class=\"hljs-string\">\"/\"</span>).concat(coordinatorRequest.getWfName()).concat(<span class=\"hljs-string\">\".xml\"</span>),coordinatorRequest.getFrequencyType(), coordinatorRequest.getCallbackId());<br><br>            <span class=\"hljs-comment\">// 创建shell脚本</span><br>            String shellFileName = coordinatorRequest.getWfName() + <span class=\"hljs-string\">\"-shell.sh\"</span>;<br>            String shellFilePath = coordinatorRequest.getWfPath().concat(coordinatorRequest.getWfName()).concat(<span class=\"hljs-string\">\"/shell/\"</span>);<br>            String shellPath = createShellFileAndUpload(shellFileName, shellFilePath);<br><br>            <span class=\"hljs-comment\">// 创建脚本任务的配置</span><br>            Properties prop = oozieClient.createConfiguration();<br>            prop.setProperty(OozieClient.COORDINATOR_APP_PATH, appPath.toString());<br>            prop.setProperty(oozieClient.LIBPATH, oozieConfig.getOozieLibPath());<br>            prop.setProperty(oozieClient.USE_SYSTEM_LIBPATH, String.valueOf(oozieConfig.isOozieSystemLibPath()));<br>            prop.setProperty(OozieConstants.JOB_TRACKER,oozieConfig.getJobTracker());<br>            prop.setProperty(OozieConstants.USER_NAME,<span class=\"hljs-string\">\"admin\"</span>);<br>            prop.setProperty(OozieConstants.WORKFLOW_ROOT, rootPath.toString());<br>            String start = DateUtil.format(DateUtil.parse(coordinatorRequest.getStartTime(), <span class=\"hljs-string\">\"yyyy-MM-dd HH:mm:ss\"</span>), <span class=\"hljs-string\">\"yyyy-MM-dd'T'HH:mm'Z'\"</span>);<br>            prop.setProperty(OozieConstants.START, start);<br>            String end = DateUtil.format(DateUtil.parse(coordinatorRequest.getEndTime(), <span class=\"hljs-string\">\"yyyy-MM-dd HH:mm:ss\"</span>), <span class=\"hljs-string\">\"yyyy-MM-dd'T'HH:mm'Z'\"</span>);<br>            prop.setProperty(OozieConstants.END, end);<br>            Path outputPath = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(), coordinatorRequest.getWfPath().concat(<span class=\"hljs-string\">\"output/\"</span>));<br>            prop.setProperty(OozieConstants.JOB_OUTPUT, outputPath.toString());<br>            prop.setProperty(OozieConstants.JDBC_URL, oozieConfig.getJdbcUrl());<br>            prop.setProperty(OozieConstants.PASSWORD, StringUtils.isEmpty(oozieConfig.getPassword()) ? <span class=\"hljs-string\">\"\"</span> : oozieConfig.getPassword());<br>            prop.setProperty(OozieConstants.SQL_INPUT,coordinatorRequest.getWfPath().concat(<span class=\"hljs-string\">\"sql/\"</span>));<br>            prop.setProperty(OozieConstants.TASK_TYPE, TaskTypeEnum.COORDINATOR.name());<br>            prop.setProperty(OozieConstants.SHELL_FILE_NAME,shellFileName);<br>            prop.setProperty(OozieConstants.SHELL_FILE_PATH, shellPath);<br>            prop.setProperty(OozieConstants.CALLBACK_ID, coordinatorRequest.getCallbackId());<br>            prop.setProperty(OozieConstants.QUEUE_NAME, oozieConfig.getQueueName());<br><br>            <span class=\"hljs-comment\">/*Set Your Application Configuration*/</span><br>            prop.setProperty(OozieConstants.NAME_NODE, oozieConfig.getNameNode());<br><br>            String jobId = oozieClient.submit(prop);<br><br>            log.debug(<span class=\"hljs-string\">\"workflow job submitted, jobId = &#123;&#125;\"</span>, jobId);<br><br>            <span class=\"hljs-keyword\">return</span> jobId;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (OozieClientException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"workflow任务提交失败\"</span> ,e);<br>        &#125;<br><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">createSqlFileAndUpload</span><span class=\"hljs-params\">(String sql, String sqlPath)</span> </span>&#123;<br>        Writer writer = <span class=\"hljs-keyword\">null</span>;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Path sqlP = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(),sqlPath);<br>            writer = <span class=\"hljs-keyword\">new</span> OutputStreamWriter(fileSystem.create(sqlP));<br><br>            writer.write(sql);<br>            <span class=\"hljs-keyword\">return</span> sqlP.toString();<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"创建sql文件失败\"</span>, e);<br>        &#125; <span class=\"hljs-keyword\">finally</span> &#123;<br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != writer) &#123;<br>                <span class=\"hljs-keyword\">try</span> &#123;<br>                    writer.close();<br>                &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>                    log.error(<span class=\"hljs-string\">\"关闭流失败\"</span>, e);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">createWfFileAndUpload</span><span class=\"hljs-params\">(String wfName, String wfPath, String sqlFileName, String callbackId)</span> </span>&#123;<br>        Writer writer = <span class=\"hljs-keyword\">null</span>;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Path wf = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(),wfPath.concat(wfName).concat(<span class=\"hljs-string\">\".xml\"</span>));<br>            writer = <span class=\"hljs-keyword\">new</span> OutputStreamWriter(fileSystem.create(wf));<br>            String wfApp =<br>                    <span class=\"hljs-string\">\"&lt;workflow-app xmlns='uri:oozie:workflow:0.4' name='\"</span> + wfName + <span class=\"hljs-string\">\"'&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;start to='my-hive2-action'/&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;action name='my-hive2-action'&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"       &lt;hive2 xmlns='uri:oozie:hive2-action:0.1'&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"           &lt;name-node&gt;$&#123;nameNode&#125;&lt;/name-node&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"           &lt;prepare&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"               &lt;delete path='$&#123;jobOutput&#125;'/&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"           &lt;/prepare&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"           &lt;configuration&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                &lt;property&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                    &lt;name&gt;mapred.compress.map.output&lt;/name&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                    &lt;value&gt;true&lt;/value&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                &lt;/property&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"           &lt;/configuration&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"           &lt;jdbc-url&gt;$&#123;jdbcUrl&#125;&lt;/jdbc-url&gt;\\n\"</span> +<br><span class=\"hljs-comment\">//                            \"           &lt;password&gt;$&#123;password&#125;&lt;/password&gt;\\n\" +</span><br>                            <span class=\"hljs-string\">\"           &lt;script&gt;\"</span> + sqlFileName + <span class=\"hljs-string\">\"&lt;/script&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"           &lt;param&gt;InputDir=$&#123;sqlInput&#125;&lt;/param&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"           &lt;param&gt;OutputDir=$&#123;jobOutput&#125;&lt;/param&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"       &lt;/hive2&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;ok to='success-action'/&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;error to='error-action'/&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;/action&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;!-- 成功回调 --&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;action name='success-action'&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;shell xmlns=\\\"uri:oozie:shell-action:0.2\\\"&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;job-tracker&gt;$&#123;jobTracker&#125;&lt;/job-tracker&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;name-node&gt;$&#123;nameNode&#125;&lt;/name-node&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;configuration&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                &lt;property&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                  &lt;name&gt;mapred.job.queue.name&lt;/name&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                  &lt;value&gt;$&#123;queueName&#125;&lt;/value&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                &lt;/property&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;/configuration&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;exec&gt;$&#123;shellFileName&#125;&lt;/exec&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;argument&gt;$&#123;taskType&#125;&lt;/argument&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;argument&gt;OK&lt;/argument&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;argument&gt;$&#123;callbackId&#125;&lt;/argument&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;file&gt;$&#123;shellFilePath&#125;#$&#123;shellFilePath&#125;&lt;/file&gt; &lt;!--Copy the executable to compute node's current working directory --&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;/shell&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;ok to='end' /&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;error to='fail' /&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;/action&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"     \\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;!-- 失败回调 --&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;action name='error-action'&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;shell xmlns=\\\"uri:oozie:shell-action:0.2\\\"&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;job-tracker&gt;$&#123;jobTracker&#125;&lt;/job-tracker&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;name-node&gt;$&#123;nameNode&#125;&lt;/name-node&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;configuration&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                &lt;property&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                  &lt;name&gt;mapred.job.queue.name&lt;/name&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                  &lt;value&gt;$&#123;queueName&#125;&lt;/value&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                &lt;/property&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;/configuration&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;exec&gt;$&#123;shellFileName&#125;&lt;/exec&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;argument&gt;$&#123;taskType&#125;&lt;/argument&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;argument&gt;FAIL&lt;/argument&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;argument&gt;$&#123;callbackId&#125;&lt;/argument&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;file&gt;$&#123;shellFilePath&#125;#$&#123;shellFilePath&#125;&lt;/file&gt; &lt;!--Copy the executable to compute node's current working directory --&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;/shell&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;ok to='end' /&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;error to='fail' /&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;/action&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;kill name='fail'&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;message&gt;执行脚本失败&lt;/message&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;/kill&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;end name='end'/&gt;\\n\"</span>   +<br>                            <span class=\"hljs-string\">\"&lt;/workflow-app&gt;\"</span>;<br>            writer.write(wfApp);<br>            <span class=\"hljs-keyword\">return</span> wf.toString();<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"创建workflow文件失败\"</span>, e);<br>        &#125; <span class=\"hljs-keyword\">finally</span> &#123;<br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != writer) &#123;<br>                <span class=\"hljs-keyword\">try</span> &#123;<br>                    writer.close();<br>                &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>                    log.error(<span class=\"hljs-string\">\"关闭流失败\"</span>, e);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">createCoordFileAndUpload</span><span class=\"hljs-params\">(String coordName, String coordPath, String wfPath, FrequencyTypeEnum frequencyType, String callbackId)</span> </span>&#123;<br>        Writer writer = <span class=\"hljs-keyword\">null</span>;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Path coord = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(),coordPath.concat(coordName).concat(<span class=\"hljs-string\">\".xml\"</span>));<br>            writer = <span class=\"hljs-keyword\">new</span> OutputStreamWriter(fileSystem.create(coord));<br>            String frequency = FrequencyTypeEnum.getExpressionByName(frequencyType.name(), <span class=\"hljs-number\">1</span>);<br>            String wfApp =<br>                    <span class=\"hljs-string\">\"&lt;coordinator-app name='\"</span> + coordName + <span class=\"hljs-string\">\"' frequency='\"</span> + frequency + <span class=\"hljs-string\">\"' start='$&#123;start&#125;' end='$&#123;end&#125;' timezone='Asia/Shanghai'\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                 xmlns='uri:oozie:coordinator:0.4'&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;action&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;workflow&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;app-path&gt;\"</span> + wfPath + <span class=\"hljs-string\">\"&lt;/app-path&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;/workflow&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;/action&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"&lt;/coordinator-app&gt;\"</span>;<br>            writer.write(wfApp);<br>            <span class=\"hljs-keyword\">return</span> coordName.toString();<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"创建coordinator文件失败\"</span>, e);<br>        &#125; <span class=\"hljs-keyword\">finally</span> &#123;<br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != writer) &#123;<br>                <span class=\"hljs-keyword\">try</span> &#123;<br>                    writer.close();<br>                &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>                    log.error(<span class=\"hljs-string\">\"关闭流失败\"</span>, e);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">createShellFileAndUpload</span><span class=\"hljs-params\">(String shellFileName, String shellFilePath)</span> </span>&#123;<br>        Writer writer = <span class=\"hljs-keyword\">null</span>;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Path shellPath = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(),shellFilePath.concat(shellFileName));<br>            writer = <span class=\"hljs-keyword\">new</span> OutputStreamWriter(fileSystem.create(shellPath));<br>            String shell =<br>                    <span class=\"hljs-string\">\"#!/bin/bash\\n\"</span> +<br>                    <span class=\"hljs-string\">\"echo 'curl \"</span> + oozieConfig.getCallbackUrl() + <span class=\"hljs-string\">\"';\\n\"</span> +<br>                    <span class=\"hljs-string\">\"curl -X GET \"</span> + oozieConfig.getCallbackUrl();<br>            writer.write(shell);<br>            <span class=\"hljs-keyword\">return</span> shellPath.toString();<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"创建shell文件失败\"</span>, e);<br>        &#125; <span class=\"hljs-keyword\">finally</span> &#123;<br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != writer) &#123;<br>                <span class=\"hljs-keyword\">try</span> &#123;<br>                    writer.close();<br>                &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>                    log.error(<span class=\"hljs-string\">\"关闭流失败\"</span>, e);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">executeCallback</span><span class=\"hljs-params\">(String executeType, String taskType, String callbackId)</span> </span>&#123;<br>        <span class=\"hljs-comment\">// TODO</span><br>        log.info(<span class=\"hljs-string\">\"回调处理，executeType=&#123;&#125;, taskType=&#123;&#125;, callbackId=&#123;&#125;\"</span>, executeType, taskType, callbackId);<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">killCoordinatorJob</span><span class=\"hljs-params\">(String jobId)</span> </span>&#123;<br>        OozieClient oozieClient = <span class=\"hljs-keyword\">new</span> OozieClient(oozieConfig.getUrl());<br>        oozieClient.setDebugMode(<span class=\"hljs-number\">1</span>);<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            oozieClient.kill(jobId);<br>        &#125; <span class=\"hljs-keyword\">catch</span> (OozieClientException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"停止定时任务失败\"</span>, e);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>注意：上面调用的hdfs的接口是本文开头提到的前提条件，请到相应的文章集成hdfs，因为这是必须的，需要将脚本文件上传到hdfs才可以在oozie中引用到脚本文件。</p>\n<p>控制器</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.controller;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.model.CoordinatorRequest;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.model.WorkflowRequest;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.service.OozieService;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.utils.APIResponse;<br><span class=\"hljs-keyword\">import</span> io.swagger.annotations.Api;<br><span class=\"hljs-keyword\">import</span> io.swagger.annotations.ApiOperation;<br><span class=\"hljs-keyword\">import</span> io.swagger.annotations.ApiParam;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.web.bind.annotation.*;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/25 11:10 上午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span> TODO</span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-meta\">@Api</span>(tags = <span class=\"hljs-string\">\"oozie调度任务\"</span>)<br><span class=\"hljs-meta\">@RequestMapping</span>(<span class=\"hljs-string\">\"/oozie\"</span>)<br><span class=\"hljs-meta\">@RestController</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">OozieController</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> OozieService oozieService;<br><br>    <span class=\"hljs-meta\">@ApiOperation</span>(<span class=\"hljs-string\">\"提交workflow任务\"</span>)<br>    <span class=\"hljs-meta\">@PostMapping</span>(<span class=\"hljs-string\">\"/job/workflow\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> APIResponse&lt;String&gt; <span class=\"hljs-title\">submitWorkflowJob</span><span class=\"hljs-params\">(</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">        @RequestBody WorkflowRequest workflowRequest</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">    )</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> APIResponse.success(oozieService.submitWorkflow(workflowRequest));<br>    &#125;<br><br>    <span class=\"hljs-meta\">@ApiOperation</span>(<span class=\"hljs-string\">\"提交coordinator定时调度任务\"</span>)<br>    <span class=\"hljs-meta\">@PostMapping</span>(<span class=\"hljs-string\">\"/job/coordinator\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> APIResponse&lt;String&gt; <span class=\"hljs-title\">submitCoordJob</span><span class=\"hljs-params\">(</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">            @RequestBody CoordinatorRequest coordinatorRequest</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">            )</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> APIResponse.success(oozieService.submitCoordinator(coordinatorRequest));<br>    &#125;<br><br>    <span class=\"hljs-meta\">@ApiOperation</span>(<span class=\"hljs-string\">\"停止定时调度任务\"</span>)<br>    <span class=\"hljs-meta\">@DeleteMapping</span>(<span class=\"hljs-string\">\"/&#123;jobId&#125;\"</span>)<br>    <span class=\"hljs-keyword\">public</span> APIResponse&lt;?&gt; killCoordJob(<br>            <span class=\"hljs-meta\">@PathVariable</span>(<span class=\"hljs-string\">\"jobId\"</span>)<br>            String jobId<br>    ) &#123;<br>        oozieService.killCoordinatorJob(jobId);<br>        <span class=\"hljs-keyword\">return</span> APIResponse.success();<br>    &#125;<br><br>    <span class=\"hljs-meta\">@ApiOperation</span>(<span class=\"hljs-string\">\"处理回调\"</span>)<br>    <span class=\"hljs-meta\">@GetMapping</span>(<span class=\"hljs-string\">\"/callback\"</span>)<br>    <span class=\"hljs-keyword\">public</span> APIResponse&lt;?&gt; executeCallback(<br>            <span class=\"hljs-meta\">@ApiParam</span>(name = <span class=\"hljs-string\">\"executeType\"</span>, value = <span class=\"hljs-string\">\"处理类型\"</span>, required = <span class=\"hljs-keyword\">true</span>)<br>            <span class=\"hljs-meta\">@RequestParam</span>(name = <span class=\"hljs-string\">\"executeType\"</span>, required = <span class=\"hljs-keyword\">true</span>)<br>                    String executeType,<br>            <span class=\"hljs-meta\">@ApiParam</span>(name = <span class=\"hljs-string\">\"taskType\"</span>, value = <span class=\"hljs-string\">\"任务类型\"</span>, required = <span class=\"hljs-keyword\">true</span>)<br>            <span class=\"hljs-meta\">@RequestParam</span>(name = <span class=\"hljs-string\">\"taskType\"</span>, required = <span class=\"hljs-keyword\">true</span>)<br>                    String taskType,<br>            <span class=\"hljs-meta\">@ApiParam</span>(name = <span class=\"hljs-string\">\"callbackId\"</span>, value = <span class=\"hljs-string\">\"回调编号\"</span>, required = <span class=\"hljs-keyword\">true</span>)<br>            <span class=\"hljs-meta\">@RequestParam</span>(name = <span class=\"hljs-string\">\"callbackId\"</span>, required = <span class=\"hljs-keyword\">true</span>)<br>            String callbackId<br>    ) &#123;<br>        oozieService.executeCallback(executeType, taskType, callbackId);<br>        <span class=\"hljs-keyword\">return</span> APIResponse.success();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>上面实现的主要功能有：提交workflow和coordinator任务，停止任务等功能；</p>\n<p>处理回调并不是必须的，可以根据业务要求来实现各种个性化功能；</p>\n<h2 id=\"源码地址\"><a href=\"#源码地址\" class=\"headerlink\" title=\"源码地址:\"></a>源码地址:</h2><p><a href=\"https://github.com/WinterChenS/springboot-learning-experience/tree/master/spring-boot-hadoop\" target=\"_blank\" rel=\"noopener\">WinterChenS/springboot-learning-experience</a></p>\n<h2 id=\"参考文档：\"><a href=\"#参考文档：\" class=\"headerlink\" title=\"参考文档：\"></a>参考文档：</h2><ul>\n<li><a href=\"https://oozie-study.readthedocs.io/en/master/Official%20Document/02.%20Example/#java-api\" target=\"_blank\" rel=\"noopener\">https://oozie-study.readthedocs.io/en/master/Official Document/02. Example/#java-api</a></li>\n<li><a href=\"https://timepasstechies.com/oozie-workflow-example-shell-action-end-end-configuration/\" target=\"_blank\" rel=\"noopener\">https://timepasstechies.com/oozie-workflow-example-shell-action-end-end-configuration/</a></li>\n<li><a href=\"https://oozie.apache.org/docs/3.1.3-incubating/DG_CommandLineTool.html\" target=\"_blank\" rel=\"noopener\">https://oozie.apache.org/docs/3.1.3-incubating/DG_CommandLineTool.html</a></li>\n<li><a href=\"https://www.programcreek.com/java-api-examples/?api=org.apache.oozie.client.OozieClient\" target=\"_blank\" rel=\"noopener\">https://www.programcreek.com/java-api-examples/?api=org.apache.oozie.client.OozieClient</a></li>\n</ul>\n","categories":[{"name":"hadoop","path":"api/categories/hadoop.json"}],"tags":[{"name":"hadoop","path":"api/tags/hadoop.json"},{"name":"springboot","path":"api/tags/springboot.json"},{"name":"oozie","path":"api/tags/oozie.json"}]}