{"title":"Java使用mpxj导入.mpp格式的Project文件（甘特图）","slug":"java-read-mpp-file","date":"2018-01-18T14:00:00.000Z","updated":"2022-12-01T01:32:39.787Z","comments":true,"path":"api/articles/java-read-mpp-file.json","excerpt":" [Figure] 最近换工作了，主要的项目都是企业内部为支撑的管理平台，刚入入职没多久，遇到了一个需求，就是导入微软的Project文件，踩过不少坑，所以记录一下，后续还有从数据库导出Project引导文件，也就是xml文件","covers":["data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==","data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==","data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="],"cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046772682398.jpg","content":"<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046772877237.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<blockquote>\n<p>最近换工作了，主要的项目都是企业内部为支撑的管理平台，刚入入职没多久，遇到了一个需求，就是导入微软的Project文件，踩过不少坑，所以记录一下，后续还有从数据库导出Project引导文件，也就是xml文件</p>\n</blockquote>\n<a id=\"more\"></a>\n\n<p><img    class=\"lazyload\" data-original=\"http://img.blog.csdn.net/20180117180051197?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvV2ludGVyX2NoZW4wMDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">这里写图片描述</span></p>\n<h2 id=\"依赖\"><a href=\"#依赖\" class=\"headerlink\" title=\"依赖\"></a>依赖</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">&lt;!-- 读取project文件 --&gt;<br>&lt;dependency&gt;<br>\t&lt;groupId&gt;net.sf.mpxj&lt;&#x2F;groupId&gt;<br>\t&lt;artifactId&gt;mpxj&lt;&#x2F;artifactId&gt;<br>\t&lt;version&gt;7.1.0&lt;&#x2F;version&gt;<br>&lt;&#x2F;dependency&gt;<br></code></pre></td></tr></table></figure>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><p> 博主使用的读取方式是递归读取的，无论Project文件中的任务有多少层，都可以读到，好了，直接看代码，注意看注释：</p>\n<h3 id=\"核心方法\"><a href=\"#核心方法\" class=\"headerlink\" title=\"核心方法\"></a>核心方法</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><br><span class=\"hljs-meta\">@Transactional</span><br>   <span class=\"hljs-meta\">@Override</span><br>   <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">readMmpFileToDB</span><span class=\"hljs-params\">(File file)</span> </span>&#123;<span class=\"hljs-comment\">//如果读取的是MultipartFile，那么直接使用获取InputStream即可</span><br>       <span class=\"hljs-keyword\">try</span>&#123;<br>       \t<span class=\"hljs-comment\">//这个是读取文件的组件</span><br>           MPPReader mppRead = <span class=\"hljs-keyword\">new</span> MPPReader();<br>           <span class=\"hljs-comment\">//注意，如果在这一步出现了读取异常，肯定是版本不兼容，换个版本试试</span><br>           ProjectFile pf = mppRead.read(file);<br>           <span class=\"hljs-comment\">//从文件中获取的任务对象</span><br>           List&lt;Task&gt; tasks = pf.getChildTasks();<br>           <span class=\"hljs-comment\">//这个可以不用，这个list只是我用来装下所有的数据，如果不需要可以不使用</span><br>           List&lt;Project&gt; proList = <span class=\"hljs-keyword\">new</span> LinkedList&lt;&gt;();<br>           <span class=\"hljs-comment\">//这个是用来封装任务的对象，为了便于区别，初始化批次号，然后所有读取的数据都需要加上批次号</span><br>           Project pro = <span class=\"hljs-keyword\">new</span> Project();<br>           pro.setBatchNum(StringUtils.UUID());<span class=\"hljs-comment\">//生成批次号UUID</span><br>           <span class=\"hljs-comment\">//这个方法是一个递归方法</span><br>           getChildrenTask(tasks.get(<span class=\"hljs-number\">0</span>), pro ,proList, <span class=\"hljs-number\">0</span>);<br>       &#125;<span class=\"hljs-keyword\">catch</span> (MPXJException e) &#123;<br>           logger.error(e.getMessage());<br>           <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> RuntimeException();<br>       &#125; <span class=\"hljs-keyword\">catch</span> (Exception e) &#123;<br>           logger.error(e.getMessage());<br>           <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> RuntimeException();<br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"> <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 这个方法是一个递归</span><br><span class=\"hljs-comment\"> * 方法的原理：进行读取父任务，如果下一层任务还是父任务，那么继续调用当前方法，如果到了最后一层，调用另外一个读取底层的方法</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> task</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> project</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> list</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> levelNum</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">getChildrenTask</span><span class=\"hljs-params\">(Task task, Project project, List&lt;Project&gt; list, <span class=\"hljs-keyword\">int</span> levelNum)</span></span>&#123;<br>        <span class=\"hljs-keyword\">if</span>(task.getResourceAssignments().size() == <span class=\"hljs-number\">0</span>)&#123;<span class=\"hljs-comment\">//这个判断是进行是否是最后一层任务的判断==0说明是父任务</span><br>            levelNum ++;<span class=\"hljs-comment\">//层级号需要增加，这个只是博主用来记录该层的层级数</span><br>            List&lt;Task&gt; tasks = task.getChildTasks();<span class=\"hljs-comment\">//继续获取子任务</span><br>            <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; tasks.size(); i++) &#123;<span class=\"hljs-comment\">//该循环是遍历所有的子任务</span><br>                <span class=\"hljs-keyword\">if</span>(tasks.get(i).getResourceAssignments().size() == <span class=\"hljs-number\">0</span>)&#123;<span class=\"hljs-comment\">//说明还是在父任务层</span><br>                    Project pro = <span class=\"hljs-keyword\">new</span> Project();<br>                    <span class=\"hljs-keyword\">if</span> (project.getProjId() != <span class=\"hljs-keyword\">null</span>)&#123;<span class=\"hljs-comment\">//说明不是第一次读取了，因为如果是第一层，那么还没有进行数据库的添加，没有返回主键Id</span><br>                        pro.setParentId(project.getProjId());<span class=\"hljs-comment\">//将上一级目录的Id赋值给下一级的ParentId</span><br>                    &#125;<br>                    pro.setBatchNum(project.getBatchNum());<span class=\"hljs-comment\">//批量号</span><br>                    pro.setImportTime(<span class=\"hljs-keyword\">new</span> Date());<span class=\"hljs-comment\">//导入时间</span><br>                    pro.setLevel(levelNum);<span class=\"hljs-comment\">//层级</span><br>                    pro.setTaskName(tasks.get(i).getName());<span class=\"hljs-comment\">//这个是获取文件中的“任务名称”列的数据</span><br>                    pro.setDurationDate(tasks.get(i).getDuration().toString());<span class=\"hljs-comment\">//获取的是文件中的“工期”</span><br>                    pro.setStartDate(tasks.get(i).getStart());<span class=\"hljs-comment\">//获取文件中的 “开始时间”</span><br>                    pro.setEndDate(tasks.get(i).getFinish());<span class=\"hljs-comment\">//获取文件中的 “完成时间”</span><br>                    pro.setResource(tasks.get(i).getResourceGroup());<span class=\"hljs-comment\">//获取文件中的 “资源名称”</span><br>                    <span class=\"hljs-keyword\">this</span>.addProjectInfo(pro);<span class=\"hljs-comment\">//将该条数据添加到数据库，并且会返回主键Id，用做子任务的ParentId,这个需要在mybatis的Mapper中设置</span><br>                    getChildrenTask(tasks.get(i), pro,list,levelNum);<span class=\"hljs-comment\">//继续进行递归，当前保存的只是父任务的信息</span><br>                &#125;<span class=\"hljs-keyword\">else</span>&#123;<span class=\"hljs-comment\">//继续进行递归</span><br>                    getChildrenTask(tasks.get(i), project, list, levelNum);<br>                &#125;<br>            &#125;<br>        &#125;<span class=\"hljs-keyword\">else</span>&#123;<span class=\"hljs-comment\">//说明已经到了最底层的子任务了，那么就调用进行最底层数据读取的方法</span><br>            <span class=\"hljs-keyword\">if</span> (project.getProjId() != <span class=\"hljs-keyword\">null</span>)&#123;<br>                getResourceAssignment(task, project, list, levelNum);<br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">getResourceAssignment</span><span class=\"hljs-params\">(Task task, Project project, List&lt;Project&gt; proList, <span class=\"hljs-keyword\">int</span> levelNum)</span></span>&#123;<br>    List&lt;ResourceAssignment&gt; list = task.getResourceAssignments();<span class=\"hljs-comment\">//读取最底层的属性</span><br>    ResourceAssignment rs = list.get(<span class=\"hljs-number\">0</span>);<br>    Project pro = <span class=\"hljs-keyword\">new</span> Project();<br>    pro.setTaskName(task.getName());<br>    pro.setParentId(project.getProjId());<br>    pro.setLevel(levelNum);<br>    pro.setImportTime(<span class=\"hljs-keyword\">new</span> Date());<br>    pro.setBatchNum(project.getBatchNum());<br>    pro.setDurationDate(task.getDuration().toString());<br>    pro.setStartDate(rs.getStart());<span class=\"hljs-comment\">//注意，这个从ResourceAssignment中读取</span><br>    pro.setEndDate(rs.getFinish());<span class=\"hljs-comment\">//同上</span><br>    String resource = <span class=\"hljs-string\">\"\"</span>;<br>    <span class=\"hljs-keyword\">if</span>(list.size() &gt; <span class=\"hljs-number\">1</span>)&#123;<br>        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; list.size(); i++) &#123;<br>            <span class=\"hljs-keyword\">if</span> (list.get(i).getResource() != <span class=\"hljs-keyword\">null</span>)&#123;<br>                <span class=\"hljs-keyword\">if</span>(i &lt; list.size() - <span class=\"hljs-number\">1</span>)&#123;<br>                    resource += list.get(i).getResource().getName() + <span class=\"hljs-string\">\",\"</span>;<br>                &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>                    resource += list.get(i).getResource().getName();<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<span class=\"hljs-keyword\">else</span>&#123;<br><br>        <span class=\"hljs-keyword\">if</span>(list.size() &gt; <span class=\"hljs-number\">0</span> &amp;&amp; list.get(<span class=\"hljs-number\">0</span>).getResource() != <span class=\"hljs-keyword\">null</span>)&#123;<br>            resource = list.get(<span class=\"hljs-number\">0</span>).getResource().getName();<br>        &#125;<br>    &#125;<br>    <span class=\"hljs-keyword\">if</span>(!StringUtils.isEmpty(resource))&#123;<br>        pro.setResource(resource);<br>    &#125;<br>    <span class=\"hljs-keyword\">this</span>.addProjectInfo(pro);<span class=\"hljs-comment\">//将数据保存在数据库中,同样会返回主键</span><br>    proList.add(pro);<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n<h3 id=\"封装对象\"><a href=\"#封装对象\" class=\"headerlink\" title=\"封装对象\"></a>封装对象</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><br><span class=\"hljs-keyword\">package</span> com.winter.model;<br><br><span class=\"hljs-keyword\">import</span> java.util.Date;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * Project文件封装类</span><br><span class=\"hljs-comment\"> * Created By Donghua.Chen on  2018/1/9</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Project</span> </span>&#123;<br>    <span class=\"hljs-comment\">/* 自增主键Id */</span><br>    <span class=\"hljs-keyword\">private</span> Integer projId;<br>    <span class=\"hljs-comment\">/* 上级Id */</span><br>    <span class=\"hljs-keyword\">private</span> Integer parentId;<br>    <span class=\"hljs-comment\">/* 结构层级 */</span><br>    <span class=\"hljs-keyword\">private</span> Integer level;<br>    <span class=\"hljs-comment\">/* 任务名称 */</span><br>    <span class=\"hljs-keyword\">private</span> String taskName;<br>    <span class=\"hljs-comment\">/* 工期 */</span><br>    <span class=\"hljs-keyword\">private</span> String durationDate;<br>    <span class=\"hljs-comment\">/* 开始时间 */</span><br>    <span class=\"hljs-keyword\">private</span> Date startDate;<br>    <span class=\"hljs-comment\">/* 结束时间 */</span><br>    <span class=\"hljs-keyword\">private</span> Date endDate;<br>    <span class=\"hljs-comment\">/* 前置任务ID */</span><br>    <span class=\"hljs-keyword\">private</span> Integer preTask;<br>    <span class=\"hljs-comment\">/* 资源名称 */</span><br>    <span class=\"hljs-keyword\">private</span> String resource;<br>    <span class=\"hljs-comment\">/* 导入时间 */</span><br>    <span class=\"hljs-keyword\">private</span> Date importTime;<br>    <span class=\"hljs-comment\">/* 批次号 */</span><br>    <span class=\"hljs-keyword\">private</span> String batchNum;<br><br>    <span class=\"hljs-comment\">//省略get、set方法</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"Mybatis-接口方法\"><a href=\"#Mybatis-接口方法\" class=\"headerlink\" title=\"Mybatis 接口方法\"></a>Mybatis 接口方法</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * 插入project数据</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@param</span> project</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span></span><br><span class=\"hljs-comment\">     */</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">addProjectSelective</span><span class=\"hljs-params\">(Project project)</span></span>;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"Mapper\"><a href=\"#Mapper\" class=\"headerlink\" title=\"Mapper\"></a>Mapper</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sql</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"TABLE_PROJECT\"</span>&gt;</span><br>  PROJECT<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sql</span>&gt;</span><br><br><span class=\"hljs-comment\">&lt;!-- 插入数据之后返回主键 需要这两个配置： useGeneratedKeys=\"true\" keyProperty=\"projId\" --&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">insert</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"addProjectSelective\"</span> <span class=\"hljs-attr\">useGeneratedKeys</span>=<span class=\"hljs-string\">\"true\"</span> <span class=\"hljs-attr\">keyProperty</span>=<span class=\"hljs-string\">\"projId\"</span> <span class=\"hljs-attr\">parameterType</span>=<span class=\"hljs-string\">\"com.winter.model.Project\"</span>&gt;</span><br>    INSERT INTO<br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">include</span> <span class=\"hljs-attr\">refid</span>=<span class=\"hljs-string\">\"TABLE_PROJECT\"</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">trim</span> <span class=\"hljs-attr\">prefix</span>=<span class=\"hljs-string\">\"(\"</span> <span class=\"hljs-attr\">suffix</span>=<span class=\"hljs-string\">\")\"</span> <span class=\"hljs-attr\">suffixOverrides</span>=<span class=\"hljs-string\">\",\"</span> &gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"parentId != null\"</span>&gt;</span><br>            parentId,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"level != null\"</span>&gt;</span><br>            level,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"taskName != null\"</span>&gt;</span><br>            taskName,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"durationDate != null\"</span>&gt;</span><br>            durationDate,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"startDate != null\"</span>&gt;</span><br>            startDate,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"endDate != null\"</span>&gt;</span><br>            endDate,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"preTask != null\"</span>&gt;</span><br>            preTask,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"resource != null\"</span>&gt;</span><br>            resource,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"importTime != null\"</span>&gt;</span><br>            importTime,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"importTime != null\"</span>&gt;</span><br>            batchNum,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">trim</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">trim</span> <span class=\"hljs-attr\">prefix</span>=<span class=\"hljs-string\">\"values (\"</span> <span class=\"hljs-attr\">suffix</span>=<span class=\"hljs-string\">\")\"</span> <span class=\"hljs-attr\">suffixOverrides</span>=<span class=\"hljs-string\">\",\"</span> &gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"parentId != null\"</span>&gt;</span><br>            #&#123;parentId, jdbcType=INTEGER&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"level != null\"</span>&gt;</span><br>            #&#123;level, jdbcType=INTEGER&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"taskName != null\"</span>&gt;</span><br>            #&#123;taskName, jdbcType=VARCHAR&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"durationDate != null\"</span>&gt;</span><br>            #&#123;durationDate, jdbcType=VARCHAR&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"startDate != null\"</span>&gt;</span><br>            #&#123;startDate, jdbcType=DATE&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"endDate != null\"</span>&gt;</span><br>            #&#123;endDate, jdbcType=DATE&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"preTask != null\"</span>&gt;</span><br>            #&#123;preTask, jdbcType=INTEGER&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"resource != null\"</span>&gt;</span><br>            #&#123;resource, jdbcType=VARCHAR&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"importTime != null\"</span>&gt;</span><br>            #&#123;importTime, jdbcType=DATE&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"batchNum != null\"</span>&gt;</span><br>            #&#123;batchNum, jdbcType=VARCHAR&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">trim</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">insert</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"效果\"><a href=\"#效果\" class=\"headerlink\" title=\"效果\"></a>效果</h2><p><img    class=\"lazyload\" data-original=\"http://img.blog.csdn.net/20180117180307631?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvV2ludGVyX2NoZW4wMDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">这里写图片描述</span></p>\n<h2 id=\"拓展\"><a href=\"#拓展\" class=\"headerlink\" title=\"拓展\"></a>拓展</h2><p>当然，还有很多自定义的字段读取，如果有需要可以联系我，或者看官方文档<br>email：<a href=\"mailto:1085143002@qq.com\">1085143002@qq.com</a></p>\n<h2 id=\"相关资源\"><a href=\"#相关资源\" class=\"headerlink\" title=\"相关资源\"></a>相关资源</h2><ul>\n<li>mpxj官方API文档：<a href=\"http://www.mpxj.org/apidocs/index.html\" target=\"_blank\" rel=\"noopener\">http://www.mpxj.org/apidocs/index.html</a></li>\n<li>项目源码：<a href=\"https://github.com/WinterChenS/springboot-mybatis-demo\" target=\"_blank\" rel=\"noopener\">https://github.com/WinterChenS/springboot-mybatis-demo</a></li>\n<li>导入模板在源码的file文件夹中，sql在sql文件夹中</li>\n</ul>\n","more":"<p><img    class=\"lazyload\" data-original=\"http://img.blog.csdn.net/20180117180051197?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvV2ludGVyX2NoZW4wMDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">这里写图片描述</span></p>\n<h2 id=\"依赖\"><a href=\"#依赖\" class=\"headerlink\" title=\"依赖\"></a>依赖</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">&lt;!-- 读取project文件 --&gt;<br>&lt;dependency&gt;<br>\t&lt;groupId&gt;net.sf.mpxj&lt;&#x2F;groupId&gt;<br>\t&lt;artifactId&gt;mpxj&lt;&#x2F;artifactId&gt;<br>\t&lt;version&gt;7.1.0&lt;&#x2F;version&gt;<br>&lt;&#x2F;dependency&gt;<br></code></pre></td></tr></table></figure>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><p> 博主使用的读取方式是递归读取的，无论Project文件中的任务有多少层，都可以读到，好了，直接看代码，注意看注释：</p>\n<h3 id=\"核心方法\"><a href=\"#核心方法\" class=\"headerlink\" title=\"核心方法\"></a>核心方法</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><br><span class=\"hljs-meta\">@Transactional</span><br>   <span class=\"hljs-meta\">@Override</span><br>   <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">readMmpFileToDB</span><span class=\"hljs-params\">(File file)</span> </span>&#123;<span class=\"hljs-comment\">//如果读取的是MultipartFile，那么直接使用获取InputStream即可</span><br>       <span class=\"hljs-keyword\">try</span>&#123;<br>       \t<span class=\"hljs-comment\">//这个是读取文件的组件</span><br>           MPPReader mppRead = <span class=\"hljs-keyword\">new</span> MPPReader();<br>           <span class=\"hljs-comment\">//注意，如果在这一步出现了读取异常，肯定是版本不兼容，换个版本试试</span><br>           ProjectFile pf = mppRead.read(file);<br>           <span class=\"hljs-comment\">//从文件中获取的任务对象</span><br>           List&lt;Task&gt; tasks = pf.getChildTasks();<br>           <span class=\"hljs-comment\">//这个可以不用，这个list只是我用来装下所有的数据，如果不需要可以不使用</span><br>           List&lt;Project&gt; proList = <span class=\"hljs-keyword\">new</span> LinkedList&lt;&gt;();<br>           <span class=\"hljs-comment\">//这个是用来封装任务的对象，为了便于区别，初始化批次号，然后所有读取的数据都需要加上批次号</span><br>           Project pro = <span class=\"hljs-keyword\">new</span> Project();<br>           pro.setBatchNum(StringUtils.UUID());<span class=\"hljs-comment\">//生成批次号UUID</span><br>           <span class=\"hljs-comment\">//这个方法是一个递归方法</span><br>           getChildrenTask(tasks.get(<span class=\"hljs-number\">0</span>), pro ,proList, <span class=\"hljs-number\">0</span>);<br>       &#125;<span class=\"hljs-keyword\">catch</span> (MPXJException e) &#123;<br>           logger.error(e.getMessage());<br>           <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> RuntimeException();<br>       &#125; <span class=\"hljs-keyword\">catch</span> (Exception e) &#123;<br>           logger.error(e.getMessage());<br>           <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> RuntimeException();<br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"> <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 这个方法是一个递归</span><br><span class=\"hljs-comment\"> * 方法的原理：进行读取父任务，如果下一层任务还是父任务，那么继续调用当前方法，如果到了最后一层，调用另外一个读取底层的方法</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> task</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> project</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> list</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> levelNum</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">getChildrenTask</span><span class=\"hljs-params\">(Task task, Project project, List&lt;Project&gt; list, <span class=\"hljs-keyword\">int</span> levelNum)</span></span>&#123;<br>        <span class=\"hljs-keyword\">if</span>(task.getResourceAssignments().size() == <span class=\"hljs-number\">0</span>)&#123;<span class=\"hljs-comment\">//这个判断是进行是否是最后一层任务的判断==0说明是父任务</span><br>            levelNum ++;<span class=\"hljs-comment\">//层级号需要增加，这个只是博主用来记录该层的层级数</span><br>            List&lt;Task&gt; tasks = task.getChildTasks();<span class=\"hljs-comment\">//继续获取子任务</span><br>            <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; tasks.size(); i++) &#123;<span class=\"hljs-comment\">//该循环是遍历所有的子任务</span><br>                <span class=\"hljs-keyword\">if</span>(tasks.get(i).getResourceAssignments().size() == <span class=\"hljs-number\">0</span>)&#123;<span class=\"hljs-comment\">//说明还是在父任务层</span><br>                    Project pro = <span class=\"hljs-keyword\">new</span> Project();<br>                    <span class=\"hljs-keyword\">if</span> (project.getProjId() != <span class=\"hljs-keyword\">null</span>)&#123;<span class=\"hljs-comment\">//说明不是第一次读取了，因为如果是第一层，那么还没有进行数据库的添加，没有返回主键Id</span><br>                        pro.setParentId(project.getProjId());<span class=\"hljs-comment\">//将上一级目录的Id赋值给下一级的ParentId</span><br>                    &#125;<br>                    pro.setBatchNum(project.getBatchNum());<span class=\"hljs-comment\">//批量号</span><br>                    pro.setImportTime(<span class=\"hljs-keyword\">new</span> Date());<span class=\"hljs-comment\">//导入时间</span><br>                    pro.setLevel(levelNum);<span class=\"hljs-comment\">//层级</span><br>                    pro.setTaskName(tasks.get(i).getName());<span class=\"hljs-comment\">//这个是获取文件中的“任务名称”列的数据</span><br>                    pro.setDurationDate(tasks.get(i).getDuration().toString());<span class=\"hljs-comment\">//获取的是文件中的“工期”</span><br>                    pro.setStartDate(tasks.get(i).getStart());<span class=\"hljs-comment\">//获取文件中的 “开始时间”</span><br>                    pro.setEndDate(tasks.get(i).getFinish());<span class=\"hljs-comment\">//获取文件中的 “完成时间”</span><br>                    pro.setResource(tasks.get(i).getResourceGroup());<span class=\"hljs-comment\">//获取文件中的 “资源名称”</span><br>                    <span class=\"hljs-keyword\">this</span>.addProjectInfo(pro);<span class=\"hljs-comment\">//将该条数据添加到数据库，并且会返回主键Id，用做子任务的ParentId,这个需要在mybatis的Mapper中设置</span><br>                    getChildrenTask(tasks.get(i), pro,list,levelNum);<span class=\"hljs-comment\">//继续进行递归，当前保存的只是父任务的信息</span><br>                &#125;<span class=\"hljs-keyword\">else</span>&#123;<span class=\"hljs-comment\">//继续进行递归</span><br>                    getChildrenTask(tasks.get(i), project, list, levelNum);<br>                &#125;<br>            &#125;<br>        &#125;<span class=\"hljs-keyword\">else</span>&#123;<span class=\"hljs-comment\">//说明已经到了最底层的子任务了，那么就调用进行最底层数据读取的方法</span><br>            <span class=\"hljs-keyword\">if</span> (project.getProjId() != <span class=\"hljs-keyword\">null</span>)&#123;<br>                getResourceAssignment(task, project, list, levelNum);<br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">getResourceAssignment</span><span class=\"hljs-params\">(Task task, Project project, List&lt;Project&gt; proList, <span class=\"hljs-keyword\">int</span> levelNum)</span></span>&#123;<br>    List&lt;ResourceAssignment&gt; list = task.getResourceAssignments();<span class=\"hljs-comment\">//读取最底层的属性</span><br>    ResourceAssignment rs = list.get(<span class=\"hljs-number\">0</span>);<br>    Project pro = <span class=\"hljs-keyword\">new</span> Project();<br>    pro.setTaskName(task.getName());<br>    pro.setParentId(project.getProjId());<br>    pro.setLevel(levelNum);<br>    pro.setImportTime(<span class=\"hljs-keyword\">new</span> Date());<br>    pro.setBatchNum(project.getBatchNum());<br>    pro.setDurationDate(task.getDuration().toString());<br>    pro.setStartDate(rs.getStart());<span class=\"hljs-comment\">//注意，这个从ResourceAssignment中读取</span><br>    pro.setEndDate(rs.getFinish());<span class=\"hljs-comment\">//同上</span><br>    String resource = <span class=\"hljs-string\">\"\"</span>;<br>    <span class=\"hljs-keyword\">if</span>(list.size() &gt; <span class=\"hljs-number\">1</span>)&#123;<br>        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; list.size(); i++) &#123;<br>            <span class=\"hljs-keyword\">if</span> (list.get(i).getResource() != <span class=\"hljs-keyword\">null</span>)&#123;<br>                <span class=\"hljs-keyword\">if</span>(i &lt; list.size() - <span class=\"hljs-number\">1</span>)&#123;<br>                    resource += list.get(i).getResource().getName() + <span class=\"hljs-string\">\",\"</span>;<br>                &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>                    resource += list.get(i).getResource().getName();<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<span class=\"hljs-keyword\">else</span>&#123;<br><br>        <span class=\"hljs-keyword\">if</span>(list.size() &gt; <span class=\"hljs-number\">0</span> &amp;&amp; list.get(<span class=\"hljs-number\">0</span>).getResource() != <span class=\"hljs-keyword\">null</span>)&#123;<br>            resource = list.get(<span class=\"hljs-number\">0</span>).getResource().getName();<br>        &#125;<br>    &#125;<br>    <span class=\"hljs-keyword\">if</span>(!StringUtils.isEmpty(resource))&#123;<br>        pro.setResource(resource);<br>    &#125;<br>    <span class=\"hljs-keyword\">this</span>.addProjectInfo(pro);<span class=\"hljs-comment\">//将数据保存在数据库中,同样会返回主键</span><br>    proList.add(pro);<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n<h3 id=\"封装对象\"><a href=\"#封装对象\" class=\"headerlink\" title=\"封装对象\"></a>封装对象</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><br><span class=\"hljs-keyword\">package</span> com.winter.model;<br><br><span class=\"hljs-keyword\">import</span> java.util.Date;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * Project文件封装类</span><br><span class=\"hljs-comment\"> * Created By Donghua.Chen on  2018/1/9</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Project</span> </span>&#123;<br>    <span class=\"hljs-comment\">/* 自增主键Id */</span><br>    <span class=\"hljs-keyword\">private</span> Integer projId;<br>    <span class=\"hljs-comment\">/* 上级Id */</span><br>    <span class=\"hljs-keyword\">private</span> Integer parentId;<br>    <span class=\"hljs-comment\">/* 结构层级 */</span><br>    <span class=\"hljs-keyword\">private</span> Integer level;<br>    <span class=\"hljs-comment\">/* 任务名称 */</span><br>    <span class=\"hljs-keyword\">private</span> String taskName;<br>    <span class=\"hljs-comment\">/* 工期 */</span><br>    <span class=\"hljs-keyword\">private</span> String durationDate;<br>    <span class=\"hljs-comment\">/* 开始时间 */</span><br>    <span class=\"hljs-keyword\">private</span> Date startDate;<br>    <span class=\"hljs-comment\">/* 结束时间 */</span><br>    <span class=\"hljs-keyword\">private</span> Date endDate;<br>    <span class=\"hljs-comment\">/* 前置任务ID */</span><br>    <span class=\"hljs-keyword\">private</span> Integer preTask;<br>    <span class=\"hljs-comment\">/* 资源名称 */</span><br>    <span class=\"hljs-keyword\">private</span> String resource;<br>    <span class=\"hljs-comment\">/* 导入时间 */</span><br>    <span class=\"hljs-keyword\">private</span> Date importTime;<br>    <span class=\"hljs-comment\">/* 批次号 */</span><br>    <span class=\"hljs-keyword\">private</span> String batchNum;<br><br>    <span class=\"hljs-comment\">//省略get、set方法</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"Mybatis-接口方法\"><a href=\"#Mybatis-接口方法\" class=\"headerlink\" title=\"Mybatis 接口方法\"></a>Mybatis 接口方法</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * 插入project数据</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@param</span> project</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span></span><br><span class=\"hljs-comment\">     */</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">addProjectSelective</span><span class=\"hljs-params\">(Project project)</span></span>;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"Mapper\"><a href=\"#Mapper\" class=\"headerlink\" title=\"Mapper\"></a>Mapper</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sql</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"TABLE_PROJECT\"</span>&gt;</span><br>  PROJECT<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sql</span>&gt;</span><br><br><span class=\"hljs-comment\">&lt;!-- 插入数据之后返回主键 需要这两个配置： useGeneratedKeys=\"true\" keyProperty=\"projId\" --&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">insert</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"addProjectSelective\"</span> <span class=\"hljs-attr\">useGeneratedKeys</span>=<span class=\"hljs-string\">\"true\"</span> <span class=\"hljs-attr\">keyProperty</span>=<span class=\"hljs-string\">\"projId\"</span> <span class=\"hljs-attr\">parameterType</span>=<span class=\"hljs-string\">\"com.winter.model.Project\"</span>&gt;</span><br>    INSERT INTO<br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">include</span> <span class=\"hljs-attr\">refid</span>=<span class=\"hljs-string\">\"TABLE_PROJECT\"</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">trim</span> <span class=\"hljs-attr\">prefix</span>=<span class=\"hljs-string\">\"(\"</span> <span class=\"hljs-attr\">suffix</span>=<span class=\"hljs-string\">\")\"</span> <span class=\"hljs-attr\">suffixOverrides</span>=<span class=\"hljs-string\">\",\"</span> &gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"parentId != null\"</span>&gt;</span><br>            parentId,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"level != null\"</span>&gt;</span><br>            level,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"taskName != null\"</span>&gt;</span><br>            taskName,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"durationDate != null\"</span>&gt;</span><br>            durationDate,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"startDate != null\"</span>&gt;</span><br>            startDate,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"endDate != null\"</span>&gt;</span><br>            endDate,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"preTask != null\"</span>&gt;</span><br>            preTask,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"resource != null\"</span>&gt;</span><br>            resource,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"importTime != null\"</span>&gt;</span><br>            importTime,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"importTime != null\"</span>&gt;</span><br>            batchNum,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">trim</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">trim</span> <span class=\"hljs-attr\">prefix</span>=<span class=\"hljs-string\">\"values (\"</span> <span class=\"hljs-attr\">suffix</span>=<span class=\"hljs-string\">\")\"</span> <span class=\"hljs-attr\">suffixOverrides</span>=<span class=\"hljs-string\">\",\"</span> &gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"parentId != null\"</span>&gt;</span><br>            #&#123;parentId, jdbcType=INTEGER&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"level != null\"</span>&gt;</span><br>            #&#123;level, jdbcType=INTEGER&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"taskName != null\"</span>&gt;</span><br>            #&#123;taskName, jdbcType=VARCHAR&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"durationDate != null\"</span>&gt;</span><br>            #&#123;durationDate, jdbcType=VARCHAR&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"startDate != null\"</span>&gt;</span><br>            #&#123;startDate, jdbcType=DATE&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"endDate != null\"</span>&gt;</span><br>            #&#123;endDate, jdbcType=DATE&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"preTask != null\"</span>&gt;</span><br>            #&#123;preTask, jdbcType=INTEGER&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"resource != null\"</span>&gt;</span><br>            #&#123;resource, jdbcType=VARCHAR&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"importTime != null\"</span>&gt;</span><br>            #&#123;importTime, jdbcType=DATE&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"batchNum != null\"</span>&gt;</span><br>            #&#123;batchNum, jdbcType=VARCHAR&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">trim</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">insert</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"效果\"><a href=\"#效果\" class=\"headerlink\" title=\"效果\"></a>效果</h2><p><img    class=\"lazyload\" data-original=\"http://img.blog.csdn.net/20180117180307631?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvV2ludGVyX2NoZW4wMDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">这里写图片描述</span></p>\n<h2 id=\"拓展\"><a href=\"#拓展\" class=\"headerlink\" title=\"拓展\"></a>拓展</h2><p>当然，还有很多自定义的字段读取，如果有需要可以联系我，或者看官方文档<br>email：<a href=\"mailto:1085143002@qq.com\">1085143002@qq.com</a></p>\n<h2 id=\"相关资源\"><a href=\"#相关资源\" class=\"headerlink\" title=\"相关资源\"></a>相关资源</h2><ul>\n<li>mpxj官方API文档：<a href=\"http://www.mpxj.org/apidocs/index.html\" target=\"_blank\" rel=\"noopener\">http://www.mpxj.org/apidocs/index.html</a></li>\n<li>项目源码：<a href=\"https://github.com/WinterChenS/springboot-mybatis-demo\" target=\"_blank\" rel=\"noopener\">https://github.com/WinterChenS/springboot-mybatis-demo</a></li>\n<li>导入模板在源码的file文件夹中，sql在sql文件夹中</li>\n</ul>","categories":[{"name":"java","path":"api/categories/java.json"}],"tags":[{"name":"java","path":"api/tags/java.json"}]}