{"title":"springboot集成hive实战","slug":"2020-12-01-springboot-hive","date":"2020-12-01T11:30:00.000Z","updated":"2022-12-01T01:32:39.783Z","comments":true,"path":"api/articles/2020-12-01-springboot-hive.json","excerpt":null,"covers":null,"cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046754257652.jpg","content":"<p>springboot集成hive实现基本的api调用</p>\n<h2 id=\"maven坐标\"><a href=\"#maven坐标\" class=\"headerlink\" title=\"maven坐标\"></a>maven坐标</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-comment\">&lt;!-- hadoop --&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-common<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-streaming<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-yarn-common<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">exclusions</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">exclusion</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.google.guava<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>guava<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">exclusion</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">exclusions</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-distcp<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>provided<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-mapreduce-client-core<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-hdfs<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-mapreduce-client-jobclient<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>provided<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.alibaba<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>druid<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.2.1<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br>    <span class=\"hljs-comment\">&lt;!-- hive依赖 --&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hive<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hive-jdbc<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>2.3.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br>    <span class=\"hljs-comment\">&lt;!-- 中文分词器 --&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>cn.bestwu<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>ik-analyzers<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>5.1.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"配置：\"><a href=\"#配置：\" class=\"headerlink\" title=\"配置：\"></a>配置：</h2><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">spring:</span><br>  <span class=\"hljs-attr\">application:</span><br>    <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">hadoop-demo</span><br>  <span class=\"hljs-attr\">datasource:</span><br>    <span class=\"hljs-attr\">hive:</span> <span class=\"hljs-comment\">#hive数据源</span><br>      <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">jdbc:hive2://192.168.150.119:10000/default</span><br>      <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">com.alibaba.druid.pool.DruidDataSource</span><br>      <span class=\"hljs-attr\">username:</span> <span class=\"hljs-string\">winterchen</span><br>      <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">winterchen</span><br>      <span class=\"hljs-attr\">driver-class-name:</span> <span class=\"hljs-string\">org.apache.hive.jdbc.HiveDriver</span><br>    <span class=\"hljs-attr\">common-config:</span> <span class=\"hljs-comment\">#连接池统一配置，应用到所有的数据源</span><br>      <span class=\"hljs-attr\">initialSize:</span> <span class=\"hljs-number\">1</span><br>      <span class=\"hljs-attr\">minIdle:</span> <span class=\"hljs-number\">1</span><br>      <span class=\"hljs-attr\">maxIdle:</span> <span class=\"hljs-number\">5</span><br>      <span class=\"hljs-attr\">maxActive:</span> <span class=\"hljs-number\">50</span><br>      <span class=\"hljs-attr\">maxWait:</span> <span class=\"hljs-number\">10000</span><br>      <span class=\"hljs-attr\">timeBetweenEvictionRunsMillis:</span> <span class=\"hljs-number\">10000</span><br>      <span class=\"hljs-attr\">minEvictableIdleTimeMillis:</span> <span class=\"hljs-number\">300000</span><br>      <span class=\"hljs-attr\">validationQuery:</span> <span class=\"hljs-string\">select</span> <span class=\"hljs-string\">'x'</span><br>      <span class=\"hljs-attr\">testWhileIdle:</span> <span class=\"hljs-literal\">true</span><br>      <span class=\"hljs-attr\">testOnBorrow:</span> <span class=\"hljs-literal\">false</span><br>      <span class=\"hljs-attr\">testOnReturn:</span> <span class=\"hljs-literal\">false</span><br>      <span class=\"hljs-attr\">poolPreparedStatements:</span> <span class=\"hljs-literal\">true</span><br>      <span class=\"hljs-attr\">maxOpenPreparedStatements:</span> <span class=\"hljs-number\">20</span><br>      <span class=\"hljs-attr\">filters:</span> <span class=\"hljs-string\">stat</span><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-meta\">@ConfigurationProperties</span>(prefix = <span class=\"hljs-string\">\"spring.datasource.hive\"</span>, ignoreUnknownFields = <span class=\"hljs-keyword\">false</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HiveJdbcProperties</span> </span>&#123;<br><br>    <span class=\"hljs-keyword\">private</span> String url;<br><br>    <span class=\"hljs-keyword\">private</span> String type;<br><br>    <span class=\"hljs-keyword\">private</span> String username;<br><br>    <span class=\"hljs-keyword\">private</span> String password;<br><br>    <span class=\"hljs-keyword\">private</span> String driverClassName;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-meta\">@ConfigurationProperties</span>(prefix = <span class=\"hljs-string\">\"spring.datasource.common-config\"</span>, ignoreUnknownFields = <span class=\"hljs-keyword\">false</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DataSourceCommonProperties</span> </span>&#123;<br><br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> initialSize = <span class=\"hljs-number\">10</span>;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> minIdle;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> maxIdle;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> maxActive;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> maxWait;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> timeBetweenEvictionRunsMillis;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> minEvictableIdleTimeMillis;<br>    <span class=\"hljs-keyword\">private</span> String validationQuery;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> testWhileIdle;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> testOnBorrow;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> testOnReturn;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> poolPreparedStatements;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> maxOpenPreparedStatements;<br>    <span class=\"hljs-keyword\">private</span> String filters;<br><br>    <span class=\"hljs-keyword\">private</span> String mapperLocations;<br>    <span class=\"hljs-keyword\">private</span> String typeAliasPackage;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Slf</span>4j<br><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-meta\">@EnableConfigurationProperties</span>(&#123;HiveJdbcProperties<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>, <span class=\"hljs-title\">DataSourceCommonProperties</span>.<span class=\"hljs-title\">class</span>&#125;)</span><br><span class=\"hljs-class\"><span class=\"hljs-title\">public</span> <span class=\"hljs-title\">class</span> <span class=\"hljs-title\">HiveDruidConfiguration</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> HiveJdbcProperties hiveJdbcProperties;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> DataSourceCommonProperties dataSourceCommonProperties;<br><br>    <span class=\"hljs-meta\">@Bean</span>(<span class=\"hljs-string\">\"hiveDruidDataSource\"</span>) <span class=\"hljs-comment\">//新建bean实例</span><br>    <span class=\"hljs-meta\">@Qualifier</span>(<span class=\"hljs-string\">\"hiveDruidDataSource\"</span>)<span class=\"hljs-comment\">//标识</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> DataSource <span class=\"hljs-title\">dataSource</span><span class=\"hljs-params\">()</span></span>&#123;<br>        DruidDataSource datasource = <span class=\"hljs-keyword\">new</span> DruidDataSource();<br><br>        <span class=\"hljs-comment\">//配置数据源属性</span><br>        datasource.setUrl(hiveJdbcProperties.getUrl());<br>        datasource.setUsername(hiveJdbcProperties.getUsername());<br>        datasource.setPassword(hiveJdbcProperties.getPassword());<br>        datasource.setDriverClassName(hiveJdbcProperties.getDriverClassName());<br><br>        <span class=\"hljs-comment\">//配置统一属性</span><br>        datasource.setInitialSize(dataSourceCommonProperties.getInitialSize());<br>        datasource.setMinIdle(dataSourceCommonProperties.getMinIdle());<br>        datasource.setMaxActive(dataSourceCommonProperties.getMaxActive());<br>        datasource.setMaxWait(dataSourceCommonProperties.getMaxWait());<br>        datasource.setTimeBetweenEvictionRunsMillis(dataSourceCommonProperties.getTimeBetweenEvictionRunsMillis());<br>        datasource.setMinEvictableIdleTimeMillis(dataSourceCommonProperties.getMinEvictableIdleTimeMillis());<br>        datasource.setValidationQuery(dataSourceCommonProperties.getValidationQuery());<br>        datasource.setTestWhileIdle(dataSourceCommonProperties.isTestWhileIdle());<br>        datasource.setTestOnBorrow(dataSourceCommonProperties.isTestOnBorrow());<br>        datasource.setTestOnReturn(dataSourceCommonProperties.isTestOnReturn());<br>        datasource.setPoolPreparedStatements(dataSourceCommonProperties.isPoolPreparedStatements());<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            datasource.setFilters(dataSourceCommonProperties.getFilters());<br>        &#125; <span class=\"hljs-keyword\">catch</span> (SQLException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"Druid configuration initialization filter error.\"</span>, e);<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> datasource;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>注册jdbcTemplate </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HiveJdbcConfiguration</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Bean</span>(<span class=\"hljs-string\">\"hiveJdbcTemplate\"</span>)<br>    <span class=\"hljs-meta\">@Qualifier</span>(<span class=\"hljs-string\">\"hiveJdbcTemplate\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> JdbcTemplate <span class=\"hljs-title\">jdbcTemplate</span><span class=\"hljs-params\">(@Qualifier(<span class=\"hljs-string\">\"hiveDruidDataSource\"</span>)</span> DataSource dataSource) </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> JdbcTemplate(dataSource);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"基本api调用\"><a href=\"#基本api调用\" class=\"headerlink\" title=\"基本api调用\"></a>基本api调用</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.service;<br><br><span class=\"hljs-keyword\">import</span> java.util.List;<br><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">HiveService</span> </span>&#123;<br><br>    <span class=\"hljs-function\">Object <span class=\"hljs-title\">select</span><span class=\"hljs-params\">(String hql)</span></span>;<br><br>    <span class=\"hljs-function\">List&lt;String&gt; <span class=\"hljs-title\">listAllTables</span><span class=\"hljs-params\">()</span></span>;<br><br>    <span class=\"hljs-function\">List&lt;String&gt; <span class=\"hljs-title\">describeTable</span><span class=\"hljs-params\">(String tableName)</span></span>;<br><br>    <span class=\"hljs-function\">List&lt;String&gt; <span class=\"hljs-title\">selectFromTable</span><span class=\"hljs-params\">(String tableName)</span></span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.service.impl;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.service.HiveService;<br><span class=\"hljs-keyword\">import</span> lombok.extern.slf4j.Slf4j;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Qualifier;<br><span class=\"hljs-keyword\">import</span> org.springframework.jdbc.core.JdbcTemplate;<br><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Service;<br><span class=\"hljs-keyword\">import</span> org.springframework.util.StringUtils;<br><br><span class=\"hljs-keyword\">import</span> javax.sql.DataSource;<br><span class=\"hljs-keyword\">import</span> java.sql.ResultSet;<br><span class=\"hljs-keyword\">import</span> java.sql.SQLException;<br><span class=\"hljs-keyword\">import</span> java.sql.Statement;<br><span class=\"hljs-keyword\">import</span> java.util.ArrayList;<br><span class=\"hljs-keyword\">import</span> java.util.Collections;<br><span class=\"hljs-keyword\">import</span> java.util.List;<br><br><span class=\"hljs-meta\">@Slf</span>4j<br><span class=\"hljs-meta\">@Service</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HiveServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">HiveService</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-meta\">@Qualifier</span>(<span class=\"hljs-string\">\"hiveJdbcTemplate\"</span>)<br>    <span class=\"hljs-keyword\">private</span> JdbcTemplate hiveJdbcTemplate;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-meta\">@Qualifier</span>(<span class=\"hljs-string\">\"hiveDruidDataSource\"</span>)<br>    <span class=\"hljs-keyword\">private</span> DataSource hiveDruidDataSource;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> Object <span class=\"hljs-title\">select</span><span class=\"hljs-params\">(String hql)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> hiveJdbcTemplate.queryForObject(hql, Object<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> List&lt;String&gt; <span class=\"hljs-title\">listAllTables</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        List&lt;String&gt; result = <span class=\"hljs-keyword\">new</span> ArrayList&lt;&gt;();<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Statement statement = hiveDruidDataSource.getConnection().createStatement();<br>            String sql = <span class=\"hljs-string\">\"show tables\"</span>;<br>            log.info(<span class=\"hljs-string\">\"Running: \"</span> + sql);<br>            ResultSet resultSet = statement.executeQuery(sql);<br>            <span class=\"hljs-keyword\">while</span> (resultSet.next()) &#123;<br>                result.add(resultSet.getString(<span class=\"hljs-number\">1</span>));<br>            &#125;<br>            <span class=\"hljs-keyword\">return</span> result;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (SQLException throwables) &#123;<br>            log.error(throwables.getMessage());<br>        &#125;<br><br>        <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> List&lt;String&gt; <span class=\"hljs-title\">describeTable</span><span class=\"hljs-params\">(String tableName)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(tableName))&#123;<br>            <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>        &#125;<br>        List&lt;String&gt; result = <span class=\"hljs-keyword\">new</span> ArrayList&lt;&gt;();<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Statement statement = hiveDruidDataSource.getConnection().createStatement();<br>            String sql = <span class=\"hljs-string\">\"describe \"</span> + tableName;<br>            log.info(<span class=\"hljs-string\">\"Running\"</span> + sql);<br>            ResultSet resultSet = statement.executeQuery(sql);<br>            <span class=\"hljs-keyword\">while</span> (resultSet.next()) &#123;<br>                result.add(resultSet.getString(<span class=\"hljs-number\">1</span>));<br>            &#125;<br>            <span class=\"hljs-keyword\">return</span> result;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (SQLException throwables) &#123;<br>            log.error(throwables.getMessage());<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> List&lt;String&gt; <span class=\"hljs-title\">selectFromTable</span><span class=\"hljs-params\">(String tableName)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(tableName))&#123;<br>            <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>        &#125;<br>        List&lt;String&gt; result = <span class=\"hljs-keyword\">new</span> ArrayList&lt;&gt;();<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Statement statement = hiveDruidDataSource.getConnection().createStatement();<br>            String sql = <span class=\"hljs-string\">\"select * from \"</span> + tableName;<br>            log.info(<span class=\"hljs-string\">\"Running\"</span> + sql);<br>            ResultSet resultSet = statement.executeQuery(sql);<br>            <span class=\"hljs-keyword\">int</span> columnCount = resultSet.getMetaData().getColumnCount();<br>            String str = <span class=\"hljs-keyword\">null</span>;<br>            <span class=\"hljs-keyword\">while</span> (resultSet.next()) &#123;<br>                str = <span class=\"hljs-string\">\"\"</span>;<br>                <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">1</span>; i &lt; columnCount; i++) &#123;<br>                    str += resultSet.getString(i) + <span class=\"hljs-string\">\" \"</span>;<br>                &#125;<br>                str += resultSet.getString(columnCount);<br>                log.info(str);<br>                result.add(str);<br>            &#125;<br>            <span class=\"hljs-keyword\">return</span> result;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (SQLException throwables) &#123;<br>            log.error(throwables.getMessage());<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>hive本身就是基于hadoop的MapReduce的一层封装，所以对于hive的操作都是查询和新增等操作，其他的api请参考jdbctemplate接口</p>\n<p>源码地址: </p>\n<p><a href=\"https://github.com/WinterChenS/springboot-learning-experience/tree/master/spring-boot-hadoop\" target=\"_blank\" rel=\"noopener\">WinterChenS/springboot-learning-experience</a></p>\n","more":"<p>springboot集成hive实现基本的api调用</p>\n<h2 id=\"maven坐标\"><a href=\"#maven坐标\" class=\"headerlink\" title=\"maven坐标\"></a>maven坐标</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-comment\">&lt;!-- hadoop --&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-common<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-streaming<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-yarn-common<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">exclusions</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">exclusion</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.google.guava<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>guava<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">exclusion</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">exclusions</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-distcp<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>provided<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-mapreduce-client-core<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-hdfs<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-mapreduce-client-jobclient<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>provided<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.alibaba<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>druid<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.2.1<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br>    <span class=\"hljs-comment\">&lt;!-- hive依赖 --&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hive<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hive-jdbc<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>2.3.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br>    <span class=\"hljs-comment\">&lt;!-- 中文分词器 --&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>cn.bestwu<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>ik-analyzers<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>5.1.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"配置：\"><a href=\"#配置：\" class=\"headerlink\" title=\"配置：\"></a>配置：</h2><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">spring:</span><br>  <span class=\"hljs-attr\">application:</span><br>    <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">hadoop-demo</span><br>  <span class=\"hljs-attr\">datasource:</span><br>    <span class=\"hljs-attr\">hive:</span> <span class=\"hljs-comment\">#hive数据源</span><br>      <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">jdbc:hive2://192.168.150.119:10000/default</span><br>      <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">com.alibaba.druid.pool.DruidDataSource</span><br>      <span class=\"hljs-attr\">username:</span> <span class=\"hljs-string\">winterchen</span><br>      <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">winterchen</span><br>      <span class=\"hljs-attr\">driver-class-name:</span> <span class=\"hljs-string\">org.apache.hive.jdbc.HiveDriver</span><br>    <span class=\"hljs-attr\">common-config:</span> <span class=\"hljs-comment\">#连接池统一配置，应用到所有的数据源</span><br>      <span class=\"hljs-attr\">initialSize:</span> <span class=\"hljs-number\">1</span><br>      <span class=\"hljs-attr\">minIdle:</span> <span class=\"hljs-number\">1</span><br>      <span class=\"hljs-attr\">maxIdle:</span> <span class=\"hljs-number\">5</span><br>      <span class=\"hljs-attr\">maxActive:</span> <span class=\"hljs-number\">50</span><br>      <span class=\"hljs-attr\">maxWait:</span> <span class=\"hljs-number\">10000</span><br>      <span class=\"hljs-attr\">timeBetweenEvictionRunsMillis:</span> <span class=\"hljs-number\">10000</span><br>      <span class=\"hljs-attr\">minEvictableIdleTimeMillis:</span> <span class=\"hljs-number\">300000</span><br>      <span class=\"hljs-attr\">validationQuery:</span> <span class=\"hljs-string\">select</span> <span class=\"hljs-string\">'x'</span><br>      <span class=\"hljs-attr\">testWhileIdle:</span> <span class=\"hljs-literal\">true</span><br>      <span class=\"hljs-attr\">testOnBorrow:</span> <span class=\"hljs-literal\">false</span><br>      <span class=\"hljs-attr\">testOnReturn:</span> <span class=\"hljs-literal\">false</span><br>      <span class=\"hljs-attr\">poolPreparedStatements:</span> <span class=\"hljs-literal\">true</span><br>      <span class=\"hljs-attr\">maxOpenPreparedStatements:</span> <span class=\"hljs-number\">20</span><br>      <span class=\"hljs-attr\">filters:</span> <span class=\"hljs-string\">stat</span><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-meta\">@ConfigurationProperties</span>(prefix = <span class=\"hljs-string\">\"spring.datasource.hive\"</span>, ignoreUnknownFields = <span class=\"hljs-keyword\">false</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HiveJdbcProperties</span> </span>&#123;<br><br>    <span class=\"hljs-keyword\">private</span> String url;<br><br>    <span class=\"hljs-keyword\">private</span> String type;<br><br>    <span class=\"hljs-keyword\">private</span> String username;<br><br>    <span class=\"hljs-keyword\">private</span> String password;<br><br>    <span class=\"hljs-keyword\">private</span> String driverClassName;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-meta\">@ConfigurationProperties</span>(prefix = <span class=\"hljs-string\">\"spring.datasource.common-config\"</span>, ignoreUnknownFields = <span class=\"hljs-keyword\">false</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DataSourceCommonProperties</span> </span>&#123;<br><br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> initialSize = <span class=\"hljs-number\">10</span>;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> minIdle;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> maxIdle;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> maxActive;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> maxWait;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> timeBetweenEvictionRunsMillis;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> minEvictableIdleTimeMillis;<br>    <span class=\"hljs-keyword\">private</span> String validationQuery;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> testWhileIdle;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> testOnBorrow;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> testOnReturn;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> poolPreparedStatements;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> maxOpenPreparedStatements;<br>    <span class=\"hljs-keyword\">private</span> String filters;<br><br>    <span class=\"hljs-keyword\">private</span> String mapperLocations;<br>    <span class=\"hljs-keyword\">private</span> String typeAliasPackage;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Slf</span>4j<br><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-meta\">@EnableConfigurationProperties</span>(&#123;HiveJdbcProperties<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>, <span class=\"hljs-title\">DataSourceCommonProperties</span>.<span class=\"hljs-title\">class</span>&#125;)</span><br><span class=\"hljs-class\"><span class=\"hljs-title\">public</span> <span class=\"hljs-title\">class</span> <span class=\"hljs-title\">HiveDruidConfiguration</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> HiveJdbcProperties hiveJdbcProperties;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> DataSourceCommonProperties dataSourceCommonProperties;<br><br>    <span class=\"hljs-meta\">@Bean</span>(<span class=\"hljs-string\">\"hiveDruidDataSource\"</span>) <span class=\"hljs-comment\">//新建bean实例</span><br>    <span class=\"hljs-meta\">@Qualifier</span>(<span class=\"hljs-string\">\"hiveDruidDataSource\"</span>)<span class=\"hljs-comment\">//标识</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> DataSource <span class=\"hljs-title\">dataSource</span><span class=\"hljs-params\">()</span></span>&#123;<br>        DruidDataSource datasource = <span class=\"hljs-keyword\">new</span> DruidDataSource();<br><br>        <span class=\"hljs-comment\">//配置数据源属性</span><br>        datasource.setUrl(hiveJdbcProperties.getUrl());<br>        datasource.setUsername(hiveJdbcProperties.getUsername());<br>        datasource.setPassword(hiveJdbcProperties.getPassword());<br>        datasource.setDriverClassName(hiveJdbcProperties.getDriverClassName());<br><br>        <span class=\"hljs-comment\">//配置统一属性</span><br>        datasource.setInitialSize(dataSourceCommonProperties.getInitialSize());<br>        datasource.setMinIdle(dataSourceCommonProperties.getMinIdle());<br>        datasource.setMaxActive(dataSourceCommonProperties.getMaxActive());<br>        datasource.setMaxWait(dataSourceCommonProperties.getMaxWait());<br>        datasource.setTimeBetweenEvictionRunsMillis(dataSourceCommonProperties.getTimeBetweenEvictionRunsMillis());<br>        datasource.setMinEvictableIdleTimeMillis(dataSourceCommonProperties.getMinEvictableIdleTimeMillis());<br>        datasource.setValidationQuery(dataSourceCommonProperties.getValidationQuery());<br>        datasource.setTestWhileIdle(dataSourceCommonProperties.isTestWhileIdle());<br>        datasource.setTestOnBorrow(dataSourceCommonProperties.isTestOnBorrow());<br>        datasource.setTestOnReturn(dataSourceCommonProperties.isTestOnReturn());<br>        datasource.setPoolPreparedStatements(dataSourceCommonProperties.isPoolPreparedStatements());<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            datasource.setFilters(dataSourceCommonProperties.getFilters());<br>        &#125; <span class=\"hljs-keyword\">catch</span> (SQLException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"Druid configuration initialization filter error.\"</span>, e);<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> datasource;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>注册jdbcTemplate </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HiveJdbcConfiguration</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Bean</span>(<span class=\"hljs-string\">\"hiveJdbcTemplate\"</span>)<br>    <span class=\"hljs-meta\">@Qualifier</span>(<span class=\"hljs-string\">\"hiveJdbcTemplate\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> JdbcTemplate <span class=\"hljs-title\">jdbcTemplate</span><span class=\"hljs-params\">(@Qualifier(<span class=\"hljs-string\">\"hiveDruidDataSource\"</span>)</span> DataSource dataSource) </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> JdbcTemplate(dataSource);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"基本api调用\"><a href=\"#基本api调用\" class=\"headerlink\" title=\"基本api调用\"></a>基本api调用</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.service;<br><br><span class=\"hljs-keyword\">import</span> java.util.List;<br><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">HiveService</span> </span>&#123;<br><br>    <span class=\"hljs-function\">Object <span class=\"hljs-title\">select</span><span class=\"hljs-params\">(String hql)</span></span>;<br><br>    <span class=\"hljs-function\">List&lt;String&gt; <span class=\"hljs-title\">listAllTables</span><span class=\"hljs-params\">()</span></span>;<br><br>    <span class=\"hljs-function\">List&lt;String&gt; <span class=\"hljs-title\">describeTable</span><span class=\"hljs-params\">(String tableName)</span></span>;<br><br>    <span class=\"hljs-function\">List&lt;String&gt; <span class=\"hljs-title\">selectFromTable</span><span class=\"hljs-params\">(String tableName)</span></span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.service.impl;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.service.HiveService;<br><span class=\"hljs-keyword\">import</span> lombok.extern.slf4j.Slf4j;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Qualifier;<br><span class=\"hljs-keyword\">import</span> org.springframework.jdbc.core.JdbcTemplate;<br><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Service;<br><span class=\"hljs-keyword\">import</span> org.springframework.util.StringUtils;<br><br><span class=\"hljs-keyword\">import</span> javax.sql.DataSource;<br><span class=\"hljs-keyword\">import</span> java.sql.ResultSet;<br><span class=\"hljs-keyword\">import</span> java.sql.SQLException;<br><span class=\"hljs-keyword\">import</span> java.sql.Statement;<br><span class=\"hljs-keyword\">import</span> java.util.ArrayList;<br><span class=\"hljs-keyword\">import</span> java.util.Collections;<br><span class=\"hljs-keyword\">import</span> java.util.List;<br><br><span class=\"hljs-meta\">@Slf</span>4j<br><span class=\"hljs-meta\">@Service</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HiveServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">HiveService</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-meta\">@Qualifier</span>(<span class=\"hljs-string\">\"hiveJdbcTemplate\"</span>)<br>    <span class=\"hljs-keyword\">private</span> JdbcTemplate hiveJdbcTemplate;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-meta\">@Qualifier</span>(<span class=\"hljs-string\">\"hiveDruidDataSource\"</span>)<br>    <span class=\"hljs-keyword\">private</span> DataSource hiveDruidDataSource;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> Object <span class=\"hljs-title\">select</span><span class=\"hljs-params\">(String hql)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> hiveJdbcTemplate.queryForObject(hql, Object<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> List&lt;String&gt; <span class=\"hljs-title\">listAllTables</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        List&lt;String&gt; result = <span class=\"hljs-keyword\">new</span> ArrayList&lt;&gt;();<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Statement statement = hiveDruidDataSource.getConnection().createStatement();<br>            String sql = <span class=\"hljs-string\">\"show tables\"</span>;<br>            log.info(<span class=\"hljs-string\">\"Running: \"</span> + sql);<br>            ResultSet resultSet = statement.executeQuery(sql);<br>            <span class=\"hljs-keyword\">while</span> (resultSet.next()) &#123;<br>                result.add(resultSet.getString(<span class=\"hljs-number\">1</span>));<br>            &#125;<br>            <span class=\"hljs-keyword\">return</span> result;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (SQLException throwables) &#123;<br>            log.error(throwables.getMessage());<br>        &#125;<br><br>        <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> List&lt;String&gt; <span class=\"hljs-title\">describeTable</span><span class=\"hljs-params\">(String tableName)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(tableName))&#123;<br>            <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>        &#125;<br>        List&lt;String&gt; result = <span class=\"hljs-keyword\">new</span> ArrayList&lt;&gt;();<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Statement statement = hiveDruidDataSource.getConnection().createStatement();<br>            String sql = <span class=\"hljs-string\">\"describe \"</span> + tableName;<br>            log.info(<span class=\"hljs-string\">\"Running\"</span> + sql);<br>            ResultSet resultSet = statement.executeQuery(sql);<br>            <span class=\"hljs-keyword\">while</span> (resultSet.next()) &#123;<br>                result.add(resultSet.getString(<span class=\"hljs-number\">1</span>));<br>            &#125;<br>            <span class=\"hljs-keyword\">return</span> result;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (SQLException throwables) &#123;<br>            log.error(throwables.getMessage());<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> List&lt;String&gt; <span class=\"hljs-title\">selectFromTable</span><span class=\"hljs-params\">(String tableName)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(tableName))&#123;<br>            <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>        &#125;<br>        List&lt;String&gt; result = <span class=\"hljs-keyword\">new</span> ArrayList&lt;&gt;();<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Statement statement = hiveDruidDataSource.getConnection().createStatement();<br>            String sql = <span class=\"hljs-string\">\"select * from \"</span> + tableName;<br>            log.info(<span class=\"hljs-string\">\"Running\"</span> + sql);<br>            ResultSet resultSet = statement.executeQuery(sql);<br>            <span class=\"hljs-keyword\">int</span> columnCount = resultSet.getMetaData().getColumnCount();<br>            String str = <span class=\"hljs-keyword\">null</span>;<br>            <span class=\"hljs-keyword\">while</span> (resultSet.next()) &#123;<br>                str = <span class=\"hljs-string\">\"\"</span>;<br>                <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">1</span>; i &lt; columnCount; i++) &#123;<br>                    str += resultSet.getString(i) + <span class=\"hljs-string\">\" \"</span>;<br>                &#125;<br>                str += resultSet.getString(columnCount);<br>                log.info(str);<br>                result.add(str);<br>            &#125;<br>            <span class=\"hljs-keyword\">return</span> result;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (SQLException throwables) &#123;<br>            log.error(throwables.getMessage());<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>hive本身就是基于hadoop的MapReduce的一层封装，所以对于hive的操作都是查询和新增等操作，其他的api请参考jdbctemplate接口</p>\n<p>源码地址: </p>\n<p><a href=\"https://github.com/WinterChenS/springboot-learning-experience/tree/master/spring-boot-hadoop\" target=\"_blank\" rel=\"noopener\">WinterChenS/springboot-learning-experience</a></p>\n","categories":[{"name":"hadoop","path":"api/categories/hadoop.json"}],"tags":[{"name":"hadoop","path":"api/tags/hadoop.json"},{"name":"hive","path":"api/tags/hive.json"},{"name":"springboot","path":"api/tags/springboot.json"}]}