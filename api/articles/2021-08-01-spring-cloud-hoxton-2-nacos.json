{"title":"SpringCloud系列教程(二)之Nacos","slug":"2021-08-01-spring-cloud-hoxton-2-nacos","date":"2021-08-01T05:14:00.000Z","updated":"2022-12-01T01:32:39.783Z","comments":true,"path":"api/articles/2021-08-01-spring-cloud-hoxton-2-nacos.json","excerpt":null,"covers":["data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==","data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==","data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==","data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="],"cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046761982351.jpg","content":"<blockquote>\n<p>阅读提醒：</p>\n</blockquote>\n<ol>\n<li>本文面向的是有一定springboot基础者</li>\n<li>本次教程使用的Spring Cloud Hoxton RELEASE版本</li>\n</ol>\n<h2 id=\"本文概览\"><a href=\"#本文概览\" class=\"headerlink\" title=\"本文概览\"></a>本文概览</h2><ul>\n<li>什么是注册中心？</li>\n<li>什么是配置中心？</li>\n<li>如何在springcloud中使用Nacos？</li>\n</ul>\n<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>在使用nacos之前我们需要理解nacos在整个微服务架构中担任了什么样的角色，在微服务架构中，注册中心是非常核心的基础服务之一，在微服务流行之前就已经出现在分布式架构中。比如Dubbo，Dubbo在国内是比较流行的分布式架构，也是一个非常实用的框架，提供了比较完备的服务治理功能，而服务治理的实现主要依靠注册中心。</p>\n<p>本文中用到的demo源码地址：<a href=\"https://github.com/WinterChenS/spring-cloud-hoxton-study\" target=\"_blank\" rel=\"noopener\">https://github.com/WinterChenS/spring-cloud-hoxton-study</a></p>\n<h2 id=\"什么是注册中心？\"><a href=\"#什么是注册中心？\" class=\"headerlink\" title=\"什么是注册中心？\"></a>什么是注册中心？</h2><p>注册中心可以说是微服务架构中的”通讯录“，它记录了服务和服务地址的映射关系。在分布式架构中，服务会注册到这里，当服务需要调用其它服务时，就这里找到服务的地址，进行调用。</p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046455713643.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p>列举一个比较简单的生活例子：</p>\n<ol>\n<li>小明要给小红打电话，需要从通讯录(注册中心)中获取到小红的电话号码(服务地址);</li>\n<li>小明根据通讯录中的电话号码拨打小红的电话号码(服务请求);</li>\n<li>小红接通了电话，并随后完成了通话；</li>\n<li>后面再拨打小红的电话号码可以通过电话保存的号码进行拨打(本地缓存);</li>\n</ol>\n<p>nacos在整个微服务架构中充当了通讯录的角色，服务之间的调用，监控等都需要通过注册中心进行获取服务的地址端口的映射，并且一般服务端都会有本地缓存，下次请求之前会查询本地的服务映射信息，可以减少网络请求提高服务的吞吐量。</p>\n<h2 id=\"什么是配置中心？\"><a href=\"#什么是配置中心？\" class=\"headerlink\" title=\"什么是配置中心？\"></a>什么是配置中心？</h2><p>配置中心其实理解起来很简单，就是字面意思，把服务的配置集中在配置中心，可以实现动态的修改，避免了每次修改配置文件都需要重新发布服务的尴尬。</p>\n<h2 id=\"下载nacos，并启动\"><a href=\"#下载nacos，并启动\" class=\"headerlink\" title=\"下载nacos，并启动\"></a>下载nacos，并启动</h2><p>Nacos 致力于帮助您发现、配置和管理微服务。Nacos 提供了一组简单易用的特性集，帮助您快速实现动态服务发现、服务配置、服务元数据及流量管理。下载地址<a href=\"https://github.com/alibaba/nacos/releases，下载最新版的2.0版本。\" target=\"_blank\" rel=\"noopener\">https://github.com/alibaba/nacos/releases，下载最新版的2.0版本。</a></p>\n<p>下载完成后，解压，在解压后的文件的/bin目录下，windows系统点击startup.cmd就可以启动nacos。linux或mac执行以下命令启动nacos。</p>\n<p>sh startup.sh -m standalone</p>\n<p>登陆页面：<a href=\"http://localhost:8848/nacos/\" target=\"_blank\" rel=\"noopener\">http://localhost:8848/nacos/</a> 登陆用户nacos，登陆密码为nacos。</p>\n<h2 id=\"jdk版本\"><a href=\"#jdk版本\" class=\"headerlink\" title=\"jdk版本\"></a>jdk版本</h2><ul>\n<li>jdk： 1.8</li>\n<li>maven： 3.3.9</li>\n<li>nacos: 2.0</li>\n</ul>\n<h2 id=\"springcloud-和-springboot-版本\"><a href=\"#springcloud-和-springboot-版本\" class=\"headerlink\" title=\"springcloud 和 springboot 版本\"></a>springcloud 和 springboot 版本</h2><ul>\n<li>springcloud: Hoxton.RELEASE</li>\n<li>springboot: 2.2.13.RELEASE</li>\n<li>springcloud-alibaba: 2.2.0.RELEASE</li>\n</ul>\n<h2 id=\"配置中心\"><a href=\"#配置中心\" class=\"headerlink\" title=\"配置中心\"></a>配置中心</h2><p>首先我们新建一个springboot 基础项目，这里项目命名为：<code>spring-cloud-hoxton-study</code></p>\n<h3 id=\"项目结构：\"><a href=\"#项目结构：\" class=\"headerlink\" title=\"项目结构：\"></a>项目结构：</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\">-spring-cloud-hoxton-study<br>  |—spring-cloud-nacos-consumer<br>  |—pom.xml<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"父pom文件加入依赖-spring-cloud-hoxton-study-：\"><a href=\"#父pom文件加入依赖-spring-cloud-hoxton-study-：\" class=\"headerlink\" title=\"父pom文件加入依赖(spring-cloud-hoxton-study)：\"></a>父pom文件加入依赖(spring-cloud-hoxton-study)：</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">properties</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">java.version</span>&gt;</span>1.8<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">java.version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">spring-cloud.version</span>&gt;</span>Hoxton.RELEASE<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">spring-cloud.version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">spring-boot.version</span>&gt;</span>2.2.13.RELEASE<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">spring-boot.version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">spring-cloud-alibaba.version</span>&gt;</span>2.2.0.RELEASE<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">spring-cloud-alibaba.version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">properties</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependencyManagement</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependencies</span>&gt;</span><br>            <span class=\"hljs-comment\">&lt;!-- springCloud依赖 --&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.cloud<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-cloud-dependencies<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">type</span>&gt;</span>pom<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">type</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>import<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br>            <span class=\"hljs-comment\">&lt;!-- springBoot依赖 --&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-boot-dependencies<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">type</span>&gt;</span>pom<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">type</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>import<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br>\t\t\t\t\t\t<span class=\"hljs-comment\">&lt;!-- spring cloud alibaba 依赖 --&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.alibaba.cloud<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;spring-cloud-alibaba.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">type</span>&gt;</span>pom<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">type</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>import<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependencies</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependencyManagement</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"子pom修改-spring-cloud-nacos-consumer-：parent\"><a href=\"#子pom修改-spring-cloud-nacos-consumer-：parent\" class=\"headerlink\" title=\"子pom修改(spring-cloud-nacos-consumer)：parent\"></a>子pom修改(spring-cloud-nacos-consumer)：parent</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">parent</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.winterchen<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-cloud-hoxton-study<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">parent</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"子pom加入依赖-spring-cloud-nacos-consumer-：\"><a href=\"#子pom加入依赖-spring-cloud-nacos-consumer-：\" class=\"headerlink\" title=\"子pom加入依赖(spring-cloud-nacos-consumer)：\"></a>子pom加入依赖(spring-cloud-nacos-consumer)：</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.alibaba.cloud<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<blockquote>\n<p>注意：这里只是放了主要的maven依赖，如果需要查看全部的依赖，请查看<a href=\"https://github.com/WinterChenS/spring-cloud-hoxton-study\" target=\"_blank\" rel=\"noopener\">demo的源码</a></p>\n</blockquote>\n<h3 id=\"创建配置：bootstrap-properties-或者-bootstrap-yml\"><a href=\"#创建配置：bootstrap-properties-或者-bootstrap-yml\" class=\"headerlink\" title=\"创建配置：bootstrap.properties 或者 bootstrap.yml\"></a>创建配置：<code>bootstrap.properties</code> 或者 <code>bootstrap.yml</code></h3><p>bootstrap.properties</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">spring.cloud.nacos.config.server-addr&#x3D;127.0.0.1:8848<br><br>spring.application.name&#x3D;winter-nacos-consumer<br><br>spring.profiles.active&#x3D;dev<br></code></pre></td></tr></table></figure>\n\n<p>bootstrap.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">spring:</span><br>  <span class=\"hljs-attr\">cloud:</span><br>    <span class=\"hljs-attr\">nacos:</span><br>      <span class=\"hljs-attr\">config:</span><br>        <span class=\"hljs-attr\">server-addr:</span> <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span><span class=\"hljs-string\">:8848</span><br>        <span class=\"hljs-attr\">file-extension:</span> <span class=\"hljs-string\">yaml</span><br>  <span class=\"hljs-attr\">application:</span><br>    <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">winter-nacos-consumer</span><br>  <span class=\"hljs-attr\">profiles:</span><br>    <span class=\"hljs-attr\">active:</span> <span class=\"hljs-string\">dev</span><br></code></pre></td></tr></table></figure>\n\n<blockquote>\n<p>文中的：127.0.0.1:8848 就是上面搭建的nacos服务</p>\n</blockquote>\n<p>之所以需要配置 <code>spring.application.name</code>是因为nacos默认获取配置文件是按照name作为dataId的</p>\n<p>在 Nacos Spring Cloud 中，dataId 的完整格式如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">$&#123;prefix&#125;-$&#123;spring.profiles.active&#125;.$&#123;file-extension&#125;<br></code></pre></td></tr></table></figure>\n\n<ul>\n<li>prefix 默认为 <code>spring.application.name</code> 的值，也可以通过配置项 <code>spring.cloud.nacos.config.prefix</code>来配置。</li>\n<li><code>spring.profiles.active</code> 即为当前环境对应的 <code>profile</code>，详情可以参考 <code>Spring Boot</code>文档。 注意：当 <code>spring.profiles.active</code> 为空时，对应的连接符 - 也将不存在，dataId 的拼接格式变成 <code>${prefix}.${file-extension}</code></li>\n<li><code>file-exetension</code> 为配置内容的数据格式，可以通过配置项 <code>spring.cloud.nacos.config.file-extension</code> 来配置。目前只支持 <code>properties</code> 和 <code>yaml</code> 类型。</li>\n</ul>\n<h3 id=\"在nacos配置中心创建配置文件\"><a href=\"#在nacos配置中心创建配置文件\" class=\"headerlink\" title=\"在nacos配置中心创建配置文件\"></a>在nacos配置中心创建配置文件</h3><p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046455981185.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p>配置详情：</p>\n<p>Data ID: <code>winter-nacos-consumer-dev.yaml</code></p>\n<p>Group: <code>DEFAULT_GROUP</code></p>\n<p>配置内容：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">server:</span><br>  <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">16011</span><br><br><span class=\"hljs-attr\">spring:</span><br>  <span class=\"hljs-attr\">cloud:</span><br>    <span class=\"hljs-attr\">nacos:</span><br>      <span class=\"hljs-attr\">discovery:</span><br>        <span class=\"hljs-attr\">server-addr:</span> <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span><span class=\"hljs-string\">:8848</span><br><br><span class=\"hljs-attr\">test:</span><br>  <span class=\"hljs-attr\">config:</span><br>    <span class=\"hljs-attr\">refresh:</span> <span class=\"hljs-literal\">true</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"自动刷新\"><a href=\"#自动刷新\" class=\"headerlink\" title=\"自动刷新\"></a>自动刷新</h3><p>通过 Spring Cloud 原生注解 @RefreshScope 实现配置自动更新：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Api</span>(<span class=\"hljs-string\">\"nacos api\"</span>)<br><span class=\"hljs-meta\">@RestController</span><br><span class=\"hljs-meta\">@RequestMapping</span>(<span class=\"hljs-string\">\"/nacos\"</span>)<br><span class=\"hljs-meta\">@RefreshScope</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">NacosController</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">BaseController</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;test.config.refresh:true&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> refresh;<br><br>    <span class=\"hljs-meta\">@GetMapping</span>(<span class=\"hljs-string\">\"/\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> CommonResult&lt;Boolean&gt; <span class=\"hljs-title\">get</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> CommonResult.success(refresh);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"如何测试\"><a href=\"#如何测试\" class=\"headerlink\" title=\"如何测试\"></a>如何测试</h3><p>我们可以通过请求上面的接口: <a href=\"http://127.0.0.1:16011/nacos\" target=\"_blank\" rel=\"noopener\">http://127.0.0.1:16011/nacos</a></p>\n<p>返回的结果是：true</p>\n<p>然后修改一下配置中心的:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\">test:<br>  config:<br>    refresh: <span class=\"hljs-keyword\">false</span><br></code></pre></td></tr></table></figure>\n\n<p>可以发现控制台的日志有打印：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-number\">2021</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">27</span> <span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">25</span>:<span class=\"hljs-number\">13.973</span>  INFO <span class=\"hljs-number\">17240</span> --- [<span class=\"hljs-number\">8.25</span><span class=\"hljs-number\">.36</span><span class=\"hljs-number\">.41_8848</span>] o.s.c.e.event.RefreshEventListener       : Refresh keys changed: [test.config.refresh]<br></code></pre></td></tr></table></figure>\n\n<p>再请求一次就可以发现结果变成了：false</p>\n<h2 id=\"服务注册与发现\"><a href=\"#服务注册与发现\" class=\"headerlink\" title=\"服务注册与发现\"></a>服务注册与发现</h2><p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046456195432.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<blockquote>\n<p>仍然使用上面的项目进行</p>\n</blockquote>\n<h3 id=\"添加依赖：\"><a href=\"#添加依赖：\" class=\"headerlink\" title=\"添加依赖：\"></a>添加依赖：</h3><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\">&lt;!-- Nacos 注册中心 --&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"增加配置\"><a href=\"#增加配置\" class=\"headerlink\" title=\"增加配置\"></a>增加配置</h3><p>以下是完整的配置</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">server:</span><br>  <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">16011</span><br><br><span class=\"hljs-attr\">spring:</span><br>  <span class=\"hljs-attr\">cloud:</span><br>    <span class=\"hljs-attr\">nacos:</span><br>      <span class=\"hljs-attr\">discovery:</span><br>        <span class=\"hljs-attr\">server-addr:</span> <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span><span class=\"hljs-string\">:8848</span><br><br><span class=\"hljs-attr\">test:</span><br>  <span class=\"hljs-attr\">config:</span><br>    <span class=\"hljs-attr\">refresh:</span> <span class=\"hljs-literal\">true</span><br></code></pre></td></tr></table></figure>\n\n<p>启动类增加：<code>@EnableDiscoveryClient</code> 以启用服务注册与发现</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@SpringBootApplication</span>(exclude= &#123;DataSourceAutoConfiguration<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>&#125;)</span><br><span class=\"hljs-class\">@<span class=\"hljs-title\">EnableDiscoveryClient</span></span><br><span class=\"hljs-class\"><span class=\"hljs-title\">public</span> <span class=\"hljs-title\">class</span> <span class=\"hljs-title\">SpringCloudNacosApplication</span> </span>&#123;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(SpringCloudNacosApplication<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>, <span class=\"hljs-title\">args</span>)</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>接下来需要测试一下服务注册与发现的功能是否正常，所以我们需要<strong>复制</strong>原有的服务<code>spring-cloud-nacos-consumer</code> 并改名为：<code>spring-cloud-nacos-provider</code></p>\n<p>当前工程结构：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\">-spring-cloud-hoxton-study<br>  |—spring-cloud-nacos-consumer<br>  |—spring-cloud-nacos-provider<br>  |—pom.xml<br></code></pre></td></tr></table></figure>\n\n<p><code>spring-cloud-nacos-consumer</code> 服务下的<code>NacosController</code> 增加方法：<code>echo</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@RestController</span><br><span class=\"hljs-meta\">@RequestMapping</span>(<span class=\"hljs-string\">\"/nacos\"</span>)<br><span class=\"hljs-meta\">@RefreshScope</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">NacosController</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;test.config.refresh:true&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> refresh;<br><br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">final</span> RestTemplate restTemplate;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">NacosController</span><span class=\"hljs-params\">(RestTemplate restTemplate)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">this</span>.restTemplate = restTemplate;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@GetMapping</span>(<span class=\"hljs-string\">\"\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">get</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> refresh;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@GetMapping</span>(<span class=\"hljs-string\">\"/echo/&#123;str&#125;\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">echo</span><span class=\"hljs-params\">(@PathVariable String str)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> restTemplate.getForObject(<span class=\"hljs-string\">\"http://winter-nacos-provider/nacos/echo/\"</span> + str, String<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p><code>spring-cloud-nacos-provider</code> 服务下的<code>NacosController</code> 增加方法：<code>echo</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@RestController</span><br><span class=\"hljs-meta\">@RequestMapping</span>(<span class=\"hljs-string\">\"/nacos\"</span>)<br><span class=\"hljs-meta\">@RefreshScope</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">NacosController</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;test.config.refresh:true&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> refresh;<br><br>    <span class=\"hljs-meta\">@GetMapping</span>(<span class=\"hljs-string\">\"\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">get</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> refresh;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@GetMapping</span>(<span class=\"hljs-string\">\"/echo/&#123;string&#125;\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">echo</span><span class=\"hljs-params\">(@PathVariable String string)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">\"Hello Nacos Discovery \"</span> + string;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"开始测试：\"><a href=\"#开始测试：\" class=\"headerlink\" title=\"开始测试：\"></a>开始测试：</h3><p>测试之前需要给<code>spring-cloud-nacos-provider</code> 进行配置中心的配置：</p>\n<ol>\n<li>修改<code>bootstrap.yml</code> 的 <code>spring.application.name=winter-nacos-provider</code> ;</li>\n<li>在配置中心新增配置文件：<code>winter-nacos-provider-dev.yaml</code> 具体的配置如下:</li>\n</ol>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">server:</span><br>  <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">16012</span><br><br><span class=\"hljs-attr\">spring:</span><br>  <span class=\"hljs-attr\">cloud:</span><br>    <span class=\"hljs-attr\">nacos:</span><br>      <span class=\"hljs-attr\">discovery:</span><br>        <span class=\"hljs-attr\">server-addr:</span> <span class=\"hljs-number\">118.25</span><span class=\"hljs-number\">.36</span><span class=\"hljs-number\">.41</span><span class=\"hljs-string\">:8848</span><br>  <span class=\"hljs-attr\">profiles:</span><br>    <span class=\"hljs-attr\">active:</span> <span class=\"hljs-string\">dev</span><br><br><span class=\"hljs-attr\">test:</span><br>  <span class=\"hljs-attr\">config:</span><br>    <span class=\"hljs-attr\">refresh:</span> <span class=\"hljs-literal\">true</span><br></code></pre></td></tr></table></figure>\n\n<p>分别启动两个服务，然后调用接口: <a href=\"http://127.0.0.1:16011/nacos/echo/hello\" target=\"_blank\" rel=\"noopener\">http://127.0.0.1:16011/nacos/echo/hello</a></p>\n<p>请求的结果：</p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046456542050.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>本文介绍了springcloud如何使用nacos作为配置中心和注册中心，作为微服务中比较核心的两个基础功能，需要熟练的在实战中进行使用，后面也会陆续介绍如何与其他的组件进行组合使用。</p>\n<p>上面使用的restTemplate进行服务的调用，这样显然在实际的使用当中是非常的不便利的，那么在实际应用中使用什么方式进行远程调用呢？下一篇将介绍如何使用open feign进行远程服务调用的。</p>\n<h2 id=\"源码地址\"><a href=\"#源码地址\" class=\"headerlink\" title=\"源码地址\"></a>源码地址</h2><p><a href=\"https://github.com/WinterChenS/spring-cloud-hoxton-study\" target=\"_blank\" rel=\"noopener\">https://github.com/WinterChenS/spring-cloud-hoxton-study</a></p>\n<p>参考文献：</p>\n<p><a href=\"https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html\" target=\"_blank\" rel=\"noopener\">Nacos Spring Cloud 快速开始</a></p>\n","more":"<blockquote>\n<p>阅读提醒：</p>\n</blockquote>\n<ol>\n<li>本文面向的是有一定springboot基础者</li>\n<li>本次教程使用的Spring Cloud Hoxton RELEASE版本</li>\n</ol>\n<h2 id=\"本文概览\"><a href=\"#本文概览\" class=\"headerlink\" title=\"本文概览\"></a>本文概览</h2><ul>\n<li>什么是注册中心？</li>\n<li>什么是配置中心？</li>\n<li>如何在springcloud中使用Nacos？</li>\n</ul>\n<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>在使用nacos之前我们需要理解nacos在整个微服务架构中担任了什么样的角色，在微服务架构中，注册中心是非常核心的基础服务之一，在微服务流行之前就已经出现在分布式架构中。比如Dubbo，Dubbo在国内是比较流行的分布式架构，也是一个非常实用的框架，提供了比较完备的服务治理功能，而服务治理的实现主要依靠注册中心。</p>\n<p>本文中用到的demo源码地址：<a href=\"https://github.com/WinterChenS/spring-cloud-hoxton-study\" target=\"_blank\" rel=\"noopener\">https://github.com/WinterChenS/spring-cloud-hoxton-study</a></p>\n<h2 id=\"什么是注册中心？\"><a href=\"#什么是注册中心？\" class=\"headerlink\" title=\"什么是注册中心？\"></a>什么是注册中心？</h2><p>注册中心可以说是微服务架构中的”通讯录“，它记录了服务和服务地址的映射关系。在分布式架构中，服务会注册到这里，当服务需要调用其它服务时，就这里找到服务的地址，进行调用。</p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046455713643.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p>列举一个比较简单的生活例子：</p>\n<ol>\n<li>小明要给小红打电话，需要从通讯录(注册中心)中获取到小红的电话号码(服务地址);</li>\n<li>小明根据通讯录中的电话号码拨打小红的电话号码(服务请求);</li>\n<li>小红接通了电话，并随后完成了通话；</li>\n<li>后面再拨打小红的电话号码可以通过电话保存的号码进行拨打(本地缓存);</li>\n</ol>\n<p>nacos在整个微服务架构中充当了通讯录的角色，服务之间的调用，监控等都需要通过注册中心进行获取服务的地址端口的映射，并且一般服务端都会有本地缓存，下次请求之前会查询本地的服务映射信息，可以减少网络请求提高服务的吞吐量。</p>\n<h2 id=\"什么是配置中心？\"><a href=\"#什么是配置中心？\" class=\"headerlink\" title=\"什么是配置中心？\"></a>什么是配置中心？</h2><p>配置中心其实理解起来很简单，就是字面意思，把服务的配置集中在配置中心，可以实现动态的修改，避免了每次修改配置文件都需要重新发布服务的尴尬。</p>\n<h2 id=\"下载nacos，并启动\"><a href=\"#下载nacos，并启动\" class=\"headerlink\" title=\"下载nacos，并启动\"></a>下载nacos，并启动</h2><p>Nacos 致力于帮助您发现、配置和管理微服务。Nacos 提供了一组简单易用的特性集，帮助您快速实现动态服务发现、服务配置、服务元数据及流量管理。下载地址<a href=\"https://github.com/alibaba/nacos/releases，下载最新版的2.0版本。\" target=\"_blank\" rel=\"noopener\">https://github.com/alibaba/nacos/releases，下载最新版的2.0版本。</a></p>\n<p>下载完成后，解压，在解压后的文件的/bin目录下，windows系统点击startup.cmd就可以启动nacos。linux或mac执行以下命令启动nacos。</p>\n<p>sh startup.sh -m standalone</p>\n<p>登陆页面：<a href=\"http://localhost:8848/nacos/\" target=\"_blank\" rel=\"noopener\">http://localhost:8848/nacos/</a> 登陆用户nacos，登陆密码为nacos。</p>\n<h2 id=\"jdk版本\"><a href=\"#jdk版本\" class=\"headerlink\" title=\"jdk版本\"></a>jdk版本</h2><ul>\n<li>jdk： 1.8</li>\n<li>maven： 3.3.9</li>\n<li>nacos: 2.0</li>\n</ul>\n<h2 id=\"springcloud-和-springboot-版本\"><a href=\"#springcloud-和-springboot-版本\" class=\"headerlink\" title=\"springcloud 和 springboot 版本\"></a>springcloud 和 springboot 版本</h2><ul>\n<li>springcloud: Hoxton.RELEASE</li>\n<li>springboot: 2.2.13.RELEASE</li>\n<li>springcloud-alibaba: 2.2.0.RELEASE</li>\n</ul>\n<h2 id=\"配置中心\"><a href=\"#配置中心\" class=\"headerlink\" title=\"配置中心\"></a>配置中心</h2><p>首先我们新建一个springboot 基础项目，这里项目命名为：<code>spring-cloud-hoxton-study</code></p>\n<h3 id=\"项目结构：\"><a href=\"#项目结构：\" class=\"headerlink\" title=\"项目结构：\"></a>项目结构：</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\">-spring-cloud-hoxton-study<br>  |—spring-cloud-nacos-consumer<br>  |—pom.xml<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"父pom文件加入依赖-spring-cloud-hoxton-study-：\"><a href=\"#父pom文件加入依赖-spring-cloud-hoxton-study-：\" class=\"headerlink\" title=\"父pom文件加入依赖(spring-cloud-hoxton-study)：\"></a>父pom文件加入依赖(spring-cloud-hoxton-study)：</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">properties</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">java.version</span>&gt;</span>1.8<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">java.version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">spring-cloud.version</span>&gt;</span>Hoxton.RELEASE<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">spring-cloud.version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">spring-boot.version</span>&gt;</span>2.2.13.RELEASE<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">spring-boot.version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">spring-cloud-alibaba.version</span>&gt;</span>2.2.0.RELEASE<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">spring-cloud-alibaba.version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">properties</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependencyManagement</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependencies</span>&gt;</span><br>            <span class=\"hljs-comment\">&lt;!-- springCloud依赖 --&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.cloud<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-cloud-dependencies<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">type</span>&gt;</span>pom<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">type</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>import<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br>            <span class=\"hljs-comment\">&lt;!-- springBoot依赖 --&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-boot-dependencies<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;spring-boot.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">type</span>&gt;</span>pom<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">type</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>import<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br>\t\t\t\t\t\t<span class=\"hljs-comment\">&lt;!-- spring cloud alibaba 依赖 --&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.alibaba.cloud<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;spring-cloud-alibaba.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">type</span>&gt;</span>pom<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">type</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>import<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependencies</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependencyManagement</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"子pom修改-spring-cloud-nacos-consumer-：parent\"><a href=\"#子pom修改-spring-cloud-nacos-consumer-：parent\" class=\"headerlink\" title=\"子pom修改(spring-cloud-nacos-consumer)：parent\"></a>子pom修改(spring-cloud-nacos-consumer)：parent</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">parent</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.winterchen<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-cloud-hoxton-study<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">parent</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"子pom加入依赖-spring-cloud-nacos-consumer-：\"><a href=\"#子pom加入依赖-spring-cloud-nacos-consumer-：\" class=\"headerlink\" title=\"子pom加入依赖(spring-cloud-nacos-consumer)：\"></a>子pom加入依赖(spring-cloud-nacos-consumer)：</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.alibaba.cloud<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<blockquote>\n<p>注意：这里只是放了主要的maven依赖，如果需要查看全部的依赖，请查看<a href=\"https://github.com/WinterChenS/spring-cloud-hoxton-study\" target=\"_blank\" rel=\"noopener\">demo的源码</a></p>\n</blockquote>\n<h3 id=\"创建配置：bootstrap-properties-或者-bootstrap-yml\"><a href=\"#创建配置：bootstrap-properties-或者-bootstrap-yml\" class=\"headerlink\" title=\"创建配置：bootstrap.properties 或者 bootstrap.yml\"></a>创建配置：<code>bootstrap.properties</code> 或者 <code>bootstrap.yml</code></h3><p>bootstrap.properties</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">spring.cloud.nacos.config.server-addr&#x3D;127.0.0.1:8848<br><br>spring.application.name&#x3D;winter-nacos-consumer<br><br>spring.profiles.active&#x3D;dev<br></code></pre></td></tr></table></figure>\n\n<p>bootstrap.yml</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">spring:</span><br>  <span class=\"hljs-attr\">cloud:</span><br>    <span class=\"hljs-attr\">nacos:</span><br>      <span class=\"hljs-attr\">config:</span><br>        <span class=\"hljs-attr\">server-addr:</span> <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span><span class=\"hljs-string\">:8848</span><br>        <span class=\"hljs-attr\">file-extension:</span> <span class=\"hljs-string\">yaml</span><br>  <span class=\"hljs-attr\">application:</span><br>    <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">winter-nacos-consumer</span><br>  <span class=\"hljs-attr\">profiles:</span><br>    <span class=\"hljs-attr\">active:</span> <span class=\"hljs-string\">dev</span><br></code></pre></td></tr></table></figure>\n\n<blockquote>\n<p>文中的：127.0.0.1:8848 就是上面搭建的nacos服务</p>\n</blockquote>\n<p>之所以需要配置 <code>spring.application.name</code>是因为nacos默认获取配置文件是按照name作为dataId的</p>\n<p>在 Nacos Spring Cloud 中，dataId 的完整格式如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">$&#123;prefix&#125;-$&#123;spring.profiles.active&#125;.$&#123;file-extension&#125;<br></code></pre></td></tr></table></figure>\n\n<ul>\n<li>prefix 默认为 <code>spring.application.name</code> 的值，也可以通过配置项 <code>spring.cloud.nacos.config.prefix</code>来配置。</li>\n<li><code>spring.profiles.active</code> 即为当前环境对应的 <code>profile</code>，详情可以参考 <code>Spring Boot</code>文档。 注意：当 <code>spring.profiles.active</code> 为空时，对应的连接符 - 也将不存在，dataId 的拼接格式变成 <code>${prefix}.${file-extension}</code></li>\n<li><code>file-exetension</code> 为配置内容的数据格式，可以通过配置项 <code>spring.cloud.nacos.config.file-extension</code> 来配置。目前只支持 <code>properties</code> 和 <code>yaml</code> 类型。</li>\n</ul>\n<h3 id=\"在nacos配置中心创建配置文件\"><a href=\"#在nacos配置中心创建配置文件\" class=\"headerlink\" title=\"在nacos配置中心创建配置文件\"></a>在nacos配置中心创建配置文件</h3><p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046455981185.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p>配置详情：</p>\n<p>Data ID: <code>winter-nacos-consumer-dev.yaml</code></p>\n<p>Group: <code>DEFAULT_GROUP</code></p>\n<p>配置内容：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">server:</span><br>  <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">16011</span><br><br><span class=\"hljs-attr\">spring:</span><br>  <span class=\"hljs-attr\">cloud:</span><br>    <span class=\"hljs-attr\">nacos:</span><br>      <span class=\"hljs-attr\">discovery:</span><br>        <span class=\"hljs-attr\">server-addr:</span> <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span><span class=\"hljs-string\">:8848</span><br><br><span class=\"hljs-attr\">test:</span><br>  <span class=\"hljs-attr\">config:</span><br>    <span class=\"hljs-attr\">refresh:</span> <span class=\"hljs-literal\">true</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"自动刷新\"><a href=\"#自动刷新\" class=\"headerlink\" title=\"自动刷新\"></a>自动刷新</h3><p>通过 Spring Cloud 原生注解 @RefreshScope 实现配置自动更新：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Api</span>(<span class=\"hljs-string\">\"nacos api\"</span>)<br><span class=\"hljs-meta\">@RestController</span><br><span class=\"hljs-meta\">@RequestMapping</span>(<span class=\"hljs-string\">\"/nacos\"</span>)<br><span class=\"hljs-meta\">@RefreshScope</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">NacosController</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">BaseController</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;test.config.refresh:true&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> refresh;<br><br>    <span class=\"hljs-meta\">@GetMapping</span>(<span class=\"hljs-string\">\"/\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> CommonResult&lt;Boolean&gt; <span class=\"hljs-title\">get</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> CommonResult.success(refresh);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"如何测试\"><a href=\"#如何测试\" class=\"headerlink\" title=\"如何测试\"></a>如何测试</h3><p>我们可以通过请求上面的接口: <a href=\"http://127.0.0.1:16011/nacos\" target=\"_blank\" rel=\"noopener\">http://127.0.0.1:16011/nacos</a></p>\n<p>返回的结果是：true</p>\n<p>然后修改一下配置中心的:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\">test:<br>  config:<br>    refresh: <span class=\"hljs-keyword\">false</span><br></code></pre></td></tr></table></figure>\n\n<p>可以发现控制台的日志有打印：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-number\">2021</span>-<span class=\"hljs-number\">07</span>-<span class=\"hljs-number\">27</span> <span class=\"hljs-number\">11</span>:<span class=\"hljs-number\">25</span>:<span class=\"hljs-number\">13.973</span>  INFO <span class=\"hljs-number\">17240</span> --- [<span class=\"hljs-number\">8.25</span><span class=\"hljs-number\">.36</span><span class=\"hljs-number\">.41_8848</span>] o.s.c.e.event.RefreshEventListener       : Refresh keys changed: [test.config.refresh]<br></code></pre></td></tr></table></figure>\n\n<p>再请求一次就可以发现结果变成了：false</p>\n<h2 id=\"服务注册与发现\"><a href=\"#服务注册与发现\" class=\"headerlink\" title=\"服务注册与发现\"></a>服务注册与发现</h2><p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046456195432.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<blockquote>\n<p>仍然使用上面的项目进行</p>\n</blockquote>\n<h3 id=\"添加依赖：\"><a href=\"#添加依赖：\" class=\"headerlink\" title=\"添加依赖：\"></a>添加依赖：</h3><figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\">&lt;!-- Nacos 注册中心 --&gt;<br>&lt;dependency&gt;<br>    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;<br>    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"增加配置\"><a href=\"#增加配置\" class=\"headerlink\" title=\"增加配置\"></a>增加配置</h3><p>以下是完整的配置</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">server:</span><br>  <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">16011</span><br><br><span class=\"hljs-attr\">spring:</span><br>  <span class=\"hljs-attr\">cloud:</span><br>    <span class=\"hljs-attr\">nacos:</span><br>      <span class=\"hljs-attr\">discovery:</span><br>        <span class=\"hljs-attr\">server-addr:</span> <span class=\"hljs-number\">127.0</span><span class=\"hljs-number\">.0</span><span class=\"hljs-number\">.1</span><span class=\"hljs-string\">:8848</span><br><br><span class=\"hljs-attr\">test:</span><br>  <span class=\"hljs-attr\">config:</span><br>    <span class=\"hljs-attr\">refresh:</span> <span class=\"hljs-literal\">true</span><br></code></pre></td></tr></table></figure>\n\n<p>启动类增加：<code>@EnableDiscoveryClient</code> 以启用服务注册与发现</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@SpringBootApplication</span>(exclude= &#123;DataSourceAutoConfiguration<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>&#125;)</span><br><span class=\"hljs-class\">@<span class=\"hljs-title\">EnableDiscoveryClient</span></span><br><span class=\"hljs-class\"><span class=\"hljs-title\">public</span> <span class=\"hljs-title\">class</span> <span class=\"hljs-title\">SpringCloudNacosApplication</span> </span>&#123;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(SpringCloudNacosApplication<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>, <span class=\"hljs-title\">args</span>)</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>接下来需要测试一下服务注册与发现的功能是否正常，所以我们需要<strong>复制</strong>原有的服务<code>spring-cloud-nacos-consumer</code> 并改名为：<code>spring-cloud-nacos-provider</code></p>\n<p>当前工程结构：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\">-spring-cloud-hoxton-study<br>  |—spring-cloud-nacos-consumer<br>  |—spring-cloud-nacos-provider<br>  |—pom.xml<br></code></pre></td></tr></table></figure>\n\n<p><code>spring-cloud-nacos-consumer</code> 服务下的<code>NacosController</code> 增加方法：<code>echo</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@RestController</span><br><span class=\"hljs-meta\">@RequestMapping</span>(<span class=\"hljs-string\">\"/nacos\"</span>)<br><span class=\"hljs-meta\">@RefreshScope</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">NacosController</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;test.config.refresh:true&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> refresh;<br><br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">final</span> RestTemplate restTemplate;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">NacosController</span><span class=\"hljs-params\">(RestTemplate restTemplate)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">this</span>.restTemplate = restTemplate;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@GetMapping</span>(<span class=\"hljs-string\">\"\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">get</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> refresh;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@GetMapping</span>(<span class=\"hljs-string\">\"/echo/&#123;str&#125;\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">echo</span><span class=\"hljs-params\">(@PathVariable String str)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> restTemplate.getForObject(<span class=\"hljs-string\">\"http://winter-nacos-provider/nacos/echo/\"</span> + str, String<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p><code>spring-cloud-nacos-provider</code> 服务下的<code>NacosController</code> 增加方法：<code>echo</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@RestController</span><br><span class=\"hljs-meta\">@RequestMapping</span>(<span class=\"hljs-string\">\"/nacos\"</span>)<br><span class=\"hljs-meta\">@RefreshScope</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">NacosController</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;test.config.refresh:true&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> refresh;<br><br>    <span class=\"hljs-meta\">@GetMapping</span>(<span class=\"hljs-string\">\"\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">get</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> refresh;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@GetMapping</span>(<span class=\"hljs-string\">\"/echo/&#123;string&#125;\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">echo</span><span class=\"hljs-params\">(@PathVariable String string)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">\"Hello Nacos Discovery \"</span> + string;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"开始测试：\"><a href=\"#开始测试：\" class=\"headerlink\" title=\"开始测试：\"></a>开始测试：</h3><p>测试之前需要给<code>spring-cloud-nacos-provider</code> 进行配置中心的配置：</p>\n<ol>\n<li>修改<code>bootstrap.yml</code> 的 <code>spring.application.name=winter-nacos-provider</code> ;</li>\n<li>在配置中心新增配置文件：<code>winter-nacos-provider-dev.yaml</code> 具体的配置如下:</li>\n</ol>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">server:</span><br>  <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">16012</span><br><br><span class=\"hljs-attr\">spring:</span><br>  <span class=\"hljs-attr\">cloud:</span><br>    <span class=\"hljs-attr\">nacos:</span><br>      <span class=\"hljs-attr\">discovery:</span><br>        <span class=\"hljs-attr\">server-addr:</span> <span class=\"hljs-number\">118.25</span><span class=\"hljs-number\">.36</span><span class=\"hljs-number\">.41</span><span class=\"hljs-string\">:8848</span><br>  <span class=\"hljs-attr\">profiles:</span><br>    <span class=\"hljs-attr\">active:</span> <span class=\"hljs-string\">dev</span><br><br><span class=\"hljs-attr\">test:</span><br>  <span class=\"hljs-attr\">config:</span><br>    <span class=\"hljs-attr\">refresh:</span> <span class=\"hljs-literal\">true</span><br></code></pre></td></tr></table></figure>\n\n<p>分别启动两个服务，然后调用接口: <a href=\"http://127.0.0.1:16011/nacos/echo/hello\" target=\"_blank\" rel=\"noopener\">http://127.0.0.1:16011/nacos/echo/hello</a></p>\n<p>请求的结果：</p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046456542050.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>本文介绍了springcloud如何使用nacos作为配置中心和注册中心，作为微服务中比较核心的两个基础功能，需要熟练的在实战中进行使用，后面也会陆续介绍如何与其他的组件进行组合使用。</p>\n<p>上面使用的restTemplate进行服务的调用，这样显然在实际的使用当中是非常的不便利的，那么在实际应用中使用什么方式进行远程调用呢？下一篇将介绍如何使用open feign进行远程服务调用的。</p>\n<h2 id=\"源码地址\"><a href=\"#源码地址\" class=\"headerlink\" title=\"源码地址\"></a>源码地址</h2><p><a href=\"https://github.com/WinterChenS/spring-cloud-hoxton-study\" target=\"_blank\" rel=\"noopener\">https://github.com/WinterChenS/spring-cloud-hoxton-study</a></p>\n<p>参考文献：</p>\n<p><a href=\"https://nacos.io/zh-cn/docs/quick-start-spring-cloud.html\" target=\"_blank\" rel=\"noopener\">Nacos Spring Cloud 快速开始</a></p>\n","categories":[{"name":"springcloud","path":"api/categories/springcloud.json"}],"tags":[{"name":"springcloud","path":"api/tags/springcloud.json"},{"name":"Hoxton","path":"api/tags/Hoxton.json"},{"name":"nacos","path":"api/tags/nacos.json"}]}