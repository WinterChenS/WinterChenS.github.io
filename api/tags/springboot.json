{"name":"springboot","postlist":[{"title":"springboot集成hive实战","slug":"2020-12-01-springboot-hive","date":"2020-12-01T11:30:00.000Z","updated":"2022-12-01T01:32:39.783Z","comments":true,"top":null,"path":"api/articles/2020-12-01-springboot-hive.json","excerpt":null,"keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046754257652.jpg","content":"<p>springboot集成hive实现基本的api调用</p>\n<h2 id=\"maven坐标\"><a href=\"#maven坐标\" class=\"headerlink\" title=\"maven坐标\"></a>maven坐标</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-comment\">&lt;!-- hadoop --&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-common<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-streaming<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-yarn-common<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">exclusions</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">exclusion</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.google.guava<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>guava<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">exclusion</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">exclusions</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-distcp<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>provided<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-mapreduce-client-core<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-hdfs<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-mapreduce-client-jobclient<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>provided<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.alibaba<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>druid<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.2.1<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br>    <span class=\"hljs-comment\">&lt;!-- hive依赖 --&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hive<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hive-jdbc<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>2.3.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br>    <span class=\"hljs-comment\">&lt;!-- 中文分词器 --&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>cn.bestwu<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>ik-analyzers<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>5.1.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"配置：\"><a href=\"#配置：\" class=\"headerlink\" title=\"配置：\"></a>配置：</h2><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">spring:</span><br>  <span class=\"hljs-attr\">application:</span><br>    <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">hadoop-demo</span><br>  <span class=\"hljs-attr\">datasource:</span><br>    <span class=\"hljs-attr\">hive:</span> <span class=\"hljs-comment\">#hive数据源</span><br>      <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">jdbc:hive2://192.168.150.119:10000/default</span><br>      <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">com.alibaba.druid.pool.DruidDataSource</span><br>      <span class=\"hljs-attr\">username:</span> <span class=\"hljs-string\">winterchen</span><br>      <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">winterchen</span><br>      <span class=\"hljs-attr\">driver-class-name:</span> <span class=\"hljs-string\">org.apache.hive.jdbc.HiveDriver</span><br>    <span class=\"hljs-attr\">common-config:</span> <span class=\"hljs-comment\">#连接池统一配置，应用到所有的数据源</span><br>      <span class=\"hljs-attr\">initialSize:</span> <span class=\"hljs-number\">1</span><br>      <span class=\"hljs-attr\">minIdle:</span> <span class=\"hljs-number\">1</span><br>      <span class=\"hljs-attr\">maxIdle:</span> <span class=\"hljs-number\">5</span><br>      <span class=\"hljs-attr\">maxActive:</span> <span class=\"hljs-number\">50</span><br>      <span class=\"hljs-attr\">maxWait:</span> <span class=\"hljs-number\">10000</span><br>      <span class=\"hljs-attr\">timeBetweenEvictionRunsMillis:</span> <span class=\"hljs-number\">10000</span><br>      <span class=\"hljs-attr\">minEvictableIdleTimeMillis:</span> <span class=\"hljs-number\">300000</span><br>      <span class=\"hljs-attr\">validationQuery:</span> <span class=\"hljs-string\">select</span> <span class=\"hljs-string\">'x'</span><br>      <span class=\"hljs-attr\">testWhileIdle:</span> <span class=\"hljs-literal\">true</span><br>      <span class=\"hljs-attr\">testOnBorrow:</span> <span class=\"hljs-literal\">false</span><br>      <span class=\"hljs-attr\">testOnReturn:</span> <span class=\"hljs-literal\">false</span><br>      <span class=\"hljs-attr\">poolPreparedStatements:</span> <span class=\"hljs-literal\">true</span><br>      <span class=\"hljs-attr\">maxOpenPreparedStatements:</span> <span class=\"hljs-number\">20</span><br>      <span class=\"hljs-attr\">filters:</span> <span class=\"hljs-string\">stat</span><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-meta\">@ConfigurationProperties</span>(prefix = <span class=\"hljs-string\">\"spring.datasource.hive\"</span>, ignoreUnknownFields = <span class=\"hljs-keyword\">false</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HiveJdbcProperties</span> </span>&#123;<br><br>    <span class=\"hljs-keyword\">private</span> String url;<br><br>    <span class=\"hljs-keyword\">private</span> String type;<br><br>    <span class=\"hljs-keyword\">private</span> String username;<br><br>    <span class=\"hljs-keyword\">private</span> String password;<br><br>    <span class=\"hljs-keyword\">private</span> String driverClassName;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-meta\">@ConfigurationProperties</span>(prefix = <span class=\"hljs-string\">\"spring.datasource.common-config\"</span>, ignoreUnknownFields = <span class=\"hljs-keyword\">false</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DataSourceCommonProperties</span> </span>&#123;<br><br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> initialSize = <span class=\"hljs-number\">10</span>;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> minIdle;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> maxIdle;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> maxActive;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> maxWait;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> timeBetweenEvictionRunsMillis;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> minEvictableIdleTimeMillis;<br>    <span class=\"hljs-keyword\">private</span> String validationQuery;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> testWhileIdle;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> testOnBorrow;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> testOnReturn;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> poolPreparedStatements;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> maxOpenPreparedStatements;<br>    <span class=\"hljs-keyword\">private</span> String filters;<br><br>    <span class=\"hljs-keyword\">private</span> String mapperLocations;<br>    <span class=\"hljs-keyword\">private</span> String typeAliasPackage;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Slf</span>4j<br><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-meta\">@EnableConfigurationProperties</span>(&#123;HiveJdbcProperties<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>, <span class=\"hljs-title\">DataSourceCommonProperties</span>.<span class=\"hljs-title\">class</span>&#125;)</span><br><span class=\"hljs-class\"><span class=\"hljs-title\">public</span> <span class=\"hljs-title\">class</span> <span class=\"hljs-title\">HiveDruidConfiguration</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> HiveJdbcProperties hiveJdbcProperties;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> DataSourceCommonProperties dataSourceCommonProperties;<br><br>    <span class=\"hljs-meta\">@Bean</span>(<span class=\"hljs-string\">\"hiveDruidDataSource\"</span>) <span class=\"hljs-comment\">//新建bean实例</span><br>    <span class=\"hljs-meta\">@Qualifier</span>(<span class=\"hljs-string\">\"hiveDruidDataSource\"</span>)<span class=\"hljs-comment\">//标识</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> DataSource <span class=\"hljs-title\">dataSource</span><span class=\"hljs-params\">()</span></span>&#123;<br>        DruidDataSource datasource = <span class=\"hljs-keyword\">new</span> DruidDataSource();<br><br>        <span class=\"hljs-comment\">//配置数据源属性</span><br>        datasource.setUrl(hiveJdbcProperties.getUrl());<br>        datasource.setUsername(hiveJdbcProperties.getUsername());<br>        datasource.setPassword(hiveJdbcProperties.getPassword());<br>        datasource.setDriverClassName(hiveJdbcProperties.getDriverClassName());<br><br>        <span class=\"hljs-comment\">//配置统一属性</span><br>        datasource.setInitialSize(dataSourceCommonProperties.getInitialSize());<br>        datasource.setMinIdle(dataSourceCommonProperties.getMinIdle());<br>        datasource.setMaxActive(dataSourceCommonProperties.getMaxActive());<br>        datasource.setMaxWait(dataSourceCommonProperties.getMaxWait());<br>        datasource.setTimeBetweenEvictionRunsMillis(dataSourceCommonProperties.getTimeBetweenEvictionRunsMillis());<br>        datasource.setMinEvictableIdleTimeMillis(dataSourceCommonProperties.getMinEvictableIdleTimeMillis());<br>        datasource.setValidationQuery(dataSourceCommonProperties.getValidationQuery());<br>        datasource.setTestWhileIdle(dataSourceCommonProperties.isTestWhileIdle());<br>        datasource.setTestOnBorrow(dataSourceCommonProperties.isTestOnBorrow());<br>        datasource.setTestOnReturn(dataSourceCommonProperties.isTestOnReturn());<br>        datasource.setPoolPreparedStatements(dataSourceCommonProperties.isPoolPreparedStatements());<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            datasource.setFilters(dataSourceCommonProperties.getFilters());<br>        &#125; <span class=\"hljs-keyword\">catch</span> (SQLException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"Druid configuration initialization filter error.\"</span>, e);<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> datasource;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>注册jdbcTemplate </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HiveJdbcConfiguration</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Bean</span>(<span class=\"hljs-string\">\"hiveJdbcTemplate\"</span>)<br>    <span class=\"hljs-meta\">@Qualifier</span>(<span class=\"hljs-string\">\"hiveJdbcTemplate\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> JdbcTemplate <span class=\"hljs-title\">jdbcTemplate</span><span class=\"hljs-params\">(@Qualifier(<span class=\"hljs-string\">\"hiveDruidDataSource\"</span>)</span> DataSource dataSource) </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> JdbcTemplate(dataSource);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"基本api调用\"><a href=\"#基本api调用\" class=\"headerlink\" title=\"基本api调用\"></a>基本api调用</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.service;<br><br><span class=\"hljs-keyword\">import</span> java.util.List;<br><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">HiveService</span> </span>&#123;<br><br>    <span class=\"hljs-function\">Object <span class=\"hljs-title\">select</span><span class=\"hljs-params\">(String hql)</span></span>;<br><br>    <span class=\"hljs-function\">List&lt;String&gt; <span class=\"hljs-title\">listAllTables</span><span class=\"hljs-params\">()</span></span>;<br><br>    <span class=\"hljs-function\">List&lt;String&gt; <span class=\"hljs-title\">describeTable</span><span class=\"hljs-params\">(String tableName)</span></span>;<br><br>    <span class=\"hljs-function\">List&lt;String&gt; <span class=\"hljs-title\">selectFromTable</span><span class=\"hljs-params\">(String tableName)</span></span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.service.impl;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.service.HiveService;<br><span class=\"hljs-keyword\">import</span> lombok.extern.slf4j.Slf4j;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Qualifier;<br><span class=\"hljs-keyword\">import</span> org.springframework.jdbc.core.JdbcTemplate;<br><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Service;<br><span class=\"hljs-keyword\">import</span> org.springframework.util.StringUtils;<br><br><span class=\"hljs-keyword\">import</span> javax.sql.DataSource;<br><span class=\"hljs-keyword\">import</span> java.sql.ResultSet;<br><span class=\"hljs-keyword\">import</span> java.sql.SQLException;<br><span class=\"hljs-keyword\">import</span> java.sql.Statement;<br><span class=\"hljs-keyword\">import</span> java.util.ArrayList;<br><span class=\"hljs-keyword\">import</span> java.util.Collections;<br><span class=\"hljs-keyword\">import</span> java.util.List;<br><br><span class=\"hljs-meta\">@Slf</span>4j<br><span class=\"hljs-meta\">@Service</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HiveServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">HiveService</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-meta\">@Qualifier</span>(<span class=\"hljs-string\">\"hiveJdbcTemplate\"</span>)<br>    <span class=\"hljs-keyword\">private</span> JdbcTemplate hiveJdbcTemplate;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-meta\">@Qualifier</span>(<span class=\"hljs-string\">\"hiveDruidDataSource\"</span>)<br>    <span class=\"hljs-keyword\">private</span> DataSource hiveDruidDataSource;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> Object <span class=\"hljs-title\">select</span><span class=\"hljs-params\">(String hql)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> hiveJdbcTemplate.queryForObject(hql, Object<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> List&lt;String&gt; <span class=\"hljs-title\">listAllTables</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        List&lt;String&gt; result = <span class=\"hljs-keyword\">new</span> ArrayList&lt;&gt;();<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Statement statement = hiveDruidDataSource.getConnection().createStatement();<br>            String sql = <span class=\"hljs-string\">\"show tables\"</span>;<br>            log.info(<span class=\"hljs-string\">\"Running: \"</span> + sql);<br>            ResultSet resultSet = statement.executeQuery(sql);<br>            <span class=\"hljs-keyword\">while</span> (resultSet.next()) &#123;<br>                result.add(resultSet.getString(<span class=\"hljs-number\">1</span>));<br>            &#125;<br>            <span class=\"hljs-keyword\">return</span> result;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (SQLException throwables) &#123;<br>            log.error(throwables.getMessage());<br>        &#125;<br><br>        <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> List&lt;String&gt; <span class=\"hljs-title\">describeTable</span><span class=\"hljs-params\">(String tableName)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(tableName))&#123;<br>            <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>        &#125;<br>        List&lt;String&gt; result = <span class=\"hljs-keyword\">new</span> ArrayList&lt;&gt;();<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Statement statement = hiveDruidDataSource.getConnection().createStatement();<br>            String sql = <span class=\"hljs-string\">\"describe \"</span> + tableName;<br>            log.info(<span class=\"hljs-string\">\"Running\"</span> + sql);<br>            ResultSet resultSet = statement.executeQuery(sql);<br>            <span class=\"hljs-keyword\">while</span> (resultSet.next()) &#123;<br>                result.add(resultSet.getString(<span class=\"hljs-number\">1</span>));<br>            &#125;<br>            <span class=\"hljs-keyword\">return</span> result;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (SQLException throwables) &#123;<br>            log.error(throwables.getMessage());<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> List&lt;String&gt; <span class=\"hljs-title\">selectFromTable</span><span class=\"hljs-params\">(String tableName)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(tableName))&#123;<br>            <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>        &#125;<br>        List&lt;String&gt; result = <span class=\"hljs-keyword\">new</span> ArrayList&lt;&gt;();<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Statement statement = hiveDruidDataSource.getConnection().createStatement();<br>            String sql = <span class=\"hljs-string\">\"select * from \"</span> + tableName;<br>            log.info(<span class=\"hljs-string\">\"Running\"</span> + sql);<br>            ResultSet resultSet = statement.executeQuery(sql);<br>            <span class=\"hljs-keyword\">int</span> columnCount = resultSet.getMetaData().getColumnCount();<br>            String str = <span class=\"hljs-keyword\">null</span>;<br>            <span class=\"hljs-keyword\">while</span> (resultSet.next()) &#123;<br>                str = <span class=\"hljs-string\">\"\"</span>;<br>                <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">1</span>; i &lt; columnCount; i++) &#123;<br>                    str += resultSet.getString(i) + <span class=\"hljs-string\">\" \"</span>;<br>                &#125;<br>                str += resultSet.getString(columnCount);<br>                log.info(str);<br>                result.add(str);<br>            &#125;<br>            <span class=\"hljs-keyword\">return</span> result;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (SQLException throwables) &#123;<br>            log.error(throwables.getMessage());<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>hive本身就是基于hadoop的MapReduce的一层封装，所以对于hive的操作都是查询和新增等操作，其他的api请参考jdbctemplate接口</p>\n<p>源码地址: </p>\n<p><a href=\"https://github.com/WinterChenS/springboot-learning-experience/tree/master/spring-boot-hadoop\" target=\"_blank\" rel=\"noopener\">WinterChenS/springboot-learning-experience</a></p>\n","raw":null,"categories":[{"name":"hadoop","path":"api/categories/hadoop.json"}],"tags":[{"name":"hadoop","path":"api/tags/hadoop.json"},{"name":"hive","path":"api/tags/hive.json"},{"name":"springboot","path":"api/tags/springboot.json"}]},{"title":"mongodb多数据源之mongotemplate和事务的配置","slug":"2020-12-28-mongodb-mutil-source","date":"2020-12-28T07:55:00.000Z","updated":"2022-12-01T01:32:39.783Z","comments":true,"top":null,"path":"api/articles/2020-12-28-mongodb-mutil-source.json","excerpt":null,"keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046758159575.jpg","content":"<blockquote>\n<p>题图：我的家乡，拍摄于2020年初疫情期间</p>\n</blockquote>\n<h2 id=\"maven坐标\"><a href=\"#maven坐标\" class=\"headerlink\" title=\"maven坐标\"></a>maven坐标</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-boot-starter-data-mongodb<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>2.1.13.RELEASE<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"多数据源配置\"><a href=\"#多数据源配置\" class=\"headerlink\" title=\"多数据源配置\"></a>多数据源配置</h2><p>配置文件：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">spring:</span><br>  <span class=\"hljs-attr\">data:</span><br>    <span class=\"hljs-attr\">mongodb:</span><br>      <span class=\"hljs-attr\">uri:</span> <span class=\"hljs-string\">mongodb://192.168.150.154:17017</span><br>      <span class=\"hljs-attr\">database:</span> <span class=\"hljs-string\">ewell-label</span><br>    <span class=\"hljs-attr\">mongodb-target:</span><br>      <span class=\"hljs-attr\">uri:</span> <span class=\"hljs-string\">mongodb://192.168.150.154:17017</span><br>      <span class=\"hljs-attr\">database:</span> <span class=\"hljs-string\">ewell-label-target</span><br></code></pre></td></tr></table></figure>\n\n<p>java配置：</p>\n<p>主数据源：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.label.service.configuration;<br><br><span class=\"hljs-keyword\">import</span> com.mongodb.MongoClient;<br><span class=\"hljs-keyword\">import</span> com.mongodb.MongoClientURI;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Qualifier;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Value;<br><span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.Bean;<br><span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.Configuration;<br><span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.Primary;<br><span class=\"hljs-keyword\">import</span> org.springframework.data.mongodb.MongoDbFactory;<br><span class=\"hljs-keyword\">import</span> org.springframework.data.mongodb.MongoTransactionManager;<br><span class=\"hljs-keyword\">import</span> org.springframework.data.mongodb.config.AbstractMongoConfiguration;<br><span class=\"hljs-keyword\">import</span> org.springframework.data.mongodb.core.MongoTemplate;<br><span class=\"hljs-keyword\">import</span> org.springframework.data.mongodb.core.SimpleMongoDbFactory;<br><span class=\"hljs-keyword\">import</span> org.springframework.data.mongodb.core.convert.DefaultDbRefResolver;<br><span class=\"hljs-keyword\">import</span> org.springframework.data.mongodb.core.convert.DefaultMongoTypeMapper;<br><span class=\"hljs-keyword\">import</span> org.springframework.data.mongodb.core.convert.MappingMongoConverter;<br><span class=\"hljs-keyword\">import</span> org.springframework.data.mongodb.core.mapping.MongoMappingContext;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/12/2 3:51 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span> 业务mongo数据源</span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">BusinessMongoConfig</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">AbstractMongoConfiguration</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.data.mongodb.uri&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String uri;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.data.mongodb.database&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String database;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">protected</span> String <span class=\"hljs-title\">getDatabaseName</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> database;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> MongoClient <span class=\"hljs-title\">mongoClient</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        MongoClientURI mongoClientURI = <span class=\"hljs-keyword\">new</span> MongoClientURI(uri);<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> MongoClient(mongoClientURI);<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Primary</span><br>    <span class=\"hljs-meta\">@Bean</span>(<span class=\"hljs-string\">\"mongoMappingContext\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> MongoMappingContext <span class=\"hljs-title\">mongoMappingContext</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        MongoMappingContext mappingContext = <span class=\"hljs-keyword\">new</span> MongoMappingContext();<br>        <span class=\"hljs-keyword\">return</span> mappingContext;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Primary</span><br>    <span class=\"hljs-meta\">@Bean</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> MongoTransactionManager <span class=\"hljs-title\">transactionManager</span><span class=\"hljs-params\">(@Qualifier(<span class=\"hljs-string\">\"mongoDbFactory\"</span>)</span> MongoDbFactory mongoDbFactory) <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> MongoTransactionManager(mongoDbFactory);<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Primary</span><br>    <span class=\"hljs-meta\">@Bean</span>(<span class=\"hljs-string\">\"mongoDbFactory\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> MongoDbFactory <span class=\"hljs-title\">mongoDbFactory</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> SimpleMongoDbFactory(mongoClient(), getDatabaseName());<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Primary</span><br>    <span class=\"hljs-meta\">@Bean</span>(<span class=\"hljs-string\">\"mappingMongoConverter\"</span>) <span class=\"hljs-comment\">//使用自定义的typeMapper去除写入mongodb时的“_class”字段</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> MappingMongoConverter <span class=\"hljs-title\">mappingMongoConverter</span><span class=\"hljs-params\">(@Qualifier(<span class=\"hljs-string\">\"mongoDbFactory\"</span>)</span> MongoDbFactory mongoDbFactory,</span><br><span class=\"hljs-function\">                                                       @<span class=\"hljs-title\">Qualifier</span><span class=\"hljs-params\">(<span class=\"hljs-string\">\"mongoMappingContext\"</span>)</span> MongoMappingContext mongoMappingContext) <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>        DefaultDbRefResolver dbRefResolver = <span class=\"hljs-keyword\">new</span> DefaultDbRefResolver(mongoDbFactory);<br>        MappingMongoConverter converter = <span class=\"hljs-keyword\">new</span> MappingMongoConverter(dbRefResolver, mongoMappingContext);<br>        converter.setTypeMapper(<span class=\"hljs-keyword\">new</span> DefaultMongoTypeMapper(<span class=\"hljs-keyword\">null</span>));<br>        <span class=\"hljs-keyword\">return</span> converter;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Primary</span><br>    <span class=\"hljs-meta\">@Bean</span>(name = <span class=\"hljs-string\">\"mongoTemplate\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> MongoTemplate <span class=\"hljs-title\">getMongoTemplate</span><span class=\"hljs-params\">(@Qualifier(<span class=\"hljs-string\">\"mongoDbFactory\"</span>)</span> MongoDbFactory mongoDbFactory,</span><br><span class=\"hljs-function\">                                          @<span class=\"hljs-title\">Qualifier</span><span class=\"hljs-params\">(<span class=\"hljs-string\">\"mappingMongoConverter\"</span>)</span> MappingMongoConverter mappingMongoConverter) <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> MongoTemplate(mongoDbFactory, mappingMongoConverter);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>第二数据源</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.label.service.configuration;<br><br><span class=\"hljs-keyword\">import</span> com.mongodb.MongoClient;<br><span class=\"hljs-keyword\">import</span> com.mongodb.MongoClientURI;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Qualifier;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Value;<br><span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.Bean;<br><span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.Configuration;<br><span class=\"hljs-keyword\">import</span> org.springframework.data.mongodb.MongoDbFactory;<br><span class=\"hljs-keyword\">import</span> org.springframework.data.mongodb.MongoTransactionManager;<br><span class=\"hljs-keyword\">import</span> org.springframework.data.mongodb.config.AbstractMongoConfiguration;<br><span class=\"hljs-keyword\">import</span> org.springframework.data.mongodb.core.MongoTemplate;<br><span class=\"hljs-keyword\">import</span> org.springframework.data.mongodb.core.SimpleMongoDbFactory;<br><span class=\"hljs-keyword\">import</span> org.springframework.data.mongodb.core.convert.DefaultDbRefResolver;<br><span class=\"hljs-keyword\">import</span> org.springframework.data.mongodb.core.convert.DefaultMongoTypeMapper;<br><span class=\"hljs-keyword\">import</span> org.springframework.data.mongodb.core.convert.MappingMongoConverter;<br><span class=\"hljs-keyword\">import</span> org.springframework.data.mongodb.core.mapping.MongoMappingContext;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/12/2 3:53 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span> TODO</span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">TargetMongoConfig</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">AbstractMongoConfiguration</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.data.mongodb-target.uri&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String uri;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.data.mongodb-target.database&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String database;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">protected</span> String <span class=\"hljs-title\">getDatabaseName</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> database;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> MongoClient <span class=\"hljs-title\">mongoClient</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        MongoClientURI mongoClientURI = <span class=\"hljs-keyword\">new</span> MongoClientURI(uri);<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> MongoClient(mongoClientURI);<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Bean</span>(<span class=\"hljs-string\">\"targetMongoMappingContext\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> MongoMappingContext <span class=\"hljs-title\">mongoMappingContext</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        MongoMappingContext mappingContext = <span class=\"hljs-keyword\">new</span> MongoMappingContext();<br>        <span class=\"hljs-keyword\">return</span> mappingContext;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Bean</span>(<span class=\"hljs-string\">\"TARGET_MONGO_TRANSACTION_MANAGER\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> MongoTransactionManager <span class=\"hljs-title\">transactionManager</span><span class=\"hljs-params\">(@Qualifier(<span class=\"hljs-string\">\"targetMongoDbFactory\"</span>)</span> MongoDbFactory mongoDbFactory) <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> MongoTransactionManager(mongoDbFactory);<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Bean</span>(<span class=\"hljs-string\">\"targetMongoDbFactory\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> MongoDbFactory <span class=\"hljs-title\">mongoDbFactory</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> SimpleMongoDbFactory(mongoClient(), getDatabaseName());<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Bean</span>(<span class=\"hljs-string\">\"targetMappingMongoConverter\"</span>) <span class=\"hljs-comment\">//使用自定义的typeMapper去除写入mongodb时的“_class”字段</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> MappingMongoConverter <span class=\"hljs-title\">mappingMongoConverter</span><span class=\"hljs-params\">(@Qualifier(<span class=\"hljs-string\">\"targetMongoDbFactory\"</span>)</span> MongoDbFactory mongoDbFactory,</span><br><span class=\"hljs-function\">                                                       @<span class=\"hljs-title\">Qualifier</span><span class=\"hljs-params\">(<span class=\"hljs-string\">\"targetMongoMappingContext\"</span>)</span> MongoMappingContext mongoMappingContext) <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>        DefaultDbRefResolver dbRefResolver = <span class=\"hljs-keyword\">new</span> DefaultDbRefResolver(mongoDbFactory);<br>        MappingMongoConverter converter = <span class=\"hljs-keyword\">new</span> MappingMongoConverter(dbRefResolver, mongoMappingContext);<br>        converter.setTypeMapper(<span class=\"hljs-keyword\">new</span> DefaultMongoTypeMapper(<span class=\"hljs-keyword\">null</span>));<br>        <span class=\"hljs-keyword\">return</span> converter;<br>    &#125;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * MongoTemplate实现</span><br><span class=\"hljs-comment\">     */</span><br>    <span class=\"hljs-meta\">@Bean</span>(name = <span class=\"hljs-string\">\"targetMongoTemplate\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> MongoTemplate <span class=\"hljs-title\">getMongoTemplate</span><span class=\"hljs-params\">(@Qualifier(<span class=\"hljs-string\">\"targetMongoDbFactory\"</span>)</span> MongoDbFactory mongoDbFactory,</span><br><span class=\"hljs-function\">                                          @<span class=\"hljs-title\">Qualifier</span><span class=\"hljs-params\">(<span class=\"hljs-string\">\"mappingMongoConverter\"</span>)</span> MappingMongoConverter mappingMongoConverter) <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> MongoTemplate(mongoDbFactory, mappingMongoConverter);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"使用\"><a href=\"#使用\" class=\"headerlink\" title=\"使用\"></a>使用</h2><p>默认的使用：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Autowired</span><br>  <span class=\"hljs-keyword\">private</span> MongoTemplate mongoTemplate;<br></code></pre></td></tr></table></figure>\n\n<p>使用另一个数据源，只需要指定名称即可:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Autowired</span><br>  <span class=\"hljs-meta\">@Qualifier</span>(<span class=\"hljs-string\">\"targetMongoTemplate\"</span>)<br>  <span class=\"hljs-keyword\">private</span> MongoTemplate targetMongoTemplate;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"事务\"><a href=\"#事务\" class=\"headerlink\" title=\"事务\"></a>事务</h2><p>普通的：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Transactional</span>(rollbackFor = Throwable<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span><br></code></pre></td></tr></table></figure>\n\n<p>其他数据源指定事务管理器即可</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Transactional</span>(rollbackFor = Throwable<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>, <span class=\"hljs-title\">transactionManager</span> </span>= <span class=\"hljs-string\">\"TARGET_MONGO_TRANSACTION_MANAGER\"</span>)<br></code></pre></td></tr></table></figure>\n\n<p>注意：两种事务不能混合使用</p>\n","raw":null,"categories":[{"name":"mongodb","path":"api/categories/mongodb.json"}],"tags":[{"name":"springboot","path":"api/tags/springboot.json"},{"name":"mongodb","path":"api/tags/mongodb.json"},{"name":"mongotemplate","path":"api/tags/mongotemplate.json"},{"name":"transactional","path":"api/tags/transactional.json"}]},{"title":"springboot 整合 Shardingsphere 4.0 分库分表","slug":"2020-04-21-sharingsphere-springboot","date":"2020-04-21T05:50:00.000Z","updated":"2022-12-01T01:32:39.783Z","comments":true,"top":null,"path":"api/articles/2020-04-21-sharingsphere-springboot.json","excerpt":null,"keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046447745919.png","content":"<blockquote>\n<p>最近Shardingsphere在Apache Software Foundation 简称ASF 毕业成为Apache顶级项目，也是目前ASF收个分布式数据库中间件项目，未来可期啊，今天我们就搭建一下springboot整合Shardingsphere4.0版本。</p>\n</blockquote>\n<h2 id=\"依赖：\"><a href=\"#依赖：\" class=\"headerlink\" title=\"依赖：\"></a>依赖：</h2><ul>\n<li>jdk1.8</li>\n<li>maven3.6.3</li>\n<li>mybatis plus</li>\n<li>mysql8.0</li>\n<li>Shardingsphere 4.0</li>\n</ul>\n<h2 id=\"数据库的结构：\"><a href=\"#数据库的结构：\" class=\"headerlink\" title=\"数据库的结构：\"></a>数据库的结构：</h2><p>–|<br>  |- ds0<br>  |   |- t_order0<br>  |   |- t_order1<br>  |<br>  |- ds1<br>      |- t_order0<br>      |- t_order1</p>\n<h3 id=\"创建数据库\"><a href=\"#创建数据库\" class=\"headerlink\" title=\"创建数据库\"></a>创建数据库</h3><h4 id=\"数据库ds0\"><a href=\"#数据库ds0\" class=\"headerlink\" title=\"数据库ds0\"></a>数据库ds0</h4><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">DATABASE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-keyword\">EXISTS</span> <span class=\"hljs-string\">`ds0`</span> <span class=\"hljs-comment\">/*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci */</span>;<br><span class=\"hljs-keyword\">USE</span> <span class=\"hljs-string\">`ds0`</span>;<br><br><span class=\"hljs-keyword\">SET</span> <span class=\"hljs-keyword\">NAMES</span> utf8mb4;<br><span class=\"hljs-keyword\">SET</span> FOREIGN_KEY_CHECKS = <span class=\"hljs-number\">0</span>;<br><br><span class=\"hljs-comment\">-- ----------------------------</span><br><span class=\"hljs-comment\">-- Table structure for t_order0</span><br><span class=\"hljs-comment\">-- ----------------------------</span><br><span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> <span class=\"hljs-string\">`t_order0`</span>;<br><span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-string\">`t_order0`</span>  (<br>  <span class=\"hljs-string\">`order_id`</span> <span class=\"hljs-built_in\">bigint</span>(<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">COMMENT</span> <span class=\"hljs-string\">'订单号（主键）'</span>,<br>  <span class=\"hljs-string\">`order_name`</span> <span class=\"hljs-built_in\">varchar</span>(<span class=\"hljs-number\">255</span>) <span class=\"hljs-built_in\">CHARACTER</span> <span class=\"hljs-keyword\">SET</span> utf8mb4 <span class=\"hljs-keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">COMMENT</span> <span class=\"hljs-string\">'订单名称'</span>,<br>  <span class=\"hljs-string\">`order_status`</span> <span class=\"hljs-built_in\">int</span>(<span class=\"hljs-number\">0</span>) <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">COMMENT</span> <span class=\"hljs-string\">'订单状态'</span>,<br>  <span class=\"hljs-string\">`user_id`</span> <span class=\"hljs-built_in\">bigint</span>(<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">COMMENT</span> <span class=\"hljs-string\">'用户id'</span>,<br>  PRIMARY <span class=\"hljs-keyword\">KEY</span> (<span class=\"hljs-string\">`order_id`</span>) <span class=\"hljs-keyword\">USING</span> BTREE<br>) <span class=\"hljs-keyword\">ENGINE</span> = <span class=\"hljs-keyword\">InnoDB</span> <span class=\"hljs-built_in\">CHARACTER</span> <span class=\"hljs-keyword\">SET</span> = utf8mb4 <span class=\"hljs-keyword\">COLLATE</span> = utf8mb4_general_ci ROW_FORMAT = Dynamic;<br><br><span class=\"hljs-comment\">-- ----------------------------</span><br><span class=\"hljs-comment\">-- Table structure for t_order1</span><br><span class=\"hljs-comment\">-- ----------------------------</span><br><span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> <span class=\"hljs-string\">`t_order1`</span>;<br><span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-string\">`t_order1`</span>  (<br>  <span class=\"hljs-string\">`order_id`</span> <span class=\"hljs-built_in\">bigint</span>(<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">COMMENT</span> <span class=\"hljs-string\">'订单号（主键）'</span>,<br>  <span class=\"hljs-string\">`order_name`</span> <span class=\"hljs-built_in\">varchar</span>(<span class=\"hljs-number\">255</span>) <span class=\"hljs-built_in\">CHARACTER</span> <span class=\"hljs-keyword\">SET</span> utf8mb4 <span class=\"hljs-keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">COMMENT</span> <span class=\"hljs-string\">'订单名称'</span>,<br>  <span class=\"hljs-string\">`order_status`</span> <span class=\"hljs-built_in\">int</span>(<span class=\"hljs-number\">0</span>) <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">COMMENT</span> <span class=\"hljs-string\">'订单状态'</span>,<br>  <span class=\"hljs-string\">`user_id`</span> <span class=\"hljs-built_in\">bigint</span>(<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">COMMENT</span> <span class=\"hljs-string\">'用户id'</span>,<br>  PRIMARY <span class=\"hljs-keyword\">KEY</span> (<span class=\"hljs-string\">`order_id`</span>) <span class=\"hljs-keyword\">USING</span> BTREE<br>) <span class=\"hljs-keyword\">ENGINE</span> = <span class=\"hljs-keyword\">InnoDB</span> <span class=\"hljs-built_in\">CHARACTER</span> <span class=\"hljs-keyword\">SET</span> = utf8mb4 <span class=\"hljs-keyword\">COLLATE</span> = utf8mb4_general_ci ROW_FORMAT = Dynamic;<br><br><span class=\"hljs-keyword\">SET</span> FOREIGN_KEY_CHECKS = <span class=\"hljs-number\">1</span>;<br></code></pre></td></tr></table></figure>\n\n<h4 id=\"数据库ds1\"><a href=\"#数据库ds1\" class=\"headerlink\" title=\"数据库ds1\"></a>数据库ds1</h4><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">DATABASE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-keyword\">EXISTS</span> <span class=\"hljs-string\">`ds1`</span> <span class=\"hljs-comment\">/*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci */</span>;<br><span class=\"hljs-keyword\">USE</span> <span class=\"hljs-string\">`ds1`</span>;<br><br><span class=\"hljs-keyword\">SET</span> <span class=\"hljs-keyword\">NAMES</span> utf8mb4;<br><span class=\"hljs-keyword\">SET</span> FOREIGN_KEY_CHECKS = <span class=\"hljs-number\">0</span>;<br><br><span class=\"hljs-comment\">-- ----------------------------</span><br><span class=\"hljs-comment\">-- Table structure for t_order0</span><br><span class=\"hljs-comment\">-- ----------------------------</span><br><span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> <span class=\"hljs-string\">`t_order0`</span>;<br><span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-string\">`t_order0`</span>  (<br>  <span class=\"hljs-string\">`order_id`</span> <span class=\"hljs-built_in\">bigint</span>(<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">COMMENT</span> <span class=\"hljs-string\">'订单号（主键）'</span>,<br>  <span class=\"hljs-string\">`order_name`</span> <span class=\"hljs-built_in\">varchar</span>(<span class=\"hljs-number\">255</span>) <span class=\"hljs-built_in\">CHARACTER</span> <span class=\"hljs-keyword\">SET</span> utf8mb4 <span class=\"hljs-keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">COMMENT</span> <span class=\"hljs-string\">'订单名称'</span>,<br>  <span class=\"hljs-string\">`order_status`</span> <span class=\"hljs-built_in\">int</span>(<span class=\"hljs-number\">0</span>) <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">COMMENT</span> <span class=\"hljs-string\">'订单状态'</span>,<br>  <span class=\"hljs-string\">`user_id`</span> <span class=\"hljs-built_in\">bigint</span>(<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">COMMENT</span> <span class=\"hljs-string\">'用户id'</span>,<br>  PRIMARY <span class=\"hljs-keyword\">KEY</span> (<span class=\"hljs-string\">`order_id`</span>) <span class=\"hljs-keyword\">USING</span> BTREE<br>) <span class=\"hljs-keyword\">ENGINE</span> = <span class=\"hljs-keyword\">InnoDB</span> <span class=\"hljs-built_in\">CHARACTER</span> <span class=\"hljs-keyword\">SET</span> = utf8mb4 <span class=\"hljs-keyword\">COLLATE</span> = utf8mb4_general_ci ROW_FORMAT = Dynamic;<br><br><span class=\"hljs-comment\">-- ----------------------------</span><br><span class=\"hljs-comment\">-- Table structure for t_order1</span><br><span class=\"hljs-comment\">-- ----------------------------</span><br><span class=\"hljs-keyword\">DROP</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-keyword\">IF</span> <span class=\"hljs-keyword\">EXISTS</span> <span class=\"hljs-string\">`t_order1`</span>;<br><span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> <span class=\"hljs-string\">`t_order1`</span>  (<br>  <span class=\"hljs-string\">`order_id`</span> <span class=\"hljs-built_in\">bigint</span>(<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">COMMENT</span> <span class=\"hljs-string\">'订单号（主键）'</span>,<br>  <span class=\"hljs-string\">`order_name`</span> <span class=\"hljs-built_in\">varchar</span>(<span class=\"hljs-number\">255</span>) <span class=\"hljs-built_in\">CHARACTER</span> <span class=\"hljs-keyword\">SET</span> utf8mb4 <span class=\"hljs-keyword\">COLLATE</span> utf8mb4_general_ci <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">COMMENT</span> <span class=\"hljs-string\">'订单名称'</span>,<br>  <span class=\"hljs-string\">`order_status`</span> <span class=\"hljs-built_in\">int</span>(<span class=\"hljs-number\">0</span>) <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">COMMENT</span> <span class=\"hljs-string\">'订单状态'</span>,<br>  <span class=\"hljs-string\">`user_id`</span> <span class=\"hljs-built_in\">bigint</span>(<span class=\"hljs-number\">0</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> <span class=\"hljs-keyword\">COMMENT</span> <span class=\"hljs-string\">'用户id'</span>,<br>  PRIMARY <span class=\"hljs-keyword\">KEY</span> (<span class=\"hljs-string\">`order_id`</span>) <span class=\"hljs-keyword\">USING</span> BTREE<br>) <span class=\"hljs-keyword\">ENGINE</span> = <span class=\"hljs-keyword\">InnoDB</span> <span class=\"hljs-built_in\">CHARACTER</span> <span class=\"hljs-keyword\">SET</span> = utf8mb4 <span class=\"hljs-keyword\">COLLATE</span> = utf8mb4_general_ci ROW_FORMAT = Dynamic;<br><br><span class=\"hljs-keyword\">SET</span> FOREIGN_KEY_CHECKS = <span class=\"hljs-number\">1</span>;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"pom-xml\"><a href=\"#pom-xml\" class=\"headerlink\" title=\"pom.xml\"></a>pom.xml</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">project</span> <span class=\"hljs-attr\">xmlns</span>=<span class=\"hljs-string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"hljs-attr\">xmlns:xsi</span>=<span class=\"hljs-string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span><br><span class=\"hljs-tag\">         <span class=\"hljs-attr\">xsi:schemaLocation</span>=<span class=\"hljs-string\">\"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd\"</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">modelVersion</span>&gt;</span>4.0.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">modelVersion</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">parent</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>2.2.6.RELEASE<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">relativePath</span>/&gt;</span> <span class=\"hljs-comment\">&lt;!-- lookup parent from repository --&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">parent</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.winterchen<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>shardingsphere-demo<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>shardingsphere-demo<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">description</span>&gt;</span>shardingsphere demo<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">description</span>&gt;</span><br><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">properties</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">java.version</span>&gt;</span>1.8<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">java.version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sharding-sphere.version</span>&gt;</span>4.0.1<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sharding-sphere.version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">properties</span>&gt;</span><br><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependencies</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-comment\">&lt;!--mysql，根据自己数据库版本进行相关调整，不然会报错--&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>mysql<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>8.0.13<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>runtime<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-comment\">&lt;!--Mybatis-Plus--&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.baomidou<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>3.1.1<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-comment\">&lt;!-- for spring boot --&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.shardingsphere<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>sharding-jdbc-spring-boot-starter<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;sharding-sphere.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br>        <span class=\"hljs-comment\">&lt;!-- for spring namespace --&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.shardingsphere<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>sharding-jdbc-spring-namespace<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;sharding-sphere.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependencies</span>&gt;</span><br><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">build</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugins</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugin</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugin</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugins</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">build</span>&gt;</span><br><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">project</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>注意：数据库驱动版本，请根据自己数据库版本进行相关调整，不然会报错</p>\n</blockquote>\n<h2 id=\"项目配置\"><a href=\"#项目配置\" class=\"headerlink\" title=\"项目配置\"></a>项目配置</h2><h3 id=\"application-properties\"><a href=\"#application-properties\" class=\"headerlink\" title=\"application.properties\"></a>application.properties</h3><figure class=\"highlight properties\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs properties\"><span class=\"hljs-meta\">server.port</span>=<span class=\"hljs-string\">8098</span><br><br><span class=\"hljs-comment\"># 数据源 ds0,ds1</span><br><span class=\"hljs-meta\">spring.shardingsphere.datasource.names</span>=<span class=\"hljs-string\">ds0,ds1</span><br><span class=\"hljs-comment\"># 第一个数据库</span><br><span class=\"hljs-meta\">spring.shardingsphere.datasource.ds0.type</span>=<span class=\"hljs-string\">com.zaxxer.hikari.HikariDataSource</span><br><span class=\"hljs-meta\">spring.shardingsphere.datasource.ds0.driver-class-name</span>=<span class=\"hljs-string\">com.mysql.cj.jdbc.Driver</span><br><span class=\"hljs-meta\">spring.shardingsphere.datasource.ds0.jdbc-url</span>=<span class=\"hljs-string\">jdbc:mysql://192.168.133.134:3306/ds0?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf8&amp;characterSetResults=utf8&amp;useSSL=false&amp;verifyServerCertificate=false&amp;autoReconnct=true&amp;autoReconnectForPools=true&amp;allowMultiQueries=true</span><br><span class=\"hljs-meta\">spring.shardingsphere.datasource.ds0.username</span>=<span class=\"hljs-string\">root</span><br><span class=\"hljs-meta\">spring.shardingsphere.datasource.ds0.password</span>=<span class=\"hljs-string\">root</span><br><br><span class=\"hljs-comment\"># 第二个数据库</span><br><span class=\"hljs-meta\">spring.shardingsphere.datasource.ds1.type</span>=<span class=\"hljs-string\">com.zaxxer.hikari.HikariDataSource</span><br><span class=\"hljs-meta\">spring.shardingsphere.datasource.ds1.driver-class-name</span>=<span class=\"hljs-string\">com.mysql.cj.jdbc.Driver</span><br><span class=\"hljs-meta\">spring.shardingsphere.datasource.ds1.jdbc-url</span>=<span class=\"hljs-string\">jdbc:mysql://192.168.133.134:3306/ds1?serverTimezone=UTC&amp;useUnicode=true&amp;characterEncoding=utf8&amp;characterSetResults=utf8&amp;useSSL=false&amp;verifyServerCertificate=false&amp;autoReconnct=true&amp;autoReconnectForPools=true&amp;allowMultiQueries=true</span><br><span class=\"hljs-meta\">spring.shardingsphere.datasource.ds1.username</span>=<span class=\"hljs-string\">root</span><br><span class=\"hljs-meta\">spring.shardingsphere.datasource.ds1.password</span>=<span class=\"hljs-string\">root</span><br><br><span class=\"hljs-comment\"># 水平拆分的数据库（表） 配置分库 + 分表策略 行表达式分片策略</span><br><span class=\"hljs-comment\"># 分库策略</span><br><span class=\"hljs-meta\">spring.shardingsphere.sharding.default-database-strategy.inline.sharding-column</span>=<span class=\"hljs-string\">user_id</span><br><span class=\"hljs-meta\">spring.shardingsphere.sharding.default-database-strategy.inline.algorithm-expression</span>=<span class=\"hljs-string\">ds$-&gt;&#123;user_id % 2&#125;</span><br><br><br><span class=\"hljs-comment\"># 分表策略 其中t_order为逻辑表 分表主要取决于order_id行</span><br><span class=\"hljs-meta\">spring.shardingsphere.sharding.tables.t_order.actual-data-nodes</span>=<span class=\"hljs-string\">ds$-&gt;&#123;0..1&#125;.t_order$-&gt;&#123;0..1&#125;</span><br><span class=\"hljs-meta\">spring.shardingsphere.sharding.tables.t_order.table-strategy.inline.sharding-column</span>=<span class=\"hljs-string\">order_id</span><br><span class=\"hljs-meta\">spring.shardingsphere.sharding.tables.t_order.key-generator.column</span>=<span class=\"hljs-string\">order_id</span><br><span class=\"hljs-meta\">spring.shardingsphere.sharding.tables.t_order.key-generator.type</span>=<span class=\"hljs-string\">SNOWFLAKE</span><br><br><span class=\"hljs-comment\"># 分片算法表达式</span><br><span class=\"hljs-meta\">spring.shardingsphere.sharding.tables.t_order.table-strategy.inline.algorithm-expression</span>=<span class=\"hljs-string\">t_order$-&gt;&#123;order_id % 2&#125;</span><br><br><br><span class=\"hljs-comment\"># 打印执行的数据库以及语句</span><br><span class=\"hljs-meta\">spring.shardingsphere.props.sql.show</span>=<span class=\"hljs-string\">true</span><br><span class=\"hljs-meta\">spring.main.allow-bean-definition-overriding</span>=<span class=\"hljs-string\">true</span><br><br><br><span class=\"hljs-comment\"># mybatis-plus</span><br><span class=\"hljs-meta\">mybatis-plus.mapper-locations</span>=<span class=\"hljs-string\">classpath:/mapper/*.xml</span><br><span class=\"hljs-meta\">mybatis-plus.configuration.jdbc-type-for-null</span>=<span class=\"hljs-string\">'null'</span><br></code></pre></td></tr></table></figure>\n<blockquote>\n<p>注意：数据库连接配置、mybatis-plus扫包路径，需要根据实际情况进行改变</p>\n</blockquote>\n<p>以上的配置实现了分库分表，一下几点概念需要明白：</p>\n<h3 id=\"逻辑表\"><a href=\"#逻辑表\" class=\"headerlink\" title=\"逻辑表\"></a>逻辑表</h3><p>水平拆分的数据库（表）的相同逻辑和数据结构表的总称。例：订单数据根据主键尾数拆分为10张表，分别是t_order0到t_order9，他们的逻辑表名为t_order。</p>\n<h3 id=\"真实表\"><a href=\"#真实表\" class=\"headerlink\" title=\"真实表\"></a>真实表</h3><p>在分片的数据库中真实存在的物理表。即上个示例中的t_order0到t_order9。</p>\n<h3 id=\"数据节点\"><a href=\"#数据节点\" class=\"headerlink\" title=\"数据节点\"></a>数据节点</h3><p>数据分片的最小单元。由数据源名称和数据表组成，例：ds0.t_order0。</p>\n<h3 id=\"分片键\"><a href=\"#分片键\" class=\"headerlink\" title=\"分片键\"></a>分片键</h3><p>用于分片的数据库字段，是将数据库(表)水平拆分的关键字段。例：将订单表中的订单主键的尾数取模分片，则订单主键为分片字段。 SQL中如果无分片字段，将执行全路由，性能较差。 除了对单分片字段的支持，ShardingSphere也支持根据多个字段进行分片。</p>\n<h3 id=\"分片算法\"><a href=\"#分片算法\" class=\"headerlink\" title=\"分片算法\"></a>分片算法</h3><p>通过分片算法将数据分片，支持通过=、&gt;=、&lt;=、&gt;、&lt;、BETWEEN和IN分片。分片算法需要应用方开发者自行实现，可实现的灵活度非常高。</p>\n<p>目前提供4种分片算法。由于分片算法和业务实现紧密相关，因此并未提供内置分片算法，而是通过分片策略将各种场景提炼出来，提供更高层级的抽象，并提供接口让应用开发者自行实现分片算法。</p>\n<ul>\n<li>精确分片算法</li>\n</ul>\n<p>对应PreciseShardingAlgorithm，用于处理使用单一键作为分片键的=与IN进行分片的场景。需要配合StandardShardingStrategy使用。</p>\n<ul>\n<li>范围分片算法</li>\n</ul>\n<p>对应RangeShardingAlgorithm，用于处理使用单一键作为分片键的BETWEEN AND、&gt;、&lt;、&gt;=、&lt;=进行分片的场景。需要配合StandardShardingStrategy使用。</p>\n<ul>\n<li>复合分片算法</li>\n</ul>\n<p>对应ComplexKeysShardingAlgorithm，用于处理使用多键作为分片键进行分片的场景，包含多个分片键的逻辑较复杂，需要应用开发者自行处理其中的复杂度。需要配合ComplexShardingStrategy使用。</p>\n<ul>\n<li>Hint分片算法</li>\n</ul>\n<p>对应HintShardingAlgorithm，用于处理使用Hint行分片的场景。需要配合HintShardingStrategy使用。</p>\n<h3 id=\"分片策略\"><a href=\"#分片策略\" class=\"headerlink\" title=\"分片策略\"></a>分片策略</h3><p>包含分片键和分片算法，由于分片算法的独立性，将其独立抽离。真正可用于分片操作的是分片键 + 分片算法，也就是分片策略。目前提供5种分片策略。</p>\n<ul>\n<li>标准分片策略</li>\n</ul>\n<p>对应StandardShardingStrategy。提供对SQL语句中的=, &gt;, &lt;, &gt;=, &lt;=, IN和BETWEEN AND的分片操作支持。StandardShardingStrategy只支持单分片键，提供PreciseShardingAlgorithm和RangeShardingAlgorithm两个分片算法。PreciseShardingAlgorithm是必选的，用于处理=和IN的分片。RangeShardingAlgorithm是可选的，用于处理BETWEEN AND, &gt;, &lt;, &gt;=, &lt;=分片，如果不配置RangeShardingAlgorithm，SQL中的BETWEEN AND将按照全库路由处理。</p>\n<ul>\n<li>复合分片策略</li>\n</ul>\n<p>对应ComplexShardingStrategy。复合分片策略。提供对SQL语句中的=, &gt;, &lt;, &gt;=, &lt;=, IN和BETWEEN AND的分片操作支持。ComplexShardingStrategy支持多分片键，由于多分片键之间的关系复杂，因此并未进行过多的封装，而是直接将分片键值组合以及分片操作符透传至分片算法，完全由应用开发者实现，提供最大的灵活度。</p>\n<ul>\n<li>行表达式分片策略</li>\n</ul>\n<p>对应InlineShardingStrategy。使用Groovy的表达式，提供对SQL语句中的=和IN的分片操作支持，只支持单分片键。对于简单的分片算法，可以通过简单的配置使用，从而避免繁琐的Java代码开发，如: t_user_$-&gt;{u_id % 8} 表示t_user表根据u_id模8，而分成8张表，表名称为t_user_0到t_user_7。</p>\n<ul>\n<li>Hint分片策略</li>\n</ul>\n<p>对应HintShardingStrategy。通过Hint指定分片值而非从SQL中提取分片值的方式进行分片的策略。</p>\n<ul>\n<li>不分片策略</li>\n</ul>\n<p>对应NoneShardingStrategy。不分片的策略。</p>\n<h3 id=\"SQL-Hint\"><a href=\"#SQL-Hint\" class=\"headerlink\" title=\"SQL Hint\"></a>SQL Hint</h3><p>对于分片字段非SQL决定，而由其他外置条件决定的场景，可使用SQL Hint灵活的注入分片字段。例：内部系统，按照员工登录主键分库，而数据库中并无此字段。SQL Hint支持通过Java API和SQL注释(待实现)两种方式使用。</p>\n<h3 id=\"自增主键生成策略\"><a href=\"#自增主键生成策略\" class=\"headerlink\" title=\"自增主键生成策略\"></a>自增主键生成策略</h3><p>通过在客户端生成自增主键替换以数据库原生自增主键的方式，做到分布式主键无重复。 采用UUID.randomUUID()的方式产生分布式主键。或者 SNOWFLAKE</p>\n<h2 id=\"mybatis-plus\"><a href=\"#mybatis-plus\" class=\"headerlink\" title=\"mybatis-plus\"></a>mybatis-plus</h2><p>mybatis-plus极大的提高了开发效率，简单的配置和使用mybatis-plus</p>\n<p>配置mybatis-plus的分页</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.shardingspheredemo.configuration;<br><br><br><span class=\"hljs-meta\">@EnableTransactionManagement</span><br><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-meta\">@MapperScan</span>(<span class=\"hljs-string\">\"com.winterchen.shardingspheredemo.dao\"</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MybatisPlusConfig</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Bean</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> PaginationInterceptor <span class=\"hljs-title\">paginationInterceptor</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        PaginationInterceptor paginationInterceptor = <span class=\"hljs-keyword\">new</span> PaginationInterceptor();<br>        <span class=\"hljs-comment\">// 设置请求的页面大于最大页后操作， true调回到首页，false 继续请求  默认false</span><br>        <span class=\"hljs-comment\">// paginationInterceptor.setOverflow(false);</span><br>        <span class=\"hljs-comment\">// 设置最大单页限制数量，默认 500 条，-1 不受限制</span><br>        <span class=\"hljs-comment\">// paginationInterceptor.setLimit(500);</span><br>        <span class=\"hljs-comment\">// 开启 count 的 join 优化,只针对部分 left join</span><br>        paginationInterceptor.setCountSqlParser(<span class=\"hljs-keyword\">new</span> JsqlParserCountOptimize());<br>        <span class=\"hljs-keyword\">return</span> paginationInterceptor;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>配置自定义的通用mapper</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.shardingspheredemo.configuration;<br><br><span class=\"hljs-keyword\">import</span> java.util.Map;<br><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">MyBaseMapper</span>&lt;<span class=\"hljs-title\">T</span>&gt; <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">BaseMapper</span>&lt;<span class=\"hljs-title\">T</span>&gt; </span>&#123;<br><br>    <span class=\"hljs-function\">IPage&lt;T&gt; <span class=\"hljs-title\">selectAllByCondition</span><span class=\"hljs-params\">(Page&lt;?&gt; page, @Param(<span class=\"hljs-string\">\"condition\"</span>)</span>Map&lt;String, Object&gt; condition)</span>;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">deleteById</span><span class=\"hljs-params\">(@Param(<span class=\"hljs-string\">\"condition\"</span>)</span>Map&lt;String, Object&gt; condition)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><h3 id=\"实体类\"><a href=\"#实体类\" class=\"headerlink\" title=\"实体类\"></a>实体类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.shardingspheredemo.model;<br><br><br><span class=\"hljs-meta\">@TableName</span>(<span class=\"hljs-string\">\"t_order\"</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">OrderInfo</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@TableId</span>(value = <span class=\"hljs-string\">\"order_id\"</span>)<br>    <span class=\"hljs-keyword\">private</span> Long orderId;<br><br>    <span class=\"hljs-meta\">@TableField</span>(value = <span class=\"hljs-string\">\"order_name\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String orderName;<br><br>    <span class=\"hljs-meta\">@TableField</span>(value = <span class=\"hljs-string\">\"order_status\"</span>)<br>    <span class=\"hljs-keyword\">private</span> Integer orderStatus;<br><br>    <span class=\"hljs-meta\">@TableField</span>(value = <span class=\"hljs-string\">\"user_id\"</span>)<br>    <span class=\"hljs-keyword\">private</span> Long userId;<br><br>    <span class=\"hljs-comment\">//省略get/set</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"Mapper\"><a href=\"#Mapper\" class=\"headerlink\" title=\"Mapper\"></a>Mapper</h3><h4 id=\"mapper\"><a href=\"#mapper\" class=\"headerlink\" title=\"mapper\"></a>mapper</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.shardingspheredemo.dao;<br><br><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">OrderMapper</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">MyBaseMapper</span>&lt;<span class=\"hljs-title\">OrderInfo</span>&gt; </span>&#123;<br><br>    <span class=\"hljs-function\">IPage&lt;OrderInfo&gt; <span class=\"hljs-title\">selectAllByCondition</span><span class=\"hljs-params\">(Page&lt;?&gt; page, @Param(<span class=\"hljs-string\">\"condition\"</span>)</span> Map&lt;String, Object&gt; condition)</span>;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">deleteById</span><span class=\"hljs-params\">(@Param(<span class=\"hljs-string\">\"condition\"</span>)</span>Map&lt;String, Object&gt; condition)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h4 id=\"mapper-xml\"><a href=\"#mapper-xml\" class=\"headerlink\" title=\"mapper xml\"></a>mapper xml</h4><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</span><br><span class=\"hljs-meta\">&lt;!DOCTYPE <span class=\"hljs-meta-keyword\">mapper</span> <span class=\"hljs-meta-keyword\">PUBLIC</span> <span class=\"hljs-meta-string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span> <span class=\"hljs-meta-string\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span> &gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">mapper</span> <span class=\"hljs-attr\">namespace</span>=<span class=\"hljs-string\">\"com.winterchen.shardingspheredemo.dao.OrderMapper\"</span>&gt;</span><br>    <br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sql</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"Base_Column_List\"</span>&gt;</span><br>        order_id, order_name, order_status, user_id<br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sql</span>&gt;</span><br>    <br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"selectAllByCondition\"</span> <span class=\"hljs-attr\">resultType</span>=<span class=\"hljs-string\">\"com.winterchen.shardingspheredemo.model.OrderInfo\"</span>&gt;</span><br>        select<br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">include</span> <span class=\"hljs-attr\">refid</span>=<span class=\"hljs-string\">\"Base_Column_List\"</span>/&gt;</span><br>        from<br>           t_order<br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">where</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"condition.userId != null\"</span>&gt;</span><br>                and user_id = #&#123;condition.userId, jdbcType=BIGINT&#125;<br>            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"condition.orderId != null\"</span>&gt;</span><br>                and order_id = #&#123;condition.orderId, jdbcType=BIGINT&#125;<br>            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"condition.orderName != null and condition.orderName != ''\"</span>&gt;</span><br>                and order_name like concat('%',#&#123;condition.orderName,jdbcType=VARCHAR&#125; ,'%')<br>            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"condition.orderStatus != null\"</span>&gt;</span><br>                and order_status = #&#123;condition.orderStatus, jdbcType=INTEGER&#125;<br>            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">where</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span><br><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">delete</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"deleteById\"</span>&gt;</span><br>        delete from t_order where order_id = #&#123;condition.orderId, jdbcType=BIGINT&#125; and user_id = #&#123;condition.userId, jdbcType=BIGINT&#125;<br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">delete</span>&gt;</span><br><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"service\"><a href=\"#service\" class=\"headerlink\" title=\"service\"></a>service</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.shardingspheredemo.service;<br><br><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">OrderService</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">IService</span>&lt;<span class=\"hljs-title\">OrderInfo</span>&gt; </span>&#123;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">save</span><span class=\"hljs-params\">(OrderInfo entity)</span></span>;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">removeById</span><span class=\"hljs-params\">(Serializable id)</span></span>;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">updateById</span><span class=\"hljs-params\">(OrderInfo entity)</span></span>;<br><br>    <span class=\"hljs-function\">IPage&lt;OrderInfo&gt; <span class=\"hljs-title\">pageOrderInfos</span><span class=\"hljs-params\">(Page&lt;?&gt; page, OrderInfo orderInfo)</span></span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.shardingspheredemo.service.impl;<br><br><br><span class=\"hljs-meta\">@Service</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">OrderServiceImpl</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">ServiceImpl</span>&lt;<span class=\"hljs-title\">OrderMapper</span>, <span class=\"hljs-title\">OrderInfo</span>&gt; <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">OrderService</span> </span>&#123;<br><br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">save</span><span class=\"hljs-params\">(OrderInfo entity)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">super</span>.save(entity);<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">removeById</span><span class=\"hljs-params\">(Serializable id)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">super</span>.removeById(id);<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">updateById</span><span class=\"hljs-params\">(OrderInfo entity)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">super</span>.updateById(entity);<br>    &#125;<br><br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> IPage&lt;OrderInfo&gt; <span class=\"hljs-title\">pageOrderInfos</span><span class=\"hljs-params\">(Page&lt;?&gt; page, OrderInfo orderInfo)</span> </span>&#123;<br>        Map&lt;String, Object&gt; map = <span class=\"hljs-keyword\">new</span> HashMap&lt;&gt;();<br>        map.put(<span class=\"hljs-string\">\"userId\"</span>, orderInfo.getUserId());<br>        map.put(<span class=\"hljs-string\">\"orderId\"</span>, orderInfo.getOrderId());<br>        map.put(<span class=\"hljs-string\">\"orderName\"</span>, orderInfo.getOrderName());<br>        map.put(<span class=\"hljs-string\">\"orderStatus\"</span>, orderInfo.getOrderStatus());<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">super</span>.baseMapper.selectAllByCondition(page, map);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"controller\"><a href=\"#controller\" class=\"headerlink\" title=\"controller\"></a>controller</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.shardingspheredemo.controller;<br><br><br><span class=\"hljs-meta\">@RestController</span><br><span class=\"hljs-meta\">@RequestMapping</span>(<span class=\"hljs-string\">\"/api/v1/order\"</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">OrderController</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> OrderService orderService;<br><br>    <span class=\"hljs-meta\">@PostMapping</span>(<span class=\"hljs-string\">\"\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">save</span><span class=\"hljs-params\">(@RequestBody OrderInfo orderInfo)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> orderService.save(orderInfo);<br>    &#125;<br><br>    <span class=\"hljs-meta\">@DeleteMapping</span>(<span class=\"hljs-string\">\"/&#123;orderId&#125;\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">deleteById</span><span class=\"hljs-params\">(</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">            @PathVariable(<span class=\"hljs-string\">\"orderId\"</span>)</span></span><br><span class=\"hljs-function\">            Long id) </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> orderService.removeById(id);<br>    &#125;<br><br>    <span class=\"hljs-meta\">@PutMapping</span>(<span class=\"hljs-string\">\"/&#123;orderId&#125;\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">updateById</span><span class=\"hljs-params\">(</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">            @PathVariable(<span class=\"hljs-string\">\"orderId\"</span>)</span></span><br><span class=\"hljs-function\">            Long orderId,</span><br><span class=\"hljs-function\">            @RequestBody OrderInfo orderInfo) </span>&#123;<br>        orderInfo.setOrderId(orderId);<br>        <span class=\"hljs-keyword\">return</span> orderService.updateById(orderInfo);<br>    &#125;<br><br>    <span class=\"hljs-meta\">@GetMapping</span>(<span class=\"hljs-string\">\"/list\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> IPage <span class=\"hljs-title\">page</span><span class=\"hljs-params\">(</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">            @RequestParam(name = <span class=\"hljs-string\">\"pageNum\"</span>, required = <span class=\"hljs-keyword\">false</span>, defaultValue = <span class=\"hljs-string\">\"1\"</span>)</span></span><br><span class=\"hljs-function\">                    Integer pageNum,</span><br><span class=\"hljs-function\">            @<span class=\"hljs-title\">RequestParam</span><span class=\"hljs-params\">(name = <span class=\"hljs-string\">\"pageSize\"</span>, required = <span class=\"hljs-keyword\">false</span>, defaultValue = <span class=\"hljs-string\">\"10\"</span>)</span></span><br><span class=\"hljs-function\">                    Integer pageSize,</span><br><span class=\"hljs-function\">            @<span class=\"hljs-title\">RequestParam</span><span class=\"hljs-params\">(name = <span class=\"hljs-string\">\"orderId\"</span>, required = <span class=\"hljs-keyword\">false</span>)</span></span><br><span class=\"hljs-function\">            Long orderId,</span><br><span class=\"hljs-function\">            @<span class=\"hljs-title\">RequestParam</span><span class=\"hljs-params\">(name = <span class=\"hljs-string\">\"orderStatus\"</span>, required = <span class=\"hljs-keyword\">false</span>)</span></span><br><span class=\"hljs-function\">            Integer orderStatus,</span><br><span class=\"hljs-function\">            @<span class=\"hljs-title\">RequestParam</span><span class=\"hljs-params\">(name = <span class=\"hljs-string\">\"orderName\"</span>, required = <span class=\"hljs-keyword\">false</span>)</span></span><br><span class=\"hljs-function\">            String orderName) </span>&#123;<br>        Page&lt;OrderInfo&gt; page = <span class=\"hljs-keyword\">new</span> Page&lt;&gt;(pageNum,pageSize);<br>        OrderInfo orderInfo = <span class=\"hljs-keyword\">new</span> OrderInfo();<br>        orderInfo.setOrderId(orderId);<br>        orderInfo.setOrderName(orderName);<br>        orderInfo.setOrderStatus(orderStatus);<br>        <span class=\"hljs-keyword\">return</span> orderService.pageOrderInfos(page, orderInfo);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"启动类\"><a href=\"#启动类\" class=\"headerlink\" title=\"启动类\"></a>启动类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.shardingspheredemo;<br><br><br><br><span class=\"hljs-meta\">@SpringBootApplication</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ShardingsphereDemoApplication</span> </span>&#123;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(ShardingsphereDemoApplication<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>, <span class=\"hljs-title\">args</span>)</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>以上就整合完毕了，可以使用postMan进行测试，测试截图就不展示了，后面会介绍关于读写分离的相关介绍，如果需要查看详细的介绍可以参考官方文档。</p>\n<h2 id=\"相关资源\"><a href=\"#相关资源\" class=\"headerlink\" title=\"相关资源\"></a>相关资源</h2><ul>\n<li>官方源码地址：<a href=\"https://github.com/apache/shardingsphere\" target=\"_blank\" rel=\"noopener\">https://github.com/apache/shardingsphere</a></li>\n<li>官方文档：<a href=\"https://shardingsphere.apache.org/document/current/cn/overview/\" target=\"_blank\" rel=\"noopener\">https://shardingsphere.apache.org/document/current/cn/overview/</a></li>\n<li>mybatis-plus官方文档：<a href=\"https://mp.baomidou.com/guide/\" target=\"_blank\" rel=\"noopener\">https://mp.baomidou.com/guide/</a></li>\n</ul>\n","raw":null,"categories":[{"name":"sharingsphere","path":"api/categories/sharingsphere.json"}],"tags":[{"name":"springboot","path":"api/tags/springboot.json"},{"name":"sharingsphere","path":"api/tags/sharingsphere.json"},{"name":"mybatis-plus","path":"api/tags/mybatis-plus.json"}]},{"title":"springboot集成hadoop实战","slug":"2020-12-01-springboot-hadoop-hdfs-mapreduce","date":"2020-12-01T10:43:00.000Z","updated":"2022-12-01T01:32:39.783Z","comments":true,"top":null,"path":"api/articles/2020-12-01-springboot-hadoop-hdfs-mapreduce.json","excerpt":null,"keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046751576454.jpg","content":"<p>springboot集成hadoop实现hdfs增删改查</p>\n<h2 id=\"maven坐标\"><a href=\"#maven坐标\" class=\"headerlink\" title=\"maven坐标\"></a>maven坐标</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-common<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-streaming<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-yarn-common<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">exclusions</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">exclusion</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.google.guava<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>guava<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">exclusion</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">exclusions</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-distcp<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>provided<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-mapreduce-client-core<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-hdfs<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-mapreduce-client-jobclient<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>provided<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br><span class=\"hljs-comment\">&lt;!-- 中文分词器 --&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>cn.bestwu<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>ik-analyzers<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>5.1.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><p>hdfs的配置</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">hdfs:</span><br>  <span class=\"hljs-attr\">hdfsPath:</span> <span class=\"hljs-string\">hdfs://bigdata-master:8020</span><br>  <span class=\"hljs-attr\">hdfsName:</span> <span class=\"hljs-string\">bigdata-master</span><br></code></pre></td></tr></table></figure>\n\n<p>将fileSystem配置并注册到spring容器</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Slf</span>4j<br><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HadoopHDFSConfiguration</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;hdfs.hdfsPath&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String hdfsPath;<br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;hdfs.hdfsName&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String hdfsName;<br><br>    <span class=\"hljs-meta\">@Bean</span><br>    <span class=\"hljs-keyword\">public</span> org.apache.hadoop.conf.<span class=\"hljs-function\">Configuration  <span class=\"hljs-title\">getConfiguration</span><span class=\"hljs-params\">()</span></span>&#123;<br>        org.apache.hadoop.conf.Configuration configuration = <span class=\"hljs-keyword\">new</span> org.apache.hadoop.conf.Configuration();<br>        configuration.set(<span class=\"hljs-string\">\"fs.defaultFS\"</span>, hdfsPath);<br>        <span class=\"hljs-keyword\">return</span> configuration;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Bean</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> FileSystem <span class=\"hljs-title\">getFileSystem</span><span class=\"hljs-params\">()</span></span>&#123;<br>        FileSystem fileSystem = <span class=\"hljs-keyword\">null</span>;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            fileSystem = FileSystem.get(<span class=\"hljs-keyword\">new</span> URI(hdfsPath), getConfiguration(), hdfsName);<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            <span class=\"hljs-comment\">// TODO Auto-generated catch block</span><br>            log.error(e.getMessage());<br>        &#125; <span class=\"hljs-keyword\">catch</span> (InterruptedException e) &#123;<br>            <span class=\"hljs-comment\">// TODO Auto-generated catch block</span><br>            log.error(e.getMessage());<br>        &#125; <span class=\"hljs-keyword\">catch</span> (URISyntaxException e) &#123;<br>            <span class=\"hljs-comment\">// TODO Auto-generated catch block</span><br>            log.error(e.getMessage());<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> fileSystem;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"增删改查\"><a href=\"#增删改查\" class=\"headerlink\" title=\"增删改查\"></a>增删改查</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">HDFSService</span> </span>&#123;<br><br>\t\t<span class=\"hljs-comment\">// 创建文件夹</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">makeFolder</span><span class=\"hljs-params\">(String path)</span></span>;<br>\t\t<span class=\"hljs-comment\">// 是否存在文件</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">existFile</span><span class=\"hljs-params\">(String path)</span></span>;<br>\t\t<br>    List&lt;Map&lt;String, Object&gt;&gt; readCatalog(String path);<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">createFile</span><span class=\"hljs-params\">(String path, MultipartFile file)</span></span>;<br><br>    <span class=\"hljs-function\">String <span class=\"hljs-title\">readFileContent</span><span class=\"hljs-params\">(String path)</span></span>;<br><br>    List&lt;Map&lt;String, Object&gt;&gt; listFile(String path);<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">renameFile</span><span class=\"hljs-params\">(String oldName, String newName)</span></span>;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">deleteFile</span><span class=\"hljs-params\">(String path)</span></span>;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">uploadFile</span><span class=\"hljs-params\">(String path, String uploadPath)</span></span>;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">downloadFile</span><span class=\"hljs-params\">(String path, String downloadPath)</span></span>;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">copyFile</span><span class=\"hljs-params\">(String sourcePath, String targetPath)</span></span>;<br><br>    <span class=\"hljs-keyword\">byte</span>[] openFileToBytes(String path);<br><br>    BlockLocation[] getFileBlockLocations(String path);<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Slf</span>4j<br><span class=\"hljs-meta\">@Service</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HDFSServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">HDFSService</span> </span>&#123;<br><br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-keyword\">int</span> bufferSize = <span class=\"hljs-number\">1024</span> * <span class=\"hljs-number\">1024</span> * <span class=\"hljs-number\">64</span>;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> FileSystem fileSystem;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">makeFolder</span><span class=\"hljs-params\">(String path)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">boolean</span> target = <span class=\"hljs-keyword\">false</span>;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(path)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>        &#125;<br>        <span class=\"hljs-keyword\">if</span> (existFile(path)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">true</span>;<br>        &#125;<br>        Path src = <span class=\"hljs-keyword\">new</span> Path(path);<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            target = fileSystem.mkdirs(src);<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(e.getMessage());<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> target;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">existFile</span><span class=\"hljs-params\">(String path)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(path))&#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>        &#125;<br>        Path src = <span class=\"hljs-keyword\">new</span> Path(path);<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            <span class=\"hljs-keyword\">return</span> fileSystem.exists(src);<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(e.getMessage());<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-keyword\">public</span> List&lt;Map&lt;String, Object&gt;&gt; readCatalog(String path) &#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(path))&#123;<br>            <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>        &#125;<br>        <span class=\"hljs-keyword\">if</span> (!existFile(path))&#123;<br>            log.error(<span class=\"hljs-string\">\"catalog is not exist!!\"</span>);<br>            <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>        &#125;<br><br>        Path src = <span class=\"hljs-keyword\">new</span> Path(path);<br>        FileStatus[] fileStatuses = <span class=\"hljs-keyword\">null</span>;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            fileStatuses = fileSystem.listStatus(src);<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(e.getMessage());<br>        &#125;<br>        List&lt;Map&lt;String, Object&gt;&gt; result = <span class=\"hljs-keyword\">new</span> ArrayList&lt;&gt;(fileStatuses.length);<br><br>        <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != fileStatuses &amp;&amp; <span class=\"hljs-number\">0</span> &lt; fileStatuses.length) &#123;<br>            <span class=\"hljs-keyword\">for</span> (FileStatus fileStatus : fileStatuses) &#123;<br>                Map&lt;String, Object&gt; cataLogMap = <span class=\"hljs-keyword\">new</span> HashMap&lt;&gt;();<br>                cataLogMap.put(<span class=\"hljs-string\">\"filePath\"</span>, fileStatus.getPath());<br>                cataLogMap.put(<span class=\"hljs-string\">\"fileStatus\"</span>, fileStatus);<br>                result.add(cataLogMap);<br>            &#125;<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> result;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">createFile</span><span class=\"hljs-params\">(String path, MultipartFile file)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">boolean</span> target = <span class=\"hljs-keyword\">false</span>;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(path)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>        &#125;<br>        String fileName = file.getName();<br>        Path newPath = <span class=\"hljs-keyword\">new</span> Path(path + <span class=\"hljs-string\">\"/\"</span> + fileName);<br><br>        FSDataOutputStream outputStream = <span class=\"hljs-keyword\">null</span>;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            outputStream = fileSystem.create(newPath);<br>            outputStream.write(file.getBytes());<br>            target = <span class=\"hljs-keyword\">true</span>;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(e.getMessage());<br>        &#125; <span class=\"hljs-keyword\">finally</span> &#123;<br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != outputStream) &#123;<br>                <span class=\"hljs-keyword\">try</span> &#123;<br>                    outputStream.close();<br>                &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>                    log.error(e.getMessage());<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> target;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">readFileContent</span><span class=\"hljs-params\">(String path)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(path))&#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>        &#125;<br><br>        <span class=\"hljs-keyword\">if</span> (!existFile(path)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>        &#125;<br><br>        Path src = <span class=\"hljs-keyword\">new</span> Path(path);<br><br>        FSDataInputStream inputStream = <span class=\"hljs-keyword\">null</span>;<br>        StringBuilder sb = <span class=\"hljs-keyword\">new</span> StringBuilder();<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            inputStream = fileSystem.open(src);<br>            String lineText = <span class=\"hljs-string\">\"\"</span>;<br>            <span class=\"hljs-keyword\">while</span> ((lineText = inputStream.readLine()) != <span class=\"hljs-keyword\">null</span>) &#123;<br>                sb.append(lineText);<br>            &#125;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(e.getMessage());<br>        &#125; <span class=\"hljs-keyword\">finally</span> &#123;<br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != inputStream) &#123;<br>                <span class=\"hljs-keyword\">try</span> &#123;<br>                    inputStream.close();<br>                &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>                    log.error(e.getMessage());<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> sb.toString();<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-keyword\">public</span> List&lt;Map&lt;String, Object&gt;&gt; listFile(String path) &#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(path)) &#123;<br>            <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>        &#125;<br>        <span class=\"hljs-keyword\">if</span> (!existFile(path)) &#123;<br>            <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>        &#125;<br>        List&lt;Map&lt;String,Object&gt;&gt; resultList = <span class=\"hljs-keyword\">new</span> ArrayList&lt;&gt;();<br><br>        Path src = <span class=\"hljs-keyword\">new</span> Path(path);<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            RemoteIterator&lt;LocatedFileStatus&gt; fileIterator = fileSystem.listFiles(src, <span class=\"hljs-keyword\">true</span>);<br>            <span class=\"hljs-keyword\">while</span> (fileIterator.hasNext()) &#123;<br>                LocatedFileStatus next = fileIterator.next();<br>                Path filePath = next.getPath();<br>                String fileName = filePath.getName();<br>                Map&lt;String, Object&gt; map = <span class=\"hljs-keyword\">new</span> HashMap&lt;&gt;();<br>                map.put(<span class=\"hljs-string\">\"fileName\"</span>, fileName);<br>                map.put(<span class=\"hljs-string\">\"filePath\"</span>, filePath.toString());<br>                resultList.add(map);<br>            &#125;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(e.getMessage());<br>        &#125;<br><br>        <span class=\"hljs-keyword\">return</span> resultList;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">renameFile</span><span class=\"hljs-params\">(String oldName, String newName)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">boolean</span> target = <span class=\"hljs-keyword\">false</span>;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(oldName) || StringUtils.isEmpty(newName)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>        &#125;<br>        Path oldPath = <span class=\"hljs-keyword\">new</span> Path(oldName);<br>        Path newPath = <span class=\"hljs-keyword\">new</span> Path(newName);<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            target = fileSystem.rename(oldPath, newPath);<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(e.getMessage());<br>        &#125;<br><br>        <span class=\"hljs-keyword\">return</span> target;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">deleteFile</span><span class=\"hljs-params\">(String path)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">boolean</span> target = <span class=\"hljs-keyword\">false</span>;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(path)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>        &#125;<br>        <span class=\"hljs-keyword\">if</span> (!existFile(path)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>        &#125;<br>        Path src = <span class=\"hljs-keyword\">new</span> Path(path);<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            target = fileSystem.deleteOnExit(src);<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(e.getMessage());<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> target;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">uploadFile</span><span class=\"hljs-params\">(String path, String uploadPath)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(path) || StringUtils.isEmpty(uploadPath)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>        &#125;<br><br>        Path clientPath = <span class=\"hljs-keyword\">new</span> Path(path);<br><br>        Path serverPath = <span class=\"hljs-keyword\">new</span> Path(uploadPath);<br><br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            fileSystem.copyFromLocalFile(<span class=\"hljs-keyword\">false</span>,clientPath,serverPath);<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">true</span>;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(e.getMessage(), e);<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">downloadFile</span><span class=\"hljs-params\">(String path, String downloadPath)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(path) || StringUtils.isEmpty(downloadPath)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>        &#125;<br><br>        Path clienPath = <span class=\"hljs-keyword\">new</span> Path(path);<br><br>        Path targetPath = <span class=\"hljs-keyword\">new</span> Path(downloadPath);<br><br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            fileSystem.copyToLocalFile(<span class=\"hljs-keyword\">false</span>,clienPath, targetPath);<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">true</span>;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(e.getMessage());<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">copyFile</span><span class=\"hljs-params\">(String sourcePath, String targetPath)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(sourcePath) || StringUtils.isEmpty(targetPath)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>        &#125;<br><br>        Path oldPath = <span class=\"hljs-keyword\">new</span> Path(sourcePath);<br><br>        Path newPath = <span class=\"hljs-keyword\">new</span> Path(targetPath);<br><br>        FSDataInputStream inputStream = <span class=\"hljs-keyword\">null</span>;<br>        FSDataOutputStream outputStream = <span class=\"hljs-keyword\">null</span>;<br><br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            inputStream = fileSystem.open(oldPath);<br>            outputStream = fileSystem.create(newPath);<br><br>            IOUtils.copyBytes(inputStream,outputStream,bufferSize,<span class=\"hljs-keyword\">false</span>);<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">true</span>;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(e.getMessage());<br>        &#125; <span class=\"hljs-keyword\">finally</span> &#123;<br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != inputStream) &#123;<br>                <span class=\"hljs-keyword\">try</span> &#123;<br>                    inputStream.close();<br>                &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>                    log.error(e.getMessage());<br>                &#125;<br>            &#125;<br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != outputStream) &#123;<br>                <span class=\"hljs-keyword\">try</span> &#123;<br>                    outputStream.close();<br>                &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>                    log.error(e.getMessage());<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">byte</span>[] openFileToBytes(String path) &#123;<br><br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(path)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>        &#125;<br><br>        <span class=\"hljs-keyword\">if</span> (!existFile(path)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>        &#125;<br><br>        Path src = <span class=\"hljs-keyword\">new</span> Path(path);<br>        <span class=\"hljs-keyword\">byte</span>[] result = <span class=\"hljs-keyword\">null</span>;<br>        FSDataInputStream inputStream = <span class=\"hljs-keyword\">null</span>;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            inputStream = fileSystem.open(src);<br>            result = IOUtils.readFullyToByteArray(inputStream);<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(e.getMessage());<br>        &#125; <span class=\"hljs-keyword\">finally</span> &#123;<br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != inputStream)&#123;<br>                <span class=\"hljs-keyword\">try</span> &#123;<br>                    inputStream.close();<br>                &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>                    log.error(e.getMessage());<br>                &#125;<br>            &#125;<br>        &#125;<br><br>        <span class=\"hljs-keyword\">return</span> result;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-keyword\">public</span> BlockLocation[] getFileBlockLocations(String path) &#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(path)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>        &#125;<br>        <span class=\"hljs-keyword\">if</span> (!existFile(path)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>        &#125;<br>        BlockLocation[] blocks = <span class=\"hljs-keyword\">null</span>;<br>        Path src = <span class=\"hljs-keyword\">new</span> Path(path);<br>        <span class=\"hljs-keyword\">try</span>&#123;<br>            FileStatus fileStatus = fileSystem.getFileStatus(src);<br>            blocks = fileSystem.getFileBlockLocations(fileStatus, <span class=\"hljs-number\">0</span>, fileStatus.getLen());<br>        &#125;<span class=\"hljs-keyword\">catch</span>(Exception e)&#123;<br>            log.error(e.getMessage());<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> blocks;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"mapReduce\"><a href=\"#mapReduce\" class=\"headerlink\" title=\"mapReduce\"></a>mapReduce</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.reduce;<br><br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.io.IntWritable;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.io.LongWritable;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.io.Text;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.mapreduce.Reducer;<br><br><span class=\"hljs-keyword\">import</span> java.io.IOException;<br><span class=\"hljs-keyword\">import</span> java.util.ArrayList;<br><span class=\"hljs-keyword\">import</span> java.util.List;<br><br><span class=\"hljs-comment\">/*</span><br><span class=\"hljs-comment\"> * 继承Reducer类需要定义四个输出、输出类型泛型：</span><br><span class=\"hljs-comment\"> * 四个泛型类型分别代表：</span><br><span class=\"hljs-comment\"> * KeyIn        Reducer的输入数据的Key，这里是每行文字中的单词\"hello\"</span><br><span class=\"hljs-comment\"> * ValueIn      Reducer的输入数据的Value，这里是每行文字中的次数</span><br><span class=\"hljs-comment\"> * KeyOut       Reducer的输出数据的Key，这里是每行文字中的单词\"hello\"</span><br><span class=\"hljs-comment\"> * ValueOut     Reducer的输出数据的Value，这里是每行文字中的出现的总次数</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">WordReduce</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Reducer</span>&lt;<span class=\"hljs-title\">Text</span>, <span class=\"hljs-title\">IntWritable</span>, <span class=\"hljs-title\">Text</span>, <span class=\"hljs-title\">IntWritable</span>&gt; </span>&#123;<br><br>    <span class=\"hljs-keyword\">private</span> IntWritable result = <span class=\"hljs-keyword\">new</span> IntWritable();<br>    <span class=\"hljs-keyword\">private</span> List&lt;String&gt; textList = <span class=\"hljs-keyword\">new</span> ArrayList&lt;&gt;();<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">reduce</span><span class=\"hljs-params\">(Text key, Iterable&lt;IntWritable&gt; values, Context context)</span> <span class=\"hljs-keyword\">throws</span> IOException, InterruptedException </span>&#123;<br>        <span class=\"hljs-keyword\">int</span> sum = <span class=\"hljs-number\">0</span>;<br>        <span class=\"hljs-keyword\">for</span> (IntWritable val : values) &#123;<br>            sum += val.get();<br>        &#125;<br>        result.set(sum);<br>        context.write(key, result);<br><br>        String keyStr = key.toString();<br><br>        <span class=\"hljs-comment\">// 使用分词器，内容已经被统计好了，直接输出即可</span><br>        <span class=\"hljs-keyword\">if</span> (textList.contains(keyStr)) &#123;<br>            System.out.println(<span class=\"hljs-string\">\"============ \"</span> + keyStr + <span class=\"hljs-string\">\" 统计分词为: \"</span> + sum + <span class=\"hljs-string\">\" ============\"</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.configuration;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.HadoopDemoApplication;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.mapper.WordMapper;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.reduce.WordReduce;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.conf.Configuration;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.fs.Path;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.io.IntWritable;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.io.Text;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.mapreduce.Job;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Value;<br><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Component;<br><br><span class=\"hljs-keyword\">import</span> javax.annotation.PostConstruct;<br><span class=\"hljs-keyword\">import</span> java.io.IOException;<br><br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ReduceJobsConfiguration</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;hdfs.hdfsPath&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String hdfsPath;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * 获取HDFS配置信息</span><br><span class=\"hljs-comment\">     *</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span></span><br><span class=\"hljs-comment\">     */</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> Configuration <span class=\"hljs-title\">getConfiguration</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        Configuration configuration = <span class=\"hljs-keyword\">new</span> Configuration();<br>        configuration.set(<span class=\"hljs-string\">\"fs.defaultFS\"</span>, hdfsPath);<br>        configuration.set(<span class=\"hljs-string\">\"mapred.job.tracker\"</span>, hdfsPath);<br>        <span class=\"hljs-keyword\">return</span> configuration;<br>    &#125;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * 获取单词统计的配置信息</span><br><span class=\"hljs-comment\">     *</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@param</span> jobName</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@param</span> inputPath</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@param</span> outputPath</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@throws</span> IOException</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@throws</span> ClassNotFoundException</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@throws</span> InterruptedException</span><br><span class=\"hljs-comment\">     */</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">getWordCountJobsConf</span><span class=\"hljs-params\">(String jobName, String inputPath, String outputPath)</span></span><br><span class=\"hljs-function\">            <span class=\"hljs-keyword\">throws</span> IOException, ClassNotFoundException, InterruptedException </span>&#123;<br>        Configuration conf = getConfiguration();<br>        Job job = Job.getInstance(conf, jobName);<br><br>        job.setMapperClass(WordMapper<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br>        job.setCombinerClass(WordReduce<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br>        job.setJarByClass(HadoopDemoApplication<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br>        job.setReducerClass(WordReduce<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br><br>        job.setOutputKeyClass(Text<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br>        job.setOutputValueClass(IntWritable<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br><br>        FileInputFormat.addInputPath(job, <span class=\"hljs-keyword\">new</span> Path(inputPath));<br>        FileOutputFormat.setOutputPath(job, <span class=\"hljs-keyword\">new</span> Path(outputPath));<br>        job.waitForCompletion(<span class=\"hljs-keyword\">true</span>);<br>    &#125;<br><br>    <span class=\"hljs-meta\">@PostConstruct</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">getPath</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        hdfsPath = <span class=\"hljs-keyword\">this</span>.hdfsPath;<br>    &#125;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">getHdfsPath</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> hdfsPath;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">MapReduceService</span> </span>&#123;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">wordCount</span><span class=\"hljs-params\">(String jobName, String inputPath, String outputPath)</span> <span class=\"hljs-keyword\">throws</span> Exception</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.service.impl;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.configuration.ReduceJobsConfiguration;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.service.HDFSService;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.service.MapReduceService;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Service;<br><span class=\"hljs-keyword\">import</span> org.springframework.util.StringUtils;<br><br><span class=\"hljs-meta\">@Service</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MapReduceServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">MapReduceService</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> HDFSService hdfsService;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> ReduceJobsConfiguration reduceJobsConfiguration;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">wordCount</span><span class=\"hljs-params\">(String jobName, String inputPath, String outputPath)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(jobName) || StringUtils.isEmpty(inputPath)) &#123;<br>            <span class=\"hljs-keyword\">return</span>;<br>        &#125;<br>        <span class=\"hljs-comment\">// 输出目录 = output/当前Job,如果输出路径存在则删除，保证每次都是最新的</span><br>        <span class=\"hljs-keyword\">if</span> (hdfsService.existFile(outputPath)) &#123;<br>            hdfsService.deleteFile(outputPath);<br>        &#125;<br>        reduceJobsConfiguration.getWordCountJobsConf(jobName, inputPath, outputPath);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.service.impl;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.configuration.ReduceJobsConfiguration;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.service.HDFSService;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.service.MapReduceService;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Service;<br><span class=\"hljs-keyword\">import</span> org.springframework.util.StringUtils;<br><br><span class=\"hljs-meta\">@Service</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MapReduceServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">MapReduceService</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> HDFSService hdfsService;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> ReduceJobsConfiguration reduceJobsConfiguration;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">wordCount</span><span class=\"hljs-params\">(String jobName, String inputPath, String outputPath)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(jobName) || StringUtils.isEmpty(inputPath)) &#123;<br>            <span class=\"hljs-keyword\">return</span>;<br>        &#125;<br>        <span class=\"hljs-comment\">// 输出目录 = output/当前Job,如果输出路径存在则删除，保证每次都是最新的</span><br>        <span class=\"hljs-keyword\">if</span> (hdfsService.existFile(outputPath)) &#123;<br>            hdfsService.deleteFile(outputPath);<br>        &#125;<br>        reduceJobsConfiguration.getWordCountJobsConf(jobName, inputPath, outputPath);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Slf</span>4j<br><span class=\"hljs-meta\">@Api</span>(tags = <span class=\"hljs-string\">\"map reduce api\"</span>)<br><span class=\"hljs-meta\">@RestController</span><br><span class=\"hljs-meta\">@RequestMapping</span>(<span class=\"hljs-string\">\"/api/v1/map-reduce\"</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MapReduceController</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> MapReduceService mapReduceService;<br><br>    <span class=\"hljs-meta\">@ApiOperation</span>(<span class=\"hljs-string\">\"count word\"</span>)<br>    <span class=\"hljs-meta\">@PostMapping</span>(<span class=\"hljs-string\">\"/word/count\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> APIResponse <span class=\"hljs-title\">wordCount</span><span class=\"hljs-params\">(</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">            @ApiParam(name = <span class=\"hljs-string\">\"jobName\"</span>, required = <span class=\"hljs-keyword\">true</span>)</span></span><br><span class=\"hljs-function\">            @<span class=\"hljs-title\">RequestParam</span><span class=\"hljs-params\">(name = <span class=\"hljs-string\">\"jobName\"</span>, required = <span class=\"hljs-keyword\">true</span>)</span></span><br><span class=\"hljs-function\">            String jobName,</span><br><span class=\"hljs-function\">            @<span class=\"hljs-title\">ApiParam</span><span class=\"hljs-params\">(name = <span class=\"hljs-string\">\"inputPath\"</span>, required = <span class=\"hljs-keyword\">true</span>)</span></span><br><span class=\"hljs-function\">            @<span class=\"hljs-title\">RequestParam</span><span class=\"hljs-params\">(name = <span class=\"hljs-string\">\"inputPath\"</span>, required = <span class=\"hljs-keyword\">true</span>)</span></span><br><span class=\"hljs-function\">            String inputPath,</span><br><span class=\"hljs-function\">            @<span class=\"hljs-title\">ApiParam</span><span class=\"hljs-params\">(name = <span class=\"hljs-string\">\"outputPath\"</span>, required = <span class=\"hljs-keyword\">true</span>)</span></span><br><span class=\"hljs-function\">            @<span class=\"hljs-title\">RequestParam</span><span class=\"hljs-params\">(name = <span class=\"hljs-string\">\"outputPath\"</span>, required = <span class=\"hljs-keyword\">true</span>)</span></span><br><span class=\"hljs-function\">            String outputPath</span><br><span class=\"hljs-function\">    )</span>&#123;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            mapReduceService.wordCount(jobName, inputPath, outputPath);<br>            <span class=\"hljs-keyword\">return</span> APIResponse.success();<br>        &#125; <span class=\"hljs-keyword\">catch</span> (Exception e) &#123;<br>            log.error(e.getMessage());<br>            <span class=\"hljs-keyword\">return</span> APIResponse.fail(e.getMessage());<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>以上就是日常开发中能使用到的基本的功能：hdfs的增删改查，以及MapReduce；</p>\n<p>源码地址: </p>\n<p><a href=\"https://github.com/WinterChenS/springboot-learning-experience/tree/master/spring-boot-hadoop\" target=\"_blank\" rel=\"noopener\">WinterChenS/springboot-learning-experience</a></p>\n","raw":null,"categories":[{"name":"hadoop","path":"api/categories/hadoop.json"}],"tags":[{"name":"hadoop","path":"api/tags/hadoop.json"},{"name":"springboot","path":"api/tags/springboot.json"},{"name":"hdfs","path":"api/tags/hdfs.json"}]},{"title":"springboot集成Oozie实战","slug":"2020-12-01-springboot-oozie","date":"2020-12-01T11:43:00.000Z","updated":"2022-12-01T01:32:39.783Z","comments":true,"top":null,"path":"api/articles/2020-12-01-springboot-oozie.json","excerpt":null,"keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046755978859.jpg","content":"<p>本文将以springboot调用Oozie的API实现workflow和coordinator等任务的提交停止</p>\n<h2 id=\"前提：\"><a href=\"#前提：\" class=\"headerlink\" title=\"前提：\"></a>前提：</h2><p>关于hadoop的集成，请参考另外一篇文章，这里就过多的赘述：</p>\n<p><a href=\"https://blog.winterchen.com/2020/12/01/2020-12-01-springboot-hadoop-hdfs-mapreduce/\">springboot集成hadoop实战</a></p>\n<h2 id=\"maven坐标\"><a href=\"#maven坐标\" class=\"headerlink\" title=\"maven坐标\"></a>maven坐标</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-common<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-streaming<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-yarn-common<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">exclusions</span>&gt;</span><br>             <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">exclusion</span>&gt;</span><br>                 <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.google.guava<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>                 <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>guava<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>             <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">exclusion</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">exclusions</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-distcp<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>provided<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-mapreduce-client-core<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-hdfs<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-mapreduce-client-jobclient<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>provided<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br>\t<span class=\"hljs-comment\">&lt;!-- oozie --&gt;</span><br>     <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.oozie<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>oozie-client<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>         <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>4.3.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>     <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">hdfs:</span><br>  <span class=\"hljs-attr\">hdfsPath:</span> <span class=\"hljs-string\">hdfs://bigdata-master:8020</span><br>  <span class=\"hljs-attr\">hdfsName:</span> <span class=\"hljs-string\">bigdata-master</span><br><br><span class=\"hljs-attr\">oozie:</span><br>  <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">http://bigdata-master:11000/oozie</span><br>  <span class=\"hljs-attr\">wf:</span><br>    <span class=\"hljs-attr\">application:</span><br>      <span class=\"hljs-attr\">path:</span> <span class=\"hljs-string\">hdfs://bigdata-master:9000/user/oozie/workflow/hiveserver2.xml</span><br>  <span class=\"hljs-attr\">use:</span><br>    <span class=\"hljs-attr\">system:</span><br>      <span class=\"hljs-attr\">libpath:</span> <span class=\"hljs-literal\">true</span><br>  <span class=\"hljs-attr\">libpath:</span> <span class=\"hljs-string\">hdfs://bigdata-master:8020/user/oozie/share/lib</span><br>  <span class=\"hljs-attr\">callback:</span><br>    <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">http://172.16.120.29:8080/label/oozie/callback?executeType=$1\\&amp;taskType=$2\\&amp;callbackId=$3</span><br>  <span class=\"hljs-attr\">jdbc:</span><br>    <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">jdbc:hive2://192.168.150.119:10000/default</span><br>    <span class=\"hljs-attr\">password:</span><br>  <span class=\"hljs-attr\">nameNode:</span> <span class=\"hljs-string\">hdfs://bigdata-master:8020</span><br>  <span class=\"hljs-attr\">resourceManager:</span> <span class=\"hljs-string\">hdfs://bigdata-master:8088</span><br>  <span class=\"hljs-attr\">queueName:</span> <span class=\"hljs-string\">default</span><br>  <span class=\"hljs-attr\">job-tracker:</span> <span class=\"hljs-string\">bigdata-master:8032</span><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.model;<br><br><span class=\"hljs-keyword\">import</span> lombok.AllArgsConstructor;<br><span class=\"hljs-keyword\">import</span> lombok.Data;<br><span class=\"hljs-keyword\">import</span> lombok.NoArgsConstructor;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Value;<br><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Component;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/19 7:21 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span></span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">OozieConfig</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.nameNode&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String nameNode;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.job-tracker&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String jobTracker;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.resourceManager&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String resourceManager;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.queueName&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String queueName;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.url&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String url;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.wf.application.path&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String oozieApplicationPath;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.libpath&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String oozieLibPath;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.use.system.libpath&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> oozieSystemLibPath;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.jdbc.url&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String jdbcUrl;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.jdbc.password&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String password;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;oozie.callback.url&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String callbackUrl;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"基础类\"><a href=\"#基础类\" class=\"headerlink\" title=\"基础类\"></a>基础类</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/23 2:23 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span></span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">OozieConstants</span> </span>&#123;<br><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String NAME_NODE= <span class=\"hljs-string\">\"nameNode\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String RESOURCE_MANAGER = <span class=\"hljs-string\">\"resourcemanager\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String QUEUE_NAME = <span class=\"hljs-string\">\"queueName\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String ROOT_DIR = <span class=\"hljs-string\">\"rootdir\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String JOB_TRACKER = <span class=\"hljs-string\">\"jobTracker\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String JOB_OUTPUT = <span class=\"hljs-string\">\"jobOutput\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String JDBC_URL = <span class=\"hljs-string\">\"jdbcUrl\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String PASSWORD = <span class=\"hljs-string\">\"password\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String SQL_INPUT = <span class=\"hljs-string\">\"sqlInput\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String USER_NAME = <span class=\"hljs-string\">\"user.name\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String TASK_TYPE = <span class=\"hljs-string\">\"taskType\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String SHELL_FILE_NAME = <span class=\"hljs-string\">\"shellFileName\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String SHELL_FILE_PATH = <span class=\"hljs-string\">\"shellFilePath\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String CALLBACK_ID = <span class=\"hljs-string\">\"callbackId\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String WORKFLOW_ROOT = <span class=\"hljs-string\">\"workflowRoot\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String START = <span class=\"hljs-string\">\"start\"</span>;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> String END = <span class=\"hljs-string\">\"end\"</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.model;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.enums.FrequencyTypeEnum;<br><span class=\"hljs-keyword\">import</span> io.swagger.annotations.ApiModel;<br><span class=\"hljs-keyword\">import</span> io.swagger.annotations.ApiModelProperty;<br><span class=\"hljs-keyword\">import</span> lombok.*;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/25 6:01 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span> 定时调度任务请求</span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@EqualsAndHashCode</span>(callSuper = <span class=\"hljs-keyword\">false</span>)<br><span class=\"hljs-meta\">@ToString</span><br><span class=\"hljs-meta\">@Builder</span><br><span class=\"hljs-meta\">@ApiModel</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">CoordinatorRequest</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"定时调度任务名称\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String coordName;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"定时调度任务文件路径\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String coordPath;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"频率\"</span>)<br>    <span class=\"hljs-keyword\">private</span> FrequencyTypeEnum frequencyType;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"开始时间\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String startTime;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"结束时间\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String endTime;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"workflow名称\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String wfName;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"workflow路径\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String wfPath;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"回调编号\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String callbackId;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.model;<br><br><span class=\"hljs-keyword\">import</span> io.swagger.annotations.ApiModel;<br><span class=\"hljs-keyword\">import</span> io.swagger.annotations.ApiModelProperty;<br><span class=\"hljs-keyword\">import</span> lombok.*;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/25 5:33 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span> workflow任务请求</span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@EqualsAndHashCode</span>(callSuper = <span class=\"hljs-keyword\">false</span>)<br><span class=\"hljs-meta\">@ToString</span><br><span class=\"hljs-meta\">@Builder</span><br><span class=\"hljs-meta\">@ApiModel</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">WorkflowRequest</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"workflow名称\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String wfName;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"workflow路径\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String wfPath;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"执行的sql\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String sql;<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"回调编号\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String callbackId;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"功能实现\"><a href=\"#功能实现\" class=\"headerlink\" title=\"功能实现\"></a>功能实现</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.service;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.enums.FrequencyTypeEnum;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.model.CoordinatorRequest;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.model.WorkflowRequest;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/23 2:06 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span></span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">OozieService</span> </span>&#123;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Author</span> winterchen</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Description</span> 提交workflow任务</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Date</span> 6:21 下午 2020/11/25</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Param</span> [workflowRequest]</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span> java.lang.String</span><br><span class=\"hljs-comment\">     **/</span><br>    <span class=\"hljs-function\">String <span class=\"hljs-title\">submitWorkflow</span><span class=\"hljs-params\">(WorkflowRequest workflowRequest)</span></span>;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Author</span> winterchen</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Description</span> 提交coordinator任务</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Date</span> 6:21 下午 2020/11/25</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Param</span> [coordinatorRequest]</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span> java.lang.String</span><br><span class=\"hljs-comment\">     **/</span><br>    <span class=\"hljs-function\">String <span class=\"hljs-title\">submitCoordinator</span><span class=\"hljs-params\">(CoordinatorRequest coordinatorRequest)</span></span>;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Author</span> winterchen</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Description</span> 创建并上传sql文件至hdfs</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Date</span> 6:21 下午 2020/11/25</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Param</span> [sql, sqlPath]</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span> java.lang.String 文件地址</span><br><span class=\"hljs-comment\">     **/</span><br>    <span class=\"hljs-function\">String <span class=\"hljs-title\">createSqlFileAndUpload</span><span class=\"hljs-params\">(String sql, String sqlPath)</span></span>;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Author</span> winterchen</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Description</span> 创建并上传workflow任务脚本文件至hdfs</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Date</span> 6:22 下午 2020/11/25</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Param</span> [wfName, wfPath, sqlPath, callbackId]</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span> String 文件地址</span><br><span class=\"hljs-comment\">     **/</span><br>    <span class=\"hljs-function\">String <span class=\"hljs-title\">createWfFileAndUpload</span><span class=\"hljs-params\">(String wfName, String wfPath, String sqlPath, String callbackId)</span></span>;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Author</span> winterchen</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Description</span> 创建并上传coordinator定时任务脚本文件至hdfs</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Date</span> 6:23 下午 2020/11/25</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Param</span> [coordName, coordPath, wfPath, frequencyType, callbackId]</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span> String 文件地址</span><br><span class=\"hljs-comment\">     **/</span><br>    <span class=\"hljs-function\">String <span class=\"hljs-title\">createCoordFileAndUpload</span><span class=\"hljs-params\">(String coordName, String coordPath, String wfPath, FrequencyTypeEnum frequencyType, String callbackId)</span></span>;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Author</span> winterchen</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Description</span> 创建shell脚本并上传</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Date</span> 6:41 下午 2020/11/25</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Param</span> [shellFileName, shellFilePath]</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span> String 文件地址</span><br><span class=\"hljs-comment\">     **/</span><br>    <span class=\"hljs-function\">String  <span class=\"hljs-title\">createShellFileAndUpload</span><span class=\"hljs-params\">(String shellFileName, String shellFilePath)</span></span>;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Author</span> winterchen</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Description</span> 处理回调</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Date</span> 6:24 下午 2020/11/25</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Param</span> [targetType, targetId]</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span> void</span><br><span class=\"hljs-comment\">     **/</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">executeCallback</span><span class=\"hljs-params\">(String executeType, String taskType, String callbackId)</span></span>;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Author</span> winterchen</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Description</span> 停止定时调度任务</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Date</span> 6:24 下午 2020/11/25</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@Param</span> [jobId]</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span> void</span><br><span class=\"hljs-comment\">     **/</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">killCoordinatorJob</span><span class=\"hljs-params\">(String jobId)</span></span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.service.impl;<br><br><span class=\"hljs-keyword\">import</span> cn.hutool.core.date.DateUtil;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.constants.OozieConstants;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.enums.FrequencyTypeEnum;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.enums.TaskTypeEnum;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.model.CoordinatorRequest;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.model.OozieConfig;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.model.WorkflowRequest;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.service.OozieService;<br><span class=\"hljs-keyword\">import</span> lombok.extern.slf4j.Slf4j;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.fs.FileSystem;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.fs.Path;<br><span class=\"hljs-keyword\">import</span> org.apache.oozie.client.*;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Service;<br><span class=\"hljs-keyword\">import</span> org.springframework.util.StringUtils;<br><br><span class=\"hljs-keyword\">import</span> java.io.IOException;<br><span class=\"hljs-keyword\">import</span> java.io.OutputStreamWriter;<br><span class=\"hljs-keyword\">import</span> java.io.Writer;<br><span class=\"hljs-keyword\">import</span> java.util.Properties;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/23 2:06 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span></span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-meta\">@Slf</span>4j<br><span class=\"hljs-meta\">@Service</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">OozieServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">OozieService</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> FileSystem fileSystem;<br><br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">final</span> OozieConfig oozieConfig;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">OozieServiceImpl</span><span class=\"hljs-params\">(OozieConfig oozieConfig)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">this</span>.oozieConfig = oozieConfig;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">submitWorkflow</span><span class=\"hljs-params\">(WorkflowRequest workflowRequest)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            OozieClient oozieClient = <span class=\"hljs-keyword\">new</span> OozieClient(oozieConfig.getUrl());<br>            oozieClient.setDebugMode(<span class=\"hljs-number\">1</span>);<br>            Path appPath = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(), workflowRequest.getWfPath().concat(workflowRequest.getWfName()).concat(<span class=\"hljs-string\">\".xml\"</span>));<br>            <span class=\"hljs-comment\">// 创建相关文件</span><br><br>            <span class=\"hljs-comment\">// 创建并上传sql文件</span><br>            String sqlPath = workflowRequest.getWfPath().concat(<span class=\"hljs-string\">\"sql/\"</span>.concat(workflowRequest.getWfName()).concat(<span class=\"hljs-string\">\"-sql.q\"</span>));<br>            createSqlFileAndUpload(workflowRequest.getSql(), sqlPath);<br><br>            <span class=\"hljs-comment\">// 创建shell脚本</span><br>            String shellFileName = workflowRequest.getWfName() + <span class=\"hljs-string\">\"-shell.sh\"</span>;<br>            String shellFilePath = workflowRequest.getWfPath().concat(workflowRequest.getWfName()).concat(<span class=\"hljs-string\">\"/shell/\"</span>);<br>            String shellPath = createShellFileAndUpload(shellFileName, shellFilePath);<br><br>            <span class=\"hljs-comment\">// 创建并上传wf脚本文件</span><br>            createWfFileAndUpload(workflowRequest.getWfName(), workflowRequest.getWfPath(), sqlPath, workflowRequest.getCallbackId());<br><br>            <span class=\"hljs-comment\">// 创建脚本任务的配置</span><br>            Properties prop = oozieClient.createConfiguration();<br>            prop.setProperty(OozieClient.APP_PATH, appPath.toString());<br>            prop.setProperty(oozieClient.LIBPATH, oozieConfig.getOozieLibPath());<br>            prop.setProperty(oozieClient.USE_SYSTEM_LIBPATH, String.valueOf(oozieConfig.isOozieSystemLibPath()));<br><br>            <span class=\"hljs-comment\">/*Set Your Application Configuration*/</span><br>            prop.setProperty(OozieConstants.NAME_NODE, oozieConfig.getNameNode());<br>            prop.setProperty(OozieConstants.JOB_TRACKER,oozieConfig.getJobTracker());<br>            Path outputPath = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(), workflowRequest.getWfPath().concat(<span class=\"hljs-string\">\"output/\"</span>));<br>            prop.setProperty(OozieConstants.JOB_OUTPUT, outputPath.toString());<br>            prop.setProperty(OozieConstants.JDBC_URL, oozieConfig.getJdbcUrl());<br>            prop.setProperty(OozieConstants.PASSWORD, StringUtils.isEmpty(oozieConfig.getPassword()) ? <span class=\"hljs-string\">\"\"</span> : oozieConfig.getPassword());<br>            prop.setProperty(OozieConstants.SQL_INPUT,workflowRequest.getWfPath().concat(<span class=\"hljs-string\">\"sql/\"</span>));<br>            prop.setProperty(OozieConstants.USER_NAME,<span class=\"hljs-string\">\"admin\"</span>);<br>            prop.setProperty(OozieConstants.TASK_TYPE, TaskTypeEnum.WORKFLOW.name());<br>            prop.setProperty(OozieConstants.SHELL_FILE_NAME,shellFileName);<br>            prop.setProperty(OozieConstants.SHELL_FILE_PATH, shellPath);<br>            prop.setProperty(OozieConstants.CALLBACK_ID, workflowRequest.getCallbackId());<br>            prop.setProperty(OozieConstants.QUEUE_NAME, oozieConfig.getQueueName());<br><br>            String jobId = oozieClient.submit(prop);<br>            oozieClient.start(jobId);<br><br>            log.debug(<span class=\"hljs-string\">\"workflow job submitted, jobId = &#123;&#125;\"</span>, jobId);<br><br>            <span class=\"hljs-keyword\">return</span> jobId;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (OozieClientException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"workflow任务提交失败\"</span> ,e);<br>        &#125;<br><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">submitCoordinator</span><span class=\"hljs-params\">(CoordinatorRequest coordinatorRequest)</span> </span>&#123;<br><br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            OozieClient oozieClient = <span class=\"hljs-keyword\">new</span> OozieClient(oozieConfig.getUrl());<br>            oozieClient.setDebugMode(<span class=\"hljs-number\">1</span>);<br>            Path rootPath = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(), coordinatorRequest.getCoordPath());<br>            Path appPath = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(), coordinatorRequest.getCoordPath()<br>                    .concat(coordinatorRequest.getCoordName()).concat(<span class=\"hljs-string\">\".xml\"</span>));<br>            Path wf = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(), coordinatorRequest.getWfPath());<br>            <span class=\"hljs-comment\">// 创建相关文件</span><br>            <span class=\"hljs-comment\">// 创建并上传定时调度任务脚本</span><br>            createCoordFileAndUpload(coordinatorRequest.getCoordName(),coordinatorRequest.getCoordPath(),<br>                    wf.toString().concat(<span class=\"hljs-string\">\"/\"</span>).concat(coordinatorRequest.getWfName()).concat(<span class=\"hljs-string\">\".xml\"</span>),coordinatorRequest.getFrequencyType(), coordinatorRequest.getCallbackId());<br><br>            <span class=\"hljs-comment\">// 创建shell脚本</span><br>            String shellFileName = coordinatorRequest.getWfName() + <span class=\"hljs-string\">\"-shell.sh\"</span>;<br>            String shellFilePath = coordinatorRequest.getWfPath().concat(coordinatorRequest.getWfName()).concat(<span class=\"hljs-string\">\"/shell/\"</span>);<br>            String shellPath = createShellFileAndUpload(shellFileName, shellFilePath);<br><br>            <span class=\"hljs-comment\">// 创建脚本任务的配置</span><br>            Properties prop = oozieClient.createConfiguration();<br>            prop.setProperty(OozieClient.COORDINATOR_APP_PATH, appPath.toString());<br>            prop.setProperty(oozieClient.LIBPATH, oozieConfig.getOozieLibPath());<br>            prop.setProperty(oozieClient.USE_SYSTEM_LIBPATH, String.valueOf(oozieConfig.isOozieSystemLibPath()));<br>            prop.setProperty(OozieConstants.JOB_TRACKER,oozieConfig.getJobTracker());<br>            prop.setProperty(OozieConstants.USER_NAME,<span class=\"hljs-string\">\"admin\"</span>);<br>            prop.setProperty(OozieConstants.WORKFLOW_ROOT, rootPath.toString());<br>            String start = DateUtil.format(DateUtil.parse(coordinatorRequest.getStartTime(), <span class=\"hljs-string\">\"yyyy-MM-dd HH:mm:ss\"</span>), <span class=\"hljs-string\">\"yyyy-MM-dd'T'HH:mm'Z'\"</span>);<br>            prop.setProperty(OozieConstants.START, start);<br>            String end = DateUtil.format(DateUtil.parse(coordinatorRequest.getEndTime(), <span class=\"hljs-string\">\"yyyy-MM-dd HH:mm:ss\"</span>), <span class=\"hljs-string\">\"yyyy-MM-dd'T'HH:mm'Z'\"</span>);<br>            prop.setProperty(OozieConstants.END, end);<br>            Path outputPath = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(), coordinatorRequest.getWfPath().concat(<span class=\"hljs-string\">\"output/\"</span>));<br>            prop.setProperty(OozieConstants.JOB_OUTPUT, outputPath.toString());<br>            prop.setProperty(OozieConstants.JDBC_URL, oozieConfig.getJdbcUrl());<br>            prop.setProperty(OozieConstants.PASSWORD, StringUtils.isEmpty(oozieConfig.getPassword()) ? <span class=\"hljs-string\">\"\"</span> : oozieConfig.getPassword());<br>            prop.setProperty(OozieConstants.SQL_INPUT,coordinatorRequest.getWfPath().concat(<span class=\"hljs-string\">\"sql/\"</span>));<br>            prop.setProperty(OozieConstants.TASK_TYPE, TaskTypeEnum.COORDINATOR.name());<br>            prop.setProperty(OozieConstants.SHELL_FILE_NAME,shellFileName);<br>            prop.setProperty(OozieConstants.SHELL_FILE_PATH, shellPath);<br>            prop.setProperty(OozieConstants.CALLBACK_ID, coordinatorRequest.getCallbackId());<br>            prop.setProperty(OozieConstants.QUEUE_NAME, oozieConfig.getQueueName());<br><br>            <span class=\"hljs-comment\">/*Set Your Application Configuration*/</span><br>            prop.setProperty(OozieConstants.NAME_NODE, oozieConfig.getNameNode());<br><br>            String jobId = oozieClient.submit(prop);<br><br>            log.debug(<span class=\"hljs-string\">\"workflow job submitted, jobId = &#123;&#125;\"</span>, jobId);<br><br>            <span class=\"hljs-keyword\">return</span> jobId;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (OozieClientException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"workflow任务提交失败\"</span> ,e);<br>        &#125;<br><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">createSqlFileAndUpload</span><span class=\"hljs-params\">(String sql, String sqlPath)</span> </span>&#123;<br>        Writer writer = <span class=\"hljs-keyword\">null</span>;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Path sqlP = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(),sqlPath);<br>            writer = <span class=\"hljs-keyword\">new</span> OutputStreamWriter(fileSystem.create(sqlP));<br><br>            writer.write(sql);<br>            <span class=\"hljs-keyword\">return</span> sqlP.toString();<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"创建sql文件失败\"</span>, e);<br>        &#125; <span class=\"hljs-keyword\">finally</span> &#123;<br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != writer) &#123;<br>                <span class=\"hljs-keyword\">try</span> &#123;<br>                    writer.close();<br>                &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>                    log.error(<span class=\"hljs-string\">\"关闭流失败\"</span>, e);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">createWfFileAndUpload</span><span class=\"hljs-params\">(String wfName, String wfPath, String sqlFileName, String callbackId)</span> </span>&#123;<br>        Writer writer = <span class=\"hljs-keyword\">null</span>;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Path wf = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(),wfPath.concat(wfName).concat(<span class=\"hljs-string\">\".xml\"</span>));<br>            writer = <span class=\"hljs-keyword\">new</span> OutputStreamWriter(fileSystem.create(wf));<br>            String wfApp =<br>                    <span class=\"hljs-string\">\"&lt;workflow-app xmlns='uri:oozie:workflow:0.4' name='\"</span> + wfName + <span class=\"hljs-string\">\"'&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;start to='my-hive2-action'/&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;action name='my-hive2-action'&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"       &lt;hive2 xmlns='uri:oozie:hive2-action:0.1'&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"           &lt;name-node&gt;$&#123;nameNode&#125;&lt;/name-node&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"           &lt;prepare&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"               &lt;delete path='$&#123;jobOutput&#125;'/&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"           &lt;/prepare&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"           &lt;configuration&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                &lt;property&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                    &lt;name&gt;mapred.compress.map.output&lt;/name&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                    &lt;value&gt;true&lt;/value&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                &lt;/property&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"           &lt;/configuration&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"           &lt;jdbc-url&gt;$&#123;jdbcUrl&#125;&lt;/jdbc-url&gt;\\n\"</span> +<br><span class=\"hljs-comment\">//                            \"           &lt;password&gt;$&#123;password&#125;&lt;/password&gt;\\n\" +</span><br>                            <span class=\"hljs-string\">\"           &lt;script&gt;\"</span> + sqlFileName + <span class=\"hljs-string\">\"&lt;/script&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"           &lt;param&gt;InputDir=$&#123;sqlInput&#125;&lt;/param&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"           &lt;param&gt;OutputDir=$&#123;jobOutput&#125;&lt;/param&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"       &lt;/hive2&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;ok to='success-action'/&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;error to='error-action'/&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;/action&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;!-- 成功回调 --&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;action name='success-action'&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;shell xmlns=\\\"uri:oozie:shell-action:0.2\\\"&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;job-tracker&gt;$&#123;jobTracker&#125;&lt;/job-tracker&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;name-node&gt;$&#123;nameNode&#125;&lt;/name-node&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;configuration&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                &lt;property&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                  &lt;name&gt;mapred.job.queue.name&lt;/name&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                  &lt;value&gt;$&#123;queueName&#125;&lt;/value&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                &lt;/property&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;/configuration&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;exec&gt;$&#123;shellFileName&#125;&lt;/exec&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;argument&gt;$&#123;taskType&#125;&lt;/argument&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;argument&gt;OK&lt;/argument&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;argument&gt;$&#123;callbackId&#125;&lt;/argument&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;file&gt;$&#123;shellFilePath&#125;#$&#123;shellFilePath&#125;&lt;/file&gt; &lt;!--Copy the executable to compute node's current working directory --&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;/shell&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;ok to='end' /&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;error to='fail' /&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;/action&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"     \\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;!-- 失败回调 --&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;action name='error-action'&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;shell xmlns=\\\"uri:oozie:shell-action:0.2\\\"&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;job-tracker&gt;$&#123;jobTracker&#125;&lt;/job-tracker&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;name-node&gt;$&#123;nameNode&#125;&lt;/name-node&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;configuration&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                &lt;property&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                  &lt;name&gt;mapred.job.queue.name&lt;/name&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                  &lt;value&gt;$&#123;queueName&#125;&lt;/value&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                &lt;/property&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;/configuration&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;exec&gt;$&#123;shellFileName&#125;&lt;/exec&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;argument&gt;$&#123;taskType&#125;&lt;/argument&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;argument&gt;FAIL&lt;/argument&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;argument&gt;$&#123;callbackId&#125;&lt;/argument&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;file&gt;$&#123;shellFilePath&#125;#$&#123;shellFilePath&#125;&lt;/file&gt; &lt;!--Copy the executable to compute node's current working directory --&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;/shell&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;ok to='end' /&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;error to='fail' /&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;/action&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;kill name='fail'&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;message&gt;执行脚本失败&lt;/message&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;/kill&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;end name='end'/&gt;\\n\"</span>   +<br>                            <span class=\"hljs-string\">\"&lt;/workflow-app&gt;\"</span>;<br>            writer.write(wfApp);<br>            <span class=\"hljs-keyword\">return</span> wf.toString();<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"创建workflow文件失败\"</span>, e);<br>        &#125; <span class=\"hljs-keyword\">finally</span> &#123;<br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != writer) &#123;<br>                <span class=\"hljs-keyword\">try</span> &#123;<br>                    writer.close();<br>                &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>                    log.error(<span class=\"hljs-string\">\"关闭流失败\"</span>, e);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">createCoordFileAndUpload</span><span class=\"hljs-params\">(String coordName, String coordPath, String wfPath, FrequencyTypeEnum frequencyType, String callbackId)</span> </span>&#123;<br>        Writer writer = <span class=\"hljs-keyword\">null</span>;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Path coord = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(),coordPath.concat(coordName).concat(<span class=\"hljs-string\">\".xml\"</span>));<br>            writer = <span class=\"hljs-keyword\">new</span> OutputStreamWriter(fileSystem.create(coord));<br>            String frequency = FrequencyTypeEnum.getExpressionByName(frequencyType.name(), <span class=\"hljs-number\">1</span>);<br>            String wfApp =<br>                    <span class=\"hljs-string\">\"&lt;coordinator-app name='\"</span> + coordName + <span class=\"hljs-string\">\"' frequency='\"</span> + frequency + <span class=\"hljs-string\">\"' start='$&#123;start&#125;' end='$&#123;end&#125;' timezone='Asia/Shanghai'\\n\"</span> +<br>                            <span class=\"hljs-string\">\"                 xmlns='uri:oozie:coordinator:0.4'&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;action&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;workflow&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"            &lt;app-path&gt;\"</span> + wfPath + <span class=\"hljs-string\">\"&lt;/app-path&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"        &lt;/workflow&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"    &lt;/action&gt;\\n\"</span> +<br>                            <span class=\"hljs-string\">\"&lt;/coordinator-app&gt;\"</span>;<br>            writer.write(wfApp);<br>            <span class=\"hljs-keyword\">return</span> coordName.toString();<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"创建coordinator文件失败\"</span>, e);<br>        &#125; <span class=\"hljs-keyword\">finally</span> &#123;<br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != writer) &#123;<br>                <span class=\"hljs-keyword\">try</span> &#123;<br>                    writer.close();<br>                &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>                    log.error(<span class=\"hljs-string\">\"关闭流失败\"</span>, e);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">createShellFileAndUpload</span><span class=\"hljs-params\">(String shellFileName, String shellFilePath)</span> </span>&#123;<br>        Writer writer = <span class=\"hljs-keyword\">null</span>;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Path shellPath = <span class=\"hljs-keyword\">new</span> Path(fileSystem.getHomeDirectory(),shellFilePath.concat(shellFileName));<br>            writer = <span class=\"hljs-keyword\">new</span> OutputStreamWriter(fileSystem.create(shellPath));<br>            String shell =<br>                    <span class=\"hljs-string\">\"#!/bin/bash\\n\"</span> +<br>                    <span class=\"hljs-string\">\"echo 'curl \"</span> + oozieConfig.getCallbackUrl() + <span class=\"hljs-string\">\"';\\n\"</span> +<br>                    <span class=\"hljs-string\">\"curl -X GET \"</span> + oozieConfig.getCallbackUrl();<br>            writer.write(shell);<br>            <span class=\"hljs-keyword\">return</span> shellPath.toString();<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"创建shell文件失败\"</span>, e);<br>        &#125; <span class=\"hljs-keyword\">finally</span> &#123;<br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != writer) &#123;<br>                <span class=\"hljs-keyword\">try</span> &#123;<br>                    writer.close();<br>                &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>                    log.error(<span class=\"hljs-string\">\"关闭流失败\"</span>, e);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">executeCallback</span><span class=\"hljs-params\">(String executeType, String taskType, String callbackId)</span> </span>&#123;<br>        <span class=\"hljs-comment\">// TODO</span><br>        log.info(<span class=\"hljs-string\">\"回调处理，executeType=&#123;&#125;, taskType=&#123;&#125;, callbackId=&#123;&#125;\"</span>, executeType, taskType, callbackId);<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">killCoordinatorJob</span><span class=\"hljs-params\">(String jobId)</span> </span>&#123;<br>        OozieClient oozieClient = <span class=\"hljs-keyword\">new</span> OozieClient(oozieConfig.getUrl());<br>        oozieClient.setDebugMode(<span class=\"hljs-number\">1</span>);<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            oozieClient.kill(jobId);<br>        &#125; <span class=\"hljs-keyword\">catch</span> (OozieClientException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"停止定时任务失败\"</span>, e);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>注意：上面调用的hdfs的接口是本文开头提到的前提条件，请到相应的文章集成hdfs，因为这是必须的，需要将脚本文件上传到hdfs才可以在oozie中引用到脚本文件。</p>\n<p>控制器</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.controller;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.model.CoordinatorRequest;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.model.WorkflowRequest;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.service.OozieService;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.utils.APIResponse;<br><span class=\"hljs-keyword\">import</span> io.swagger.annotations.Api;<br><span class=\"hljs-keyword\">import</span> io.swagger.annotations.ApiOperation;<br><span class=\"hljs-keyword\">import</span> io.swagger.annotations.ApiParam;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.web.bind.annotation.*;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/25 11:10 上午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span> TODO</span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-meta\">@Api</span>(tags = <span class=\"hljs-string\">\"oozie调度任务\"</span>)<br><span class=\"hljs-meta\">@RequestMapping</span>(<span class=\"hljs-string\">\"/oozie\"</span>)<br><span class=\"hljs-meta\">@RestController</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">OozieController</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> OozieService oozieService;<br><br>    <span class=\"hljs-meta\">@ApiOperation</span>(<span class=\"hljs-string\">\"提交workflow任务\"</span>)<br>    <span class=\"hljs-meta\">@PostMapping</span>(<span class=\"hljs-string\">\"/job/workflow\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> APIResponse&lt;String&gt; <span class=\"hljs-title\">submitWorkflowJob</span><span class=\"hljs-params\">(</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">        @RequestBody WorkflowRequest workflowRequest</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">    )</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> APIResponse.success(oozieService.submitWorkflow(workflowRequest));<br>    &#125;<br><br>    <span class=\"hljs-meta\">@ApiOperation</span>(<span class=\"hljs-string\">\"提交coordinator定时调度任务\"</span>)<br>    <span class=\"hljs-meta\">@PostMapping</span>(<span class=\"hljs-string\">\"/job/coordinator\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> APIResponse&lt;String&gt; <span class=\"hljs-title\">submitCoordJob</span><span class=\"hljs-params\">(</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">            @RequestBody CoordinatorRequest coordinatorRequest</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">            )</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> APIResponse.success(oozieService.submitCoordinator(coordinatorRequest));<br>    &#125;<br><br>    <span class=\"hljs-meta\">@ApiOperation</span>(<span class=\"hljs-string\">\"停止定时调度任务\"</span>)<br>    <span class=\"hljs-meta\">@DeleteMapping</span>(<span class=\"hljs-string\">\"/&#123;jobId&#125;\"</span>)<br>    <span class=\"hljs-keyword\">public</span> APIResponse&lt;?&gt; killCoordJob(<br>            <span class=\"hljs-meta\">@PathVariable</span>(<span class=\"hljs-string\">\"jobId\"</span>)<br>            String jobId<br>    ) &#123;<br>        oozieService.killCoordinatorJob(jobId);<br>        <span class=\"hljs-keyword\">return</span> APIResponse.success();<br>    &#125;<br><br>    <span class=\"hljs-meta\">@ApiOperation</span>(<span class=\"hljs-string\">\"处理回调\"</span>)<br>    <span class=\"hljs-meta\">@GetMapping</span>(<span class=\"hljs-string\">\"/callback\"</span>)<br>    <span class=\"hljs-keyword\">public</span> APIResponse&lt;?&gt; executeCallback(<br>            <span class=\"hljs-meta\">@ApiParam</span>(name = <span class=\"hljs-string\">\"executeType\"</span>, value = <span class=\"hljs-string\">\"处理类型\"</span>, required = <span class=\"hljs-keyword\">true</span>)<br>            <span class=\"hljs-meta\">@RequestParam</span>(name = <span class=\"hljs-string\">\"executeType\"</span>, required = <span class=\"hljs-keyword\">true</span>)<br>                    String executeType,<br>            <span class=\"hljs-meta\">@ApiParam</span>(name = <span class=\"hljs-string\">\"taskType\"</span>, value = <span class=\"hljs-string\">\"任务类型\"</span>, required = <span class=\"hljs-keyword\">true</span>)<br>            <span class=\"hljs-meta\">@RequestParam</span>(name = <span class=\"hljs-string\">\"taskType\"</span>, required = <span class=\"hljs-keyword\">true</span>)<br>                    String taskType,<br>            <span class=\"hljs-meta\">@ApiParam</span>(name = <span class=\"hljs-string\">\"callbackId\"</span>, value = <span class=\"hljs-string\">\"回调编号\"</span>, required = <span class=\"hljs-keyword\">true</span>)<br>            <span class=\"hljs-meta\">@RequestParam</span>(name = <span class=\"hljs-string\">\"callbackId\"</span>, required = <span class=\"hljs-keyword\">true</span>)<br>            String callbackId<br>    ) &#123;<br>        oozieService.executeCallback(executeType, taskType, callbackId);<br>        <span class=\"hljs-keyword\">return</span> APIResponse.success();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>上面实现的主要功能有：提交workflow和coordinator任务，停止任务等功能；</p>\n<p>处理回调并不是必须的，可以根据业务要求来实现各种个性化功能；</p>\n<h2 id=\"源码地址\"><a href=\"#源码地址\" class=\"headerlink\" title=\"源码地址:\"></a>源码地址:</h2><p><a href=\"https://github.com/WinterChenS/springboot-learning-experience/tree/master/spring-boot-hadoop\" target=\"_blank\" rel=\"noopener\">WinterChenS/springboot-learning-experience</a></p>\n<h2 id=\"参考文档：\"><a href=\"#参考文档：\" class=\"headerlink\" title=\"参考文档：\"></a>参考文档：</h2><ul>\n<li><a href=\"https://oozie-study.readthedocs.io/en/master/Official%20Document/02.%20Example/#java-api\" target=\"_blank\" rel=\"noopener\">https://oozie-study.readthedocs.io/en/master/Official Document/02. Example/#java-api</a></li>\n<li><a href=\"https://timepasstechies.com/oozie-workflow-example-shell-action-end-end-configuration/\" target=\"_blank\" rel=\"noopener\">https://timepasstechies.com/oozie-workflow-example-shell-action-end-end-configuration/</a></li>\n<li><a href=\"https://oozie.apache.org/docs/3.1.3-incubating/DG_CommandLineTool.html\" target=\"_blank\" rel=\"noopener\">https://oozie.apache.org/docs/3.1.3-incubating/DG_CommandLineTool.html</a></li>\n<li><a href=\"https://www.programcreek.com/java-api-examples/?api=org.apache.oozie.client.OozieClient\" target=\"_blank\" rel=\"noopener\">https://www.programcreek.com/java-api-examples/?api=org.apache.oozie.client.OozieClient</a></li>\n</ul>\n","raw":null,"categories":[{"name":"hadoop","path":"api/categories/hadoop.json"}],"tags":[{"name":"hadoop","path":"api/tags/hadoop.json"},{"name":"springboot","path":"api/tags/springboot.json"},{"name":"oozie","path":"api/tags/oozie.json"}]}]}