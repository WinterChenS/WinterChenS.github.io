{"name":"Hibernate","postlist":[{"title":"Hibernate 自定义查询sql 并使用自定义对象接收查询结果","slug":"hibernate-sql","date":"2018-01-18T13:50:00.000Z","updated":"2022-12-01T01:32:39.787Z","comments":true,"top":null,"path":"api/articles/hibernate-sql.json","excerpt":" [Figure] 在很多的生产中，hibernate并不能满足我们所有的开发需求，比如，很多表的联合查询，并且查询之后的各种结果封装在自定义的dto对象中，那么我们就需要使用自定义的sql进行查询了，好了，开始我们新的旅程吧。","keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046767188692.jpg","content":"<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046767443548.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<blockquote>\n<p>在很多的生产中，hibernate并不能满足我们所有的开发需求，比如，很多表的联合查询，并且查询之后的各种结果封装在自定义的dto对象中，那么我们就需要使用自定义的sql进行查询了，好了，开始我们新的旅程吧。</p>\n</blockquote>\n<a id=\"more\"></a>\n<h3 id=\"需求：\"><a href=\"#需求：\" class=\"headerlink\" title=\"需求：\"></a>需求：</h3><ul>\n<li>n张表进行联合查询</li>\n<li>将结果封装在一个DTO的对象中</li>\n</ul>\n<h3 id=\"代码：\"><a href=\"#代码：\" class=\"headerlink\" title=\"代码：\"></a>代码：</h3><p><strong>本文中使用了一个很复杂的联合查询的sql，所以大家并不需要了解详细，只需要只是我们进行一个很复杂的多张表进行联合查询的操作，最后将结果使用自定义的dto对象接收即可</strong></p>\n<h4 id=\"SQL\"><a href=\"#SQL\" class=\"headerlink\" title=\"SQL\"></a>SQL</h4><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">SELECT</span><br>\tp9.projectId,<br>\tp9.fenxiaoMoney,<br>\tp9.shopCount<br><span class=\"hljs-keyword\">FROM</span><br>\t(<br>\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\tp8.projectId,<br>\t\t\tp8.fenxiaoMoney,<br>\t\t\t<span class=\"hljs-keyword\">count</span>(ic.inviteByPerson) shopCount<br>\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t(<br>\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\tp7.projectId,<br>\t\t\t\tp7.fenxiaoMoney<br>\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t(<br>\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\tpp.projectId,<br>\t\t\t\t\t\tg.fenxiaoMoney<br>\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t(<br>\t\t\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\t\t\tp6.projectId<br>\t\t\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t\t\t(<br>\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\t\t\t\t\tp5.projectId<br>\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t\t\t\t\t(<br>\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\t\t\t\t\t\t\tp4.projectId<br>\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t\t\t\t\t\t\t(<br>\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\tp2.projectId<br>\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t(<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tp1.projectId<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tp.projectId<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt_projects p<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">WHERE</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-number\">1</span> = <span class=\"hljs-number\">1</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> p.averagePrice &gt;= <span class=\"hljs-number\">1.0</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> p.averagePrice &lt;= <span class=\"hljs-number\">10000000000.0</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> p.saleLongitude &gt;= <span class=\"hljs-number\">1.0</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> p.saleLongitude &lt;= <span class=\"hljs-number\">10000.00</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> p.saleLatitude &gt;= <span class=\"hljs-number\">1.0</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> p.saleLatitude &lt;= <span class=\"hljs-number\">10000.0</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> p.rightsYears = <span class=\"hljs-number\">70</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> p.city <span class=\"hljs-keyword\">LIKE</span> <span class=\"hljs-string\">'%330000%'</span> <span class=\"hljs-comment\">#AND p.isOpenStatus = 1</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> p.buildArea &gt;= <span class=\"hljs-number\">1.0</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> p.buildArea &lt;= <span class=\"hljs-number\">10000000.0</span> <span class=\"hljs-comment\">#AND p.afforestationRatio = 1</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> p.projectName <span class=\"hljs-keyword\">LIKE</span> <span class=\"hljs-string\">'%%'</span> <span class=\"hljs-comment\">#AND p.projectId = '1515269bc87448b4927fa676c624c8f6'</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) p1<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">INNER</span> <span class=\"hljs-keyword\">JOIN</span> (<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttargetId<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt_tagsrelation<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">WHERE</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-number\">1</span> = <span class=\"hljs-number\">1</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> originalTags <span class=\"hljs-keyword\">LIKE</span> <span class=\"hljs-string\">'%4507%'</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> originalTags <span class=\"hljs-keyword\">LIKE</span> <span class=\"hljs-string\">'%757%'</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) t1 <span class=\"hljs-keyword\">ON</span> p1.projectId = t1.targetId<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t) p2<br>\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">INNER</span> <span class=\"hljs-keyword\">JOIN</span> (<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\th.projectId<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt_projecthouses h<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">WHERE</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\th.houseNum <span class=\"hljs-keyword\">IN</span> (<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttargetId<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt_tagsrelation<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">WHERE</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-number\">1</span> = <span class=\"hljs-number\">1</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> originalTags <span class=\"hljs-keyword\">LIKE</span> <span class=\"hljs-string\">'%%'</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> h.houseStatus = <span class=\"hljs-number\">1</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> isOpen = <span class=\"hljs-number\">1</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t) p3 <span class=\"hljs-keyword\">ON</span> p2.projectId = p3.projectId<br>\t\t\t\t\t\t\t\t\t\t\t\t) p4<br>\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">INNER</span> <span class=\"hljs-keyword\">JOIN</span> (<br>\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\tprojectId<br>\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\tt_projecthousetypes pht<br>\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">WHERE</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-number\">1</span> = <span class=\"hljs-number\">1</span><br>\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> pht.housType = <span class=\"hljs-string\">'三房两厅一卫'</span><br>\t\t\t\t\t\t\t\t\t\t\t) pht1 <span class=\"hljs-keyword\">ON</span> p4.projectId = pht1.projectId<br>\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">GROUP</span> <span class=\"hljs-keyword\">BY</span><br>\t\t\t\t\t\t\t\t\t\t\t\tp4.projectId<br>\t\t\t\t\t\t\t\t\t\t) p5<br>\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">INNER</span> <span class=\"hljs-keyword\">JOIN</span> (<br>\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\t\t\t\t\t\tph.projectId<br>\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t\t\t\t\t\tt_projecthouses ph<br>\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">WHERE</span><br>\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-number\">1</span> = <span class=\"hljs-number\">1</span><br>\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> (<br>\t\t\t\t\t\t\t\t\t\t\tph.houseKind = <span class=\"hljs-string\">'10'</span><br>\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">OR</span> ph.houseKind = <span class=\"hljs-string\">'0'</span><br>\t\t\t\t\t\t\t\t\t\t)<br>\t\t\t\t\t\t\t\t\t) hk <span class=\"hljs-keyword\">ON</span> p5.projectId = hk.projectId<br>\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">GROUP</span> <span class=\"hljs-keyword\">BY</span><br>\t\t\t\t\t\t\t\t\t\tp5.projectId<br>\t\t\t\t\t\t\t\t) p6<br>\t\t\t\t\t\t\t<span class=\"hljs-keyword\">INNER</span> <span class=\"hljs-keyword\">JOIN</span> (<br>\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\t\t\t\tapplyForPerson<br>\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t\t\t\tt_applychart<br>\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">WHERE</span><br>\t\t\t\t\t\t\t\t\tapplyByPerson = <span class=\"hljs-string\">'860635'</span><br>\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> applyStatus = <span class=\"hljs-number\">2</span><br>\t\t\t\t\t\t\t) ap <span class=\"hljs-keyword\">ON</span> p6.projectId = ap.applyForPerson<br>\t\t\t\t\t\t) pp<br>\t\t\t\t\t<span class=\"hljs-keyword\">LEFT</span> <span class=\"hljs-keyword\">JOIN</span> t_projectguide g <span class=\"hljs-keyword\">ON</span> pp.projectId = g.projectId<br>\t\t\t\t) p7<br>\t\t) p8<br>\t\t\t<br>\t\t<span class=\"hljs-keyword\">LEFT</span> <span class=\"hljs-keyword\">JOIN</span> (<span class=\"hljs-keyword\">SELECT</span> inviteByPerson <span class=\"hljs-keyword\">FROM</span> t_invitechart <span class=\"hljs-keyword\">WHERE</span> inviteStatus = <span class=\"hljs-number\">2</span>) ic <span class=\"hljs-keyword\">ON</span> p8.projectId = ic.inviteByPerson<br>\t\t<span class=\"hljs-keyword\">GROUP</span> <span class=\"hljs-keyword\">BY</span><br>\t\t\tp8.projectId<br>\t) p9<br><span class=\"hljs-keyword\">LEFT</span> <span class=\"hljs-keyword\">JOIN</span> (<br>\t<span class=\"hljs-keyword\">SELECT</span><br>\t\tbeCollectId<br>\t<span class=\"hljs-keyword\">FROM</span><br>\t\tt_newcollectrecord<br>\t<span class=\"hljs-keyword\">WHERE</span><br>\t\tuserId = <span class=\"hljs-string\">'4e0b0089-410a-497e-8056-6190e2a183d4'</span><br>) nc <span class=\"hljs-keyword\">ON</span> p9.projectId = nc.beCollectId<br><span class=\"hljs-keyword\">GROUP</span> <span class=\"hljs-keyword\">BY</span><br>\tp9.projectId<br><span class=\"hljs-keyword\">ORDER</span> <span class=\"hljs-keyword\">BY</span><br>\tshopCount <span class=\"hljs-keyword\">DESC</span><br><span class=\"hljs-keyword\">LIMIT</span> <span class=\"hljs-number\">0</span>,<br> <span class=\"hljs-number\">10</span><br></code></pre></td></tr></table></figure>\n\n<p>从sql中可以看出我们需要查的三个参数：</p>\n<ul>\n<li>项目的Id</li>\n<li>钱的数量</li>\n<li>合作店铺的数量</li>\n</ul>\n<p>需要的额外功能：</p>\n<ul>\n<li>分页</li>\n<li>根据上面的参数进行排序</li>\n</ul>\n<h4 id=\"SQL拼接方法\"><a href=\"#SQL拼接方法\" class=\"headerlink\" title=\"SQL拼接方法\"></a>SQL拼接方法</h4><p><strong>顾名思义就是将上述的sql使用java进行拼接，因为这样便于查看和bug查找(这段并不重要)</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t * 拼接Hql中的p段</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> param</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> user</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> sb</span><br><span class=\"hljs-comment\">\t */</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">jointHqlTheP</span><span class=\"hljs-params\">(ShopSearchParam param, User user, StringBuilder sb)</span></span>&#123;<br>\t\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t\t * SELECT</span><br><span class=\"hljs-comment\">\t\t\t\tp.projectId</span><br><span class=\"hljs-comment\">\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\tt_projects p</span><br><span class=\"hljs-comment\">\t\t\tWHERE</span><br><span class=\"hljs-comment\">\t\t\t\t1 = 1</span><br><span class=\"hljs-comment\">\t\t\tAND p.averagePrice &gt;= 1.0</span><br><span class=\"hljs-comment\">\t\t\tAND p.averagePrice &lt;= 10000000000.0</span><br><span class=\"hljs-comment\">\t\t\tAND p.saleLongitude &gt;= 1.0</span><br><span class=\"hljs-comment\">\t\t\tAND p.saleLongitude &lt;= 10000.00</span><br><span class=\"hljs-comment\">\t\t\tAND p.saleLatitude &gt;= 1.0</span><br><span class=\"hljs-comment\">\t\t\tAND p.saleLatitude &lt;= 10000.0</span><br><span class=\"hljs-comment\">\t\t\tAND p.rightsYears = 70</span><br><span class=\"hljs-comment\">\t\t\tAND p.city LIKE '%330000%' #AND p.isOpenStatus = 1</span><br><span class=\"hljs-comment\">\t\t\tAND p.buildArea &gt;= 1.0</span><br><span class=\"hljs-comment\">\t\t\tAND p.buildArea &lt;= 10000000.0 #AND p.afforestationRatio = 1</span><br><span class=\"hljs-comment\">\t\t\tAND p.projectName LIKE '%%' #AND p.projectId = '1515269bc87448b4927fa676c624c8f6'</span><br><span class=\"hljs-comment\">\t\t */</span><br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" p.projectId \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" t_projects p \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" WHERE \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" 1 = 1 \"</span>);<br>\t\t<span class=\"hljs-keyword\">if</span>(param.getMinAveragePrice() != <span class=\"hljs-keyword\">null</span>)&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.averagePrice &gt;= \"</span> + param.getMinAveragePrice());<br>\t\t&#125;<br>\t\t<span class=\"hljs-keyword\">if</span>(param.getMaxAveragePrice() != <span class=\"hljs-keyword\">null</span>)&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.averagePrice &lt;= \"</span> + param.getMaxAveragePrice());<br>\t\t&#125;<br>\t\t<span class=\"hljs-keyword\">if</span>(!isEmpty(param.getMinLongitudes()))&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.saleLongitude &gt;= \"</span> + param.getMinLongitudes());<br>\t\t&#125;<br>\t\t<span class=\"hljs-keyword\">if</span>(!isEmpty(param.getMaxLongitudes()))&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.saleLongitude &lt;= \"</span> + param.getMaxLongitudes());<br>\t\t&#125;<br>\t\t<span class=\"hljs-keyword\">if</span>(!isEmpty(param.getMinLatitudes()))&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.saleLatitude &gt;= \"</span> + param.getMinLatitudes());<br>\t\t&#125;<br>\t\t<span class=\"hljs-keyword\">if</span>(!isEmpty(param.getMaxLatitudes()))&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.saleLatitude &lt;= \"</span> + param.getMaxLatitudes());<br>\t\t&#125;<br>\t\t<span class=\"hljs-keyword\">if</span>(param.getRightsYears() != <span class=\"hljs-keyword\">null</span>)&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.rightsYears = \"</span> + param.getRightsYears());<br>\t\t&#125;<br>\t\t<span class=\"hljs-keyword\">if</span>(!isEmpty(param.getCityId()))&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.city LIKE '%\"</span> + param.getCityId() + <span class=\"hljs-string\">\"%'\"</span>);<br>\t\t&#125;<span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(!isEmpty(param.getCityName()))&#123;<br>\t\t\tString hql = <span class=\"hljs-string\">\"from CountryProvinceInfo where cityName = '\"</span> + param.getCityName() + <span class=\"hljs-string\">\"' and cityLevel = '市' \"</span>;<br>\t\t\tCountryProvinceInfo cp = (CountryProvinceInfo) baseDao.loadObject(hql);<br>\t\t\tString cityId = cp.getUpCityId();<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.city LIKE '%\"</span> + cityId + <span class=\"hljs-string\">\"%'\"</span>);<br>\t\t&#125;<br>\t\t<span class=\"hljs-comment\">//项目状态 在售、等待售、全部</span><br>\t\t<span class=\"hljs-keyword\">if</span>(param.getProjectStatus() != <span class=\"hljs-keyword\">null</span>)&#123;<br>\t\t\t<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.isOpenStatus = \"</span> + param.getProjectStatus());<br>\t\t&#125;<br>\t\t<span class=\"hljs-keyword\">if</span>(param.getMinBulidArea() != <span class=\"hljs-keyword\">null</span>)&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.buildArea &gt;= \"</span> + param.getMinBulidArea());<br>\t\t&#125;<br>\t\t<span class=\"hljs-keyword\">if</span>(param.getMaxBuildArea() != <span class=\"hljs-keyword\">null</span>)&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.buildArea &lt;= \"</span> + param.getMaxBuildArea());<br>\t\t&#125;<br>\t\t<span class=\"hljs-keyword\">if</span>(!isEmpty(param.getProjectName()))&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.projectName LIKE '%\"</span> + param.getProjectName() + <span class=\"hljs-string\">\"%' \"</span>);<br>\t\t&#125;<br>\t\t<span class=\"hljs-keyword\">if</span>(!isEmpty(param.getProjectId()))&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.projectId = '\"</span> + param.getProjectId() + <span class=\"hljs-string\">\"' \"</span>);<br>\t\t&#125;<br>\t\t<br>\t&#125;<br>\t<br>\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t * 拼接Hql的p1段 -- 项目标签过滤</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> param</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> user</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> sb</span><br><span class=\"hljs-comment\">\t */</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">jointHqlTheP1</span><span class=\"hljs-params\">(ShopSearchParam param, User user, StringBuilder sb)</span></span>&#123;<br>\t\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t\t * SELECT</span><br><span class=\"hljs-comment\">\t\t\t\tp1.projectId</span><br><span class=\"hljs-comment\">\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t(</span><br><span class=\"hljs-comment\">\t\t\t\t\t&#123;p&#125;//这个是p段</span><br><span class=\"hljs-comment\">\t\t\t\t) p1</span><br><span class=\"hljs-comment\">\t\t\tINNER JOIN (</span><br><span class=\"hljs-comment\">\t\t\t\tSELECT</span><br><span class=\"hljs-comment\">\t\t\t\t\ttargetId</span><br><span class=\"hljs-comment\">\t\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t\tt_tagsrelation</span><br><span class=\"hljs-comment\">\t\t\t\tWHERE</span><br><span class=\"hljs-comment\">\t\t\t\t\t1 = 1</span><br><span class=\"hljs-comment\">\t\t\t\tAND originalTags LIKE '%4507%'</span><br><span class=\"hljs-comment\">\t\t\t\tAND originalTags LIKE '%757%'</span><br><span class=\"hljs-comment\">\t\t\t) t1 ON p1.projectId = t1.targetId</span><br><span class=\"hljs-comment\">\t\t */</span><br>\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" p1.projectId \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" ( \"</span>);<br>\t\t<br>\t\t<span class=\"hljs-keyword\">this</span>.jointHqlTheP(param, user, sb);<span class=\"hljs-comment\">//将p加入</span><br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" ) p1 \"</span>);<br>\t\t<span class=\"hljs-keyword\">if</span>(!isEmpty(param.getpTags()))&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" INNER JOIN ( \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" targetId \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" t_tagsrelation \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" WHERE \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" 1 = 1 \"</span>);<br>\t\t\tString[] pTags = <span class=\"hljs-keyword\">this</span>.stringToArray(param.getpTags());<br>\t\t\t<span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; pTags.length; i++) &#123;<br>\t\t\t\tsb.append(<span class=\"hljs-string\">\" AND originalTags LIKE '%\"</span> + pTags[i] + <span class=\"hljs-string\">\"%' \"</span>);<br>\t\t\t&#125;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" ) t1 ON p1.projectId = t1.targetId \"</span>);<br>\t\t&#125;<br>\t\t<br>\t&#125;<br>\t<br>\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t * 拼接Hql的p2段 -- 房源标签过滤</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> param</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> user</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> sb</span><br><span class=\"hljs-comment\">\t */</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">jointHqlTheP2</span><span class=\"hljs-params\">(ShopSearchParam param, User user, StringBuilder sb)</span></span>&#123;<br>\t\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t\t * SELECT</span><br><span class=\"hljs-comment\">\t\t\t\tp2.projectId</span><br><span class=\"hljs-comment\">\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t(</span><br><span class=\"hljs-comment\">\t\t\t\t\t&#123;p1&#125;//这个是p1段</span><br><span class=\"hljs-comment\">\t\t\t\t) p2</span><br><span class=\"hljs-comment\">\t\t\tINNER JOIN (</span><br><span class=\"hljs-comment\">\t\t\t\tSELECT</span><br><span class=\"hljs-comment\">\t\t\t\t\th.projectId</span><br><span class=\"hljs-comment\">\t\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t\tt_projecthouses h</span><br><span class=\"hljs-comment\">\t\t\t\tWHERE</span><br><span class=\"hljs-comment\">\t\t\t\t\th.houseNum IN (</span><br><span class=\"hljs-comment\">\t\t\t\t\t\tSELECT</span><br><span class=\"hljs-comment\">\t\t\t\t\t\t\ttargetId</span><br><span class=\"hljs-comment\">\t\t\t\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t\t\t\tt_tagsrelation</span><br><span class=\"hljs-comment\">\t\t\t\t\t\tWHERE</span><br><span class=\"hljs-comment\">\t\t\t\t\t\t\t1 = 1</span><br><span class=\"hljs-comment\">\t\t\t\t\t\tAND originalTags LIKE '%%'</span><br><span class=\"hljs-comment\">\t\t\t\t\t)</span><br><span class=\"hljs-comment\">\t\t\t\tAND h.houseStatus = 1</span><br><span class=\"hljs-comment\">\t\t\t\tAND isOpen = 1</span><br><span class=\"hljs-comment\">\t\t\t) p3 ON p2.projectId = p3.projectId</span><br><span class=\"hljs-comment\">\t\t */</span><br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" p2.projectId \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" ( \"</span>);<br>\t\t<br>\t\t<span class=\"hljs-keyword\">this</span>.jointHqlTheP1(param, user, sb);<span class=\"hljs-comment\">//这个拼接p1</span><br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" ) p2 \"</span>);<br>\t\t<br>\t\t<span class=\"hljs-keyword\">if</span>(!isEmpty(param.gethTags()))&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" INNER JOIN ( \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" h.projectId \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" t_projecthouses h \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" WHERE \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" h.houseNum IN ( \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" targetId \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" t_tagsrelation \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" WHERE \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" 1=1 \"</span>);<br>\t\t\tString[] hTags = <span class=\"hljs-keyword\">this</span>.stringToArray(param.gethTags());<br>\t\t\t<span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; hTags.length; i++) &#123;<br>\t\t\t\tsb.append(<span class=\"hljs-string\">\" AND originalTags LIKE '%\"</span> + hTags[i] + <span class=\"hljs-string\">\"%' \"</span>);<br>\t\t\t&#125;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" ) \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND h.houseStatus = 1 \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND isOpen = 1 \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" ) p3 ON p2.projectId = p3.projectId \"</span>);<br>\t\t\t<br>\t\t&#125;<br>\t&#125;<br>\t<br>\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t * 拼接Hql的p4段 -- 房源户型</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> param</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> user</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> sb</span><br><span class=\"hljs-comment\">\t */</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">jointHqlTheP4</span><span class=\"hljs-params\">(ShopSearchParam param, User user, StringBuilder sb)</span></span>&#123;<br>\t\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t\t * SELECT</span><br><span class=\"hljs-comment\">\t\t\t\tp4.projectId</span><br><span class=\"hljs-comment\">\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t(</span><br><span class=\"hljs-comment\">\t\t\t\t\t&#123;p2&#125;//这个是p2段</span><br><span class=\"hljs-comment\">\t\t\t\t) p4</span><br><span class=\"hljs-comment\">\t\t\tINNER JOIN (</span><br><span class=\"hljs-comment\">\t\t\t\tSELECT</span><br><span class=\"hljs-comment\">\t\t\t\t\tprojectId</span><br><span class=\"hljs-comment\">\t\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t\tt_projecthousetypes pht</span><br><span class=\"hljs-comment\">\t\t\t\tWHERE</span><br><span class=\"hljs-comment\">\t\t\t\t\t1 = 1</span><br><span class=\"hljs-comment\">\t\t\t\tAND pht.housType = '三房两厅一卫'</span><br><span class=\"hljs-comment\">\t\t\t) pht1 ON p4.projectId = pht1.projectId</span><br><span class=\"hljs-comment\">\t\t\tGROUP BY</span><br><span class=\"hljs-comment\">\t\t\t\tp4.projectId</span><br><span class=\"hljs-comment\">\t\t */</span><br>\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" p4.projectId \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" ( \"</span>);<br>\t\t<br>\t\t<span class=\"hljs-keyword\">this</span>.jointHqlTheP2(param, user, sb);<br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" ) p4 \"</span>);<br>\t\t<br>\t\t<span class=\"hljs-keyword\">if</span>(!isEmpty(param.getHouseType()))&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" INNER JOIN ( \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" projectId \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" t_projecthousetypes pht \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" WHERE \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" 1 = 1 \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND pht.housType = '\"</span> + param.getHouseType() + <span class=\"hljs-string\">\"' \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" ) pht1 ON p4.projectId = pht1.projectId \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" GROUP BY \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" p4.projectId \"</span>);<br>\t\t&#125;<br>\t\t<br>\t\t<br>\t\t<br>\t&#125;<br>\t<br>\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t * 拼接Hql的p5段 -- 房源类型过滤</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> param</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> user</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> sb</span><br><span class=\"hljs-comment\">\t */</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">jointHqlTheP5</span><span class=\"hljs-params\">(ShopSearchParam param, User user, StringBuilder sb)</span></span>&#123;<br>\t\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t\t * SELECT</span><br><span class=\"hljs-comment\">\t\t\t\tp5.projectId</span><br><span class=\"hljs-comment\">\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t(</span><br><span class=\"hljs-comment\">\t\t\t\t\t&#123;p4&#125;//拼接p4段</span><br><span class=\"hljs-comment\">\t\t\t\t) p5</span><br><span class=\"hljs-comment\">\t\t\tINNER JOIN (</span><br><span class=\"hljs-comment\">\t\t\t\tSELECT</span><br><span class=\"hljs-comment\">\t\t\t\t\tph.projectId</span><br><span class=\"hljs-comment\">\t\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t\tt_projecthouses ph</span><br><span class=\"hljs-comment\">\t\t\t\tWHERE</span><br><span class=\"hljs-comment\">\t\t\t\t\t1 = 1</span><br><span class=\"hljs-comment\">\t\t\t\tAND (</span><br><span class=\"hljs-comment\">\t\t\t\t\tph.houseKind = '10'</span><br><span class=\"hljs-comment\">\t\t\t\t\tOR ph.houseKind = '0'</span><br><span class=\"hljs-comment\">\t\t\t\t)</span><br><span class=\"hljs-comment\">\t\t\t) hk ON p5.projectId = hk.projectId</span><br><span class=\"hljs-comment\">\t\t\tGROUP BY</span><br><span class=\"hljs-comment\">\t\t\t\tp5.projectId</span><br><span class=\"hljs-comment\">\t\t */</span><br>\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" p5.projectId \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" ( \"</span>);<br>\t\t<br>\t\t<span class=\"hljs-keyword\">this</span>.jointHqlTheP4(param, user, sb);<br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" ) p5 \"</span>);<br>\t\t<br>\t\t<span class=\"hljs-keyword\">if</span>(!isEmpty(param.getHouseKinds()))&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" INNER JOIN ( \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" ph.projectId \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" t_projecthouses ph \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" WHERE \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" 1 = 1 \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND ( \"</span>);<br>\t\t\tString[] kinds = <span class=\"hljs-keyword\">this</span>.stringToArray(param.getHouseKinds());<br>\t\t\t<span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; kinds.length; i++) &#123;<br>\t\t\t\t<span class=\"hljs-keyword\">if</span>(i == <span class=\"hljs-number\">0</span>)&#123;<br>\t\t\t\t\tsb.append(<span class=\"hljs-string\">\" ph.houseKind = '\"</span> + kinds[i] + <span class=\"hljs-string\">\"' \"</span>);<br>\t\t\t\t&#125;<span class=\"hljs-keyword\">else</span>&#123;<br>\t\t\t\t\tsb.append(<span class=\"hljs-string\">\" OR  ph.houseKind = '\"</span> + kinds[i] + <span class=\"hljs-string\">\"' \"</span>);<br>\t\t\t\t&#125;<br>\t\t\t&#125;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" ) \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" ) hk ON p5.projectId = hk.projectId \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" GROUP BY p5.projectId \"</span>);<br>\t\t&#125;<br>\t\t<br>\t&#125;<br>\t<br>\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t * 拼接Hql的p5段 -- 房源类型过滤</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> param</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> user</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> sb</span><br><span class=\"hljs-comment\">\t */</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">jointHqlTheP6</span><span class=\"hljs-params\">(ShopSearchParam param, User user, StringBuilder sb)</span></span>&#123;<br>\t\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t\t * SELECT</span><br><span class=\"hljs-comment\">\t\t\t\tp6.projectId</span><br><span class=\"hljs-comment\">\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t(</span><br><span class=\"hljs-comment\">\t\t\t\t\t&#123;p5&#125;//拼接p5段</span><br><span class=\"hljs-comment\">\t\t\t\t) p6</span><br><span class=\"hljs-comment\">\t\t\tINNER JOIN (</span><br><span class=\"hljs-comment\">\t\t\t\tSELECT</span><br><span class=\"hljs-comment\">\t\t\t\t\tapplyForPerson</span><br><span class=\"hljs-comment\">\t\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t\tt_applychart</span><br><span class=\"hljs-comment\">\t\t\t\tWHERE</span><br><span class=\"hljs-comment\">\t\t\t\t\tapplyByPerson = '860635'</span><br><span class=\"hljs-comment\">\t\t\t\tAND applyStatus = 2</span><br><span class=\"hljs-comment\">\t\t\t) ap ON p6.projectId = ap.applyForPerson</span><br><span class=\"hljs-comment\">\t\t */</span><br>\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" p6.projectId \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" ( \"</span>);<br>\t\t<span class=\"hljs-keyword\">this</span>.jointHqlTheP5(param, user, sb);<br>\t\tsb.append(<span class=\"hljs-string\">\" ) p6 \"</span>);<br>\t\t<br>\t\t<span class=\"hljs-keyword\">if</span>(param.getInviteStatus() != <span class=\"hljs-keyword\">null</span>)&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" INNER JOIN ( \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" applyForPerson \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" t_applychart \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" WHERE \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" applyByPerson = '\"</span> + user.getParentId() + <span class=\"hljs-string\">\"' \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND applyStatus = \"</span> + param.getInviteStatus());<br>\t\t\tsb.append(<span class=\"hljs-string\">\" ) ap ON p6.projectId = ap.applyForPerson \"</span>);<br>\t\t\t<br>\t\t&#125;<br>\t\t<br>\t&#125;<br>\t<br>\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t * 拼接Hql的PP段 -- 查看带看业务定义中的佣金</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> param</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> user</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> sb</span><br><span class=\"hljs-comment\">\t */</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">jointHqlThePP</span><span class=\"hljs-params\">(ShopSearchParam param, User user, StringBuilder sb)</span></span>&#123;<br>\t\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t\t * SELECT</span><br><span class=\"hljs-comment\">\t\t\t\tpp.projectId,</span><br><span class=\"hljs-comment\">\t\t\t\tg.fenxiaoMoney</span><br><span class=\"hljs-comment\">\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t(</span><br><span class=\"hljs-comment\">\t\t\t\t\t&#123;p6&#125;//拼接p6段</span><br><span class=\"hljs-comment\">\t\t\t\t) pp</span><br><span class=\"hljs-comment\">\t\t\tLEFT JOIN t_projectguide g ON pp.projectId = g.projectId</span><br><span class=\"hljs-comment\">\t\t */</span><br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" pp.projectId, \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" g.fenxiaoMoney \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" ( \"</span>);<br>\t\t<br>\t\t<span class=\"hljs-keyword\">this</span>.jointHqlTheP6(param, user, sb);<br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" ) pp \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" LEFT JOIN t_projectguide g ON pp.projectId = g.projectId \"</span>);<br>\t\t<br>\t&#125;<br>\t<br>\t<br>\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t * 拼接Hql的P7段</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> param</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> user</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> sb</span><br><span class=\"hljs-comment\">\t */</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">jointHqlTheP7</span><span class=\"hljs-params\">(ShopSearchParam param, User user, StringBuilder sb)</span></span>&#123;<br>\t\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t\t * SELECT</span><br><span class=\"hljs-comment\">\t\t\t\tp7.projectId,</span><br><span class=\"hljs-comment\">\t\t\t\tp7.fenxiaoMoney</span><br><span class=\"hljs-comment\">\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t(</span><br><span class=\"hljs-comment\">\t\t\t\t\t&#123;pp&#125;//拼接pp段</span><br><span class=\"hljs-comment\">\t\t\t\t) p7</span><br><span class=\"hljs-comment\">\t\t */</span><br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" p7.projectId, \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" p7.fenxiaoMoney \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" ( \"</span>);<br>\t\t<br>\t\t<span class=\"hljs-keyword\">this</span>.jointHqlThePP(param, user, sb);<br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" ) p7 \"</span>);<br>\t&#125;<br>\t<br>\t<br>\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t * 拼接Hql的P8段 -- 项目的合作门店数量</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> param</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> user</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> sb</span><br><span class=\"hljs-comment\">\t */</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">jointHqlTheP8</span><span class=\"hljs-params\">(ShopSearchParam param, User user, StringBuilder sb)</span></span>&#123;<br>\t\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t\t * SELECT</span><br><span class=\"hljs-comment\">\t\t\tp8.projectId,</span><br><span class=\"hljs-comment\">\t\t\tp8.fenxiaoMoney,</span><br><span class=\"hljs-comment\">\t\t\tcount(ic.inviteByPerson) shopCount</span><br><span class=\"hljs-comment\">\t\tFROM</span><br><span class=\"hljs-comment\">\t\t(</span><br><span class=\"hljs-comment\">\t\t\t&#123;p7&#125; //拼接P7段</span><br><span class=\"hljs-comment\">\t\t) p8</span><br><span class=\"hljs-comment\">\t\t\t</span><br><span class=\"hljs-comment\">\t\tLEFT JOIN t_invitechart ic ON p8.projectId = ic.inviteByPerson</span><br><span class=\"hljs-comment\">\t\tGROUP BY</span><br><span class=\"hljs-comment\">\t\t\tp8.projectId</span><br><span class=\"hljs-comment\">\t\t */</span><br>\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" p8.projectId, \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" p8.fenxiaoMoney, \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" count(ic.inviteByPerson) shopCount \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" ( \"</span>);<br>\t\t<br>\t\t<span class=\"hljs-keyword\">this</span>.jointHqlTheP7(param, user, sb);<br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" ) p8 \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" LEFT JOIN (SELECT inviteByPerson FROM t_invitechart WHERE inviteStatus = 2) ic ON p8.projectId = ic.inviteByPerson \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" GROUP BY p8.projectId \"</span>);<br>\t&#125;<br>\t<br>\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t * 拼接Hql的P9段 -- 个人是否收藏</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> param</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> user</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> sb</span><br><span class=\"hljs-comment\">\t */</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">jointHqlTheP9</span><span class=\"hljs-params\">(ShopSearchParam param, User user, StringBuilder sb, Page page)</span></span>&#123;<br>\t\t<br>\t\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t\t * SELECT</span><br><span class=\"hljs-comment\">\t\t \t*</span><br><span class=\"hljs-comment\">\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t(</span><br><span class=\"hljs-comment\">\t\t\t\t\t&#123;p8&#125;//拼接p8段</span><br><span class=\"hljs-comment\">\t\t\t\t) p9</span><br><span class=\"hljs-comment\">\t\t\tLEFT JOIN (</span><br><span class=\"hljs-comment\">\t\t\t\tSELECT</span><br><span class=\"hljs-comment\">\t\t\t\t\tbeCollectId</span><br><span class=\"hljs-comment\">\t\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t\tt_newcollectrecord</span><br><span class=\"hljs-comment\">\t\t\t\tWHERE</span><br><span class=\"hljs-comment\">\t\t\t\t\tuserId = '4e0b0089-410a-497e-8056-6190e2a183d4'</span><br><span class=\"hljs-comment\">\t\t\t) nc ON p9.projectId = nc.beCollectId</span><br><span class=\"hljs-comment\">\t\t\tGROUP BY</span><br><span class=\"hljs-comment\">\t\t\t\tp9.projectId</span><br><span class=\"hljs-comment\">\t\t\tORDER BY</span><br><span class=\"hljs-comment\">\t\t\t\tshopCount DESC</span><br><span class=\"hljs-comment\">\t\t\tLIMIT 0,</span><br><span class=\"hljs-comment\">\t\t\t 10</span><br><span class=\"hljs-comment\">\t\t */</span><br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" p9.projectId, p9.fenxiaoMoney, p9.shopCount \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" ( \"</span>);<br>\t\t<br>\t\t<span class=\"hljs-keyword\">this</span>.jointHqlTheP8(param, user, sb);<br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" ) p9 \"</span>);<br>\t\t<span class=\"hljs-keyword\">if</span>(param.getIsClikeLike() != <span class=\"hljs-keyword\">null</span>)&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" LEFT JOIN ( \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" beCollectId \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" t_newcollectrecord \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" WHERE \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" userId = '\"</span> + user.getUserId() + <span class=\"hljs-string\">\"' \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" ) nc ON p9.projectId \"</span>);<br>\t\t\t<span class=\"hljs-keyword\">if</span>(param.getIsClikeLike() == <span class=\"hljs-number\">1</span>)&#123;<span class=\"hljs-comment\">//收藏</span><br>\t\t\t\tsb.append(<span class=\"hljs-string\">\" = \"</span>);<br>\t\t\t&#125;<span class=\"hljs-keyword\">else</span>&#123;<span class=\"hljs-comment\">//未收藏</span><br>\t\t\t\tsb.append(<span class=\"hljs-string\">\" != \"</span>);<br>\t\t\t&#125;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" nc.beCollectId \"</span>);<br>\t\t\t<br>\t\t\tsb.append(<span class=\"hljs-string\">\" GROUP BY \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" p9.projectId \"</span>);<br>\t\t<br>\t\t&#125;<br>\t\t<br>\t\t<span class=\"hljs-keyword\">if</span>(!isEmpty(param.getOrderType()) &amp;&amp; param.getOrder() != <span class=\"hljs-keyword\">null</span>)&#123;<br>\t\t\t<br>\t\t\tsb.append(<span class=\"hljs-string\">\" ORDER BY \"</span>);<br>\t\t\t<span class=\"hljs-keyword\">if</span>(param.getOrderType().equals(ShopSearchConstant.ORDER_TYPE_SHOP_COUNT))&#123;<span class=\"hljs-comment\">//合作门店数量</span><br>\t\t\t\tsb.append(<span class=\"hljs-string\">\" p9.shopCount \"</span>);<br>\t\t\t&#125;<span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(param.getOrderType().equals(ShopSearchConstant.ORDER_TYPE_MONEY))&#123;<span class=\"hljs-comment\">//及时结款率  -  暂无</span><br>\t\t\t\tsb.append(<span class=\"hljs-string\">\" p9.shopCount \"</span>);<span class=\"hljs-comment\">//暂无，暂时用这个替代</span><br>\t\t\t&#125;<span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(param.getOrderType().equals(ShopSearchConstant.ORDER_TYPE_COMMISSION))&#123;<span class=\"hljs-comment\">//佣金高低</span><br>\t\t\t\tsb.append(<span class=\"hljs-string\">\" p9.fenxiaoMoney \"</span>);<br>\t\t\t&#125;<br>\t\t\tsb.append(param.getOrderType());<br>\t\t\t<span class=\"hljs-keyword\">if</span>(param.getOrder() == <span class=\"hljs-number\">0</span>)&#123;<br>\t\t\t\tsb.append(<span class=\"hljs-string\">\" DESC \"</span>);<br>\t\t\t&#125;<span class=\"hljs-keyword\">else</span>&#123;<br>\t\t\t\tsb.append(<span class=\"hljs-string\">\" ASC \"</span>);<br>\t\t\t&#125;<br>\t\t&#125;<br>\t\t<br>\t\t<span class=\"hljs-keyword\">if</span>(page != <span class=\"hljs-keyword\">null</span>)&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" LIMIT \"</span> + page.getStart() + <span class=\"hljs-string\">\",\"</span> + page.getLimit());<br>\t\t&#125;<br>\t\t<br>\t\t <br>\t&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"Service-层\"><a href=\"#Service-层\" class=\"headerlink\" title=\"Service 层\"></a>Service 层</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//这个方法是将反射之后得到的字段类型和字段名称进行拆分</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">invokeDtoToFieldsToArray</span><span class=\"hljs-params\">(Field[] fields, String[] colums, String[] types)</span></span>&#123;<br>\t\t<span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; fields.length; i++) &#123;<br>\t\t\ttypes[i] = fields[i].getType().toString().replace(<span class=\"hljs-string\">\"class java.lang.\"</span>, <span class=\"hljs-string\">\"\"</span>);<br>\t\t\tcolums[i] = fields[i].getName();<br>\t\t&#125;<br>\t&#125;<br></code></pre></td></tr></table></figure>\n\n\n<p><strong>下面的方法就是整个Service中的核心方法了，将自定义sql交给hibernate进行处理，并且使用自定义的dto对象进行封装</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//这个方法就是将sql进行查询</span><br><span class=\"hljs-meta\">@Override</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">findProjectListByShopSearchParam</span><span class=\"hljs-params\">(ShopSearchParam shopSearchParam, Page page, User user)</span> </span>&#123;<br>\t\tStringBuilder sb = <span class=\"hljs-keyword\">new</span> StringBuilder();<br>\t\t<br>\t\t<span class=\"hljs-comment\">// 利用反射获取Project组装类的所有的字段和类型</span><br>\t\tField[] fields = ProjectMapListDTO<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>.<span class=\"hljs-title\">getDeclaredFields</span>()</span>;<br>\t\tString[] colums = <span class=\"hljs-keyword\">new</span> String[fields.length];<br>\t\tString[] types = <span class=\"hljs-keyword\">new</span> String[fields.length];<br>\t\t<span class=\"hljs-keyword\">this</span>.invokeDtoToFieldsToArray(fields, colums, types);<br>\t\t<span class=\"hljs-keyword\">this</span>.jointHqlTheP9(shopSearchParam, user, sb, page);<br>\t\t<span class=\"hljs-comment\">//返回的结果</span><br>\t\tList&lt;ProjectMapTotalDTO&gt; rsList = <span class=\"hljs-keyword\">new</span> LinkedList&lt;&gt;();<br>\t\t<span class=\"hljs-comment\">//当前用户所有收藏的项目</span><br>\t\tList&lt;NewCollectRecord&gt; collList =  <span class=\"hljs-keyword\">this</span>.findNewCollectRecordByUserId(user.getUserId(), ShopSearchConstant.COLLECT_TYPE_PROJECT,<span class=\"hljs-keyword\">null</span>);<br>\t\t<span class=\"hljs-comment\">//当前门店所有的申请</span><br>\t\tList&lt;ApplyChart&gt; appList = <span class=\"hljs-keyword\">this</span>.findApplyChartsByShopId(user.getParentId(), <span class=\"hljs-keyword\">null</span>);<br>\t\t<span class=\"hljs-comment\">//---------重要---------这个就是关键方法</span><br>\t\tList&lt;ProjectMapListDTO&gt; list = baseDao.queryDTOBySql(sb.toString(), ProjectMapListDTO<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>, <span class=\"hljs-title\">colums</span>, <span class=\"hljs-title\">types</span>)</span>;<br>\t\t<br>\t\t<span class=\"hljs-comment\">//这里是工作需要，将查询出来的结果进行再次封装--看需要吧</span><br>\t\t<span class=\"hljs-comment\">//需要进行判断是否收藏和申请状态的判断</span><br>\t\t<span class=\"hljs-keyword\">for</span> (ProjectMapListDTO pd : list) &#123;<br>\t\t\t<br>\t\t\tProjectMapTotalDTO ptd = <span class=\"hljs-keyword\">new</span> ProjectMapTotalDTO();<br>\t\t\tProject project = (Project) baseDao.loadById(Project<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>, <span class=\"hljs-title\">pd</span>.<span class=\"hljs-title\">getProjectId</span>())</span>;<br>\t\t\tptd.setProject(project);<br>\t\t\tptd.setFenxiaoMoney(pd.getFenxiaoMoney());<br>\t\t\tptd.setShopCount(pd.getShopCount());<br>\t\t\t<span class=\"hljs-comment\">//判断是否已经被收藏</span><br>\t\t\t<span class=\"hljs-keyword\">boolean</span> flag = <span class=\"hljs-keyword\">false</span>;<br>\t\t\t<span class=\"hljs-keyword\">for</span>(NewCollectRecord nr : collList)&#123;<br>\t\t\t\t<span class=\"hljs-keyword\">if</span>(nr.getBeCollectId().equals(pd.getProjectId()))&#123;<br>\t\t\t\t\tflag = <span class=\"hljs-keyword\">true</span>;<br>\t\t\t\t&#125;<br>\t\t\t&#125;<br>\t\t\t<br>\t\t\t<span class=\"hljs-comment\">//查看合作关系</span><br>\t\t\t<span class=\"hljs-keyword\">for</span>(ApplyChart ac : appList)&#123;<br>\t\t\t\t<span class=\"hljs-keyword\">if</span>(pd.getProjectId().equals(ac.getApplyForPerson()))&#123;<br>\t\t\t\t\tptd.setApplyStatus(ac.getApplyStatus());<br>\t\t\t\t&#125;<br>\t\t\t&#125;<br>\t\t\t<br>\t\t\tptd.setIsLike(flag ? <span class=\"hljs-number\">1</span> : <span class=\"hljs-number\">0</span>);<br>\t\t\trsList.add(ptd);<br>\t\t&#125;<br>\t\tpage.setRoot(rsList);<br><br>\t\tList&lt;ProjectMapTotalDTO&gt; lz = <span class=\"hljs-keyword\">this</span>.findProjectListForMapNew(shopSearchParam, user);<br>\t\tpage.setTotal(lz.size());<br>\t\t<br>\t&#125;<br></code></pre></td></tr></table></figure>\n\n<p>看看DTO对象</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.sc.tradmaster.service.shop.impl.dto;<br><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ProjectMapListDTO</span> </span>&#123;<br><br>\t<span class=\"hljs-keyword\">private</span> String projectId;<br>\t<span class=\"hljs-keyword\">private</span> Double fenxiaoMoney;<br>\t<span class=\"hljs-keyword\">private</span> Integer shopCount;<br>\t<br>\t<span class=\"hljs-comment\">//省略set和get方法</span><br>\t<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h4 id=\"DAO核心方法\"><a href=\"#DAO核心方法\" class=\"headerlink\" title=\"DAO核心方法\"></a>DAO核心方法</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">BaseDaoImpl</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">HibernateDaoSupport</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">BaseDao</span></span>&#123;<br><br>\t<span class=\"hljs-meta\">@Resource</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">mySessionFactory</span><span class=\"hljs-params\">(SessionFactory sf)</span></span>&#123;<br>\t\t<span class=\"hljs-keyword\">super</span>.setSessionFactory(sf);<br>\t&#125;<br>\t<br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t * 执行sql组装DTO对象集合</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> sql</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> clazz</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@return</span></span><br><span class=\"hljs-comment\">\t */</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> List <span class=\"hljs-title\">queryDTOBySql</span><span class=\"hljs-params\">(String sql,Class clazz,String[] colums,String[] types)</span> </span>&#123;    <br>\t\tSession session = <span class=\"hljs-keyword\">super</span>.getSessionFactory().getCurrentSession();<br>\t\tSQLQuery query = session.createSQLQuery(sql);<br>\t\t<span class=\"hljs-keyword\">if</span>(colums!=<span class=\"hljs-keyword\">null</span> &amp;&amp; types!=<span class=\"hljs-keyword\">null</span> &amp;&amp; colums.length==types.length)&#123;<br>\t\t\t<span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i=<span class=\"hljs-number\">0</span>;i&lt;colums.length;i++)&#123;<br>\t\t\t\t<span class=\"hljs-keyword\">if</span>(types[i].equals(<span class=\"hljs-string\">\"Integer\"</span>))&#123;<br>\t\t\t\t\tquery.addScalar(colums[i],StandardBasicTypes.INTEGER);<br>\t\t\t\t&#125;<span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(types[i].equals(<span class=\"hljs-string\">\"String\"</span>))&#123;<br>\t\t\t\t\tquery.addScalar(colums[i],StandardBasicTypes.STRING);<br>\t\t\t\t&#125;<span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(types[i].equals(<span class=\"hljs-string\">\"Double\"</span>))&#123;<br>\t\t\t\t\tquery.addScalar(colums[i],StandardBasicTypes.DOUBLE);<br>\t\t\t\t&#125;<span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(types[i].equals(<span class=\"hljs-string\">\"Long\"</span>))&#123;<br>\t\t\t\t\tquery.addScalar(colums[i],StandardBasicTypes.LONG);<br>\t\t\t\t&#125;<br>\t\t\t\t<br>\t\t\t&#125;<br>\t\t&#125;<br>\t\tList&lt;Object[]&gt; list = query.setResultTransformer(Transformers.aliasToBean(clazz)).list();<br>        <span class=\"hljs-keyword\">return</span> list;<br>    &#125;<br>   &#125;<br></code></pre></td></tr></table></figure>\n\n<blockquote>\n<p>结语：由于是在工作中用到的代码段，所以显得有些复杂化了，以后有时间的话，使用通俗易懂的方法讲解出来，先留个坑，如果大家遇到这种使用场景无法解决的话，欢迎打扰：<a href=\"mailto:1085143002@qq.com\">1085143002@qq.com</a></p>\n</blockquote>\n","raw":null,"categories":[{"name":"Hibernate","path":"api/categories/Hibernate.json"}],"tags":[{"name":"Hibernate","path":"api/tags/Hibernate.json"}]}]}