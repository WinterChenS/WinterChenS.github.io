{"name":"github","postlist":[{"title":"如何使用 GitHub Actions 实现 Hexo 博客的 CICD","slug":"2020-06-13-hexo-deploy-from-github-ci-cd","date":"2020-06-13T14:27:00.000Z","updated":"2022-12-01T01:32:39.783Z","comments":true,"top":null,"path":"api/articles/2020-06-13-hexo-deploy-from-github-ci-cd.json","excerpt":null,"keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046720015079.jpg","content":"<h2 id=\"仓库准备\"><a href=\"#仓库准备\" class=\"headerlink\" title=\"仓库准备\"></a>仓库准备</h2><table>\n<thead>\n<tr>\n<th>项目仓库</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><a href=\"https://github.com/WinterChenS/blog-back\" target=\"_blank\" rel=\"noopener\">https://github.com/WinterChenS/blog-back</a></td>\n<td>用于存放 hexo 生成的项目，可以理解成源码</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/WinterChenS/WinterChenS.github.io\" target=\"_blank\" rel=\"noopener\">https://github.com/WinterChenS/WinterChenS.github.io</a></td>\n<td>存放 hexo 编译后的静态文件，也是博客页面</td>\n</tr>\n</tbody></table>\n<h2 id=\"秘钥生成\"><a href=\"#秘钥生成\" class=\"headerlink\" title=\"秘钥生成\"></a>秘钥生成</h2><p>Hexo编译之后需要把生成的静态页面代码push到github pages的仓库，也就是 <code>WinterChenS/WinterChenS.github.io</code> ，没有秘钥就没有权限push。</p>\n<blockquote>\n<p>随便找一台电脑或者服务器，生成秘钥：</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">ssh-keygen -f github-deploy-key # 三次回车即可<br></code></pre></td></tr></table></figure>\n\n<p>以上步骤会生成<code>github-deploy-key</code> 和 <code>github-deploy-key.pub</code> 两个文件。</p>\n<h2 id=\"配置github仓库\"><a href=\"#配置github仓库\" class=\"headerlink\" title=\"配置github仓库\"></a>配置github仓库</h2><h3 id=\"配置blog-back仓库\"><a href=\"#配置blog-back仓库\" class=\"headerlink\" title=\"配置blog-back仓库\"></a>配置blog-back仓库</h3><p>打开 <code>https://github.com/WinterChenS/blog-back/settings/secrets</code> 点击 <code>Add new secrets</code>，分别在:</p>\n<ul>\n<li>Name 输入 <code>HEXO_DEPLOY_KEY</code></li>\n<li>Value 输入前面生成的私有KEY <code>github-deploy-key</code> 的内容</li>\n</ul>\n<h3 id=\"配置WinterChenS-github-io仓库\"><a href=\"#配置WinterChenS-github-io仓库\" class=\"headerlink\" title=\"配置WinterChenS.github.io仓库\"></a>配置WinterChenS.github.io仓库</h3><p>打开 <a href=\"https://github.com/WinterChenS/WinterChenS.github.io/settings/Deploy\" target=\"_blank\" rel=\"noopener\">https://github.com/WinterChenS/WinterChenS.github.io/settings/Deploy</a> keys，点击 Add deploy key，分别在:</p>\n<ul>\n<li>Title 输入 <code>HEXO_DEPLOY_KEY</code></li>\n<li>Key 输入前面生成的公KEY <code>github-deploy-key.pub</code> 的内容名称随意，但要勾选 Allow write access</li>\n</ul>\n<h2 id=\"编写-Action-脚本\"><a href=\"#编写-Action-脚本\" class=\"headerlink\" title=\"编写 Action 脚本\"></a>编写 Action 脚本</h2><p>使用前先要申请，直接打开<code>https://github.com/WinterChenS/WinterChenS.github.io/actions/new</code></p>\n<p>main.yml</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">name: Deploy Blog<br><br>on: [push] # 当有新push时运行<br><br>env:<br>  TZ: Asia&#x2F;Shanghai<br><br>jobs:<br>  build: # 一项叫做build的任务<br><br>    runs-on: ubuntu-latest # 在最新版的Ubuntu系统下运行<br>    <br>    steps:<br>    - name: Checkout # 将仓库内master分支的内容下载到工作目录<br>      uses: actions&#x2F;checkout@v1 # 脚本来自 https:&#x2F;&#x2F;github.com&#x2F;actions&#x2F;checkout<br>      <br>    - name: Use Node.js 10.x # 配置Node环境<br>      uses: actions&#x2F;setup-node@v1 # 配置脚本来自 https:&#x2F;&#x2F;github.com&#x2F;actions&#x2F;setup-node<br>      with:<br>        node-version: &quot;10.x&quot;<br>    <br>    - name: Setup Hexo env<br>      env:<br>        ACTION_DEPLOY_KEY: $&#123;&#123; secrets.HEXO_DEPLOY_KEY &#125;&#125; # 这里是上面WinterChenS.github.io新增的公钥：HEXO_DEPLOY_KEY<br>      run: |<br>        # set up private key for deploy<br>        mkdir -p ~&#x2F;.ssh&#x2F;<br>        echo &quot;$ACTION_DEPLOY_KEY&quot; | tr -d &#39;\\r&#39; &gt; ~&#x2F;.ssh&#x2F;id_rsa # 配置秘钥<br>        chmod 600 ~&#x2F;.ssh&#x2F;id_rsa<br>        ssh-keyscan github.com &gt;&gt; ~&#x2F;.ssh&#x2F;known_hosts<br>        # set git infomation<br>        git config --global user.name &#39;winterchens&#39; # 换成你自己的邮箱和名字<br>        git config --global user.email &#39;1085143002@qq.com&#39;<br>        # install dependencies<br>        npm i -g hexo-cli # 安装hexo<br>        npm i<br>        # 拉取主题代码<br>        rm -rf themes&#x2F;*<br>        git clone https:&#x2F;&#x2F;github.com&#x2F;WinterChenS&#x2F;hexo-theme-diaspora.git themes&#x2F;diaspora<br>        <br>  <br>    - name: Deploy<br>      run: |<br>        # publish<br>        hexo generate &amp;&amp; hexo deploy # 执行部署程序<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"修改blog-back根目录的-config-yml\"><a href=\"#修改blog-back根目录的-config-yml\" class=\"headerlink\" title=\"修改blog-back根目录的_config.yml\"></a>修改blog-back根目录的_config.yml</h2><p>如果你使用的是http，那么需要修改为ssh，已经是ssh就无须修改</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">deploy:<br>  type: git<br>  repo: git@github.com:WinterChenS&#x2F;WinterChenS.github.io.git<br>  branch: master<br></code></pre></td></tr></table></figure>\n\n<p>以后只需要把代码提交到blog-back就可以自动进行编译发布了，是不是很爽</p>\n","raw":null,"categories":[{"name":"github-actions","path":"api/categories/github-actions.json"}],"tags":[{"name":"hexo","path":"api/tags/hexo.json"},{"name":"github","path":"api/tags/github.json"},{"name":"github-actions","path":"api/tags/github-actions.json"}]}]}