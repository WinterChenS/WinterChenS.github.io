{"total":66,"pageSize":10,"pageCount":7,"data":[{"title":"spring中添加自定义的拦截器","slug":"my-spring-interceptor","date":"2018-05-09T08:48:00.000Z","updated":"2022-12-01T01:32:39.787Z","comments":true,"top":null,"path":"api/articles/my-spring-interceptor.json","excerpt":" [Figure] 要想实现自定义的拦截器，我们不得不讲讲spring中的处理程序拦截器，那么什么是处理程序拦截器呢？","keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://images.unsplash.com/photo-1522199794616-8a62b541f762?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=71b5877630deb9ab5996f91cc61b43f7&auto=format&fit=crop&w=2104&q=80","content":"<p><img   class=\"lazyload\" data-original=\"https://images.unsplash.com/photo-1522199794616-8a62b541f762?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=71b5877630deb9ab5996f91cc61b43f7&auto=format&fit=crop&w=2104&q=80\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p>要想实现自定义的拦截器，我们不得不讲讲spring中的处理程序拦截器，那么什么是处理程序拦截器呢？</p>\n<a id=\"more\"></a>\n\n<h2 id=\"什么是spring中的处理程序拦截器？\"><a href=\"#什么是spring中的处理程序拦截器？\" class=\"headerlink\" title=\"什么是spring中的处理程序拦截器？\"></a>什么是spring中的处理程序拦截器？</h2><p>要想了解拦截器在spring中的作用，我们首先要了解一下HTTP的请求执行链。</p>\n<ol>\n<li><p>DispatcherServlet捕获每一个请求；</p>\n</li>\n<li><p>DispatcherServlet将接收到的URL和相应的Controller进行映射；</p>\n</li>\n<li><p>在请求到达相应的Controller之前<strong>拦截器</strong>会进行请求处理；</p>\n</li>\n<li><p>处理完成之后进行视图的解析；</p>\n</li>\n<li><p>返回视图。</p>\n</li>\n</ol>\n<p>在第3步中，也就是今天最重要的内容，在请求到达Controller之前，请求可以被拦截器处理，这些拦截器就像过滤器。只有当URL找到对应于它们的处理器时才会调用它们。在通过拦截器(拦截器预处理，其实也可以说前置处理)进行前置处理后，请求最终到达controller。之后，发送请求生成视图。但是在这之前，拦截器还是有可能来再次处理它(拦截器后置处理)。只有在最后一次操作之后，视图解析器才能捕获数据并输出视图。</p>\n<p>处理程序映射拦截器基于<code>org.springframework.web.servlet.HandlerInterceptor</code>接口。这个接口有三个方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">HandlerInterceptor</span> </span>&#123;<br><br>  <span class=\"hljs-comment\">//请求发送到Controller之前调用</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">preHandle</span><span class=\"hljs-params\">(HttpServletRequest request, HttpServletResponse response, Object handler)</span></span><br><span class=\"hljs-function\">            <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">true</span>;<br>    &#125;<br><br>    <span class=\"hljs-comment\">//请求发送到Controller之后调用</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">postHandle</span><span class=\"hljs-params\">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">            @Nullable ModelAndView modelAndView)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>    &#125;<br><br>    <span class=\"hljs-comment\">//完成请求的处理的回调方法</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">default</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">afterCompletion</span><span class=\"hljs-params\">(HttpServletRequest request, HttpServletResponse response, Object handler,</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">            @Nullable Exception ex)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"编写自定义的拦截器\"><a href=\"#编写自定义的拦截器\" class=\"headerlink\" title=\"编写自定义的拦截器\"></a>编写自定义的拦截器</h2><p>要想编写自定义的拦截器，需要有两个步骤：</p>\n<ul>\n<li><p>实现<code>HandlerInterceptor</code>接口和方法；</p>\n</li>\n<li><p>将自定义拦截器添加到MVC中。</p>\n</li>\n</ul>\n<p>下面我们来实现一下代码：</p>\n<h3 id=\"首先我们创建一个类BaseInterceptor\"><a href=\"#首先我们创建一个类BaseInterceptor\" class=\"headerlink\" title=\"首先我们创建一个类BaseInterceptor\"></a>首先我们创建一个类<code>BaseInterceptor</code></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 实现HandlerInterceptor接口，自定义拦截器</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">BaseInterceptor</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">HandlerInterceptor</span> </span>&#123;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> Logger LOGGE = LoggerFactory.getLogger(BaseInterceptor<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br><br>      <span class=\"hljs-comment\">//实现前置方法</span><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">preHandle</span><span class=\"hljs-params\">(HttpServletRequest request, HttpServletResponse response, Object o)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>        String uri = request.getRequestURI();<br><br>        LOGGE.info(<span class=\"hljs-string\">\"UserAgent: &#123;&#125;\"</span>, request.getHeader(USER_AGENT));<br>        LOGGE.info(<span class=\"hljs-string\">\"用户访问地址: &#123;&#125;, 来路地址: &#123;&#125;\"</span>, uri, IPKit.getIpAddrByRequest(request));<br><br><br>      <span class=\"hljs-comment\">//拦截器处理用户权限</span><br>        <span class=\"hljs-keyword\">if</span> (uri.startsWith(<span class=\"hljs-string\">\"/admin\"</span>) &amp;&amp; !uri.startsWith(<span class=\"hljs-string\">\"/admin/login\"</span>)) &#123;<br>            response.sendRedirect(request.getContextPath() + <span class=\"hljs-string\">\"/admin/login\"</span>);<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>        &#125;<br><br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">true</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">postHandle</span><span class=\"hljs-params\">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, ModelAndView modelAndView)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>        <span class=\"hljs-comment\">//这个方法可以往request中添加一些公共的工具类给前端页面进行调用</span><br><br>    &#125;<br><br><br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">afterCompletion</span><span class=\"hljs-params\">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Object o, Exception e)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>        <span class=\"hljs-comment\">//当请求处理完成调用</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>以上的自定义拦截器实现类中，我们实现了<code>HandlerInterceptor</code>接口，并且实现了三个方法：<code>preHandle</code>、<code>postHandle</code>、<code>afterCompletion</code>。</p>\n<p>在实际的应用中呢，我们常常可以在请求处理的前置方法<code>preHandle</code>中进行权限的验证，<code>postHandle</code>后置方法在实际的使用当中可以往request中添加一些公共的工具类给前端页面进行调用。</p>\n<h3 id=\"创建一个类WebMvcConfig实现WebMvcConfigurer接口\"><a href=\"#创建一个类WebMvcConfig实现WebMvcConfigurer接口\" class=\"headerlink\" title=\"创建一个类WebMvcConfig实现WebMvcConfigurer接口\"></a>创建一个类<code>WebMvcConfig</code>实现<code>WebMvcConfigurer</code>接口</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 向MVC中添加自定义组件</span><br><span class=\"hljs-comment\"> * Created by Donghua.Chen on 2018/4/30.</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">WebMvcConfig</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">WebMvcConfigurer</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> BaseInterceptor baseInterceptor;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">addInterceptors</span><span class=\"hljs-params\">(InterceptorRegistry registry)</span> </span>&#123;<br>        registry.addInterceptor(baseInterceptor);<br>    &#125;<br><br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>这个类的主要作用就是将我们刚才自定义的拦截器组件添加到MVC中去。</p>\n<p>以上我们就完成了自定义拦截器的全部过程，是不是很简单呢？</p>\n","raw":null,"categories":[{"name":"spring","path":"api/categories/spring.json"}],"tags":[{"name":"spring","path":"api/tags/spring.json"}]},{"title":"关于《三体》的一些读后感-农场主和射手","slug":"about-tree-body-1","date":"2018-04-22T16:00:00.000Z","updated":"2022-12-01T01:32:39.787Z","comments":true,"top":null,"path":"api/articles/about-tree-body-1.json","excerpt":" [Figure] 地铁上发现一件非常巧合的事情，正好读到《三体》中的一个情节，汪淼去杨冬的丈夫丁仪家，两个正在打台球验证科学理论，地铁的显示屏上同时也播放着打台球的画面。","keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046765042654.jpg","content":"<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046765113656.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p>地铁上发现一件非常巧合的事情，正好读到《三体》中的一个情节，汪淼去杨冬的丈夫丁仪家，两个正在打台球验证科学理论，地铁的显示屏上同时也播放着打台球的画面。</p>\n<a id=\"more\"></a>\n<p>这一章正好读到农场主和射手，两个故事都讲的令人细思极恐，农场主讲述的是，一个农场主每天准时十二点都会给火鸡喂食，假设火鸡中有一位火鸡科学家，它就发现了一个理论，<br>每天十二点上帝都会准时发放食物，于是它们每天十二点都会准时等待食物，到了复活节这一天，食物并没有如期而至，农场主把它们都杀了。<br>第二个故事射手讲的是一个射手在一个平面上每隔10厘米就会打个洞，假如平面上生活着一个二维智能生物，那么它得出了一个理论，宇宙每隔十厘米就会出现一个洞。<br>这两个故事告诉，我们我们以为的规律/理论，可能并不存在，所以，物理科学并不存在，确实挺可怕的。</p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046765183636.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p> 杨东生前进行过多次的离子对撞的实验，发现每次的结果都不一样，台球就好比放大版的离子对撞实验，谁也不知道台球会不会在对撞的之后飞向宇宙。<br>杨东发现了这个事实，其实物理是不存在的，从微观世界看，这个现实世界非常的混乱，物理学就像农场主和射手的故事一样，所以杨东选择了自杀。</p>\n<p> 然而，真相却是三体人发射了两个智子到地球，智子能够锁住地球的科技，经过二维展开改造后的智能微观粒子，可以进行通讯、侦查、干扰粒子高能加速器等任务，所以，杨东的粒子加速碰撞试验是智子搞的鬼，物理并不存在的学说是不对的。</p>\n","raw":null,"categories":[{"name":"随笔","path":"api/categories/随笔.json"}],"tags":[{"name":"随笔","path":"api/tags/随笔.json"},{"name":"三体","path":"api/tags/三体.json"}]},{"title":"springboot2.0 Mybatis 整合 (springboot2.0版本)","slug":"springboot2-mybatis","date":"2018-04-20T16:57:00.000Z","updated":"2022-12-01T01:32:39.787Z","comments":true,"top":null,"path":"api/articles/springboot2-mybatis.json","excerpt":" [Figure] springboot终于迎来了2.0版本，很多新的特性让springboot更加强大，之前使用1.5.6版本整合了Mybatis，现在2.0版本就已经不适用了，所以，在摸索中搭建了2.0版本整合Mybatis","keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046782543036.jpg","content":"<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046782791380.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<blockquote>\n<p>springboot终于迎来了2.0版本，很多新的特性让springboot更加强大，之前<a href=\"https://blog.csdn.net/winter_chen001/article/details/77249029\" target=\"_blank\" rel=\"noopener\">使用1.5.6版本整合了Mybatis</a>，现在2.0版本就已经不适用了，所以，在摸索中搭建了2.0版本整合Mybatis</p>\n</blockquote>\n<a id=\"more\"></a>\n\n<h2 id=\"写在前面\"><a href=\"#写在前面\" class=\"headerlink\" title=\"写在前面\"></a>写在前面</h2><p>本来这篇博文老在就写好了，但是后来发现很多功能其实根本就没有检验通过就发出来了，导致遗留了很多坑，比如最难搞的就是SqlSessionFactory和PageHelper，之前写过关于springboot1.5.6版本的整合，这段时间刚好springboot发布了2.0的正式版本，很多同学可能没有注意版本，导致了整合的时候出现了很多很多的问题，这几天刚好有空就试着整合一下springboot2.0 mybatis，发现了很多很多的坑，而且网上的资源也不多，终于在两天的踩坑中成功整合了，并且将翻页功能修复好了，废话不多说了，看代码：</p>\n<h2 id=\"环境-版本一览：\"><a href=\"#环境-版本一览：\" class=\"headerlink\" title=\"环境/版本一览：\"></a>环境/版本一览：</h2><ul>\n<li>开发工具：Intellij IDEA 2017.1.3</li>\n<li>springboot: <strong>2.0.1.RELEASE</strong></li>\n<li>jdk：1.8.0_40</li>\n<li>maven:3.3.9</li>\n<li>alibaba Druid 数据库连接池：1.1.0</li>\n</ul>\n<h3 id=\"额外功能：\"><a href=\"#额外功能：\" class=\"headerlink\" title=\"额外功能：\"></a>额外功能：</h3><ul>\n<li>PageHelper 分页插件</li>\n<li>mybatis generator 自动生成代码插件（本次搭建就不讲解了，请参照<a href=\"https://blog.csdn.net/winter_chen001/article/details/77249029\" target=\"_blank\" rel=\"noopener\">Spring boot Mybatis 整合（完整版）</a>）</li>\n</ul>\n<h2 id=\"开始搭建：\"><a href=\"#开始搭建：\" class=\"headerlink\" title=\"开始搭建：\"></a>开始搭建：</h2><h3 id=\"创建项目：\"><a href=\"#创建项目：\" class=\"headerlink\" title=\"创建项目：\"></a>创建项目：</h3><p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046466648928.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046466698922.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p>添加基础的依赖：<br><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046466739962.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<h3 id=\"依赖文件：\"><a href=\"#依赖文件：\" class=\"headerlink\" title=\"依赖文件：\"></a>依赖文件：</h3><p>按照pom文件补齐需要的依赖：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">project</span> <span class=\"hljs-attr\">xmlns</span>=<span class=\"hljs-string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"hljs-attr\">xmlns:xsi</span>=<span class=\"hljs-string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span><br><span class=\"hljs-tag\">\t<span class=\"hljs-attr\">xsi:schemaLocation</span>=<span class=\"hljs-string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">modelVersion</span>&gt;</span>4.0.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">modelVersion</span>&gt;</span><br><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.winterchen<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>springboot2-mybatis-demo<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">packaging</span>&gt;</span>jar<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">packaging</span>&gt;</span><br><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>springboot2-mybatis-demo<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">description</span>&gt;</span>Demo project for Spring Boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">description</span>&gt;</span><br><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">parent</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>2.0.1.RELEASE<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">relativePath</span>/&gt;</span> <span class=\"hljs-comment\">&lt;!-- lookup parent from repository --&gt;</span><br>\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">parent</span>&gt;</span><br><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">properties</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">project.build.sourceEncoding</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">project.reporting.outputEncoding</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">java.version</span>&gt;</span>1.8<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">java.version</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">properties</span>&gt;</span><br><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependencies</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.mybatis.spring.boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.3.2<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>mysql<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>runtime<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>test<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.commons<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>commons-lang3<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>3.4<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>jackson-core<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>jackson-databind<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.fasterxml.jackson.datatype<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>jackson-datatype-joda<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.fasterxml.jackson.module<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>jackson-module-parameter-names<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t\t<span class=\"hljs-comment\">&lt;!-- 分页插件 --&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.github.pagehelper<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>pagehelper<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>5.1.3<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t\t<span class=\"hljs-comment\">&lt;!-- alibaba的druid数据库连接池 --&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.alibaba<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>druid-spring-boot-starter<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.1.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependencies</span>&gt;</span><br><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">build</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugins</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugin</span>&gt;</span><br>\t\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugin</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugins</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">build</span>&gt;</span><br><br><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">project</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"项目结构：\"><a href=\"#项目结构：\" class=\"headerlink\" title=\"项目结构：\"></a>项目结构：</h3><p><img    class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046466825127.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">项目结构</span></p>\n<h4 id=\"项目启动类：\"><a href=\"#项目启动类：\" class=\"headerlink\" title=\"项目启动类：\"></a>项目启动类：</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen;<br><br><span class=\"hljs-keyword\">import</span> org.springframework.boot.SpringApplication;<br><span class=\"hljs-keyword\">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><br><span class=\"hljs-meta\">@SpringBootApplication</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Springboot2MybatisDemoApplication</span> </span>&#123;<br><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(String[] args)</span> </span>&#123;<br>\t\tSpringApplication.run(Springboot2MybatisDemoApplication<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>, <span class=\"hljs-title\">args</span>)</span>;<br>\t&#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"配置：\"><a href=\"#配置：\" class=\"headerlink\" title=\"配置：\"></a>配置：</h3><blockquote>\n<p>可以根据个人使用习惯选择使用<code>properties</code>或者<code>yml</code>文件，本项目使用的是yml配置文件，所以把原本<code>application.properties</code>删除，创建一个<code>application.yml</code>文件</p>\n</blockquote>\n<p>在resource文件夹下创建<code>application.yml</code></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">server:</span><br>  <span class=\"hljs-attr\">port:</span> <span class=\"hljs-number\">8080</span><br><br><br><span class=\"hljs-attr\">spring:</span><br>    <span class=\"hljs-attr\">datasource:</span><br>        <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">test</span><br>        <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">jdbc:mysql://127.0.0.1:3306/mytest?useUnicode=true&amp;characterEncoding=UTF-8&amp;allowMultiQueries=true</span><br>        <span class=\"hljs-attr\">username:</span> <span class=\"hljs-string\">root</span><br>        <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">root</span><br>        <span class=\"hljs-comment\"># 使用druid数据源</span><br>        <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">com.alibaba.druid.pool.DruidDataSource</span><br>        <span class=\"hljs-attr\">driver-class-name:</span> <span class=\"hljs-string\">com.mysql.jdbc.Driver</span><br>        <span class=\"hljs-attr\">filters:</span> <span class=\"hljs-string\">stat</span><br>        <span class=\"hljs-attr\">maxActive:</span> <span class=\"hljs-number\">20</span><br>        <span class=\"hljs-attr\">initialSize:</span> <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-attr\">maxWait:</span> <span class=\"hljs-number\">60000</span><br>        <span class=\"hljs-attr\">minIdle:</span> <span class=\"hljs-number\">1</span><br>        <span class=\"hljs-attr\">timeBetweenEvictionRunsMillis:</span> <span class=\"hljs-number\">60000</span><br>        <span class=\"hljs-attr\">minEvictableIdleTimeMillis:</span> <span class=\"hljs-number\">300000</span><br>        <span class=\"hljs-attr\">validationQuery:</span> <span class=\"hljs-string\">select</span> <span class=\"hljs-string\">'x'</span><br>        <span class=\"hljs-attr\">testWhileIdle:</span> <span class=\"hljs-literal\">true</span><br>        <span class=\"hljs-attr\">testOnBorrow:</span> <span class=\"hljs-literal\">false</span><br>        <span class=\"hljs-attr\">testOnReturn:</span> <span class=\"hljs-literal\">false</span><br>        <span class=\"hljs-attr\">poolPreparedStatements:</span> <span class=\"hljs-literal\">true</span><br>        <span class=\"hljs-attr\">maxPoolPreparedStatementPerConnectionSize:</span> <span class=\"hljs-number\">20</span><br>        <span class=\"hljs-attr\">maxOpenPreparedStatements:</span> <span class=\"hljs-number\">20</span><br>        <br><span class=\"hljs-attr\">mybatis:</span><br>  <span class=\"hljs-attr\">mapper-locations:</span> <span class=\"hljs-string\">classpath:mapper/*.xml</span><br>  <span class=\"hljs-attr\">type-aliases-package:</span> <span class=\"hljs-string\">com.winterchen.model</span><br><br><span class=\"hljs-attr\">mapper:</span><br>  <span class=\"hljs-attr\">mappers:</span>  <span class=\"hljs-string\">com.winterchen.dao</span><br>  <span class=\"hljs-attr\">not-empty:</span> <span class=\"hljs-literal\">false</span><br>  <span class=\"hljs-attr\">identity:</span> <span class=\"hljs-string\">MYSQL</span><br><br><span class=\"hljs-comment\">#pagehelper</span><br><span class=\"hljs-attr\">pagehelper:</span><br>    <span class=\"hljs-attr\">helperDialect:</span> <span class=\"hljs-string\">mysql</span><br>    <span class=\"hljs-attr\">reasonable:</span> <span class=\"hljs-literal\">true</span><br>    <span class=\"hljs-attr\">supportMethodsArguments:</span> <span class=\"hljs-literal\">true</span><br>    <span class=\"hljs-attr\">params:</span> <span class=\"hljs-string\">count=countSql</span><br>    <span class=\"hljs-attr\">returnPageInfo:</span> <span class=\"hljs-string\">check</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"创建包：\"><a href=\"#创建包：\" class=\"headerlink\" title=\"创建包：\"></a>创建包：</h3><p><code>model</code>，<code>dao</code>，<code>mapper</code>,<code>config</code></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046466881978.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<h3 id=\"新建配置类：\"><a href=\"#新建配置类：\" class=\"headerlink\" title=\"新建配置类：\"></a>新建配置类：</h3><p><code>PageHelperConfig.java</code></p>\n<blockquote>\n<p>以下配置非常的重要，<code>PageHelper</code>的Page拦截器<code>PageInterceptor</code>，如果不进行配置，那么分页功能将没有效果</p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.config;<br><br><span class=\"hljs-keyword\">import</span> com.github.pagehelper.PageInterceptor;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Value;<br><span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.Bean;<br><span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.Configuration;<br><br><span class=\"hljs-keyword\">import</span> java.util.Properties;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 分页插件的配置</span><br><span class=\"hljs-comment\"> * Created by Donghua.Chen on 2018/4/20.</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">PageHelperConfig</span> </span>&#123;<br><br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;pagehelper.helperDialect&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String helperDialect;<br>    <br><br>    <span class=\"hljs-meta\">@Bean</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> PageInterceptor <span class=\"hljs-title\">pageInterceptor</span><span class=\"hljs-params\">()</span></span>&#123;<br>        PageInterceptor pageInterceptor = <span class=\"hljs-keyword\">new</span> PageInterceptor();<br>        Properties properties = <span class=\"hljs-keyword\">new</span> Properties();<br>        properties.setProperty(<span class=\"hljs-string\">\"helperDialect\"</span>, helperDialect);<br>        pageInterceptor.setProperties(properties);<br>        <span class=\"hljs-keyword\">return</span> pageInterceptor;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n<p><code>DataSourceConfig.java</code></p>\n<blockquote>\n<p>在springboot2.0版本，如果不定义<code>SqlSessionFactory</code>，那么将会导致错误，因为无法注入<code>SqlSessionFactory</code>，<strong>并且下面注释部分的内容非常的重要，这也是整合当中遇到的很大的坑，如果不将PageInterceptor作为插件设置到SqlSessionFactoryBean中，导致分页失效</strong></p>\n</blockquote>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.config;<br><br><span class=\"hljs-keyword\">import</span> com.github.pagehelper.PageHelper;<br><span class=\"hljs-keyword\">import</span> com.github.pagehelper.PageInterceptor;<br><span class=\"hljs-keyword\">import</span> org.apache.ibatis.plugin.Interceptor;<br><span class=\"hljs-keyword\">import</span> org.apache.ibatis.session.SqlSessionFactory;<br><span class=\"hljs-keyword\">import</span> org.mybatis.spring.SqlSessionFactoryBean;<br><span class=\"hljs-keyword\">import</span> org.mybatis.spring.annotation.MapperScan;<br><span class=\"hljs-keyword\">import</span> org.slf4j.Logger;<br><span class=\"hljs-keyword\">import</span> org.slf4j.LoggerFactory;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Qualifier;<br><span class=\"hljs-keyword\">import</span> org.springframework.boot.autoconfigure.jdbc.DataSourceProperties;<br><span class=\"hljs-keyword\">import</span> org.springframework.boot.context.properties.ConfigurationProperties;<br><span class=\"hljs-keyword\">import</span> org.springframework.boot.jdbc.DataSourceBuilder;<br><span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.Bean;<br><span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.Configuration;<br><span class=\"hljs-keyword\">import</span> org.springframework.core.env.Environment;<br><span class=\"hljs-keyword\">import</span> org.springframework.core.io.support.PathMatchingResourcePatternResolver;<br><span class=\"hljs-keyword\">import</span> org.springframework.transaction.annotation.EnableTransactionManagement;<br><br><span class=\"hljs-keyword\">import</span> javax.sql.DataSource;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 2018/4/19 18:46</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-meta\">@MapperScan</span>(<span class=\"hljs-string\">\"com.winterchen.dao\"</span>)<br><span class=\"hljs-meta\">@EnableTransactionManagement</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DataSourceConfig</span> </span>&#123;<br><br><br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> Logger logger = LoggerFactory.getLogger(DataSourceConfig<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> Environment env;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> PageInterceptor pageInterceptor;<br><br>    <span class=\"hljs-meta\">@Bean</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> SqlSessionFactory <span class=\"hljs-title\">sqlSessionFactory</span><span class=\"hljs-params\">(DataSource dataSource)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>        SqlSessionFactoryBean fb = <span class=\"hljs-keyword\">new</span> SqlSessionFactoryBean();<br>        fb.setDataSource(dataSource);<br>        <span class=\"hljs-comment\">//该配置非常的重要，如果不将PageInterceptor设置到SqlSessionFactoryBean中，导致分页失效</span><br>        fb.setPlugins(<span class=\"hljs-keyword\">new</span> Interceptor[]&#123;pageInterceptor&#125;);<br>        fb.setTypeAliasesPackage(env.getProperty(<span class=\"hljs-string\">\"mybatis.type-aliases-package\"</span>));<br>        fb.setMapperLocations(<span class=\"hljs-keyword\">new</span> PathMatchingResourcePatternResolver().getResources(env.getProperty(<span class=\"hljs-string\">\"mybatis.mapper-locations\"</span>)));<br>        <span class=\"hljs-keyword\">return</span> fb.getObject();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p><code>DruidDBConfig.java</code></p>\n<blockquote>\n<p>在Spring Boot1.4.0中驱动配置信息没有问题，但是连接池的配置信息不再支持这里的配置项，即无法通过配置项直接支持相应的连接池；这里列出的这些配置项可以通过定制化DataSource来实现。<br>  目前Spring Boot中默认支持的连接池有dbcp,dbcp2, tomcat, hikari三种连接池。 </p>\n</blockquote>\n<p>由于Druid暂时不在Spring Bootz中的直接支持，故需要进行配置信息的定制：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.config;<br><br><span class=\"hljs-keyword\">import</span> com.alibaba.druid.pool.DruidDataSource;<br><span class=\"hljs-keyword\">import</span> org.slf4j.Logger;<br><span class=\"hljs-keyword\">import</span> org.slf4j.LoggerFactory;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Value;<br><span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.Bean;<br><span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.Configuration;<br><span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.Primary;<br><br><span class=\"hljs-keyword\">import</span> javax.sql.DataSource;<br><span class=\"hljs-keyword\">import</span> java.sql.SQLException;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * Created by Donghua.Chen on 2018/4/19.</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DruidDBConfig</span> </span>&#123;<br>    <span class=\"hljs-keyword\">private</span> Logger logger = LoggerFactory.getLogger(DruidDBConfig<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.url&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String dbUrl;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.username&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String username;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.password&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String password;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.driver-class-name&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String driverClassName;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.initialSize&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> initialSize;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.minIdle&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> minIdle;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.maxActive&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> maxActive;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.maxWait&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> maxWait;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.timeBetweenEvictionRunsMillis&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> timeBetweenEvictionRunsMillis;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.minEvictableIdleTimeMillis&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> minEvictableIdleTimeMillis;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.validationQuery&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String validationQuery;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.testWhileIdle&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> testWhileIdle;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.testOnBorrow&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> testOnBorrow;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.testOnReturn&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> testOnReturn;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.poolPreparedStatements&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> poolPreparedStatements;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.maxPoolPreparedStatementPerConnectionSize&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> maxPoolPreparedStatementPerConnectionSize;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.filters&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String filters;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"&#123;spring.datasource.connectionProperties&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String connectionProperties;<br><br>    <span class=\"hljs-meta\">@Bean</span>     <span class=\"hljs-comment\">//声明其为Bean实例</span><br>    <span class=\"hljs-meta\">@Primary</span>  <span class=\"hljs-comment\">//在同样的DataSource中，首先使用被标注的DataSource</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> DataSource <span class=\"hljs-title\">dataSource</span><span class=\"hljs-params\">()</span></span>&#123;<br>        DruidDataSource datasource = <span class=\"hljs-keyword\">new</span> DruidDataSource();<br><br>        datasource.setUrl(<span class=\"hljs-keyword\">this</span>.dbUrl);<br>        datasource.setUsername(username);<br>        datasource.setPassword(password);<br>        datasource.setDriverClassName(driverClassName);<br><br>        <span class=\"hljs-comment\">//configuration</span><br>        datasource.setInitialSize(initialSize);<br>        datasource.setMinIdle(minIdle);<br>        datasource.setMaxActive(maxActive);<br>        datasource.setMaxWait(maxWait);<br>        datasource.setTimeBetweenEvictionRunsMillis(timeBetweenEvictionRunsMillis);<br>        datasource.setMinEvictableIdleTimeMillis(minEvictableIdleTimeMillis);<br>        datasource.setValidationQuery(validationQuery);<br>        datasource.setTestWhileIdle(testWhileIdle);<br>        datasource.setTestOnBorrow(testOnBorrow);<br>        datasource.setTestOnReturn(testOnReturn);<br>        datasource.setPoolPreparedStatements(poolPreparedStatements);<br>        datasource.setMaxPoolPreparedStatementPerConnectionSize(maxPoolPreparedStatementPerConnectionSize);<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            datasource.setFilters(filters);<br>        &#125; <span class=\"hljs-keyword\">catch</span> (SQLException e) &#123;<br>            logger.error(<span class=\"hljs-string\">\"druid configuration initialization filter\"</span>, e);<br>        &#125;<br>        datasource.setConnectionProperties(connectionProperties);<br><br>        <span class=\"hljs-keyword\">return</span> datasource;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n\n\n<h3 id=\"创建数据库和数据表\"><a href=\"#创建数据库和数据表\" class=\"headerlink\" title=\"创建数据库和数据表\"></a>创建数据库和数据表</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">DATABASE</span> mytest;<br><br><span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> t_user(<br>  userId <span class=\"hljs-built_in\">INT</span> <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> PRIMARY <span class=\"hljs-keyword\">KEY</span> AUTO_INCREMENT,<br>  userName <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">255</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> ,<br>  <span class=\"hljs-keyword\">password</span> <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">255</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> ,<br>  phone <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">255</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span><br>) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">INNODB</span> AUTO_INCREMENT=<span class=\"hljs-number\">1000</span> <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">CHARSET</span>=utf8;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"创建实体类：UserDomain-java\"><a href=\"#创建实体类：UserDomain-java\" class=\"headerlink\" title=\"创建实体类：UserDomain.java\"></a>创建实体类：<code>UserDomain.java</code></h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.model;<br><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserDomain</span> </span>&#123;<br>    <span class=\"hljs-keyword\">private</span> Integer userId;<br><br>    <span class=\"hljs-keyword\">private</span> String userName;<br><br>    <span class=\"hljs-keyword\">private</span> String password;<br><br>    <span class=\"hljs-keyword\">private</span> String phone;<br><br>    <span class=\"hljs-comment\">// get,set方法略...</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n<h3 id=\"创建dao：\"><a href=\"#创建dao：\" class=\"headerlink\" title=\"创建dao：\"></a>创建dao：</h3><p><code>UserDao.java</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.dao;<br><br><br><br><span class=\"hljs-keyword\">import</span> com.winterchen.model.UserDomain;<br><span class=\"hljs-keyword\">import</span> org.apache.ibatis.annotations.Mapper;<br><br><span class=\"hljs-keyword\">import</span> java.util.List;<br><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">UserDao</span> </span>&#123;<br><br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">insert</span><span class=\"hljs-params\">(UserDomain record)</span></span>;<br><br><br><br>    <span class=\"hljs-function\">List&lt;UserDomain&gt; <span class=\"hljs-title\">selectUsers</span><span class=\"hljs-params\">()</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>\n<h3 id=\"创建mybatis映射文件：-UserMapper-xml\"><a href=\"#创建mybatis映射文件：-UserMapper-xml\" class=\"headerlink\" title=\"创建mybatis映射文件： UserMapper.xml\"></a>创建mybatis映射文件： <code>UserMapper.xml</code></h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</span><br><span class=\"hljs-meta\">&lt;!DOCTYPE <span class=\"hljs-meta-keyword\">mapper</span> <span class=\"hljs-meta-keyword\">PUBLIC</span> <span class=\"hljs-meta-string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span> <span class=\"hljs-meta-string\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span> &gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">mapper</span> <span class=\"hljs-attr\">namespace</span>=<span class=\"hljs-string\">\"com.winterchen.dao.UserDao\"</span> &gt;</span><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sql</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"BASE_TABLE\"</span>&gt;</span><br>    t_user<br>  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sql</span>&gt;</span><br><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sql</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"BASE_COLUMN\"</span>&gt;</span><br>    userId,userName,password,phone<br>  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sql</span>&gt;</span><br><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">insert</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"insert\"</span> <span class=\"hljs-attr\">parameterType</span>=<span class=\"hljs-string\">\"com.winterchen.model.UserDomain\"</span>&gt;</span><br>    INSERT INTO<br>      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">include</span> <span class=\"hljs-attr\">refid</span>=<span class=\"hljs-string\">\"BASE_TABLE\"</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">trim</span> <span class=\"hljs-attr\">prefix</span>=<span class=\"hljs-string\">\"(\"</span> <span class=\"hljs-attr\">suffix</span>=<span class=\"hljs-string\">\")\"</span> <span class=\"hljs-attr\">suffixOverrides</span>=<span class=\"hljs-string\">\",\"</span>&gt;</span><br>      userName,password,<br>      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"phone != null\"</span>&gt;</span><br>        phone,<br>      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">trim</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">trim</span> <span class=\"hljs-attr\">prefix</span>=<span class=\"hljs-string\">\"VALUES(\"</span> <span class=\"hljs-attr\">suffix</span>=<span class=\"hljs-string\">\")\"</span> <span class=\"hljs-attr\">suffixOverrides</span>=<span class=\"hljs-string\">\",\"</span>&gt;</span><br>      #&#123;userName, jdbcType=VARCHAR&#125;,#&#123;password, jdbcType=VARCHAR&#125;,<br>      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"phone != null\"</span>&gt;</span><br>        #&#123;phone, jdbcType=VARCHAR&#125;,<br>      <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">trim</span>&gt;</span><br>  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">insert</span>&gt;</span><br><br>  <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"selectUsers\"</span> <span class=\"hljs-attr\">resultType</span>=<span class=\"hljs-string\">\"com.winterchen.model.UserDomain\"</span>&gt;</span><br>      SELECT<br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">include</span> <span class=\"hljs-attr\">refid</span>=<span class=\"hljs-string\">\"BASE_COLUMN\"</span>/&gt;</span><br>      FROM<br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">include</span> <span class=\"hljs-attr\">refid</span>=<span class=\"hljs-string\">\"BASE_TABLE\"</span>/&gt;</span><br>  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span><br><br><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"创建剩余的controller，service包和文件\"><a href=\"#创建剩余的controller，service包和文件\" class=\"headerlink\" title=\"创建剩余的controller，service包和文件\"></a>创建剩余的<code>controller</code>，<code>service</code>包和文件</h3><p><code>UserService.java</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.service.user;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.model.UserDomain;<br><br><span class=\"hljs-keyword\">import</span> java.util.List;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * Created by Administrator on 2018/4/19.</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">UserService</span> </span>&#123;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">addUser</span><span class=\"hljs-params\">(UserDomain user)</span></span>;<br><br>    <span class=\"hljs-function\">List&lt;UserDomain&gt; <span class=\"hljs-title\">findAllUser</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> pageNum, <span class=\"hljs-keyword\">int</span> pageSize)</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p><code>UserServiceImpl</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.service.user.impl;<br><br><span class=\"hljs-keyword\">import</span> com.github.pagehelper.PageHelper;<br><span class=\"hljs-keyword\">import</span> com.winterchen.dao.UserDao;<br><span class=\"hljs-keyword\">import</span> com.winterchen.model.UserDomain;<br><span class=\"hljs-keyword\">import</span> com.winterchen.service.user.UserService;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Service;<br><br><span class=\"hljs-keyword\">import</span> java.util.List;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * Created by Administrator on 2017/8/16.</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-meta\">@Service</span>(value = <span class=\"hljs-string\">\"userService\"</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">UserService</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> UserDao userDao;<span class=\"hljs-comment\">//这里会报错，但是并不会影响</span><br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">addUser</span><span class=\"hljs-params\">(UserDomain user)</span> </span>&#123;<br><br>        <span class=\"hljs-keyword\">return</span> userDao.insert(user);<br>    &#125;<br><br>    <span class=\"hljs-comment\">/*</span><br><span class=\"hljs-comment\">    * 这个方法中用到了我们开头配置依赖的分页插件pagehelper</span><br><span class=\"hljs-comment\">    * 很简单，只需要在service层传入参数，然后将参数传递给一个插件的一个静态方法即可；</span><br><span class=\"hljs-comment\">    * pageNum 开始页数</span><br><span class=\"hljs-comment\">    * pageSize 每页显示的数据条数</span><br><span class=\"hljs-comment\">    * */</span><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> List&lt;UserDomain&gt; <span class=\"hljs-title\">findAllUser</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> pageNum, <span class=\"hljs-keyword\">int</span> pageSize)</span> </span>&#123;<br>        <span class=\"hljs-comment\">//将参数传给这个方法就可以实现物理分页了，非常简单。</span><br>        PageHelper.startPage(pageNum, pageSize);<br>        <span class=\"hljs-keyword\">return</span> userDao.selectUsers();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n<p><code>UserController.java</code></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.controller;<br><br><span class=\"hljs-keyword\">import</span> com.github.pagehelper.PageHelper;<br><span class=\"hljs-keyword\">import</span> com.winterchen.model.UserDomain;<br><span class=\"hljs-keyword\">import</span> com.winterchen.service.user.UserService;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Controller;<br><span class=\"hljs-keyword\">import</span> org.springframework.web.bind.annotation.*;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * Created by Administrator on 2017/8/16.</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-meta\">@Controller</span><br><span class=\"hljs-meta\">@RequestMapping</span>(value = <span class=\"hljs-string\">\"/user\"</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserController</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> UserService userService;<br><br>    <span class=\"hljs-meta\">@ResponseBody</span><br>    <span class=\"hljs-meta\">@PostMapping</span>(<span class=\"hljs-string\">\"/add\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">addUser</span><span class=\"hljs-params\">(UserDomain user)</span></span>&#123;<br>        <span class=\"hljs-keyword\">return</span> userService.addUser(user);<br>    &#125;<br><br>    <span class=\"hljs-meta\">@ResponseBody</span><br>    <span class=\"hljs-meta\">@GetMapping</span>(<span class=\"hljs-string\">\"/all\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> Object <span class=\"hljs-title\">findAllUser</span><span class=\"hljs-params\">(</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">            @RequestParam(name = <span class=\"hljs-string\">\"pageNum\"</span>, required = <span class=\"hljs-keyword\">false</span>, defaultValue = <span class=\"hljs-string\">\"1\"</span>)</span></span><br><span class=\"hljs-function\">                    <span class=\"hljs-keyword\">int</span> pageNum,</span><br><span class=\"hljs-function\">            @<span class=\"hljs-title\">RequestParam</span><span class=\"hljs-params\">(name = <span class=\"hljs-string\">\"pageSize\"</span>, required = <span class=\"hljs-keyword\">false</span>, defaultValue = <span class=\"hljs-string\">\"10\"</span>)</span></span><br><span class=\"hljs-function\">                    <span class=\"hljs-keyword\">int</span> pageSize)</span>&#123;<br>        <span class=\"hljs-comment\">//开始分页</span><br>        PageHelper.startPage(pageNum,pageSize);<br>        <span class=\"hljs-keyword\">return</span> userService.findAllUser(pageNum,pageSize);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"项目最终的结构\"><a href=\"#项目最终的结构\" class=\"headerlink\" title=\"项目最终的结构\"></a>项目最终的结构</h2><p><img    class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046467097250.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">项目结构</span></p>\n<blockquote>\n<p>到这里如果项目就成功搭建完成了，如果还是报错的话，请仔细看看配置，后面会给出源码地址，程序员就是要不断和bug进行斗争，加油。</p>\n</blockquote>\n<h2 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h2><p>启动项目</p>\n<p><img    class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046467147252.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">启动项目</span></p>\n<p>这样就表示启动成功了</p>\n<p>然后，开始测试吧，博主使用的是postMan，一个进行http请求的测试工具</p>\n<h3 id=\"添加数据\"><a href=\"#添加数据\" class=\"headerlink\" title=\"添加数据\"></a>添加数据</h3><p><img    class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046467254251.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">添加数据</span></p>\n<h3 id=\"查询数据\"><a href=\"#查询数据\" class=\"headerlink\" title=\"查询数据\"></a>查询数据</h3><p><img    class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046467296252.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">查询数据</span></p>\n<p>源码地址：</p>\n<p><a href=\"https://github.com/WinterChenS/springboot2-mybatis-demo\" target=\"_blank\" rel=\"noopener\">https://github.com/WinterChenS/springboot2-mybatis-demo</a></p>\n<p>如果遇到问题可以加我wechat：</p>\n<img    class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046784292084.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  width = \"200\" height = \"200\"  /><span class=\"image-caption\">wechat</span>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","raw":null,"categories":[{"name":"Spring Boot","path":"api/categories/Spring Boot.json"}],"tags":[{"name":"Spring Boot","path":"api/tags/Spring Boot.json"},{"name":"mybatis","path":"api/tags/mybatis.json"}]},{"title":"用FastDFS一步步搭建文件管理系统(CentOS 7)","slug":"fastdfs-centos7","date":"2018-04-10T01:16:00.000Z","updated":"2022-12-01T01:32:39.787Z","comments":true,"top":null,"path":"api/articles/fastdfs-centos7.json","excerpt":" [Figure] 参考：FastDFS分布式文件系统","keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046765942327.jpg","content":"<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046766291606.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<h1 id=\"一、FastDFS介绍\"><a href=\"#一、FastDFS介绍\" class=\"headerlink\" title=\"一、FastDFS介绍\"></a>一、FastDFS介绍</h1><p>开源地址：<a href=\"https://github.com/happyfish100\" target=\"_blank\" rel=\"noopener\">https://github.com/happyfish100</a><br>参考：<a href=\"http://blog.chinaunix.net/uid-20196318-id-4058561.html\" target=\"_blank\" rel=\"noopener\">分布式文件系统FastDFS设计原理</a><br>参考：<a href=\"http://www.cnblogs.com/Leo_wl/p/6731647.html\" target=\"_blank\" rel=\"noopener\">FastDFS分布式文件系统</a></p>\n<a id=\"more\"></a>\n<h2 id=\"1-简介\"><a href=\"#1-简介\" class=\"headerlink\" title=\"1.简介\"></a>1.简介</h2><p>FastDFS 是一个开源的高性能分布式文件系统（DFS）。 它的主要功能包括：文件存储，文件同步和文件访问，以及高容量和负载平衡。主要解决了海量数据存储问题，特别适合以中小文件（建议范围：4KB &lt; file_size &lt;500MB）为载体的在线服务。</p>\n<p>FastDFS 系统有三个角色：跟踪服务器(Tracker Server)、存储服务器(Storage Server)和客户端(Client)。</p>\n<p>　　<strong>Tracker Server</strong>：跟踪服务器，主要做调度工作，起到均衡的作用；负责管理所有的 storage server和 group，每个 storage 在启动后会连接 Tracker，告知自己所属 group 等信息，并保持周期性心跳。</p>\n<p>　　<strong>Storage Server</strong>：存储服务器，主要提供容量和备份服务；以 group 为单位，每个 group 内可以有多台 storage server，数据互为备份。</p>\n<p>　　<strong>Client</strong>：客户端，上传下载数据的服务器，也就是我们自己的项目所部署在的服务器。<br>　　<br>　　<img    class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046457404302.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">服务基本架构</span>\n　　</p>\n<h2 id=\"2、FastDFS的存储策略\"><a href=\"#2、FastDFS的存储策略\" class=\"headerlink\" title=\"2、FastDFS的存储策略\"></a>2、FastDFS的存储策略</h2><p>为了支持大容量，存储节点（服务器）采用了分卷（或分组）的组织方式。存储系统由一个或多个卷组成，卷与卷之间的文件是相互独立的，所有卷的文件容量累加就是整个存储系统中的文件容量。一个卷可以由一台或多台存储服务器组成，一个卷下的存储服务器中的文件都是相同的，卷中的多台存储服务器起到了冗余备份和负载均衡的作用。</p>\n<p>在卷中增加服务器时，同步已有的文件由系统自动完成，同步完成后，系统自动将新增服务器切换到线上提供服务。当存储空间不足或即将耗尽时，可以动态添加卷。只需要增加一台或多台服务器，并将它们配置为一个新的卷，这样就扩大了存储系统的容量。</p>\n<h2 id=\"3、FastDFS的上传过程\"><a href=\"#3、FastDFS的上传过程\" class=\"headerlink\" title=\"3、FastDFS的上传过程\"></a>3、FastDFS的上传过程</h2><p>FastDFS向使用者提供基本文件访问接口，比如upload、download、append、delete等，以客户端库的方式提供给用户使用。</p>\n<p>Storage Server会定期的向Tracker Server发送自己的存储信息。当Tracker Server Cluster中的Tracker Server不止一个时，各个Tracker之间的关系是对等的，所以客户端上传时可以选择任意一个Tracker。</p>\n<p>当Tracker收到客户端上传文件的请求时，会为该文件分配一个可以存储文件的group，当选定了group后就要决定给客户端分配group中的哪一个storage server。当分配好storage server后，客户端向storage发送写文件请求，storage将会为文件分配一个数据存储目录。然后为文件分配一个fileid，最后根据以上的信息生成文件名存储文件。</p>\n<p><img    class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046457665865.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">FastDFS的上传过程</span></p>\n<h2 id=\"4、FastDFS的文件同步\"><a href=\"#4、FastDFS的文件同步\" class=\"headerlink\" title=\"4、FastDFS的文件同步\"></a>4、FastDFS的文件同步</h2><p>写文件时，客户端将文件写至group内一个storage server即认为写文件成功，storage server写完文件后，会由后台线程将文件同步至同group内其他的storage server。</p>\n<p>每个storage写文件后，同时会写一份binlog，binlog里不包含文件数据，只包含文件名等元信息，这份binlog用于后台同步，storage会记录向group内其他storage同步的进度，以便重启后能接上次的进度继续同步；进度以时间戳的方式进行记录，所以最好能保证集群内所有server的时钟保持同步。</p>\n<p>storage的同步进度会作为元数据的一部分汇报到tracker上，tracke在选择读storage的时候会以同步进度作为参考。</p>\n<h2 id=\"5、FastDFS的文件下载\"><a href=\"#5、FastDFS的文件下载\" class=\"headerlink\" title=\"5、FastDFS的文件下载\"></a>5、FastDFS的文件下载</h2><p>客户端uploadfile成功后，会拿到一个storage生成的文件名，接下来客户端根据这个文件名即可访问到该文件。<br><img    class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046457879129.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">FastDFS的文件下载过程</span></p>\n<p>跟upload file一样，在downloadfile时客户端可以选择任意tracker server。tracker发送download请求给某个tracker，必须带上文件名信息，tracke从文件名中解析出文件的group、大小、创建时间等信息，然后为该请求选择一个storage用来服务读请求。</p>\n<h1 id=\"二、安装FastDFS环境\"><a href=\"#二、安装FastDFS环境\" class=\"headerlink\" title=\"二、安装FastDFS环境\"></a>二、安装FastDFS环境</h1><h2 id=\"0、前言\"><a href=\"#0、前言\" class=\"headerlink\" title=\"0、前言\"></a>0、前言</h2><p>操作环境：CentOS7 X64，以下操作都是单机环境。</p>\n<p>我把所有的安装包下载到/softpackages/下，解压到当前目录。</p>\n<p>先做一件事，修改hosts，将文件服务器的ip与域名映射(单机TrackerServer环境)，因为后面很多配置里面都需要去配置服务器地址，ip变了，就只需要修改hosts即可。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># vim &#x2F;etc&#x2F;hosts<br><br>增加如下一行，这是我的IP<br>118.25.36.41 luischen.cn<br><br>如果要本机访问虚拟机，在C:\\Windows\\System32\\drivers\\etc\\hosts中同样增加一行<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"1、下载安装-libfastcommon\"><a href=\"#1、下载安装-libfastcommon\" class=\"headerlink\" title=\"1、下载安装 libfastcommon\"></a>1、下载安装 libfastcommon</h2><p>libfastcommon是从 FastDFS 和 FastDHT 中提取出来的公共 C 函数库，基础环境，安装即可 。</p>\n<h3 id=\"①-下载libfastcommon\"><a href=\"#①-下载libfastcommon\" class=\"headerlink\" title=\"① 下载libfastcommon\"></a>① 下载libfastcommon</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># wget https:&#x2F;&#x2F;github.com&#x2F;happyfish100&#x2F;libfastcommon&#x2F;archive&#x2F;V1.0.7.tar.gz<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"②-解压\"><a href=\"#②-解压\" class=\"headerlink\" title=\"② 解压\"></a>② 解压</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># tar -zxvf V1.0.7.tar.gz<br># cd libfastcommon-1.0.7<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"③-编译、安装\"><a href=\"#③-编译、安装\" class=\"headerlink\" title=\"③ 编译、安装\"></a>③ 编译、安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># .&#x2F;make.sh<br># .&#x2F;make.sh install<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"④-libfastcommon-so-安装到了-usr-lib64-libfastcommon-so，但是FastDFS主程序设置的lib目录是-usr-local-lib，所以需要创建软链接。\"><a href=\"#④-libfastcommon-so-安装到了-usr-lib64-libfastcommon-so，但是FastDFS主程序设置的lib目录是-usr-local-lib，所以需要创建软链接。\" class=\"headerlink\" title=\"④ libfastcommon.so 安装到了/usr/lib64/libfastcommon.so，但是FastDFS主程序设置的lib目录是/usr/local/lib，所以需要创建软链接。\"></a>④ libfastcommon.so 安装到了/usr/lib64/libfastcommon.so，但是FastDFS主程序设置的lib目录是/usr/local/lib，所以需要创建软链接。</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># ln -s &#x2F;usr&#x2F;lib64&#x2F;libfastcommon.so &#x2F;usr&#x2F;local&#x2F;lib&#x2F;libfastcommon.so<br># ln -s &#x2F;usr&#x2F;lib64&#x2F;libfastcommon.so &#x2F;usr&#x2F;lib&#x2F;libfastcommon.so<br># ln -s &#x2F;usr&#x2F;lib64&#x2F;libfdfsclient.so &#x2F;usr&#x2F;local&#x2F;lib&#x2F;libfdfsclient.so<br># ln -s &#x2F;usr&#x2F;lib64&#x2F;libfdfsclient.so &#x2F;usr&#x2F;lib&#x2F;libfdfsclient.so<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2、下载安装FastDFS\"><a href=\"#2、下载安装FastDFS\" class=\"headerlink\" title=\"2、下载安装FastDFS\"></a>2、下载安装FastDFS</h2><h3 id=\"①-下载FastDFS\"><a href=\"#①-下载FastDFS\" class=\"headerlink\" title=\"① 下载FastDFS\"></a>① 下载FastDFS</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># wget https:&#x2F;&#x2F;github.com&#x2F;happyfish100&#x2F;fastdfs&#x2F;archive&#x2F;V5.05.tar.gz<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"②-解压-1\"><a href=\"#②-解压-1\" class=\"headerlink\" title=\"② 解压\"></a>② 解压</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># tar -zxvf V5.05.tar.gz<br># cd fastdfs-5.05<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"③-编译、安装-1\"><a href=\"#③-编译、安装-1\" class=\"headerlink\" title=\"③ 编译、安装\"></a>③ 编译、安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># .&#x2F;make.sh<br># .&#x2F;make.sh install<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"④-默认安装方式安装后的相应文件与目录\"><a href=\"#④-默认安装方式安装后的相应文件与目录\" class=\"headerlink\" title=\"④ 默认安装方式安装后的相应文件与目录\"></a>④ 默认安装方式安装后的相应文件与目录</h3><ul>\n<li>A、服务脚本：</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">&#x2F;etc&#x2F;init.d&#x2F;fdfs_storaged<br>&#x2F;etc&#x2F;init.d&#x2F;fdfs_tracker<br></code></pre></td></tr></table></figure>\n<ul>\n<li>B、配置文件（这三个是作者给的样例配置文件） :</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">&#x2F;etc&#x2F;fdfs&#x2F;client.conf.sample<br>&#x2F;etc&#x2F;fdfs&#x2F;storage.conf.sample<br>&#x2F;etc&#x2F;fdfs&#x2F;tracker.conf.sample<br></code></pre></td></tr></table></figure>\n\n<ul>\n<li>C、命令工具在 /usr/bin/ 目录下：</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">fdfs_appender_test<br>fdfs_appender_test1<br>fdfs_append_file<br>fdfs_crc32<br>fdfs_delete_file<br>fdfs_download_file<br>fdfs_file_info<br>fdfs_monitor<br>fdfs_storaged<br>fdfs_test<br>fdfs_test1<br>fdfs_trackerd<br>fdfs_upload_appender<br>fdfs_upload_file<br>stop.sh<br>restart.sh<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"⑤-FastDFS-服务脚本设置的-bin-目录是-usr-local-bin，-但实际命令安装在-usr-bin-下。\"><a href=\"#⑤-FastDFS-服务脚本设置的-bin-目录是-usr-local-bin，-但实际命令安装在-usr-bin-下。\" class=\"headerlink\" title=\"⑤ FastDFS 服务脚本设置的 bin 目录是 /usr/local/bin， 但实际命令安装在 /usr/bin/ 下。\"></a>⑤ FastDFS 服务脚本设置的 bin 目录是 /usr/local/bin， 但实际命令安装在 /usr/bin/ 下。</h3><ul>\n<li>建立 /usr/bin 到 /usr/local/bin 的软链接</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># ln -s &#x2F;usr&#x2F;bin&#x2F;fdfs_trackerd   &#x2F;usr&#x2F;local&#x2F;bin<br># ln -s &#x2F;usr&#x2F;bin&#x2F;fdfs_storaged   &#x2F;usr&#x2F;local&#x2F;bin<br># ln -s &#x2F;usr&#x2F;bin&#x2F;stop.sh         &#x2F;usr&#x2F;local&#x2F;bin<br># ln -s &#x2F;usr&#x2F;bin&#x2F;restart.sh      &#x2F;usr&#x2F;local&#x2F;bin<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"3、配置FastDFS跟踪器-Tracker\"><a href=\"#3、配置FastDFS跟踪器-Tracker\" class=\"headerlink\" title=\"3、配置FastDFS跟踪器(Tracker)\"></a>3、配置FastDFS跟踪器(Tracker)</h2><p>配置文件详细说明参考：<a href=\"http://bbs.chinaunix.net/forum.php?mod=viewthread&tid=1941456&extra=page%3D1%26filter%3Ddigest%26digest%3D1\" target=\"_blank\" rel=\"noopener\">FastDFS 配置文件详解</a></p>\n<h3 id=\"①-进入-etc-fdfs，复制-FastDFS-跟踪器样例配置文件-tracker-conf-sample，并重命名为-tracker-conf。\"><a href=\"#①-进入-etc-fdfs，复制-FastDFS-跟踪器样例配置文件-tracker-conf-sample，并重命名为-tracker-conf。\" class=\"headerlink\" title=\"① 进入 /etc/fdfs，复制 FastDFS 跟踪器样例配置文件 tracker.conf.sample，并重命名为 tracker.conf。\"></a>① 进入 /etc/fdfs，复制 FastDFS 跟踪器样例配置文件 tracker.conf.sample，并重命名为 tracker.conf。</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># cd &#x2F;etc&#x2F;fdfs<br># cp tracker.conf.sample tracker.conf<br># vim tracker.conf<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"②-编辑tracker-conf-，修改下，其它的默认即可。\"><a href=\"#②-编辑tracker-conf-，修改下，其它的默认即可。\" class=\"headerlink\" title=\"② 编辑tracker.conf ，修改下，其它的默认即可。\"></a>② 编辑tracker.conf ，修改下，其它的默认即可。</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># 配置文件是否不生效，false 为生效<br>disabled&#x3D;false<br><br># 提供服务的端口<br>port&#x3D;22122<br><br># Tracker 数据和日志目录地址(根目录必须存在,子目录会自动创建)----------【需要修改】<br>base_path&#x3D;&#x2F;data&#x2F;fastdfs&#x2F;tracker<br><br># HTTP 服务端口----------【需要修改】<br>http.server_port&#x3D;80<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"③-创建tracker基础数据目录，即base-path对应的目录\"><a href=\"#③-创建tracker基础数据目录，即base-path对应的目录\" class=\"headerlink\" title=\"③ 创建tracker基础数据目录，即base_path对应的目录\"></a>③ 创建tracker基础数据目录，即base_path对应的目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">mkdir -p &#x2F;data&#x2F;fastdfs&#x2F;tracker<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"④-防火墙中打开跟踪端口（默认的22122）\"><a href=\"#④-防火墙中打开跟踪端口（默认的22122）\" class=\"headerlink\" title=\"④ 防火墙中打开跟踪端口（默认的22122）\"></a>④ 防火墙中打开跟踪端口（默认的22122）</h3><p>centos7的防火墙由firewalld进行管理</p>\n<ul>\n<li>查看状态：<code>systemctl status firewalld</code></li>\n<li>开启：<code>systemctl start firewalld</code></li>\n<li>关闭:  <code>systemctl stop firewalld</code></li>\n<li>添加开放IP：<code>firewall-cmd --permanent --zone=public --add-port=22122/tcp</code></li>\n<li>重启： <code>firewall-cmd --reload</code></li>\n</ul>\n<p>查看服务的运行状态：<code>netstat -unltp|grep fdfs</code></p>\n<h3 id=\"⑤-启动Tracker\"><a href=\"#⑤-启动Tracker\" class=\"headerlink\" title=\"⑤ 启动Tracker\"></a>⑤ 启动Tracker</h3><p>初次成功启动，会在 /data/fastdfs/tracker/ (配置的base_path)下创建 data、logs 两个目录。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">可以用这种方式启动<br># &#x2F;etc&#x2F;init.d&#x2F;fdfs_trackerd start<br><br>也可以用这种方式启动，前提是上面创建了软链接，后面都用这种方式<br># service fdfs_trackerd start<br></code></pre></td></tr></table></figure>\n\n<p>查看 FastDFS Tracker 是否已成功启动 ，22122端口正在被监听，则算是Tracker服务安装成功</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># netstat -unltp|grep fdfs<br></code></pre></td></tr></table></figure>\n\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046457980987.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p>关闭Tracker命令：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># service fdfs_trackerd stop<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"⑥-设置Tracker开机启动\"><a href=\"#⑥-设置Tracker开机启动\" class=\"headerlink\" title=\"⑥ 设置Tracker开机启动\"></a>⑥ 设置Tracker开机启动</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># chkconfig fdfs_trackerd on<br><br>或者：<br># vim &#x2F;etc&#x2F;rc.d&#x2F;rc.local<br>加入配置：<br>&#x2F;etc&#x2F;init.d&#x2F;fdfs_trackerd start<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"⑦-tracker-server-目录及文件结构\"><a href=\"#⑦-tracker-server-目录及文件结构\" class=\"headerlink\" title=\"⑦ tracker server 目录及文件结构\"></a>⑦ tracker server 目录及文件结构</h3><p>Tracker服务启动成功后，会在base_path下创建data、logs两个目录。目录结构如下：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">$&#123;base_path&#125;<br>  |__data<br>  |   |__storage_groups.dat：存储分组信息<br>  |   |__storage_servers.dat：存储服务器列表<br>  |__logs<br>  |   |__trackerd.log： tracker server 日志文件<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"4、配置-FastDFS-存储-Storage\"><a href=\"#4、配置-FastDFS-存储-Storage\" class=\"headerlink\" title=\"4、配置 FastDFS 存储 (Storage)\"></a>4、配置 FastDFS 存储 (Storage)</h2><h3 id=\"①-进入-etc-fdfs-目录，复制-FastDFS-存储器样例配置文件-storage-conf-sample，并重命名为-storage-conf\"><a href=\"#①-进入-etc-fdfs-目录，复制-FastDFS-存储器样例配置文件-storage-conf-sample，并重命名为-storage-conf\" class=\"headerlink\" title=\"① 进入 /etc/fdfs 目录，复制 FastDFS 存储器样例配置文件 storage.conf.sample，并重命名为 storage.conf\"></a>① 进入 /etc/fdfs 目录，复制 FastDFS 存储器样例配置文件 storage.conf.sample，并重命名为 storage.conf</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># cd &#x2F;etc&#x2F;fdfs<br># cp storage.conf.sample storage.conf<br># vim storage.conf<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"②-编辑storage-conf\"><a href=\"#②-编辑storage-conf\" class=\"headerlink\" title=\"② 编辑storage.conf\"></a>② 编辑storage.conf</h3><p>修改以下，其它的默认即可。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># 配置文件是否不生效，false 为生效<br>disabled&#x3D;false <br><br># 指定此 storage server 所在 组(卷)<br>group_name&#x3D;group1<br><br># storage server 服务端口<br>port&#x3D;23000<br><br># 心跳间隔时间，单位为秒 (这里是指主动向 tracker server 发送心跳)<br>heart_beat_interval&#x3D;30<br><br># Storage 数据和日志目录地址(根目录必须存在，子目录会自动生成)----------【需要修改】<br>base_path&#x3D;&#x2F;data&#x2F;fastdfs&#x2F;storage<br><br># 存放文件时 storage server 支持多个路径。这里配置存放文件的基路径数目，通常只配一个目录。<br>store_path_count&#x3D;1<br><br><br># 逐一配置 store_path_count 个路径，索引号基于 0。<br># 如果不配置 store_path0，那它就和 base_path 对应的路径一样。----------【需要修改】<br>store_path0&#x3D;&#x2F;data&#x2F;fastdfs&#x2F;file<br><br># FastDFS 存储文件时，采用了两级目录。这里配置存放文件的目录个数。 <br># 如果本参数只为 N（如： 256），那么 storage server 在初次运行时，会在 store_path 下自动创建 N * N 个存放文件的子目录。<br>subdir_count_per_path&#x3D;256<br><br># tracker_server 的列表 ，会主动连接 tracker_server<br># 有多个 tracker server 时，每个 tracker server 写一行----------【需要修改】<br>tracker_server&#x3D;118.25.36.41:22122<br><br># 允许系统同步的时间段 (默认是全天) 。一般用于避免高峰同步产生一些问题而设定。<br>sync_start_time&#x3D;00:00<br>sync_end_time&#x3D;23:59<br># 访问端口----------------------------------------【需要修改】<br>http.server_port&#x3D;80<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"③-创建Storage基础数据目录，对应base-path目录\"><a href=\"#③-创建Storage基础数据目录，对应base-path目录\" class=\"headerlink\" title=\"③ 创建Storage基础数据目录，对应base_path目录\"></a>③ 创建Storage基础数据目录，对应base_path目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># mkdir -p &#x2F;data&#x2F;fastdfs&#x2F;storage<br><br># 这是配置的store_path0路径<br># mkdir -p &#x2F;data&#x2F;fastdfs&#x2F;file<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"④-防火墙中打开存储器端口（默认的-23000）\"><a href=\"#④-防火墙中打开存储器端口（默认的-23000）\" class=\"headerlink\" title=\"④ 防火墙中打开存储器端口（默认的 23000）\"></a>④ 防火墙中打开存储器端口（默认的 23000）</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># 添加开放IP：<br>firewall-cmd --permanent --zone&#x3D;public --add-port&#x3D;23000&#x2F;tcp<br># 重启： <br>firewall-cmd --reload<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"⑤-启动-Storage\"><a href=\"#⑤-启动-Storage\" class=\"headerlink\" title=\"⑤ 启动 Storage\"></a>⑤ 启动 Storage</h3><p>启动Storage前确保Tracker是启动的。初次启动成功，会在 /data/fastdfs/storage 目录下创建 data、 logs 两个目录。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">可以用这种方式启动<br># &#x2F;etc&#x2F;init.d&#x2F;fdfs_storaged start<br><br>也可以用这种方式，后面都用这种<br># service fdfs_storaged start<br></code></pre></td></tr></table></figure>\n\n<p>查看 Storage 是否成功启动，23000 端口正在被监听，就算 Storage 启动成功。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># netstat -unltp|grep fdfs<br></code></pre></td></tr></table></figure>\n\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046458057926.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p>关闭Storage命令：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># service fdfs_storaged stop<br></code></pre></td></tr></table></figure>\n\n<p>查看Storage和Tracker是否在通信：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">&#x2F;usr&#x2F;bin&#x2F;fdfs_monitor &#x2F;etc&#x2F;fdfs&#x2F;storage.conf<br></code></pre></td></tr></table></figure>\n\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046458093927.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<h3 id=\"⑥-设置-Storage-开机启动\"><a href=\"#⑥-设置-Storage-开机启动\" class=\"headerlink\" title=\"⑥ 设置 Storage 开机启动\"></a>⑥ 设置 Storage 开机启动</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># chkconfig fdfs_storaged on<br><br>或者：<br># vim &#x2F;etc&#x2F;rc.d&#x2F;rc.local<br>加入配置：<br>&#x2F;etc&#x2F;init.d&#x2F;fdfs_storaged start<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"⑦-Storage-目录\"><a href=\"#⑦-Storage-目录\" class=\"headerlink\" title=\"⑦ Storage 目录\"></a>⑦ Storage 目录</h3><p>同 Tracker，Storage 启动成功后，在base_path 下创建了data、logs目录，记录着 Storage Server 的信息。</p>\n<p>在 store_path0 目录下，创建了N*N个子目录：</p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046458151928.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<h2 id=\"5、文件上传测试\"><a href=\"#5、文件上传测试\" class=\"headerlink\" title=\"5、文件上传测试\"></a>5、文件上传测试</h2><h3 id=\"①-修改-Tracker-服务器中的客户端配置文件\"><a href=\"#①-修改-Tracker-服务器中的客户端配置文件\" class=\"headerlink\" title=\"① 修改 Tracker 服务器中的客户端配置文件\"></a>① 修改 Tracker 服务器中的客户端配置文件</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># cd &#x2F;etc&#x2F;fdfs<br># cp client.conf.sample client.conf<br># vim client.conf<br></code></pre></td></tr></table></figure>\n\n<p>修改如下配置即可，其它默认。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># Client 的数据和日志目录<br>base_path&#x3D;&#x2F;data&#x2F;fastdfs&#x2F;client<br><br># Tracker端口<br>tracker_server&#x3D;118.25.36.41:22122<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"②-上传测试\"><a href=\"#②-上传测试\" class=\"headerlink\" title=\"② 上传测试\"></a>② 上传测试</h3><p>首先需要创建client目录</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">mkdir -p &#x2F;data&#x2F;fastdfs&#x2F;client<br></code></pre></td></tr></table></figure>\n\n<p> 在linux内部执行如下命令上传 namei.jpeg 图片</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># &#x2F;usr&#x2F;bin&#x2F;fdfs_upload_file &#x2F;etc&#x2F;fdfs&#x2F;client.conf storage.conf<br></code></pre></td></tr></table></figure>\n\n<p> 上传成功后返回文件ID号：</p>\n <figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">group1&#x2F;M00&#x2F;00&#x2F;00&#x2F;Cmlg2FrLU9eAVJ-ZAAAejzOgbzU97.conf<br></code></pre></td></tr></table></figure>\n\n<p><img    class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046458201073.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">上传成功</span></p>\n<p> 返回的文件ID由group、存储目录、两级子目录、fileid、文件后缀名（由客户端指定，主要用于区分文件类型）拼接而成。</p>\n<p> <img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046766779695.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<h1 id=\"三、安装Nginx\"><a href=\"#三、安装Nginx\" class=\"headerlink\" title=\"三、安装Nginx\"></a>三、安装Nginx</h1><p>上面将文件上传成功了，但我们无法下载。因此安装Nginx作为服务器以支持Http方式访问文件。同时，后面安装FastDFS的Nginx模块也需要Nginx环境。</p>\n<p>Nginx只需要安装到StorageServer所在的服务器即可，用于访问文件。我这里由于是单机，TrackerServer和StorageServer在一台服务器上。</p>\n<h2 id=\"1、安装nginx所需环境\"><a href=\"#1、安装nginx所需环境\" class=\"headerlink\" title=\"1、安装nginx所需环境\"></a>1、安装nginx所需环境</h2><h3 id=\"①-gcc-安装\"><a href=\"#①-gcc-安装\" class=\"headerlink\" title=\"① gcc 安装\"></a>① gcc 安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># yum install gcc-c++<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"②-PCRE-pcre-devel-安装\"><a href=\"#②-PCRE-pcre-devel-安装\" class=\"headerlink\" title=\"② PCRE pcre-devel 安装\"></a>② PCRE pcre-devel 安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># yum install -y pcre pcre-devel<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"③-zlib-安装\"><a href=\"#③-zlib-安装\" class=\"headerlink\" title=\"③ zlib 安装\"></a>③ zlib 安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># yum install -y zlib zlib-devel<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"④-OpenSSL-安装\"><a href=\"#④-OpenSSL-安装\" class=\"headerlink\" title=\"④ OpenSSL 安装\"></a>④ OpenSSL 安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># yum install -y openssl openssl-devel<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2、安装Nginx\"><a href=\"#2、安装Nginx\" class=\"headerlink\" title=\"2、安装Nginx\"></a>2、安装Nginx</h2><h3 id=\"①-下载nginx\"><a href=\"#①-下载nginx\" class=\"headerlink\" title=\"① 下载nginx\"></a>① 下载nginx</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># wget -c https:&#x2F;&#x2F;nginx.org&#x2F;download&#x2F;nginx-1.12.1.tar.gz<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"②-解压-2\"><a href=\"#②-解压-2\" class=\"headerlink\" title=\"② 解压\"></a>② 解压</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># tar -zxvf nginx-1.12.1.tar.gz<br># cd nginx-1.12.1<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"③-使用默认配置\"><a href=\"#③-使用默认配置\" class=\"headerlink\" title=\"③ 使用默认配置\"></a>③ 使用默认配置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># .&#x2F;configure<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"④-编译、安装\"><a href=\"#④-编译、安装\" class=\"headerlink\" title=\"④ 编译、安装\"></a>④ 编译、安装</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># make<br># make install<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"⑤-启动nginx\"><a href=\"#⑤-启动nginx\" class=\"headerlink\" title=\"⑤ 启动nginx\"></a>⑤ 启动nginx</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># cd &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;<br># .&#x2F;nginx <br><br>其它命令<br># .&#x2F;nginx -s stop<br># .&#x2F;nginx -s quit<br># .&#x2F;nginx -s reload<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"⑥-设置开机启动\"><a href=\"#⑥-设置开机启动\" class=\"headerlink\" title=\"⑥ 设置开机启动\"></a>⑥ 设置开机启动</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"><br># vim &#x2F;etc&#x2F;rc.local<br><br>添加一行：<br>&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx<br><br># 设置执行权限<br># chmod 755 &#x2F;etc&#x2F;rc.local<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"⑦-查看nginx的版本及模块\"><a href=\"#⑦-查看nginx的版本及模块\" class=\"headerlink\" title=\"⑦ 查看nginx的版本及模块\"></a>⑦ 查看nginx的版本及模块</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -V<br></code></pre></td></tr></table></figure>\n\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046458483555.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<h3 id=\"⑧-防火墙中打开Nginx端口（默认的-80）\"><a href=\"#⑧-防火墙中打开Nginx端口（默认的-80）\" class=\"headerlink\" title=\"⑧ 防火墙中打开Nginx端口（默认的 80）\"></a>⑧ 防火墙中打开Nginx端口（默认的 80）</h3><p>添加后就能在本机使用80端口访问了。</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># 添加开放IP：<br>firewall-cmd --permanent --zone&#x3D;public --add-port&#x3D;80&#x2F;tcp<br># 重启： <br>firewall-cmd --reload<br></code></pre></td></tr></table></figure>\n\n\n<h2 id=\"3、访问文件\"><a href=\"#3、访问文件\" class=\"headerlink\" title=\"3、访问文件\"></a>3、访问文件</h2><p>简单的测试访问文件</p>\n<h3 id=\"①-修改nginx-conf\"><a href=\"#①-修改nginx-conf\" class=\"headerlink\" title=\"① 修改nginx.conf\"></a>① 修改nginx.conf</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># vim &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf<br><br>添加如下行，将 &#x2F;group1&#x2F;M00 映射到 &#x2F;data&#x2F;fastdfs&#x2F;file&#x2F;data<br>location &#x2F;group1&#x2F;M00 &#123;<br>    alias &#x2F;data&#x2F;fastdfs&#x2F;file&#x2F;data;<br>&#125;<br><br># 重启nginx<br># &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -s reload<br></code></pre></td></tr></table></figure>\n\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046458524552.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p>② 在浏览器访问之前上传的图片、成功。</p>\n<p><a href=\"http://118.25.36.41/group1/M00/00/00/Cmlg2FrLU9eAVJ-ZAAAejzOgbzU97.conf\" target=\"_blank\" rel=\"noopener\">http://118.25.36.41/group1/M00/00/00/Cmlg2FrLU9eAVJ-ZAAAejzOgbzU97.conf</a></p>\n<h1 id=\"四、FastDFS-配置-Nginx-模块\"><a href=\"#四、FastDFS-配置-Nginx-模块\" class=\"headerlink\" title=\"四、FastDFS 配置 Nginx 模块\"></a>四、FastDFS 配置 Nginx 模块</h1><h2 id=\"1、安装配置Nginx模块\"><a href=\"#1、安装配置Nginx模块\" class=\"headerlink\" title=\"1、安装配置Nginx模块\"></a>1、安装配置Nginx模块</h2><h3 id=\"①-fastdfs-nginx-module-模块说明\"><a href=\"#①-fastdfs-nginx-module-模块说明\" class=\"headerlink\" title=\"① fastdfs-nginx-module 模块说明\"></a>① fastdfs-nginx-module 模块说明</h3><p>FastDFS 通过 Tracker 服务器，将文件放在 Storage 服务器存储， 但是同组存储服务器之间需要进行文件复制， 有同步延迟的问题。</p>\n<p>　　假设 Tracker 服务器将文件上传到了 192.168.51.128，上传成功后文件 ID已经返回给客户端。</p>\n<p>　　此时 FastDFS 存储集群机制会将这个文件同步到同组存储 192.168.51.129，在文件还没有复制完成的情况下，客户端如果用这个文件 ID 在 192.168.51.129 上取文件,就会出现文件无法访问的错误。</p>\n<p>　　而 fastdfs-nginx-module 可以重定向文件链接到源服务器取文件，避免客户端由于复制延迟导致的文件无法访问错误。\n　　</p>\n<h3 id=\"②-下载-fastdfs-nginx-module、解压\"><a href=\"#②-下载-fastdfs-nginx-module、解压\" class=\"headerlink\" title=\"② 下载 fastdfs-nginx-module、解压\"></a>② 下载 fastdfs-nginx-module、解压</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># 这里为啥这么长一串呢，因为最新版的master与当前nginx有些版本问题。<br># wget https:&#x2F;&#x2F;github.com&#x2F;happyfish100&#x2F;fastdfs-nginx-module&#x2F;archive&#x2F;5e5f3566bbfa57418b5506aaefbe107a42c9fcb1.zip<br><br># 解压<br># unzip 5e5f3566bbfa57418b5506aaefbe107a42c9fcb1.zip<br><br># 重命名<br># mv fastdfs-nginx-module-5e5f3566bbfa57418b5506aaefbe107a42c9fcb1  fastdfs-nginx-module-master<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"③-配置Nginx\"><a href=\"#③-配置Nginx\" class=\"headerlink\" title=\"③ 配置Nginx\"></a>③ 配置Nginx</h3><p>在nginx中添加模块</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># 先停掉nginx服务<br># &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;ngix -s stop<br><br>进入解压包目录<br># cd &#x2F;softpackages&#x2F;nginx-1.12.1&#x2F;<br><br># 添加模块<br># .&#x2F;configure --add-module&#x3D;..&#x2F;fastdfs-nginx-module-master&#x2F;src<br><br>重新编译、安装<br># make &amp;&amp; make install<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"④-查看Nginx的模块\"><a href=\"#④-查看Nginx的模块\" class=\"headerlink\" title=\"④ 查看Nginx的模块\"></a>④ 查看Nginx的模块</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx -V<br></code></pre></td></tr></table></figure>\n\n<p>有下面这个就说明添加模块成功</p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046458581094.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<h3 id=\"⑤-复制-fastdfs-nginx-module-源码中的配置文件到-etc-fdfs-目录，-并修改\"><a href=\"#⑤-复制-fastdfs-nginx-module-源码中的配置文件到-etc-fdfs-目录，-并修改\" class=\"headerlink\" title=\"⑤ 复制 fastdfs-nginx-module 源码中的配置文件到/etc/fdfs 目录， 并修改\"></a>⑤ 复制 fastdfs-nginx-module 源码中的配置文件到/etc/fdfs 目录， 并修改</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># cd &#x2F;softpackages&#x2F;fastdfs-nginx-module-master&#x2F;src<br><br># cp mod_fastdfs.conf &#x2F;etc&#x2F;fdfs&#x2F;<br></code></pre></td></tr></table></figure>\n\n<p>修改如下配置，其它默认</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># cd &#x2F;softpackages&#x2F;fastdfs-nginx-module-master&#x2F;src<br><br># cp mod_fastdfs.conf &#x2F;etc&#x2F;fdfs&#x2F;<br></code></pre></td></tr></table></figure>\n\n<p>修改如下配置，其它默认</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># 连接超时时间<br>connect_timeout&#x3D;10<br><br># Tracker Server<br>tracker_server&#x3D;118.25.36.41:22122<br><br># StorageServer 默认端口<br>storage_server_port&#x3D;23000<br><br># 如果文件ID的uri中包含&#x2F;group**，则要设置为true<br>url_have_group_name &#x3D; true<br><br># Storage 配置的store_path0路径，必须和storage.conf中的一致<br>store_path0&#x3D;&#x2F;data&#x2F;fastdfs&#x2F;file<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"⑥-复制-FastDFS-的部分配置文件到-etc-fdfs-目录\"><a href=\"#⑥-复制-FastDFS-的部分配置文件到-etc-fdfs-目录\" class=\"headerlink\" title=\"⑥ 复制 FastDFS 的部分配置文件到/etc/fdfs 目录\"></a>⑥ 复制 FastDFS 的部分配置文件到/etc/fdfs 目录</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># cd &#x2F;softpackages&#x2F;fastdfs-5.05&#x2F;conf&#x2F;<br><br># cp anti-steal.jpg http.conf mime.types &#x2F;etc&#x2F;fdfs&#x2F;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"⑦-配置nginx，修改nginx-conf\"><a href=\"#⑦-配置nginx，修改nginx-conf\" class=\"headerlink\" title=\"⑦ 配置nginx，修改nginx.conf\"></a>⑦ 配置nginx，修改nginx.conf</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># vim &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf<br></code></pre></td></tr></table></figure>\n\n<p>修改配置，其它的默认</p>\n<p>在80端口下添加fastdfs-nginx模块</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">location ~&#x2F;group([0-9])&#x2F;M00 &#123;<br>    ngx_fastdfs_module;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046458635093.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><strong>注意：</strong><br>listen 80 端口值是要与 /etc/fdfs/storage.conf 中的 http.server_port=80 (前面改成80了)相对应。如果改成其它端口，则需要统一，同时在防火墙中打开该端口。</p>\n<p>　　location 的配置，如果有多个group则配置location ~/group([0-9])/M00 ，没有则不用配group。\n　　</p>\n<h3 id=\"⑧-在-data-fastdfs-file-文件存储目录下创建软连接，将其链接到实际存放数据的目录，这一步可以省略。\"><a href=\"#⑧-在-data-fastdfs-file-文件存储目录下创建软连接，将其链接到实际存放数据的目录，这一步可以省略。\" class=\"headerlink\" title=\"⑧ 在/data/fastdfs/file 文件存储目录下创建软连接，将其链接到实际存放数据的目录，这一步可以省略。\"></a>⑧ 在/data/fastdfs/file 文件存储目录下创建软连接，将其链接到实际存放数据的目录，这一步可以省略。</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># ln -s &#x2F;data&#x2F;fastdfs&#x2F;file&#x2F;data&#x2F; &#x2F;data&#x2F;fastdfs&#x2F;file&#x2F;data&#x2F;M00<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"⑨-启动nginx\"><a href=\"#⑨-启动nginx\" class=\"headerlink\" title=\"⑨ 启动nginx\"></a>⑨ 启动nginx</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;sbin&#x2F;nginx<br></code></pre></td></tr></table></figure>\n\n<p>打印处如下就算配置成功</p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046458687094.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<h3 id=\"⑩-在地址栏访问\"><a href=\"#⑩-在地址栏访问\" class=\"headerlink\" title=\"⑩ 在地址栏访问\"></a>⑩ 在地址栏访问</h3><p>能下载文件就算安装成功。注意和第三点中直接使用nginx路由访问不同的是，这里配置 fastdfs-nginx-module 模块，可以重定向文件链接到源服务器取文件。</p>\n<p><a href=\"http://118.25.36.41/group1/M00/00/00/Cmlg2FrLU9eAVJ-ZAAAejzOgbzU97.conf\" target=\"_blank\" rel=\"noopener\">http://118.25.36.41/group1/M00/00/00/Cmlg2FrLU9eAVJ-ZAAAejzOgbzU97.conf</a></p>\n<p>最终部署结构图(盗的图)：可以按照下面的结构搭建环境。<br><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046458722093.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p>以上</p>\n<p>原作者：bojiangzhou<br>原出处：<a href=\"http://www.cnblogs.com/chiangchou/\" target=\"_blank\" rel=\"noopener\">http://www.cnblogs.com/chiangchou/</a>\n　　</p>\n","raw":null,"categories":[{"name":"FastDFS","path":"api/categories/FastDFS.json"}],"tags":[{"name":"Linux","path":"api/tags/Linux.json"},{"name":"FastDFS","path":"api/tags/FastDFS.json"}]},{"title":"如何提高即兴演讲水平？","slug":"how_to_impromptu_speech","date":"2018-03-31T05:22:29.000Z","updated":"2022-12-01T01:32:39.787Z","comments":true,"top":null,"path":"api/articles/how_to_impromptu_speech.json","excerpt":" [Figure] 什么是即兴演讲？","keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046459911120.png","content":"<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046460667070.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"><br>什么是即兴演讲？</p>\n<a id=\"more\"></a>\n\n<p>即兴演讲在演讲中的比例非常大，占到了80%以上。大到被临时邀请登上几百上千人的舞台上发言，小到平时的各种面试、遇到老板时被问起工作等，都可以说是即兴演讲。<br>即兴演讲的最大特点就是未做准备，或者说没有时间准备。同时即兴演讲在思维的敏捷性、语言的逻辑性和口头表达的雄辩性方面有更高的要求。大部分人对公众演讲的恐惧和害怕，主要来自对即兴演讲的恐惧和害怕。说到即兴演讲，大部分人都很害怕。虽然如此，但还是有方法可以训练，有技巧可以应对，让你一遇到即兴演讲，即使还没想好，但是根据这些方法技巧，你还是可以有话可讲，甚至边想边讲，边讲边想，不至于自己无话可说，呆呆站在那里，显得很白痴。今天这篇文章介绍的方法技巧，几乎可以帮你搞定所有即兴演讲。</p>\n<h2 id=\"一-散-点-联-想-法\"><a href=\"#一-散-点-联-想-法\" class=\"headerlink\" title=\"一. 散 点 联 想 法\"></a>一. 散 点 联 想 法</h2><p><img    class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046504719752.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">自信</span></p>\n<p>我们先来介绍一种练习即兴演讲的方法。<strong>散点联想法，简单说，就是将几个看似没有关联的、不相干的词语，通过一定的语言表达方式，巧妙的串联起来，组合成一段话，表达一个完整的意思。</strong></p>\n<p>说到“苹果”， 大家会想到什么？ 身边吃的苹果， 乔布斯的苹果公司，被苹果砸下的牛顿，还是联想到其他… 如果你想到水果中的苹果，也没问题，可以说说吃苹果的好处，苹果的作用等等；如果你因为苹果而想到苹果公司，想到乔布斯，联想到创新，就可以把苹果和乔布斯关联起来，把苹果跟创新关联起来；如果你联想到了牛顿，联想到牛顿因为被苹果砸了而发现了万有引力定律，这样苹果就和万有引力，和机会(机会总是留给有准备的人，如果换成别人，被苹果砸了也就砸了，而不会发现万有引力）联系起来。这就不仅仅从表层意思说苹果，<strong>演讲起来内容更有深度</strong>。</p>\n<p>散点联想法，是可以来锻炼我们的联想能力和想象能力，同时也可以提高我们的即兴演讲水平的一种训练方法。</p>\n<p>比如下面三个词：  白马，老庄，天空。</p>\n<p>这三个词并没什么关联，怎么把它们组成一个完成的意思呢？</p>\n<p>你可以这样说：</p>\n<p>白马在默默的吃草，它的一旁坐着老庄，老庄抬头看着天空。</p>\n<p>三个词都用到了，也是完整的一个意思，这是一个比较静态的画面。</p>\n<p>你还可以这样说：</p>\n<p>老庄无聊的走在河边，突然看见前面有一匹白马，于是他就跑过去骑在白马上，白马载着老庄越跑越快，最后飞向了天空。老庄就骑着白马四处路见不平就拔刀相助，从此，地球上多了一个白马英雄。</p>\n<p>这样，是不是不仅把几个不相关的词串在一起，同时还增加了故事性呢？</p>\n<p>散点联想法，各个词不一定要按顺序来，也不要受现实条件的限制，想象的越丰富，故事情节越有趣越好。刚开始可以从三个词开始，后面可以增加到四个词、五个词甚至更多。难度逐渐增加，同时也可能会带来更加意想不到好玩的有趣的故事来。</p>\n<p>再来一个： 马桶  洋娃娃  手机 袜子</p>\n<p>我之前给青少年演讲班上课，有一个学生是这样说的：拥有人工智能的洋娃娃蹲着马桶上看手机，突然，手一抖，手机就掉马桶里了。洋娃娃很着急，于是拿起身边的一只袜子，踩在袜子上跳进了马桶，洋娃娃踩着袜子就像踩在滑板上一样，顺着马桶深处滑去，她终于找到了手机，但是她没有停止，继续踏着袜子在马桶的管道里滑啊滑，后来她滑出了管道，来到了一座城堡，遇见了一位王子。</p>\n<p>下面给大家几组词，一起来练习一下吧：</p>\n<ol>\n<li><p>深圳   宇宙   小明  故宫</p>\n</li>\n<li><p>长江   大树   老虎  台灯</p>\n</li>\n<li><p>汽车   蚂蚁   拖鞋  电脑</p>\n</li>\n<li><p>红领巾 扫把 蜘蛛侠 闹钟</p>\n</li>\n<li><p>功夫熊猫 大海  小米 花瓶</p>\n</li>\n<li><p>飞机  碗  太平洋  垃圾桶</p>\n</li>\n</ol>\n<p>散点联想法，可以和家人朋友一起练习。如果有孩子，可以和孩子一起练习，既能锻炼孩子的即兴演讲能力，还能促进和孩子的关系。也可以和朋友一起练习，不要让思维受限，可以天马行空的联想。故事越丰富越有血有肉越好。通过一段时间的练习，联想能力和想象能力都会得到提升，即兴演讲的水平也会提高。</p>\n<h2 id=\"二-问题–原因–解决方案\"><a href=\"#二-问题–原因–解决方案\" class=\"headerlink\" title=\"二. 问题–原因–解决方案\"></a>二. 问题–原因–解决方案</h2><p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046504870169.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><strong>针对问题和现象的即兴演讲技巧。</strong><br>一对夫妻商量好了，老婆做饭，老公刷碗。有一天老公没刷碗，于是出现了这样一幕：</p>\n<p>老婆：你怎么又没刷碗了？</p>\n<p>老公：不就忘刷碗了吗，至于这么大声吗？</p>\n<p>老婆：嘿，你自己做错事，还有理了啊….</p>\n<p>然后家里就咚锵咚锵咚咚锵…..</p>\n<p>同样一个事情，在另一对夫妻那里是这样的：</p>\n<p>老婆：老公，你怎么又没刷碗？</p>\n<p>老公：老婆，对不起我忘了刷碗。因为最近太忙了，老想着工作的事，吃完饭就想去工作，就把刷碗这事给忘了。我现在马上去刷碗。下次，吃完饭后你要提醒我一下，这样我就不会忘记洗碗了。同时，我建议我们要不去买台洗碗机吧？它可洗得比我干净，我也不会忘记洗碗，还能节省一些时间。老婆，你说好吗？</p>\n<p>老婆听着老公的态度诚恳，建议也是有道理的，就说：这个建议不错，我们就买台洗碗机吧。钱我来出。</p>\n<p>上面两种情景，你更喜欢哪一种？</p>\n<p>这里我们跟大家介绍一个即兴演讲魔法公式：<strong>问题–原因–解决方案</strong>。</p>\n<p><strong>问题</strong>：先把问题阐述一下。</p>\n<p><strong>原因</strong>：分析产生问题的原因有哪些?</p>\n<p><strong>解决方案</strong>：针对这个问题，我们可以采取哪些措施？</p>\n<p>在被<strong>问到问题和现象的时候</strong>可以用这个即兴演讲公式，这个公式在<strong>商业和职场中用的非常多。</strong></p>\n<p>比如你在坐电梯时遇到老板，老板问你为什么3月份的销售额下降了。虽然在电梯里的时间很短，但是你如果学会这个公式，就可以轻松的应对你的老板。我们来演练一下：</p>\n<p>老板：为什么3月的销售额下降了？</p>\n<p>你：老板，3月份的销售额确实下降了一些（陈述问题）。我们也分析了原因，有以下几点：第一，2月份过年，大家都在2月份买了很多东西，3月份买的东西少了；第二，最近销售人员流失率比较大，热情也不够高；第三，竞争对手的新品在3月份上市了，抢走了我们一些客户（分析原因）。我们也做出了相应的对策：第一，会协同HR部门，招聘和培训好的销售人员，给销售人员更多激励，调动起积极性；第二，协同研发部门尽快上市我们的最新产品；第三，更深入的研究竞争对手，制定更有吸引力的价格策略（解决方案）。</p>\n<p>老板：既然想到了这些方案，那你们就好好干吧，希望4月份的业绩能够上去。</p>\n<p>这样的话，老板看你不仅知道了问题的存在，还自省分析了原因，而且还已经做出了相对应的解决方案。也就不为难你了，甚至可能以后会更加器重你。</p>\n<p>在实际工作中，出现各种问题是难免的，<strong>关键在于，你不能把问题留给老板或上级。你还要分析原因，最好能给出解决方案。</strong>不能等着老板给你解决方法。老板是喜欢做选择题而不是问答题的人，可以给出几个不同的方案，让老板来拍板。在职场中遇到问题，灵活的应用这个方式，你离升职加薪就不远了。</p>\n<p>在生<strong>活中也有很多场合可以适用</strong>的。刚才开头的那个故事，第二对夫妻的老公就是用这种方法，同时化解了矛盾。我们来分析一下。</p>\n<p>问题：“老婆，对不起我忘了刷碗”，忘记刷碗这个问题。</p>\n<p>原因：“因为最近太忙了，老想着工作的事，吃完饭就想去工作，就把刷碗这事给忘了。”</p>\n<p>解决方案：其实有三个： </p>\n<p>第一个，“我现在马上去刷碗。”；</p>\n<p>第二个，“下次，吃完饭后你要提醒我一下，这样我就不会忘记洗碗了。”；</p>\n<p>第三个，“同时，我建议我们要不去买台洗碗机吧？它可洗得比我干净，我也不会忘记洗碗，还能节省一些时间。”</p>\n<p><strong>很多时候，在家庭生活中应用这种方法，可以避免很多家庭矛盾，让生活更和谐。</strong></p>\n<p>在被问到<strong>社会问题或社会现象</strong>时，也可以很好的应用这种方法。看下面这个例子：</p>\n<p>我国青少年肥胖的比率越来越高了，从1990年的10%增加到2015年的20%。你是如何看待的？</p>\n<p>我可以这么说：</p>\n<p>问题）的确，现在青少年肥胖的比率越来越高了。（原因）我认为导致青少年肥胖比率增加的原因有：一，现在生活水平提高，吃的东西特别多，尤其是各种高热量的垃圾食品非常多；二，青少年的时间被各种课业和辅导班占用了，运动的时间很少。（解决方案）为了解决青少年肥胖问题，我建议：第一，提倡多吃粗粮，少吃垃圾食品，吃饭只吃七分饱就行；</p>\n<p>第二，减少青少年的课业，让青少年有更多的运动时间。（呼吁行动）最后，我呼吁我们社会，学校，家庭一起行动起来，让孩子尽量少吃垃圾食品，每天多一些运动的时间。这样，相信不久的将来，我们青少年肥胖的比例会得到控制，甚至降低。</p>\n<p>细心的朋友可能发现了上面的例子最后还有一个呼吁行动。没错，对于”问题–原因–解决方案“结构，有时候在后面还可以加上“行动”，变成“问题–原因–解决方案–行动”，这是这个魔法公式的变体。学会了以上这个公式，以后在街头被记者采访问到你对社会问题和社会现象的看法时，你就知道怎么说了吧？</p>\n<p>下面给大家几个题目来练习一下吧：</p>\n<ol>\n<li><p>我又长胖了。</p>\n</li>\n<li><p>为什么客户投诉这么多？</p>\n</li>\n<li><p>水污染很严重，你怎么看？</p>\n</li>\n<li><p>交通堵塞的现象越来越严重了。</p>\n</li>\n</ol>\n<p>在社会、职场及日常生活中，魔法公式“问题–原因–解决方案”都可以很好的帮你在面对问题和现象时，短时间内就有一个即兴演讲框架出来。</p>\n<p>你会了吗？</p>\n<h2 id=\"三-感谢–回顾–愿景\"><a href=\"#三-感谢–回顾–愿景\" class=\"headerlink\" title=\"三. 感谢–回顾–愿景\"></a>三. 感谢–回顾–愿景</h2><p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046505037447.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><strong>针对各种聚会场合的即兴演讲技巧。</strong></p>\n<p>在我们的生活工作中，常常需要出席各种聚会场合，例如：亲朋好友婚礼，朋友生日会，大学毕业XX年同学会，颁奖会，公司联欢会，客户答谢会，孩子毕业典礼，家庭聚会，葬礼，同事告别会等等。这些场合，有时候会邀请你上台做即兴发言，你怎么办？</p>\n<p>不用怕，放轻松，老庄现在教你一个万能公式，可以让你几乎在所有的聚会场合都能有话可讲。这个公式是：<strong>感谢–回顾–愿景</strong></p>\n<p><strong>感谢</strong>：常常用在开头，表示一定的礼节性，比如感谢主持人邀请你发言，感谢主人邀请你来参加聚会等。</p>\n<p><strong>回顾</strong>：简单回顾一下以往发生的事情，如果有你跟会场的主人或者在场的其他人之间的情谊往事的会更好。</p>\n<p><strong>愿景</strong>：表示祝愿、畅想、祝贺、表决心等等。</p>\n<p>如果用时间来分析这个公式，“感谢”是表示现在，感谢当下的人或事；“回顾”表示过去，回忆过去发生的事情；“愿景”则表示将来，对未来的畅想、祝福、祝愿以及决心行动等等。所以，你可以把这个公式简单的理解为<strong>：现在，过去和未来</strong>。</p>\n<p>这个公式非常简单，就六个字。我们下面举几个例子，帮助大家更好的理解这个聚会场合即兴发言万能公式。</p>\n<p>例子一：在朋友的婚礼上，邀请你上台发言，你是新郎的好友。就假设是老庄的婚礼上吧。</p>\n<p>下面我们来演练一下：</p>\n<p>首先，感谢婚礼主持人给我这个发言的机会，也特别感谢老庄邀请我来参加他的婚礼。（感谢）</p>\n<p>我跟新郎老庄认识十年了，老庄是个非常有毅力的人，我也是在他的影响下我开始跑步。老庄也是一个非常靠谱的人，跟他一起合作过几个公益项目，跟他一起合作，感觉特别放心，所以我觉得新娘你跟老庄在一起也一定会非常安心踏实的。我也见证了老庄和新娘的美好爱情，能深深感受新郎对新娘的爱…..(回顾）</p>\n<p>最后，祝福老庄夫妻新婚快乐，百年好合，早生贵子，最好三年抱两。也祝福所有在场的朋友们幸福快乐。（愿景）</p>\n<p>在婚礼上可以多赞美新郎或新娘的优点，如果你跟新郎和新娘都很熟悉，可以多说说跟他们之间的一些往事，甚至是调侃的玩笑都可以。 </p>\n<p>例子二：在孩子的幼儿园毕业典礼上，校方邀请你发言。还是假设老庄参加了女儿的幼儿园毕业典礼。</p>\n<p>我们也来演练一下这个场景：<br>首先，感谢菲诗国幼儿园邀请我们来参加孩子的毕业典礼，也特别感谢给我这个发言的机会。</p>\n<p>想想时间过得真快，三年前，把女儿送过来这里读书的时候，她那时才三岁，转眼间三年就过去了，孩子也长大了。这三年里，我女儿在这里过得非常快乐，每次回家后，她都会跟我们一起分享在幼儿园快乐有趣的事。我也能感受到老师们对孩子深深的爱，有一次……(回顾，如果有具体的例子，举一两个会更好）</p>\n<p>最后，希望深圳菲诗国幼儿园越办越好，希望老师们身体健康幸福快乐，希望我的女儿以及其他即将毕业的小朋友们能够健康快乐的成长。（祝愿）</p>\n<p>以后参加孩子的小学毕业典礼、中学以及大学毕业典礼，都可以用同样的方法。 </p>\n<p>例子三：参加大学毕业三十周年同学聚会，你突然被邀请上去发言。还是拿老庄为例吧，这时候他五十多岁了。</p>\n<p>我们来演练一下这个场景：</p>\n<p>首先，非常感谢大家给我这个发言的机会。也特别感谢班长老杨和其他几个老同学一起牵头组织了这次活动。（感谢）</p>\n<p>虽然三十年过去了，大家也都到了知天命的岁数，但是和大家一起走在校园里，上大学时的情景仿佛就在昨天。想起了军训时我们一起正步走，一起扛枪打靶；想起了一起欢度的中秋节；想起了在篮球场上，我们班的男生们勇夺冠军；想起了在校运会上，我们班更是刮起了一阵阵夺冠旋风.尤其是有一次，让我印象特别深刻的是，我们一起去……(回顾，多举一些大家大学时共同经历的往事，越难忘越好）</p>\n<p>最后，祝老师们身体健康，寿比南山，福如东海；祝同学们也身体健康，这样我们才能有更多的聚会机会，到了六十岁、七十岁、甚至八十岁，即使走不动了，推着轮椅我们也要继续相聚！（祝愿）</p>\n<p>下次同学会，知道怎么发言了吧？ </p>\n<p>什么？ 你说如果参加葬礼怎么发言？ 好吧，我们还是拿老庄开刷吧，假设你是老庄的老友，参加老庄的葬礼。</p>\n<p>我们来演练一下：</p>\n<p>首先，感谢主持人给我这个发言的机会，让我有机会来缅怀我们共同的朋友老庄。（感谢）</p>\n<p>在中学就认识了老庄，到现在已经六十年了，从懵懂的少年，到白发苍苍的老头，老庄的容貌一直在改变，但是他的品质没有改变，始终是乐观开朗善良。记得……(回顾，举几件你和老庄之间的往事，如果这些往事能够说明他的品质就更好）</p>\n<p>最后，衷心祝愿我的老友老庄能够在天之灵安息，也希望老庄的家人们能够节哀顺变！（希望祝福）</p>\n<p>有朋友问，在葬礼上的发言一定要悲伤的吗？其实看情况，如果你跟逝者很熟悉，也可以讲一些逝者生前开心的事情，很暖心的事情，笑中带泪。</p>\n<p>上面举了四个例子，是否学会了这个公式呢？下面，大家一起来练习一下吧：</p>\n<ol>\n<li><p>老友生日会上，邀请你发言；</p>\n</li>\n<li><p>你获得菲诗国超级演说家比赛第一名，获奖感言；</p>\n</li>\n<li><p>你当上了部门总监或者总裁，就职感言；</p>\n</li>\n<li><p>你的同事要离开公司了，大家一起为ta举行告别会，请你即兴发言；</p>\n</li>\n<li><p>参加孩子的家长会，老师邀请你发言；</p>\n</li>\n<li><p>你被评为公司先进代表，在领奖时，主持人请你即兴发言.</p>\n</li>\n</ol>\n<p><strong>感谢–回顾–愿景</strong> 这个万能公式可以应用在几乎任何的聚会场合上，学会了吗？</p>\n<h2 id=\"四-观-音-按-揭-法\"><a href=\"#四-观-音-按-揭-法\" class=\"headerlink\" title=\"四. 观 音 按 揭 法\"></a>四. 观 音 按 揭 法</h2><p><strong>针对各种聚会场合的即兴演讲技巧。</strong></p>\n<p>前面我们介绍了应对问题或现象的即兴演讲魔法公式和应对任何聚会场合的即兴演讲万能公式。有小伙伴问，那如果遇到观点型的，我该怎么办？</p>\n<p>这里就跟大家介绍应对观点型即兴演讲的万能公式：先阐述<strong>观点</strong>，接着分析<strong>原因</strong>，最好能举出具体<strong>案例</strong>，最后再强调<strong>结论</strong>。</p>\n<p>简单概括： <strong>观点–原因–案例–结论</strong> 。</p>\n<p>我给这个方法取了一个名字，叫做观音按揭法，可以想象一下观音按揭买房子。</p>\n<p><strong>观</strong>，表示观点；</p>\n<p><strong>音</strong>，是因的同音字，表示原因；</p>\n<p><strong>按</strong>，是案的同音字，表示案例；</p>\n<p><strong>揭</strong>，是结的谐音字，表示结论。</p>\n<p>一遇到观点型的即兴演讲，就可以马上在脑海里想到观音菩萨，观音菩萨是救苦救难的，她会帮你的，所以什么也不用怕。</p>\n<p>我们来举几个例子，让大家好熟悉这个观音按揭法。</p>\n<p>例子一：观音该不该在深圳按揭买房？</p>\n<p>我们一起来练习一下：</p>\n<p>我认为观音姐姐应该在深圳按揭买房（观，观点）。</p>\n<p>观音姐姐如果在深圳买房，她在人间就有了一个落脚点，有一个根据地，可以方便她随时来人间视察。深圳是中国最有活力的城市，甚至是世界上最有活力的城市，房价上涨空间大，以后即使不想再深圳住了，还可以把房子卖了，这样还可以赚很多钱，可以赚的钱拿去救助有需要的人，这也是符合观音姐姐乐意助人的性格。而且按揭买房，不用一下子拿出很多钱，只要付首付就行了（音， 分析原因）</p>\n<p>你看如来十年前在深圳华侨城买的那套别墅，当时买的才500万，去年涨到5000万，后来他卖掉了，把赚到的钱拿出一部分再去投资，剩下的钱在贵州捐建了10所如来希望小学，帮助了很多孩子（按，举出案例）。</p>\n<p>所以，我认为观音应该在深圳按揭买房（揭，结论）。</p>\n<p>有些感觉了吧。为什么要有案例呢？有了案例，特别是自己或者身边朋友的例子，就更有说服性。我们再来举几个现实中的例子。</p>\n<p>例子二： 学习演讲很重要。</p>\n<p>我们来演练一下：</p>\n<p>我认为学习演讲很重要。（观）</p>\n<p>演讲能够让有一个人更加自信，演讲可以让人逻辑更加清晰、表达更加清楚，演讲也会让人沟通更加有效，促进在职场中更快升职加薪。（音）</p>\n<p>你看老庄那个小子，以前说话都脸红，还经常结结巴巴的，自从学习了演讲之后，现在说话不脸红了，还非常的流畅，居然还去参加了演讲比赛还获了奖，而且这两年在工作中每年都加薪两次，比别人多一次。（按）</p>\n<p>所以，我认为学习演讲非常重要。（揭）</p>\n<p>如果把上面的题目改一下，“老公，我要去学习演讲。”  你也是可以用上面的方法，稍微转变下:”老公，我要去学习演讲。演讲很重要，因为…….”。 同样的，“老公，我要去跑步”， 如果你用观音按揭法说一下，相信你老公会非常支持你去跑步，说不定还会跟你一起跑。 孩子想要父母给他们买东西或者做什么事，如果用这个方法，也会更容易得到父母的支持。</p>\n<p>女人最喜欢问男人什么问题呢？ 想想也知道了，就是“你爱我吗？” “你爱不爱我？“男人一般怎么回答呢？ 当然想想也是知道的，“我爱你”，“我当然爱你了”。 这样的回答很简洁，但是往往会被认为是在敷衍。如果应用观音按揭法，相信会有不一样的结果。我们来演练一下。</p>\n<p>例子三：</p>\n<p>老婆： 你爱我吗？</p>\n<p>老公： 老婆，我爱你（观）。和你在一起，我就觉得特别幸福（音）。每当我拖着疲惫的身体回到家，闻到你做的香喷喷的菜时，我的疲劳顿时都没有了。每当我遇到困难时，你总会在一旁给我鼓励。和你一起出去旅游，让我很放松。和你去的每一个地方，我都记得。尤其是那次，我们去一个小岛上，晚上两个人躺在海边的岩石上看月光….(按）所以，老婆，我爱你，我会爱你一生一世。（揭）</p>\n<p>上面的回答和简单的回答“我爱你”，哪个会更好呢？ 以后男性朋友再遇到同样的问题，就不要简单的问题“我爱你”，要具体一点，相信对方会更满意，也会更爱你。</p>\n<p>这个方法，有个变体，可以把观点变成<strong>建议</strong>。这样在职场上应用就更广泛了。你给老板的建议，如果用这个方法，会更有说服力。</p>\n<p>我们来练习一下：</p>\n<p>例子四：</p>\n<p>老板，我建议我们采用xxxxx方法。（观）</p>\n<p>我这样建议的理由是：第一点，xxxx；第二点，xxxx；第三点，xxxx。（音）</p>\n<p>著名的L公司以前也用了这个方法，后来他们的效率提高了30%，销售额增加了20%；还有H公司两年前也使用了这种方法，销售额也增加了。（按）</p>\n<p>所以，老板我建议我们可以采用xxxxx这个方案。（揭）</p>\n<p>以后给老板提建议，可以试试这个方法。</p>\n<p>说了这么多，大家也来练习一下吧：</p>\n<ol>\n<li><p>会玩很重要；</p>\n</li>\n<li><p>吃苹果好；</p>\n</li>\n<li><p>老公，我要去跑步；</p>\n</li>\n<li><p>老师，暑假不能布置作业；</p>\n</li>\n<li><p>狗是人类的好朋友。</p>\n</li>\n</ol>\n<p>记住了，遇到观点型的即兴演讲，观音菩萨就会来帮你，不用怕哦。</p>\n<h2 id=\"五-黄-金-三-点-法\"><a href=\"#五-黄-金-三-点-法\" class=\"headerlink\" title=\"五. 黄 金 三 点 法\"></a>五. 黄 金 三 点 法</h2><p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046505322138.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p>前面几篇文章都是在介绍如何更好的做即兴演讲，我们知道：</p>\n<p>应对问题和现象的即兴演讲，我们可以用“问题–原因–解决方案”；</p>\n<p>应对观点和建议的即兴演讲，我们可以用观音按揭法“观点–原因–案例–总结”；</p>\n<p>应对各种聚会场合的即兴演讲，我们可以用“感谢–回顾–愿景”；</p>\n<p>如果遇到的不是上面几种情况，或者说遇到了上面的情况，但是你不会用上面的方法，还可以怎么办呢？</p>\n<p>别怕，最后再教大家一个即兴演讲的终极大招： 黄金三点法 。</p>\n<p>黄金三点法，这<strong>是一种比较简便的语言组织方法，可以使你在说明情况或表明态度的时候，思路更加清晰。它借助数词或序数词区分讲话的内容，即在讲话中围绕自己要表达的中心意思，运用“1，2，3“数词或，”第一、第二、第三”，“首先、其次、然后”等序数词来表达，这样讲话，让听众听起来感觉既条理清晰，又简洁明了</strong>。那又为什么是三点而不是四点五点六点呢？说多了呢，别人记不住嘛；说少了呢，又显得没水平啦。</p>\n<p>要是万一真的说不到三点呢？那也没关系，把<strong>前面的第一点和第二点结合一起就可以是第三点了，而且往往有意想不到的效果</strong>（笑果）。比如，有人问你，如何学好演讲？你可以说：第一点，坚持，坚持不懈的练习。第二点，不要脸，只要有上台演讲的机会就不要错过，厚着脸皮上台，管他讲得好不好，先讲了再说。第三点….怎么也想不出来，那就把前面两点结合在一起吧，学好演讲的</p>\n<p>第三点，坚持不要脸。</p>\n<p>如果你细心观察，就会发现，中国的官场最喜欢且最擅长用“黄金三点法”，最著名的就是“三个代表”。某某会场上，邀请领导讲话，领导通常会说“下面，我主要讲三点….”,”我补充三点….”, “我对大家有三个期望….”</p>\n<p>“黄金三点法”在什么场合应用比较多呢？在工作生活和社交中，让你说感受，谈分享或者发表见解的时候就可以经常用到。</p>\n<p>例子一：  比如你去参加一个讲座，一个课程，一次活动等等，很可能会被问到，“你对这次活动的感受如何？” 估计你会回答“很好很不错啊“。如果你这样回答也没错，因为大部分人也是这么回答的，当然你的回答也会跟大部分人一样很快被人遗忘。就拿参加菲诗国演讲来练习吧，主持人问你，“参加完菲诗国演讲你的感受如何？”</p>\n<p>第一种回答“很好很不错啊”，然后就没有然后了。</p>\n<p>第二种应用“黄金三点法”的回答：</p>\n<p>我觉得菲诗国演讲很不错，参加完我有三点收获：第一，我变自信了，现在我在台上也不怕了，而且敢于看台下的任何一个人，还对着刚才那个帅哥抛了一个媚眼；第二，我的演讲更有技巧了，不仅内容更有逻辑，舞台的呈现也更加多彩，学会了用手势、眼神、表情、舞台移动和声音的抑扬顿挫；第三，我还结交到了一帮志同道合且都积极向上的朋友。</p>\n<p>上面的两种回答，哪一种回答更让人印象深刻呢？<strong>用“黄金三点法”来分享，别人会觉得你讲话很有逻辑。</strong></p>\n<p>例子二：  你去参加各种活动，很可能要被叫去做自我介绍。这时候你也可以应用“黄金三点论”来介绍自己。</p>\n<p>大部分人的第一种介绍可能是像这样的：“大家好，我是老庄，我喜欢跑步，健身和演讲，很高兴认识大家。”这样的介绍也没问题，只是不容易让人记住。</p>\n<p>利用“黄金三点法”的自我介绍：大家好，我是老庄，老子的老，庄子的庄。我有三个标签：第一个标签“跑步”， 我从小就喜欢跑步，到现在已经能够跑了二十多年了，从2007年开始跑马拉松，到现在也将近跑了十年的马拉松；第二个标签“健身”，我很喜欢健身，也差不多健身二十多年了，小学的时候我就又六块腹肌，现在还坚持健身；第三个标签“演讲”，我很喜欢演讲，我不仅喜欢演讲，现在还辅导别人更好的做演讲。很高兴在这里认识大家，希望能和大家成为好朋友。</p>\n<p>两种自我介绍，哪一种更容易让人记住呢？用三个标签或者三个爱好或者三个特点来介绍自己，让别人更容易记住你。</p>\n<p>例子三： 在街头上被记者问到，你对某某现象有何看法？  这时候“黄金三点论”也很好用。</p>\n<p>比如， CNN记者用中文问你，“你对papi酱等网红有何看法？”</p>\n<p>不用多想，可以直接用“黄金三点法”张口就说： </p>\n<p>我对此有三点看法：</p>\n<p>首先，我很喜欢papi酱，特别喜欢她吐槽各种社会现象，可逗可好玩了； </p>\n<p>其次，网红的出现，说明互联网的力量和影响力越来越强大； </p>\n<p>最后，网红的出现，给了个体更多展现自我的机会，当然也是成名的机会，以往只有少部分掌握资源或者有关系的人才能出名，现在普通人也可以有利用互联网成名的机会，好得很。</p>\n<p><strong>“黄金三点法”在各种聚会场合也是很好用的</strong>，前面我们介绍了聚会场合的万能公式“感谢–回顾–愿景”，你要是一时想不起来，就可以用“黄金三点论”。比如，你去参加朋友的婚礼，被主持人邀请上去讲话：</p>\n<p>在这里，我送上三个祝福：第一个祝福，祝福新郎新娘新婚快乐，百年好合，能够相濡以沫，执子之手，与子偕老；第二个祝福，祝福新郎新娘早生贵子，现在政策也放开了，赶紧生一对好儿女；第三个祝福，祝福在场的所有朋友们，都能够幸福快乐！</p>\n<p>刚才用到了三个“祝福”，这也是一种提炼法，比简单说“三点”更有功力。常用的三点提炼法还有“三个务必”“三个坚持”“三个准备”“三个执行”“三个代表”等等。</p>\n<p>比三点提炼法更需要功力的是<strong>形象提炼法，用比喻的方法来说明自己的观点</strong>。拿上面的例子一来练习，主持人问你，“参加完菲诗国演讲你的感受如何？”</p>\n<p>你可以说“参加菲诗国演讲后，我遇到了张学友：张，我变得张口就敢讲话了；学，我学到了很有演讲的技巧；友，我认识了一帮积极上进的好朋友。“</p>\n<p>这里的“张学友”就是一种形象提炼法，同样是说三点，但是这种方法相比会更加让人印象深刻。</p>\n<p>黄金三点法，常用的套路有：</p>\n<p>.  我有三点收获；</p>\n<ol start=\"2\">\n<li><p>我想发表三个看法；</p>\n</li>\n<li><p>我给大家讲三个故事；</p>\n</li>\n<li><p>我就三方面来谈一下自己的心得；</p>\n</li>\n<li><p>我们的任务是分三步走；</p>\n</li>\n<li><p>我们目前有三个急需要解决的问题；</p>\n</li>\n<li><p>我想从三方面进行阐述；</p>\n</li>\n<li><p>我想给你三个建议</p>\n</li>\n</ol>\n<h2 id=\"六-总-结\"><a href=\"#六-总-结\" class=\"headerlink\" title=\"六. 总 结\"></a>六. 总 结</h2><p>最后总结一下：</p>\n<p><strong>一, 散点联想法</strong>可以用来锻炼语言的组织能力和联想能力及想象能力；</p>\n<p><strong>二，“问题–原因–解决方案”</strong>可以用来应对问题和现象的即兴演讲；</p>\n<p><strong>三，观音按揭法“观点–原因–案例–总结”</strong>可以用来应对观点和建议的即兴演讲；</p>\n<p><strong>四， “感谢–回顾–愿景”</strong>可以在各种聚会场合的即兴演讲中使用；</p>\n<p><strong>五，黄金三点法</strong>可以用在说感受，谈分享或者发表见解的时候使用以及上面的方法忘记的时候用。</p>\n<p>怎么样，是不是不再那么害怕即兴演讲了？</p>\n","raw":null,"categories":[{"name":"演讲","path":"api/categories/演讲.json"}],"tags":[{"name":"演讲","path":"api/tags/演讲.json"},{"name":"提升自我","path":"api/tags/提升自我.json"}]},{"title":"为什么说90后已经不想结婚了","slug":"why_90_not_marry","date":"2018-03-27T15:20:19.000Z","updated":"2022-12-01T01:32:39.787Z","comments":true,"top":null,"path":"api/articles/why_90_not_marry.json","excerpt":" [Figure] 2018年，第一批90后正式跨入28岁。90后出道早，10年前江湖就有他们风光无限的身影。但按照教育时间表，大多数90后，一年不耽误地读完硕士，现在也不过是刚刚走向社会，参加工作第三年，具有自主意识和自由选择的人生刚刚开始。","keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046785081661.jpg","content":"<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046785303203.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"><br>2018年，第一批90后正式跨入28岁。</p>\n<p>90后出道早，10年前江湖就有他们风光无限的身影。但按照教育时间表，大多数90后，一年不耽误地读完硕士，现在也不过是刚刚走向社会，参加工作第三年，具有自主意识和自由选择的人生刚刚开始。</p>\n<a id=\"more\"></a>\n<p>前天一个大叔忧心忡忡地对我说，听说现在90后都不想结婚了，不结婚、不生孩子，国家人口老龄化越来越严重，你们媒体人是不是应该呼吁一下？</p>\n<p>我理解他爱国心切，但不同意他对90后的理解与绑架。</p>\n<p>首先，国家可以通过放开单身生育解决问题；其次，90后现在不想结婚，不意味着他们会一辈子选择单身。</p>\n<p>结婚生孩子应该是一个人心智成熟之后的主动选择，而不是被各种压力与责任绑架的结果。我在结婚前5年，信誓旦旦地觉得自己会丁克，到了30岁，忽然产生了强烈的生育渴望，后来还一鼓作气生了二胎，没有纠结没有抱怨，毕竟是自己想清楚的事。</p>\n<p>小到衣服，大到婚姻，你不想要，只说明它暂时不适合你。</p>\n<p>90后根本还没到应该结婚的年龄，凭什么要想结婚呢？</p>\n<p>2013年的一项调查显示，法国人首婚平均年龄为男性32.3岁，女性30.5岁。比30年前，晚了7年多。同年，日本女性的平均首婚年龄为30.3岁，到了2017年，日本女性的平均首婚年龄已经提高到33岁。</p>\n<p>对于90后来说，晚婚是必然。</p>\n<p>长辈认为应该结婚的年龄，他们很多人刚从学校毕业，或者还在继续深造。中国家长的认真负责和中国教育的以学为本，造成了90后在生活方面的普遍晚熟。</p>\n<p>二十六七岁的他们，还不知道生活是什么，也不知道自己将来会做什么，在哪里居住。</p>\n<p>各种不确定性，使90后，尤其大城市的90后，根本没办法考虑结婚问题。</p>\n<p>随着医疗技术的发展，女性生育年龄红杠已经从35岁抬高到了40岁。这对于女性无疑是个喜讯。她们终于可以先实现梦想再结婚，而不必匆匆忙忙把自己嫁了。</p>\n<p>与80后相比，90后更加现实，为自己负责的意念更强。10年前，80后轻意相信了老妈逼婚时说的，你生了孩子我帮你带，你该怎么过还是怎么过，一点儿也不耽误，现在的90后对此就十分冷静了。</p>\n<p>我家邻居的孩子92年出生，在上海工作。去年春节带男朋友回来见家长。他父母以为这是要结婚的节奏，她却说：“见家长不意味着结婚。我希望你们见过我历任男朋友，这是信任。”</p>\n<p>父母让她赶紧结婚生孩子，生了孩子放在武汉，她直接怼回去：“如果我自己生，就一定要自己带。不然我哪是生孩子啊，是给你们生了个玩具。”</p>\n<p>她妈跟我抱怨，怕她以后嫁不出去，也生不出孩子，可她今年还没满26岁，离她父母担心的那种状态，至少还有10年。</p>\n<p>10年，对于学生，只是小学到初中，但对于成年人，可能意味着翻天覆地的变化。足够李安从一文不名，到拿奥斯卡；腾讯从刚刚注册公司的小不点，成长为美国《财富》杂志评选出的“全球最受尊敬50家公司”。</p>\n<p>美国长大的华人姑娘陈愉写过一本有争议的书：《30岁前别结婚》。陈愉31岁当选为洛衫矶市市长，37岁结婚，如今是两个孩子的母亲。</p>\n<p>以在国外成长的华人眼光来看，她觉得中国女性活得太紧凑了。22岁甚至25岁之前，受父母、老师的管束。刚出校门没两年，就开始忙着结婚生孩子，受丈夫、孩子、传统观念的管束。</p>\n<p>“她们还没弄懂自己，怎么可能找到懂自己的男人，进而去懂自己的孩子？”</p>\n<p>尽管有人觉得，“30岁以前不结婚”与“30岁以前一定要结婚”同样是一种年龄绑架，但我们必须承认，人的成长需要时间。</p>\n<p>如果除开父母的帮助，有多少年轻人可以在30岁以前积累到足够的心智与经济实力，去应付婚姻生活？</p>\n<p>而一定要父母帮助才能维持的婚姻，70后和80后已经暴露出太多问题，包括已婚人士的超低幸福感、居高不下的离婚率和出轨率，以及婆媳矛盾这种具有中国特色的社会癌。</p>\n<p>中国传统文化中，人的生存意义似乎只有两个：成家、业立。如果你不能立业，就早点结婚生孩子。既不成家，又不业立，是废材。</p>\n<p>但90后不这么认为。</p>\n<p>我们团队的90后被父母逼婚的时候，父亲直接撂下狠话：“你不结婚也成不了董明珠”。</p>\n<p>她不解地对我说：“我干嘛非成董明珠啊。我只想多过几年自由自在的生活，多谈几场恋爱，有问题吗？”</p>\n<p>当然没问题。成功跟功成名就本来就是两个概念。与功成名就相比，成功简单和重要得多，它是一个人按照个人意愿，活成自己。</p>\n<p>“把时间浪费在博得别人爱戴上，你会成为世界上最受人爱戴的死人。”美剧《权利的游戏》的这句台词，在90后中深入人心。</p>\n<p>一个研究中国文化的法国朋友问我，你们中国父母为什么在子女结婚生孩子方面，紧迫感那么强，是不是他们活得太无聊了？</p>\n<p>我不愿意这样想。90后的父母，也不过是离我们并不遥远的60后，70后，别忘了，60后的马东现在是90后的意见领袖。</p>\n<p>传统中国人，大约心里都有一种对于“圆满”的执念。为人父母后，也希望自己的子女，人生是圆满的。上大学、工作、结婚、生孩子，一样都不少。</p>\n<p>可惜，他们的孩子，眼里圆满却是，你不一定什么都要经历，但你所经历的，一定是你自愿选择的。</p>\n<p>正如马东所说：“生活的乐趣就是尽力而为。”</p>\n","raw":null,"categories":[{"name":"随笔","path":"api/categories/随笔.json"}],"tags":[{"name":"随笔","path":"api/tags/随笔.json"}]},{"title":"Java使用mpxj导入.mpp格式的Project文件（甘特图）","slug":"java-read-mpp-file","date":"2018-01-18T14:00:00.000Z","updated":"2022-12-01T01:32:39.787Z","comments":true,"top":null,"path":"api/articles/java-read-mpp-file.json","excerpt":" [Figure] 最近换工作了，主要的项目都是企业内部为支撑的管理平台，刚入入职没多久，遇到了一个需求，就是导入微软的Project文件，踩过不少坑，所以记录一下，后续还有从数据库导出Project引导文件，也就是xml文件","keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046772682398.jpg","content":"<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046772877237.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<blockquote>\n<p>最近换工作了，主要的项目都是企业内部为支撑的管理平台，刚入入职没多久，遇到了一个需求，就是导入微软的Project文件，踩过不少坑，所以记录一下，后续还有从数据库导出Project引导文件，也就是xml文件</p>\n</blockquote>\n<a id=\"more\"></a>\n\n<p><img    class=\"lazyload\" data-original=\"http://img.blog.csdn.net/20180117180051197?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvV2ludGVyX2NoZW4wMDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">这里写图片描述</span></p>\n<h2 id=\"依赖\"><a href=\"#依赖\" class=\"headerlink\" title=\"依赖\"></a>依赖</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">&lt;!-- 读取project文件 --&gt;<br>&lt;dependency&gt;<br>\t&lt;groupId&gt;net.sf.mpxj&lt;&#x2F;groupId&gt;<br>\t&lt;artifactId&gt;mpxj&lt;&#x2F;artifactId&gt;<br>\t&lt;version&gt;7.1.0&lt;&#x2F;version&gt;<br>&lt;&#x2F;dependency&gt;<br></code></pre></td></tr></table></figure>\n<h2 id=\"代码\"><a href=\"#代码\" class=\"headerlink\" title=\"代码\"></a>代码</h2><p> 博主使用的读取方式是递归读取的，无论Project文件中的任务有多少层，都可以读到，好了，直接看代码，注意看注释：</p>\n<h3 id=\"核心方法\"><a href=\"#核心方法\" class=\"headerlink\" title=\"核心方法\"></a>核心方法</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><br><span class=\"hljs-meta\">@Transactional</span><br>   <span class=\"hljs-meta\">@Override</span><br>   <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">readMmpFileToDB</span><span class=\"hljs-params\">(File file)</span> </span>&#123;<span class=\"hljs-comment\">//如果读取的是MultipartFile，那么直接使用获取InputStream即可</span><br>       <span class=\"hljs-keyword\">try</span>&#123;<br>       \t<span class=\"hljs-comment\">//这个是读取文件的组件</span><br>           MPPReader mppRead = <span class=\"hljs-keyword\">new</span> MPPReader();<br>           <span class=\"hljs-comment\">//注意，如果在这一步出现了读取异常，肯定是版本不兼容，换个版本试试</span><br>           ProjectFile pf = mppRead.read(file);<br>           <span class=\"hljs-comment\">//从文件中获取的任务对象</span><br>           List&lt;Task&gt; tasks = pf.getChildTasks();<br>           <span class=\"hljs-comment\">//这个可以不用，这个list只是我用来装下所有的数据，如果不需要可以不使用</span><br>           List&lt;Project&gt; proList = <span class=\"hljs-keyword\">new</span> LinkedList&lt;&gt;();<br>           <span class=\"hljs-comment\">//这个是用来封装任务的对象，为了便于区别，初始化批次号，然后所有读取的数据都需要加上批次号</span><br>           Project pro = <span class=\"hljs-keyword\">new</span> Project();<br>           pro.setBatchNum(StringUtils.UUID());<span class=\"hljs-comment\">//生成批次号UUID</span><br>           <span class=\"hljs-comment\">//这个方法是一个递归方法</span><br>           getChildrenTask(tasks.get(<span class=\"hljs-number\">0</span>), pro ,proList, <span class=\"hljs-number\">0</span>);<br>       &#125;<span class=\"hljs-keyword\">catch</span> (MPXJException e) &#123;<br>           logger.error(e.getMessage());<br>           <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> RuntimeException();<br>       &#125; <span class=\"hljs-keyword\">catch</span> (Exception e) &#123;<br>           logger.error(e.getMessage());<br>           <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> RuntimeException();<br>       &#125;<br>   &#125;<br></code></pre></td></tr></table></figure>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"> <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 这个方法是一个递归</span><br><span class=\"hljs-comment\"> * 方法的原理：进行读取父任务，如果下一层任务还是父任务，那么继续调用当前方法，如果到了最后一层，调用另外一个读取底层的方法</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> task</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> project</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> list</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@param</span> levelNum</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">getChildrenTask</span><span class=\"hljs-params\">(Task task, Project project, List&lt;Project&gt; list, <span class=\"hljs-keyword\">int</span> levelNum)</span></span>&#123;<br>        <span class=\"hljs-keyword\">if</span>(task.getResourceAssignments().size() == <span class=\"hljs-number\">0</span>)&#123;<span class=\"hljs-comment\">//这个判断是进行是否是最后一层任务的判断==0说明是父任务</span><br>            levelNum ++;<span class=\"hljs-comment\">//层级号需要增加，这个只是博主用来记录该层的层级数</span><br>            List&lt;Task&gt; tasks = task.getChildTasks();<span class=\"hljs-comment\">//继续获取子任务</span><br>            <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; tasks.size(); i++) &#123;<span class=\"hljs-comment\">//该循环是遍历所有的子任务</span><br>                <span class=\"hljs-keyword\">if</span>(tasks.get(i).getResourceAssignments().size() == <span class=\"hljs-number\">0</span>)&#123;<span class=\"hljs-comment\">//说明还是在父任务层</span><br>                    Project pro = <span class=\"hljs-keyword\">new</span> Project();<br>                    <span class=\"hljs-keyword\">if</span> (project.getProjId() != <span class=\"hljs-keyword\">null</span>)&#123;<span class=\"hljs-comment\">//说明不是第一次读取了，因为如果是第一层，那么还没有进行数据库的添加，没有返回主键Id</span><br>                        pro.setParentId(project.getProjId());<span class=\"hljs-comment\">//将上一级目录的Id赋值给下一级的ParentId</span><br>                    &#125;<br>                    pro.setBatchNum(project.getBatchNum());<span class=\"hljs-comment\">//批量号</span><br>                    pro.setImportTime(<span class=\"hljs-keyword\">new</span> Date());<span class=\"hljs-comment\">//导入时间</span><br>                    pro.setLevel(levelNum);<span class=\"hljs-comment\">//层级</span><br>                    pro.setTaskName(tasks.get(i).getName());<span class=\"hljs-comment\">//这个是获取文件中的“任务名称”列的数据</span><br>                    pro.setDurationDate(tasks.get(i).getDuration().toString());<span class=\"hljs-comment\">//获取的是文件中的“工期”</span><br>                    pro.setStartDate(tasks.get(i).getStart());<span class=\"hljs-comment\">//获取文件中的 “开始时间”</span><br>                    pro.setEndDate(tasks.get(i).getFinish());<span class=\"hljs-comment\">//获取文件中的 “完成时间”</span><br>                    pro.setResource(tasks.get(i).getResourceGroup());<span class=\"hljs-comment\">//获取文件中的 “资源名称”</span><br>                    <span class=\"hljs-keyword\">this</span>.addProjectInfo(pro);<span class=\"hljs-comment\">//将该条数据添加到数据库，并且会返回主键Id，用做子任务的ParentId,这个需要在mybatis的Mapper中设置</span><br>                    getChildrenTask(tasks.get(i), pro,list,levelNum);<span class=\"hljs-comment\">//继续进行递归，当前保存的只是父任务的信息</span><br>                &#125;<span class=\"hljs-keyword\">else</span>&#123;<span class=\"hljs-comment\">//继续进行递归</span><br>                    getChildrenTask(tasks.get(i), project, list, levelNum);<br>                &#125;<br>            &#125;<br>        &#125;<span class=\"hljs-keyword\">else</span>&#123;<span class=\"hljs-comment\">//说明已经到了最底层的子任务了，那么就调用进行最底层数据读取的方法</span><br>            <span class=\"hljs-keyword\">if</span> (project.getProjId() != <span class=\"hljs-keyword\">null</span>)&#123;<br>                getResourceAssignment(task, project, list, levelNum);<br>            &#125;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">getResourceAssignment</span><span class=\"hljs-params\">(Task task, Project project, List&lt;Project&gt; proList, <span class=\"hljs-keyword\">int</span> levelNum)</span></span>&#123;<br>    List&lt;ResourceAssignment&gt; list = task.getResourceAssignments();<span class=\"hljs-comment\">//读取最底层的属性</span><br>    ResourceAssignment rs = list.get(<span class=\"hljs-number\">0</span>);<br>    Project pro = <span class=\"hljs-keyword\">new</span> Project();<br>    pro.setTaskName(task.getName());<br>    pro.setParentId(project.getProjId());<br>    pro.setLevel(levelNum);<br>    pro.setImportTime(<span class=\"hljs-keyword\">new</span> Date());<br>    pro.setBatchNum(project.getBatchNum());<br>    pro.setDurationDate(task.getDuration().toString());<br>    pro.setStartDate(rs.getStart());<span class=\"hljs-comment\">//注意，这个从ResourceAssignment中读取</span><br>    pro.setEndDate(rs.getFinish());<span class=\"hljs-comment\">//同上</span><br>    String resource = <span class=\"hljs-string\">\"\"</span>;<br>    <span class=\"hljs-keyword\">if</span>(list.size() &gt; <span class=\"hljs-number\">1</span>)&#123;<br>        <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; list.size(); i++) &#123;<br>            <span class=\"hljs-keyword\">if</span> (list.get(i).getResource() != <span class=\"hljs-keyword\">null</span>)&#123;<br>                <span class=\"hljs-keyword\">if</span>(i &lt; list.size() - <span class=\"hljs-number\">1</span>)&#123;<br>                    resource += list.get(i).getResource().getName() + <span class=\"hljs-string\">\",\"</span>;<br>                &#125;<span class=\"hljs-keyword\">else</span>&#123;<br>                    resource += list.get(i).getResource().getName();<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<span class=\"hljs-keyword\">else</span>&#123;<br><br>        <span class=\"hljs-keyword\">if</span>(list.size() &gt; <span class=\"hljs-number\">0</span> &amp;&amp; list.get(<span class=\"hljs-number\">0</span>).getResource() != <span class=\"hljs-keyword\">null</span>)&#123;<br>            resource = list.get(<span class=\"hljs-number\">0</span>).getResource().getName();<br>        &#125;<br>    &#125;<br>    <span class=\"hljs-keyword\">if</span>(!StringUtils.isEmpty(resource))&#123;<br>        pro.setResource(resource);<br>    &#125;<br>    <span class=\"hljs-keyword\">this</span>.addProjectInfo(pro);<span class=\"hljs-comment\">//将数据保存在数据库中,同样会返回主键</span><br>    proList.add(pro);<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n<h3 id=\"封装对象\"><a href=\"#封装对象\" class=\"headerlink\" title=\"封装对象\"></a>封装对象</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><br><span class=\"hljs-keyword\">package</span> com.winter.model;<br><br><span class=\"hljs-keyword\">import</span> java.util.Date;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * Project文件封装类</span><br><span class=\"hljs-comment\"> * Created By Donghua.Chen on  2018/1/9</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Project</span> </span>&#123;<br>    <span class=\"hljs-comment\">/* 自增主键Id */</span><br>    <span class=\"hljs-keyword\">private</span> Integer projId;<br>    <span class=\"hljs-comment\">/* 上级Id */</span><br>    <span class=\"hljs-keyword\">private</span> Integer parentId;<br>    <span class=\"hljs-comment\">/* 结构层级 */</span><br>    <span class=\"hljs-keyword\">private</span> Integer level;<br>    <span class=\"hljs-comment\">/* 任务名称 */</span><br>    <span class=\"hljs-keyword\">private</span> String taskName;<br>    <span class=\"hljs-comment\">/* 工期 */</span><br>    <span class=\"hljs-keyword\">private</span> String durationDate;<br>    <span class=\"hljs-comment\">/* 开始时间 */</span><br>    <span class=\"hljs-keyword\">private</span> Date startDate;<br>    <span class=\"hljs-comment\">/* 结束时间 */</span><br>    <span class=\"hljs-keyword\">private</span> Date endDate;<br>    <span class=\"hljs-comment\">/* 前置任务ID */</span><br>    <span class=\"hljs-keyword\">private</span> Integer preTask;<br>    <span class=\"hljs-comment\">/* 资源名称 */</span><br>    <span class=\"hljs-keyword\">private</span> String resource;<br>    <span class=\"hljs-comment\">/* 导入时间 */</span><br>    <span class=\"hljs-keyword\">private</span> Date importTime;<br>    <span class=\"hljs-comment\">/* 批次号 */</span><br>    <span class=\"hljs-keyword\">private</span> String batchNum;<br><br>    <span class=\"hljs-comment\">//省略get、set方法</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"Mybatis-接口方法\"><a href=\"#Mybatis-接口方法\" class=\"headerlink\" title=\"Mybatis 接口方法\"></a>Mybatis 接口方法</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * 插入project数据</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@param</span> project</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span></span><br><span class=\"hljs-comment\">     */</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">addProjectSelective</span><span class=\"hljs-params\">(Project project)</span></span>;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"Mapper\"><a href=\"#Mapper\" class=\"headerlink\" title=\"Mapper\"></a>Mapper</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sql</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"TABLE_PROJECT\"</span>&gt;</span><br>  PROJECT<br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sql</span>&gt;</span><br><br><span class=\"hljs-comment\">&lt;!-- 插入数据之后返回主键 需要这两个配置： useGeneratedKeys=\"true\" keyProperty=\"projId\" --&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">insert</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"addProjectSelective\"</span> <span class=\"hljs-attr\">useGeneratedKeys</span>=<span class=\"hljs-string\">\"true\"</span> <span class=\"hljs-attr\">keyProperty</span>=<span class=\"hljs-string\">\"projId\"</span> <span class=\"hljs-attr\">parameterType</span>=<span class=\"hljs-string\">\"com.winter.model.Project\"</span>&gt;</span><br>    INSERT INTO<br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">include</span> <span class=\"hljs-attr\">refid</span>=<span class=\"hljs-string\">\"TABLE_PROJECT\"</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">trim</span> <span class=\"hljs-attr\">prefix</span>=<span class=\"hljs-string\">\"(\"</span> <span class=\"hljs-attr\">suffix</span>=<span class=\"hljs-string\">\")\"</span> <span class=\"hljs-attr\">suffixOverrides</span>=<span class=\"hljs-string\">\",\"</span> &gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"parentId != null\"</span>&gt;</span><br>            parentId,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"level != null\"</span>&gt;</span><br>            level,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"taskName != null\"</span>&gt;</span><br>            taskName,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"durationDate != null\"</span>&gt;</span><br>            durationDate,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"startDate != null\"</span>&gt;</span><br>            startDate,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"endDate != null\"</span>&gt;</span><br>            endDate,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"preTask != null\"</span>&gt;</span><br>            preTask,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"resource != null\"</span>&gt;</span><br>            resource,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"importTime != null\"</span>&gt;</span><br>            importTime,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"importTime != null\"</span>&gt;</span><br>            batchNum,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">trim</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">trim</span> <span class=\"hljs-attr\">prefix</span>=<span class=\"hljs-string\">\"values (\"</span> <span class=\"hljs-attr\">suffix</span>=<span class=\"hljs-string\">\")\"</span> <span class=\"hljs-attr\">suffixOverrides</span>=<span class=\"hljs-string\">\",\"</span> &gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"parentId != null\"</span>&gt;</span><br>            #&#123;parentId, jdbcType=INTEGER&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"level != null\"</span>&gt;</span><br>            #&#123;level, jdbcType=INTEGER&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"taskName != null\"</span>&gt;</span><br>            #&#123;taskName, jdbcType=VARCHAR&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"durationDate != null\"</span>&gt;</span><br>            #&#123;durationDate, jdbcType=VARCHAR&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"startDate != null\"</span>&gt;</span><br>            #&#123;startDate, jdbcType=DATE&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"endDate != null\"</span>&gt;</span><br>            #&#123;endDate, jdbcType=DATE&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"preTask != null\"</span>&gt;</span><br>            #&#123;preTask, jdbcType=INTEGER&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"resource != null\"</span>&gt;</span><br>            #&#123;resource, jdbcType=VARCHAR&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"importTime != null\"</span>&gt;</span><br>            #&#123;importTime, jdbcType=DATE&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"batchNum != null\"</span>&gt;</span><br>            #&#123;batchNum, jdbcType=VARCHAR&#125;,<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">trim</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">insert</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"效果\"><a href=\"#效果\" class=\"headerlink\" title=\"效果\"></a>效果</h2><p><img    class=\"lazyload\" data-original=\"http://img.blog.csdn.net/20180117180307631?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvV2ludGVyX2NoZW4wMDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">这里写图片描述</span></p>\n<h2 id=\"拓展\"><a href=\"#拓展\" class=\"headerlink\" title=\"拓展\"></a>拓展</h2><p>当然，还有很多自定义的字段读取，如果有需要可以联系我，或者看官方文档<br>email：<a href=\"mailto:1085143002@qq.com\">1085143002@qq.com</a></p>\n<h2 id=\"相关资源\"><a href=\"#相关资源\" class=\"headerlink\" title=\"相关资源\"></a>相关资源</h2><ul>\n<li>mpxj官方API文档：<a href=\"http://www.mpxj.org/apidocs/index.html\" target=\"_blank\" rel=\"noopener\">http://www.mpxj.org/apidocs/index.html</a></li>\n<li>项目源码：<a href=\"https://github.com/WinterChenS/springboot-mybatis-demo\" target=\"_blank\" rel=\"noopener\">https://github.com/WinterChenS/springboot-mybatis-demo</a></li>\n<li>导入模板在源码的file文件夹中，sql在sql文件夹中</li>\n</ul>\n","raw":null,"categories":[{"name":"java","path":"api/categories/java.json"}],"tags":[{"name":"java","path":"api/tags/java.json"}]},{"title":"Hibernate 自定义查询sql 并使用自定义对象接收查询结果","slug":"hibernate-sql","date":"2018-01-18T13:50:00.000Z","updated":"2022-12-01T01:32:39.787Z","comments":true,"top":null,"path":"api/articles/hibernate-sql.json","excerpt":" [Figure] 在很多的生产中，hibernate并不能满足我们所有的开发需求，比如，很多表的联合查询，并且查询之后的各种结果封装在自定义的dto对象中，那么我们就需要使用自定义的sql进行查询了，好了，开始我们新的旅程吧。","keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046767188692.jpg","content":"<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046767443548.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<blockquote>\n<p>在很多的生产中，hibernate并不能满足我们所有的开发需求，比如，很多表的联合查询，并且查询之后的各种结果封装在自定义的dto对象中，那么我们就需要使用自定义的sql进行查询了，好了，开始我们新的旅程吧。</p>\n</blockquote>\n<a id=\"more\"></a>\n<h3 id=\"需求：\"><a href=\"#需求：\" class=\"headerlink\" title=\"需求：\"></a>需求：</h3><ul>\n<li>n张表进行联合查询</li>\n<li>将结果封装在一个DTO的对象中</li>\n</ul>\n<h3 id=\"代码：\"><a href=\"#代码：\" class=\"headerlink\" title=\"代码：\"></a>代码：</h3><p><strong>本文中使用了一个很复杂的联合查询的sql，所以大家并不需要了解详细，只需要只是我们进行一个很复杂的多张表进行联合查询的操作，最后将结果使用自定义的dto对象接收即可</strong></p>\n<h4 id=\"SQL\"><a href=\"#SQL\" class=\"headerlink\" title=\"SQL\"></a>SQL</h4><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">SELECT</span><br>\tp9.projectId,<br>\tp9.fenxiaoMoney,<br>\tp9.shopCount<br><span class=\"hljs-keyword\">FROM</span><br>\t(<br>\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\tp8.projectId,<br>\t\t\tp8.fenxiaoMoney,<br>\t\t\t<span class=\"hljs-keyword\">count</span>(ic.inviteByPerson) shopCount<br>\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t(<br>\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\tp7.projectId,<br>\t\t\t\tp7.fenxiaoMoney<br>\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t(<br>\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\tpp.projectId,<br>\t\t\t\t\t\tg.fenxiaoMoney<br>\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t(<br>\t\t\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\t\t\tp6.projectId<br>\t\t\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t\t\t(<br>\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\t\t\t\t\tp5.projectId<br>\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t\t\t\t\t(<br>\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\t\t\t\t\t\t\tp4.projectId<br>\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t\t\t\t\t\t\t(<br>\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\tp2.projectId<br>\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t(<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tp1.projectId<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t(<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tp.projectId<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt_projects p<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">WHERE</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-number\">1</span> = <span class=\"hljs-number\">1</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> p.averagePrice &gt;= <span class=\"hljs-number\">1.0</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> p.averagePrice &lt;= <span class=\"hljs-number\">10000000000.0</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> p.saleLongitude &gt;= <span class=\"hljs-number\">1.0</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> p.saleLongitude &lt;= <span class=\"hljs-number\">10000.00</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> p.saleLatitude &gt;= <span class=\"hljs-number\">1.0</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> p.saleLatitude &lt;= <span class=\"hljs-number\">10000.0</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> p.rightsYears = <span class=\"hljs-number\">70</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> p.city <span class=\"hljs-keyword\">LIKE</span> <span class=\"hljs-string\">'%330000%'</span> <span class=\"hljs-comment\">#AND p.isOpenStatus = 1</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> p.buildArea &gt;= <span class=\"hljs-number\">1.0</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> p.buildArea &lt;= <span class=\"hljs-number\">10000000.0</span> <span class=\"hljs-comment\">#AND p.afforestationRatio = 1</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> p.projectName <span class=\"hljs-keyword\">LIKE</span> <span class=\"hljs-string\">'%%'</span> <span class=\"hljs-comment\">#AND p.projectId = '1515269bc87448b4927fa676c624c8f6'</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) p1<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">INNER</span> <span class=\"hljs-keyword\">JOIN</span> (<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttargetId<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt_tagsrelation<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">WHERE</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-number\">1</span> = <span class=\"hljs-number\">1</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> originalTags <span class=\"hljs-keyword\">LIKE</span> <span class=\"hljs-string\">'%4507%'</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> originalTags <span class=\"hljs-keyword\">LIKE</span> <span class=\"hljs-string\">'%757%'</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) t1 <span class=\"hljs-keyword\">ON</span> p1.projectId = t1.targetId<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t) p2<br>\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">INNER</span> <span class=\"hljs-keyword\">JOIN</span> (<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\th.projectId<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt_projecthouses h<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">WHERE</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\th.houseNum <span class=\"hljs-keyword\">IN</span> (<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttargetId<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tt_tagsrelation<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">WHERE</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-number\">1</span> = <span class=\"hljs-number\">1</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> originalTags <span class=\"hljs-keyword\">LIKE</span> <span class=\"hljs-string\">'%%'</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)<br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> h.houseStatus = <span class=\"hljs-number\">1</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> isOpen = <span class=\"hljs-number\">1</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t) p3 <span class=\"hljs-keyword\">ON</span> p2.projectId = p3.projectId<br>\t\t\t\t\t\t\t\t\t\t\t\t) p4<br>\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">INNER</span> <span class=\"hljs-keyword\">JOIN</span> (<br>\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\tprojectId<br>\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\tt_projecthousetypes pht<br>\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">WHERE</span><br>\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-number\">1</span> = <span class=\"hljs-number\">1</span><br>\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> pht.housType = <span class=\"hljs-string\">'三房两厅一卫'</span><br>\t\t\t\t\t\t\t\t\t\t\t) pht1 <span class=\"hljs-keyword\">ON</span> p4.projectId = pht1.projectId<br>\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">GROUP</span> <span class=\"hljs-keyword\">BY</span><br>\t\t\t\t\t\t\t\t\t\t\t\tp4.projectId<br>\t\t\t\t\t\t\t\t\t\t) p5<br>\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">INNER</span> <span class=\"hljs-keyword\">JOIN</span> (<br>\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\t\t\t\t\t\tph.projectId<br>\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t\t\t\t\t\tt_projecthouses ph<br>\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">WHERE</span><br>\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-number\">1</span> = <span class=\"hljs-number\">1</span><br>\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> (<br>\t\t\t\t\t\t\t\t\t\t\tph.houseKind = <span class=\"hljs-string\">'10'</span><br>\t\t\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">OR</span> ph.houseKind = <span class=\"hljs-string\">'0'</span><br>\t\t\t\t\t\t\t\t\t\t)<br>\t\t\t\t\t\t\t\t\t) hk <span class=\"hljs-keyword\">ON</span> p5.projectId = hk.projectId<br>\t\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">GROUP</span> <span class=\"hljs-keyword\">BY</span><br>\t\t\t\t\t\t\t\t\t\tp5.projectId<br>\t\t\t\t\t\t\t\t) p6<br>\t\t\t\t\t\t\t<span class=\"hljs-keyword\">INNER</span> <span class=\"hljs-keyword\">JOIN</span> (<br>\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">SELECT</span><br>\t\t\t\t\t\t\t\t\tapplyForPerson<br>\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">FROM</span><br>\t\t\t\t\t\t\t\t\tt_applychart<br>\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">WHERE</span><br>\t\t\t\t\t\t\t\t\tapplyByPerson = <span class=\"hljs-string\">'860635'</span><br>\t\t\t\t\t\t\t\t<span class=\"hljs-keyword\">AND</span> applyStatus = <span class=\"hljs-number\">2</span><br>\t\t\t\t\t\t\t) ap <span class=\"hljs-keyword\">ON</span> p6.projectId = ap.applyForPerson<br>\t\t\t\t\t\t) pp<br>\t\t\t\t\t<span class=\"hljs-keyword\">LEFT</span> <span class=\"hljs-keyword\">JOIN</span> t_projectguide g <span class=\"hljs-keyword\">ON</span> pp.projectId = g.projectId<br>\t\t\t\t) p7<br>\t\t) p8<br>\t\t\t<br>\t\t<span class=\"hljs-keyword\">LEFT</span> <span class=\"hljs-keyword\">JOIN</span> (<span class=\"hljs-keyword\">SELECT</span> inviteByPerson <span class=\"hljs-keyword\">FROM</span> t_invitechart <span class=\"hljs-keyword\">WHERE</span> inviteStatus = <span class=\"hljs-number\">2</span>) ic <span class=\"hljs-keyword\">ON</span> p8.projectId = ic.inviteByPerson<br>\t\t<span class=\"hljs-keyword\">GROUP</span> <span class=\"hljs-keyword\">BY</span><br>\t\t\tp8.projectId<br>\t) p9<br><span class=\"hljs-keyword\">LEFT</span> <span class=\"hljs-keyword\">JOIN</span> (<br>\t<span class=\"hljs-keyword\">SELECT</span><br>\t\tbeCollectId<br>\t<span class=\"hljs-keyword\">FROM</span><br>\t\tt_newcollectrecord<br>\t<span class=\"hljs-keyword\">WHERE</span><br>\t\tuserId = <span class=\"hljs-string\">'4e0b0089-410a-497e-8056-6190e2a183d4'</span><br>) nc <span class=\"hljs-keyword\">ON</span> p9.projectId = nc.beCollectId<br><span class=\"hljs-keyword\">GROUP</span> <span class=\"hljs-keyword\">BY</span><br>\tp9.projectId<br><span class=\"hljs-keyword\">ORDER</span> <span class=\"hljs-keyword\">BY</span><br>\tshopCount <span class=\"hljs-keyword\">DESC</span><br><span class=\"hljs-keyword\">LIMIT</span> <span class=\"hljs-number\">0</span>,<br> <span class=\"hljs-number\">10</span><br></code></pre></td></tr></table></figure>\n\n<p>从sql中可以看出我们需要查的三个参数：</p>\n<ul>\n<li>项目的Id</li>\n<li>钱的数量</li>\n<li>合作店铺的数量</li>\n</ul>\n<p>需要的额外功能：</p>\n<ul>\n<li>分页</li>\n<li>根据上面的参数进行排序</li>\n</ul>\n<h4 id=\"SQL拼接方法\"><a href=\"#SQL拼接方法\" class=\"headerlink\" title=\"SQL拼接方法\"></a>SQL拼接方法</h4><p><strong>顾名思义就是将上述的sql使用java进行拼接，因为这样便于查看和bug查找(这段并不重要)</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br><span class=\"line\">327</span><br><span class=\"line\">328</span><br><span class=\"line\">329</span><br><span class=\"line\">330</span><br><span class=\"line\">331</span><br><span class=\"line\">332</span><br><span class=\"line\">333</span><br><span class=\"line\">334</span><br><span class=\"line\">335</span><br><span class=\"line\">336</span><br><span class=\"line\">337</span><br><span class=\"line\">338</span><br><span class=\"line\">339</span><br><span class=\"line\">340</span><br><span class=\"line\">341</span><br><span class=\"line\">342</span><br><span class=\"line\">343</span><br><span class=\"line\">344</span><br><span class=\"line\">345</span><br><span class=\"line\">346</span><br><span class=\"line\">347</span><br><span class=\"line\">348</span><br><span class=\"line\">349</span><br><span class=\"line\">350</span><br><span class=\"line\">351</span><br><span class=\"line\">352</span><br><span class=\"line\">353</span><br><span class=\"line\">354</span><br><span class=\"line\">355</span><br><span class=\"line\">356</span><br><span class=\"line\">357</span><br><span class=\"line\">358</span><br><span class=\"line\">359</span><br><span class=\"line\">360</span><br><span class=\"line\">361</span><br><span class=\"line\">362</span><br><span class=\"line\">363</span><br><span class=\"line\">364</span><br><span class=\"line\">365</span><br><span class=\"line\">366</span><br><span class=\"line\">367</span><br><span class=\"line\">368</span><br><span class=\"line\">369</span><br><span class=\"line\">370</span><br><span class=\"line\">371</span><br><span class=\"line\">372</span><br><span class=\"line\">373</span><br><span class=\"line\">374</span><br><span class=\"line\">375</span><br><span class=\"line\">376</span><br><span class=\"line\">377</span><br><span class=\"line\">378</span><br><span class=\"line\">379</span><br><span class=\"line\">380</span><br><span class=\"line\">381</span><br><span class=\"line\">382</span><br><span class=\"line\">383</span><br><span class=\"line\">384</span><br><span class=\"line\">385</span><br><span class=\"line\">386</span><br><span class=\"line\">387</span><br><span class=\"line\">388</span><br><span class=\"line\">389</span><br><span class=\"line\">390</span><br><span class=\"line\">391</span><br><span class=\"line\">392</span><br><span class=\"line\">393</span><br><span class=\"line\">394</span><br><span class=\"line\">395</span><br><span class=\"line\">396</span><br><span class=\"line\">397</span><br><span class=\"line\">398</span><br><span class=\"line\">399</span><br><span class=\"line\">400</span><br><span class=\"line\">401</span><br><span class=\"line\">402</span><br><span class=\"line\">403</span><br><span class=\"line\">404</span><br><span class=\"line\">405</span><br><span class=\"line\">406</span><br><span class=\"line\">407</span><br><span class=\"line\">408</span><br><span class=\"line\">409</span><br><span class=\"line\">410</span><br><span class=\"line\">411</span><br><span class=\"line\">412</span><br><span class=\"line\">413</span><br><span class=\"line\">414</span><br><span class=\"line\">415</span><br><span class=\"line\">416</span><br><span class=\"line\">417</span><br><span class=\"line\">418</span><br><span class=\"line\">419</span><br><span class=\"line\">420</span><br><span class=\"line\">421</span><br><span class=\"line\">422</span><br><span class=\"line\">423</span><br><span class=\"line\">424</span><br><span class=\"line\">425</span><br><span class=\"line\">426</span><br><span class=\"line\">427</span><br><span class=\"line\">428</span><br><span class=\"line\">429</span><br><span class=\"line\">430</span><br><span class=\"line\">431</span><br><span class=\"line\">432</span><br><span class=\"line\">433</span><br><span class=\"line\">434</span><br><span class=\"line\">435</span><br><span class=\"line\">436</span><br><span class=\"line\">437</span><br><span class=\"line\">438</span><br><span class=\"line\">439</span><br><span class=\"line\">440</span><br><span class=\"line\">441</span><br><span class=\"line\">442</span><br><span class=\"line\">443</span><br><span class=\"line\">444</span><br><span class=\"line\">445</span><br><span class=\"line\">446</span><br><span class=\"line\">447</span><br><span class=\"line\">448</span><br><span class=\"line\">449</span><br><span class=\"line\">450</span><br><span class=\"line\">451</span><br><span class=\"line\">452</span><br><span class=\"line\">453</span><br><span class=\"line\">454</span><br><span class=\"line\">455</span><br><span class=\"line\">456</span><br><span class=\"line\">457</span><br><span class=\"line\">458</span><br><span class=\"line\">459</span><br><span class=\"line\">460</span><br><span class=\"line\">461</span><br><span class=\"line\">462</span><br><span class=\"line\">463</span><br><span class=\"line\">464</span><br><span class=\"line\">465</span><br><span class=\"line\">466</span><br><span class=\"line\">467</span><br><span class=\"line\">468</span><br><span class=\"line\">469</span><br><span class=\"line\">470</span><br><span class=\"line\">471</span><br><span class=\"line\">472</span><br><span class=\"line\">473</span><br><span class=\"line\">474</span><br><span class=\"line\">475</span><br><span class=\"line\">476</span><br><span class=\"line\">477</span><br><span class=\"line\">478</span><br><span class=\"line\">479</span><br><span class=\"line\">480</span><br><span class=\"line\">481</span><br><span class=\"line\">482</span><br><span class=\"line\">483</span><br><span class=\"line\">484</span><br><span class=\"line\">485</span><br><span class=\"line\">486</span><br><span class=\"line\">487</span><br><span class=\"line\">488</span><br><span class=\"line\">489</span><br><span class=\"line\">490</span><br><span class=\"line\">491</span><br><span class=\"line\">492</span><br><span class=\"line\">493</span><br><span class=\"line\">494</span><br><span class=\"line\">495</span><br><span class=\"line\">496</span><br><span class=\"line\">497</span><br><span class=\"line\">498</span><br><span class=\"line\">499</span><br><span class=\"line\">500</span><br><span class=\"line\">501</span><br><span class=\"line\">502</span><br><span class=\"line\">503</span><br><span class=\"line\">504</span><br><span class=\"line\">505</span><br><span class=\"line\">506</span><br><span class=\"line\">507</span><br><span class=\"line\">508</span><br><span class=\"line\">509</span><br><span class=\"line\">510</span><br><span class=\"line\">511</span><br><span class=\"line\">512</span><br><span class=\"line\">513</span><br><span class=\"line\">514</span><br><span class=\"line\">515</span><br><span class=\"line\">516</span><br><span class=\"line\">517</span><br><span class=\"line\">518</span><br><span class=\"line\">519</span><br><span class=\"line\">520</span><br><span class=\"line\">521</span><br><span class=\"line\">522</span><br><span class=\"line\">523</span><br><span class=\"line\">524</span><br><span class=\"line\">525</span><br><span class=\"line\">526</span><br><span class=\"line\">527</span><br><span class=\"line\">528</span><br><span class=\"line\">529</span><br><span class=\"line\">530</span><br><span class=\"line\">531</span><br><span class=\"line\">532</span><br><span class=\"line\">533</span><br><span class=\"line\">534</span><br><span class=\"line\">535</span><br><span class=\"line\">536</span><br><span class=\"line\">537</span><br><span class=\"line\">538</span><br><span class=\"line\">539</span><br><span class=\"line\">540</span><br><span class=\"line\">541</span><br><span class=\"line\">542</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t * 拼接Hql中的p段</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> param</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> user</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> sb</span><br><span class=\"hljs-comment\">\t */</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">jointHqlTheP</span><span class=\"hljs-params\">(ShopSearchParam param, User user, StringBuilder sb)</span></span>&#123;<br>\t\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t\t * SELECT</span><br><span class=\"hljs-comment\">\t\t\t\tp.projectId</span><br><span class=\"hljs-comment\">\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\tt_projects p</span><br><span class=\"hljs-comment\">\t\t\tWHERE</span><br><span class=\"hljs-comment\">\t\t\t\t1 = 1</span><br><span class=\"hljs-comment\">\t\t\tAND p.averagePrice &gt;= 1.0</span><br><span class=\"hljs-comment\">\t\t\tAND p.averagePrice &lt;= 10000000000.0</span><br><span class=\"hljs-comment\">\t\t\tAND p.saleLongitude &gt;= 1.0</span><br><span class=\"hljs-comment\">\t\t\tAND p.saleLongitude &lt;= 10000.00</span><br><span class=\"hljs-comment\">\t\t\tAND p.saleLatitude &gt;= 1.0</span><br><span class=\"hljs-comment\">\t\t\tAND p.saleLatitude &lt;= 10000.0</span><br><span class=\"hljs-comment\">\t\t\tAND p.rightsYears = 70</span><br><span class=\"hljs-comment\">\t\t\tAND p.city LIKE '%330000%' #AND p.isOpenStatus = 1</span><br><span class=\"hljs-comment\">\t\t\tAND p.buildArea &gt;= 1.0</span><br><span class=\"hljs-comment\">\t\t\tAND p.buildArea &lt;= 10000000.0 #AND p.afforestationRatio = 1</span><br><span class=\"hljs-comment\">\t\t\tAND p.projectName LIKE '%%' #AND p.projectId = '1515269bc87448b4927fa676c624c8f6'</span><br><span class=\"hljs-comment\">\t\t */</span><br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" p.projectId \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" t_projects p \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" WHERE \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" 1 = 1 \"</span>);<br>\t\t<span class=\"hljs-keyword\">if</span>(param.getMinAveragePrice() != <span class=\"hljs-keyword\">null</span>)&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.averagePrice &gt;= \"</span> + param.getMinAveragePrice());<br>\t\t&#125;<br>\t\t<span class=\"hljs-keyword\">if</span>(param.getMaxAveragePrice() != <span class=\"hljs-keyword\">null</span>)&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.averagePrice &lt;= \"</span> + param.getMaxAveragePrice());<br>\t\t&#125;<br>\t\t<span class=\"hljs-keyword\">if</span>(!isEmpty(param.getMinLongitudes()))&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.saleLongitude &gt;= \"</span> + param.getMinLongitudes());<br>\t\t&#125;<br>\t\t<span class=\"hljs-keyword\">if</span>(!isEmpty(param.getMaxLongitudes()))&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.saleLongitude &lt;= \"</span> + param.getMaxLongitudes());<br>\t\t&#125;<br>\t\t<span class=\"hljs-keyword\">if</span>(!isEmpty(param.getMinLatitudes()))&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.saleLatitude &gt;= \"</span> + param.getMinLatitudes());<br>\t\t&#125;<br>\t\t<span class=\"hljs-keyword\">if</span>(!isEmpty(param.getMaxLatitudes()))&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.saleLatitude &lt;= \"</span> + param.getMaxLatitudes());<br>\t\t&#125;<br>\t\t<span class=\"hljs-keyword\">if</span>(param.getRightsYears() != <span class=\"hljs-keyword\">null</span>)&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.rightsYears = \"</span> + param.getRightsYears());<br>\t\t&#125;<br>\t\t<span class=\"hljs-keyword\">if</span>(!isEmpty(param.getCityId()))&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.city LIKE '%\"</span> + param.getCityId() + <span class=\"hljs-string\">\"%'\"</span>);<br>\t\t&#125;<span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(!isEmpty(param.getCityName()))&#123;<br>\t\t\tString hql = <span class=\"hljs-string\">\"from CountryProvinceInfo where cityName = '\"</span> + param.getCityName() + <span class=\"hljs-string\">\"' and cityLevel = '市' \"</span>;<br>\t\t\tCountryProvinceInfo cp = (CountryProvinceInfo) baseDao.loadObject(hql);<br>\t\t\tString cityId = cp.getUpCityId();<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.city LIKE '%\"</span> + cityId + <span class=\"hljs-string\">\"%'\"</span>);<br>\t\t&#125;<br>\t\t<span class=\"hljs-comment\">//项目状态 在售、等待售、全部</span><br>\t\t<span class=\"hljs-keyword\">if</span>(param.getProjectStatus() != <span class=\"hljs-keyword\">null</span>)&#123;<br>\t\t\t<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.isOpenStatus = \"</span> + param.getProjectStatus());<br>\t\t&#125;<br>\t\t<span class=\"hljs-keyword\">if</span>(param.getMinBulidArea() != <span class=\"hljs-keyword\">null</span>)&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.buildArea &gt;= \"</span> + param.getMinBulidArea());<br>\t\t&#125;<br>\t\t<span class=\"hljs-keyword\">if</span>(param.getMaxBuildArea() != <span class=\"hljs-keyword\">null</span>)&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.buildArea &lt;= \"</span> + param.getMaxBuildArea());<br>\t\t&#125;<br>\t\t<span class=\"hljs-keyword\">if</span>(!isEmpty(param.getProjectName()))&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.projectName LIKE '%\"</span> + param.getProjectName() + <span class=\"hljs-string\">\"%' \"</span>);<br>\t\t&#125;<br>\t\t<span class=\"hljs-keyword\">if</span>(!isEmpty(param.getProjectId()))&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND p.projectId = '\"</span> + param.getProjectId() + <span class=\"hljs-string\">\"' \"</span>);<br>\t\t&#125;<br>\t\t<br>\t&#125;<br>\t<br>\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t * 拼接Hql的p1段 -- 项目标签过滤</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> param</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> user</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> sb</span><br><span class=\"hljs-comment\">\t */</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">jointHqlTheP1</span><span class=\"hljs-params\">(ShopSearchParam param, User user, StringBuilder sb)</span></span>&#123;<br>\t\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t\t * SELECT</span><br><span class=\"hljs-comment\">\t\t\t\tp1.projectId</span><br><span class=\"hljs-comment\">\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t(</span><br><span class=\"hljs-comment\">\t\t\t\t\t&#123;p&#125;//这个是p段</span><br><span class=\"hljs-comment\">\t\t\t\t) p1</span><br><span class=\"hljs-comment\">\t\t\tINNER JOIN (</span><br><span class=\"hljs-comment\">\t\t\t\tSELECT</span><br><span class=\"hljs-comment\">\t\t\t\t\ttargetId</span><br><span class=\"hljs-comment\">\t\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t\tt_tagsrelation</span><br><span class=\"hljs-comment\">\t\t\t\tWHERE</span><br><span class=\"hljs-comment\">\t\t\t\t\t1 = 1</span><br><span class=\"hljs-comment\">\t\t\t\tAND originalTags LIKE '%4507%'</span><br><span class=\"hljs-comment\">\t\t\t\tAND originalTags LIKE '%757%'</span><br><span class=\"hljs-comment\">\t\t\t) t1 ON p1.projectId = t1.targetId</span><br><span class=\"hljs-comment\">\t\t */</span><br>\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" p1.projectId \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" ( \"</span>);<br>\t\t<br>\t\t<span class=\"hljs-keyword\">this</span>.jointHqlTheP(param, user, sb);<span class=\"hljs-comment\">//将p加入</span><br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" ) p1 \"</span>);<br>\t\t<span class=\"hljs-keyword\">if</span>(!isEmpty(param.getpTags()))&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" INNER JOIN ( \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" targetId \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" t_tagsrelation \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" WHERE \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" 1 = 1 \"</span>);<br>\t\t\tString[] pTags = <span class=\"hljs-keyword\">this</span>.stringToArray(param.getpTags());<br>\t\t\t<span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; pTags.length; i++) &#123;<br>\t\t\t\tsb.append(<span class=\"hljs-string\">\" AND originalTags LIKE '%\"</span> + pTags[i] + <span class=\"hljs-string\">\"%' \"</span>);<br>\t\t\t&#125;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" ) t1 ON p1.projectId = t1.targetId \"</span>);<br>\t\t&#125;<br>\t\t<br>\t&#125;<br>\t<br>\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t * 拼接Hql的p2段 -- 房源标签过滤</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> param</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> user</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> sb</span><br><span class=\"hljs-comment\">\t */</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">jointHqlTheP2</span><span class=\"hljs-params\">(ShopSearchParam param, User user, StringBuilder sb)</span></span>&#123;<br>\t\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t\t * SELECT</span><br><span class=\"hljs-comment\">\t\t\t\tp2.projectId</span><br><span class=\"hljs-comment\">\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t(</span><br><span class=\"hljs-comment\">\t\t\t\t\t&#123;p1&#125;//这个是p1段</span><br><span class=\"hljs-comment\">\t\t\t\t) p2</span><br><span class=\"hljs-comment\">\t\t\tINNER JOIN (</span><br><span class=\"hljs-comment\">\t\t\t\tSELECT</span><br><span class=\"hljs-comment\">\t\t\t\t\th.projectId</span><br><span class=\"hljs-comment\">\t\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t\tt_projecthouses h</span><br><span class=\"hljs-comment\">\t\t\t\tWHERE</span><br><span class=\"hljs-comment\">\t\t\t\t\th.houseNum IN (</span><br><span class=\"hljs-comment\">\t\t\t\t\t\tSELECT</span><br><span class=\"hljs-comment\">\t\t\t\t\t\t\ttargetId</span><br><span class=\"hljs-comment\">\t\t\t\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t\t\t\tt_tagsrelation</span><br><span class=\"hljs-comment\">\t\t\t\t\t\tWHERE</span><br><span class=\"hljs-comment\">\t\t\t\t\t\t\t1 = 1</span><br><span class=\"hljs-comment\">\t\t\t\t\t\tAND originalTags LIKE '%%'</span><br><span class=\"hljs-comment\">\t\t\t\t\t)</span><br><span class=\"hljs-comment\">\t\t\t\tAND h.houseStatus = 1</span><br><span class=\"hljs-comment\">\t\t\t\tAND isOpen = 1</span><br><span class=\"hljs-comment\">\t\t\t) p3 ON p2.projectId = p3.projectId</span><br><span class=\"hljs-comment\">\t\t */</span><br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" p2.projectId \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" ( \"</span>);<br>\t\t<br>\t\t<span class=\"hljs-keyword\">this</span>.jointHqlTheP1(param, user, sb);<span class=\"hljs-comment\">//这个拼接p1</span><br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" ) p2 \"</span>);<br>\t\t<br>\t\t<span class=\"hljs-keyword\">if</span>(!isEmpty(param.gethTags()))&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" INNER JOIN ( \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" h.projectId \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" t_projecthouses h \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" WHERE \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" h.houseNum IN ( \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" targetId \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" t_tagsrelation \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" WHERE \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" 1=1 \"</span>);<br>\t\t\tString[] hTags = <span class=\"hljs-keyword\">this</span>.stringToArray(param.gethTags());<br>\t\t\t<span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; hTags.length; i++) &#123;<br>\t\t\t\tsb.append(<span class=\"hljs-string\">\" AND originalTags LIKE '%\"</span> + hTags[i] + <span class=\"hljs-string\">\"%' \"</span>);<br>\t\t\t&#125;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" ) \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND h.houseStatus = 1 \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND isOpen = 1 \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" ) p3 ON p2.projectId = p3.projectId \"</span>);<br>\t\t\t<br>\t\t&#125;<br>\t&#125;<br>\t<br>\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t * 拼接Hql的p4段 -- 房源户型</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> param</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> user</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> sb</span><br><span class=\"hljs-comment\">\t */</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">jointHqlTheP4</span><span class=\"hljs-params\">(ShopSearchParam param, User user, StringBuilder sb)</span></span>&#123;<br>\t\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t\t * SELECT</span><br><span class=\"hljs-comment\">\t\t\t\tp4.projectId</span><br><span class=\"hljs-comment\">\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t(</span><br><span class=\"hljs-comment\">\t\t\t\t\t&#123;p2&#125;//这个是p2段</span><br><span class=\"hljs-comment\">\t\t\t\t) p4</span><br><span class=\"hljs-comment\">\t\t\tINNER JOIN (</span><br><span class=\"hljs-comment\">\t\t\t\tSELECT</span><br><span class=\"hljs-comment\">\t\t\t\t\tprojectId</span><br><span class=\"hljs-comment\">\t\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t\tt_projecthousetypes pht</span><br><span class=\"hljs-comment\">\t\t\t\tWHERE</span><br><span class=\"hljs-comment\">\t\t\t\t\t1 = 1</span><br><span class=\"hljs-comment\">\t\t\t\tAND pht.housType = '三房两厅一卫'</span><br><span class=\"hljs-comment\">\t\t\t) pht1 ON p4.projectId = pht1.projectId</span><br><span class=\"hljs-comment\">\t\t\tGROUP BY</span><br><span class=\"hljs-comment\">\t\t\t\tp4.projectId</span><br><span class=\"hljs-comment\">\t\t */</span><br>\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" p4.projectId \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" ( \"</span>);<br>\t\t<br>\t\t<span class=\"hljs-keyword\">this</span>.jointHqlTheP2(param, user, sb);<br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" ) p4 \"</span>);<br>\t\t<br>\t\t<span class=\"hljs-keyword\">if</span>(!isEmpty(param.getHouseType()))&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" INNER JOIN ( \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" projectId \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" t_projecthousetypes pht \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" WHERE \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" 1 = 1 \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND pht.housType = '\"</span> + param.getHouseType() + <span class=\"hljs-string\">\"' \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" ) pht1 ON p4.projectId = pht1.projectId \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" GROUP BY \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" p4.projectId \"</span>);<br>\t\t&#125;<br>\t\t<br>\t\t<br>\t\t<br>\t&#125;<br>\t<br>\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t * 拼接Hql的p5段 -- 房源类型过滤</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> param</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> user</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> sb</span><br><span class=\"hljs-comment\">\t */</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">jointHqlTheP5</span><span class=\"hljs-params\">(ShopSearchParam param, User user, StringBuilder sb)</span></span>&#123;<br>\t\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t\t * SELECT</span><br><span class=\"hljs-comment\">\t\t\t\tp5.projectId</span><br><span class=\"hljs-comment\">\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t(</span><br><span class=\"hljs-comment\">\t\t\t\t\t&#123;p4&#125;//拼接p4段</span><br><span class=\"hljs-comment\">\t\t\t\t) p5</span><br><span class=\"hljs-comment\">\t\t\tINNER JOIN (</span><br><span class=\"hljs-comment\">\t\t\t\tSELECT</span><br><span class=\"hljs-comment\">\t\t\t\t\tph.projectId</span><br><span class=\"hljs-comment\">\t\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t\tt_projecthouses ph</span><br><span class=\"hljs-comment\">\t\t\t\tWHERE</span><br><span class=\"hljs-comment\">\t\t\t\t\t1 = 1</span><br><span class=\"hljs-comment\">\t\t\t\tAND (</span><br><span class=\"hljs-comment\">\t\t\t\t\tph.houseKind = '10'</span><br><span class=\"hljs-comment\">\t\t\t\t\tOR ph.houseKind = '0'</span><br><span class=\"hljs-comment\">\t\t\t\t)</span><br><span class=\"hljs-comment\">\t\t\t) hk ON p5.projectId = hk.projectId</span><br><span class=\"hljs-comment\">\t\t\tGROUP BY</span><br><span class=\"hljs-comment\">\t\t\t\tp5.projectId</span><br><span class=\"hljs-comment\">\t\t */</span><br>\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" p5.projectId \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" ( \"</span>);<br>\t\t<br>\t\t<span class=\"hljs-keyword\">this</span>.jointHqlTheP4(param, user, sb);<br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" ) p5 \"</span>);<br>\t\t<br>\t\t<span class=\"hljs-keyword\">if</span>(!isEmpty(param.getHouseKinds()))&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" INNER JOIN ( \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" ph.projectId \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" t_projecthouses ph \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" WHERE \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" 1 = 1 \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND ( \"</span>);<br>\t\t\tString[] kinds = <span class=\"hljs-keyword\">this</span>.stringToArray(param.getHouseKinds());<br>\t\t\t<span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; kinds.length; i++) &#123;<br>\t\t\t\t<span class=\"hljs-keyword\">if</span>(i == <span class=\"hljs-number\">0</span>)&#123;<br>\t\t\t\t\tsb.append(<span class=\"hljs-string\">\" ph.houseKind = '\"</span> + kinds[i] + <span class=\"hljs-string\">\"' \"</span>);<br>\t\t\t\t&#125;<span class=\"hljs-keyword\">else</span>&#123;<br>\t\t\t\t\tsb.append(<span class=\"hljs-string\">\" OR  ph.houseKind = '\"</span> + kinds[i] + <span class=\"hljs-string\">\"' \"</span>);<br>\t\t\t\t&#125;<br>\t\t\t&#125;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" ) \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" ) hk ON p5.projectId = hk.projectId \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" GROUP BY p5.projectId \"</span>);<br>\t\t&#125;<br>\t\t<br>\t&#125;<br>\t<br>\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t * 拼接Hql的p5段 -- 房源类型过滤</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> param</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> user</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> sb</span><br><span class=\"hljs-comment\">\t */</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">jointHqlTheP6</span><span class=\"hljs-params\">(ShopSearchParam param, User user, StringBuilder sb)</span></span>&#123;<br>\t\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t\t * SELECT</span><br><span class=\"hljs-comment\">\t\t\t\tp6.projectId</span><br><span class=\"hljs-comment\">\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t(</span><br><span class=\"hljs-comment\">\t\t\t\t\t&#123;p5&#125;//拼接p5段</span><br><span class=\"hljs-comment\">\t\t\t\t) p6</span><br><span class=\"hljs-comment\">\t\t\tINNER JOIN (</span><br><span class=\"hljs-comment\">\t\t\t\tSELECT</span><br><span class=\"hljs-comment\">\t\t\t\t\tapplyForPerson</span><br><span class=\"hljs-comment\">\t\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t\tt_applychart</span><br><span class=\"hljs-comment\">\t\t\t\tWHERE</span><br><span class=\"hljs-comment\">\t\t\t\t\tapplyByPerson = '860635'</span><br><span class=\"hljs-comment\">\t\t\t\tAND applyStatus = 2</span><br><span class=\"hljs-comment\">\t\t\t) ap ON p6.projectId = ap.applyForPerson</span><br><span class=\"hljs-comment\">\t\t */</span><br>\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" p6.projectId \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" ( \"</span>);<br>\t\t<span class=\"hljs-keyword\">this</span>.jointHqlTheP5(param, user, sb);<br>\t\tsb.append(<span class=\"hljs-string\">\" ) p6 \"</span>);<br>\t\t<br>\t\t<span class=\"hljs-keyword\">if</span>(param.getInviteStatus() != <span class=\"hljs-keyword\">null</span>)&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" INNER JOIN ( \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" applyForPerson \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" t_applychart \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" WHERE \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" applyByPerson = '\"</span> + user.getParentId() + <span class=\"hljs-string\">\"' \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" AND applyStatus = \"</span> + param.getInviteStatus());<br>\t\t\tsb.append(<span class=\"hljs-string\">\" ) ap ON p6.projectId = ap.applyForPerson \"</span>);<br>\t\t\t<br>\t\t&#125;<br>\t\t<br>\t&#125;<br>\t<br>\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t * 拼接Hql的PP段 -- 查看带看业务定义中的佣金</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> param</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> user</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> sb</span><br><span class=\"hljs-comment\">\t */</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">jointHqlThePP</span><span class=\"hljs-params\">(ShopSearchParam param, User user, StringBuilder sb)</span></span>&#123;<br>\t\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t\t * SELECT</span><br><span class=\"hljs-comment\">\t\t\t\tpp.projectId,</span><br><span class=\"hljs-comment\">\t\t\t\tg.fenxiaoMoney</span><br><span class=\"hljs-comment\">\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t(</span><br><span class=\"hljs-comment\">\t\t\t\t\t&#123;p6&#125;//拼接p6段</span><br><span class=\"hljs-comment\">\t\t\t\t) pp</span><br><span class=\"hljs-comment\">\t\t\tLEFT JOIN t_projectguide g ON pp.projectId = g.projectId</span><br><span class=\"hljs-comment\">\t\t */</span><br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" pp.projectId, \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" g.fenxiaoMoney \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" ( \"</span>);<br>\t\t<br>\t\t<span class=\"hljs-keyword\">this</span>.jointHqlTheP6(param, user, sb);<br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" ) pp \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" LEFT JOIN t_projectguide g ON pp.projectId = g.projectId \"</span>);<br>\t\t<br>\t&#125;<br>\t<br>\t<br>\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t * 拼接Hql的P7段</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> param</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> user</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> sb</span><br><span class=\"hljs-comment\">\t */</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">jointHqlTheP7</span><span class=\"hljs-params\">(ShopSearchParam param, User user, StringBuilder sb)</span></span>&#123;<br>\t\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t\t * SELECT</span><br><span class=\"hljs-comment\">\t\t\t\tp7.projectId,</span><br><span class=\"hljs-comment\">\t\t\t\tp7.fenxiaoMoney</span><br><span class=\"hljs-comment\">\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t(</span><br><span class=\"hljs-comment\">\t\t\t\t\t&#123;pp&#125;//拼接pp段</span><br><span class=\"hljs-comment\">\t\t\t\t) p7</span><br><span class=\"hljs-comment\">\t\t */</span><br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" p7.projectId, \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" p7.fenxiaoMoney \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" ( \"</span>);<br>\t\t<br>\t\t<span class=\"hljs-keyword\">this</span>.jointHqlThePP(param, user, sb);<br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" ) p7 \"</span>);<br>\t&#125;<br>\t<br>\t<br>\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t * 拼接Hql的P8段 -- 项目的合作门店数量</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> param</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> user</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> sb</span><br><span class=\"hljs-comment\">\t */</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">jointHqlTheP8</span><span class=\"hljs-params\">(ShopSearchParam param, User user, StringBuilder sb)</span></span>&#123;<br>\t\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t\t * SELECT</span><br><span class=\"hljs-comment\">\t\t\tp8.projectId,</span><br><span class=\"hljs-comment\">\t\t\tp8.fenxiaoMoney,</span><br><span class=\"hljs-comment\">\t\t\tcount(ic.inviteByPerson) shopCount</span><br><span class=\"hljs-comment\">\t\tFROM</span><br><span class=\"hljs-comment\">\t\t(</span><br><span class=\"hljs-comment\">\t\t\t&#123;p7&#125; //拼接P7段</span><br><span class=\"hljs-comment\">\t\t) p8</span><br><span class=\"hljs-comment\">\t\t\t</span><br><span class=\"hljs-comment\">\t\tLEFT JOIN t_invitechart ic ON p8.projectId = ic.inviteByPerson</span><br><span class=\"hljs-comment\">\t\tGROUP BY</span><br><span class=\"hljs-comment\">\t\t\tp8.projectId</span><br><span class=\"hljs-comment\">\t\t */</span><br>\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" p8.projectId, \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" p8.fenxiaoMoney, \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" count(ic.inviteByPerson) shopCount \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" ( \"</span>);<br>\t\t<br>\t\t<span class=\"hljs-keyword\">this</span>.jointHqlTheP7(param, user, sb);<br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" ) p8 \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" LEFT JOIN (SELECT inviteByPerson FROM t_invitechart WHERE inviteStatus = 2) ic ON p8.projectId = ic.inviteByPerson \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" GROUP BY p8.projectId \"</span>);<br>\t&#125;<br>\t<br>\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t * 拼接Hql的P9段 -- 个人是否收藏</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> param</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> user</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> sb</span><br><span class=\"hljs-comment\">\t */</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">jointHqlTheP9</span><span class=\"hljs-params\">(ShopSearchParam param, User user, StringBuilder sb, Page page)</span></span>&#123;<br>\t\t<br>\t\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t\t * SELECT</span><br><span class=\"hljs-comment\">\t\t \t*</span><br><span class=\"hljs-comment\">\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t(</span><br><span class=\"hljs-comment\">\t\t\t\t\t&#123;p8&#125;//拼接p8段</span><br><span class=\"hljs-comment\">\t\t\t\t) p9</span><br><span class=\"hljs-comment\">\t\t\tLEFT JOIN (</span><br><span class=\"hljs-comment\">\t\t\t\tSELECT</span><br><span class=\"hljs-comment\">\t\t\t\t\tbeCollectId</span><br><span class=\"hljs-comment\">\t\t\t\tFROM</span><br><span class=\"hljs-comment\">\t\t\t\t\tt_newcollectrecord</span><br><span class=\"hljs-comment\">\t\t\t\tWHERE</span><br><span class=\"hljs-comment\">\t\t\t\t\tuserId = '4e0b0089-410a-497e-8056-6190e2a183d4'</span><br><span class=\"hljs-comment\">\t\t\t) nc ON p9.projectId = nc.beCollectId</span><br><span class=\"hljs-comment\">\t\t\tGROUP BY</span><br><span class=\"hljs-comment\">\t\t\t\tp9.projectId</span><br><span class=\"hljs-comment\">\t\t\tORDER BY</span><br><span class=\"hljs-comment\">\t\t\t\tshopCount DESC</span><br><span class=\"hljs-comment\">\t\t\tLIMIT 0,</span><br><span class=\"hljs-comment\">\t\t\t 10</span><br><span class=\"hljs-comment\">\t\t */</span><br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" p9.projectId, p9.fenxiaoMoney, p9.shopCount \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\tsb.append(<span class=\"hljs-string\">\" ( \"</span>);<br>\t\t<br>\t\t<span class=\"hljs-keyword\">this</span>.jointHqlTheP8(param, user, sb);<br>\t\t<br>\t\tsb.append(<span class=\"hljs-string\">\" ) p9 \"</span>);<br>\t\t<span class=\"hljs-keyword\">if</span>(param.getIsClikeLike() != <span class=\"hljs-keyword\">null</span>)&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" LEFT JOIN ( \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" SELECT \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" beCollectId \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" FROM \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" t_newcollectrecord \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" WHERE \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" userId = '\"</span> + user.getUserId() + <span class=\"hljs-string\">\"' \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" ) nc ON p9.projectId \"</span>);<br>\t\t\t<span class=\"hljs-keyword\">if</span>(param.getIsClikeLike() == <span class=\"hljs-number\">1</span>)&#123;<span class=\"hljs-comment\">//收藏</span><br>\t\t\t\tsb.append(<span class=\"hljs-string\">\" = \"</span>);<br>\t\t\t&#125;<span class=\"hljs-keyword\">else</span>&#123;<span class=\"hljs-comment\">//未收藏</span><br>\t\t\t\tsb.append(<span class=\"hljs-string\">\" != \"</span>);<br>\t\t\t&#125;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" nc.beCollectId \"</span>);<br>\t\t\t<br>\t\t\tsb.append(<span class=\"hljs-string\">\" GROUP BY \"</span>);<br>\t\t\tsb.append(<span class=\"hljs-string\">\" p9.projectId \"</span>);<br>\t\t<br>\t\t&#125;<br>\t\t<br>\t\t<span class=\"hljs-keyword\">if</span>(!isEmpty(param.getOrderType()) &amp;&amp; param.getOrder() != <span class=\"hljs-keyword\">null</span>)&#123;<br>\t\t\t<br>\t\t\tsb.append(<span class=\"hljs-string\">\" ORDER BY \"</span>);<br>\t\t\t<span class=\"hljs-keyword\">if</span>(param.getOrderType().equals(ShopSearchConstant.ORDER_TYPE_SHOP_COUNT))&#123;<span class=\"hljs-comment\">//合作门店数量</span><br>\t\t\t\tsb.append(<span class=\"hljs-string\">\" p9.shopCount \"</span>);<br>\t\t\t&#125;<span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(param.getOrderType().equals(ShopSearchConstant.ORDER_TYPE_MONEY))&#123;<span class=\"hljs-comment\">//及时结款率  -  暂无</span><br>\t\t\t\tsb.append(<span class=\"hljs-string\">\" p9.shopCount \"</span>);<span class=\"hljs-comment\">//暂无，暂时用这个替代</span><br>\t\t\t&#125;<span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(param.getOrderType().equals(ShopSearchConstant.ORDER_TYPE_COMMISSION))&#123;<span class=\"hljs-comment\">//佣金高低</span><br>\t\t\t\tsb.append(<span class=\"hljs-string\">\" p9.fenxiaoMoney \"</span>);<br>\t\t\t&#125;<br>\t\t\tsb.append(param.getOrderType());<br>\t\t\t<span class=\"hljs-keyword\">if</span>(param.getOrder() == <span class=\"hljs-number\">0</span>)&#123;<br>\t\t\t\tsb.append(<span class=\"hljs-string\">\" DESC \"</span>);<br>\t\t\t&#125;<span class=\"hljs-keyword\">else</span>&#123;<br>\t\t\t\tsb.append(<span class=\"hljs-string\">\" ASC \"</span>);<br>\t\t\t&#125;<br>\t\t&#125;<br>\t\t<br>\t\t<span class=\"hljs-keyword\">if</span>(page != <span class=\"hljs-keyword\">null</span>)&#123;<br>\t\t\tsb.append(<span class=\"hljs-string\">\" LIMIT \"</span> + page.getStart() + <span class=\"hljs-string\">\",\"</span> + page.getLimit());<br>\t\t&#125;<br>\t\t<br>\t\t <br>\t&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"Service-层\"><a href=\"#Service-层\" class=\"headerlink\" title=\"Service 层\"></a>Service 层</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//这个方法是将反射之后得到的字段类型和字段名称进行拆分</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">invokeDtoToFieldsToArray</span><span class=\"hljs-params\">(Field[] fields, String[] colums, String[] types)</span></span>&#123;<br>\t\t<span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">0</span>; i &lt; fields.length; i++) &#123;<br>\t\t\ttypes[i] = fields[i].getType().toString().replace(<span class=\"hljs-string\">\"class java.lang.\"</span>, <span class=\"hljs-string\">\"\"</span>);<br>\t\t\tcolums[i] = fields[i].getName();<br>\t\t&#125;<br>\t&#125;<br></code></pre></td></tr></table></figure>\n\n\n<p><strong>下面的方法就是整个Service中的核心方法了，将自定义sql交给hibernate进行处理，并且使用自定义的dto对象进行封装</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//这个方法就是将sql进行查询</span><br><span class=\"hljs-meta\">@Override</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">findProjectListByShopSearchParam</span><span class=\"hljs-params\">(ShopSearchParam shopSearchParam, Page page, User user)</span> </span>&#123;<br>\t\tStringBuilder sb = <span class=\"hljs-keyword\">new</span> StringBuilder();<br>\t\t<br>\t\t<span class=\"hljs-comment\">// 利用反射获取Project组装类的所有的字段和类型</span><br>\t\tField[] fields = ProjectMapListDTO<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>.<span class=\"hljs-title\">getDeclaredFields</span>()</span>;<br>\t\tString[] colums = <span class=\"hljs-keyword\">new</span> String[fields.length];<br>\t\tString[] types = <span class=\"hljs-keyword\">new</span> String[fields.length];<br>\t\t<span class=\"hljs-keyword\">this</span>.invokeDtoToFieldsToArray(fields, colums, types);<br>\t\t<span class=\"hljs-keyword\">this</span>.jointHqlTheP9(shopSearchParam, user, sb, page);<br>\t\t<span class=\"hljs-comment\">//返回的结果</span><br>\t\tList&lt;ProjectMapTotalDTO&gt; rsList = <span class=\"hljs-keyword\">new</span> LinkedList&lt;&gt;();<br>\t\t<span class=\"hljs-comment\">//当前用户所有收藏的项目</span><br>\t\tList&lt;NewCollectRecord&gt; collList =  <span class=\"hljs-keyword\">this</span>.findNewCollectRecordByUserId(user.getUserId(), ShopSearchConstant.COLLECT_TYPE_PROJECT,<span class=\"hljs-keyword\">null</span>);<br>\t\t<span class=\"hljs-comment\">//当前门店所有的申请</span><br>\t\tList&lt;ApplyChart&gt; appList = <span class=\"hljs-keyword\">this</span>.findApplyChartsByShopId(user.getParentId(), <span class=\"hljs-keyword\">null</span>);<br>\t\t<span class=\"hljs-comment\">//---------重要---------这个就是关键方法</span><br>\t\tList&lt;ProjectMapListDTO&gt; list = baseDao.queryDTOBySql(sb.toString(), ProjectMapListDTO<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>, <span class=\"hljs-title\">colums</span>, <span class=\"hljs-title\">types</span>)</span>;<br>\t\t<br>\t\t<span class=\"hljs-comment\">//这里是工作需要，将查询出来的结果进行再次封装--看需要吧</span><br>\t\t<span class=\"hljs-comment\">//需要进行判断是否收藏和申请状态的判断</span><br>\t\t<span class=\"hljs-keyword\">for</span> (ProjectMapListDTO pd : list) &#123;<br>\t\t\t<br>\t\t\tProjectMapTotalDTO ptd = <span class=\"hljs-keyword\">new</span> ProjectMapTotalDTO();<br>\t\t\tProject project = (Project) baseDao.loadById(Project<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>, <span class=\"hljs-title\">pd</span>.<span class=\"hljs-title\">getProjectId</span>())</span>;<br>\t\t\tptd.setProject(project);<br>\t\t\tptd.setFenxiaoMoney(pd.getFenxiaoMoney());<br>\t\t\tptd.setShopCount(pd.getShopCount());<br>\t\t\t<span class=\"hljs-comment\">//判断是否已经被收藏</span><br>\t\t\t<span class=\"hljs-keyword\">boolean</span> flag = <span class=\"hljs-keyword\">false</span>;<br>\t\t\t<span class=\"hljs-keyword\">for</span>(NewCollectRecord nr : collList)&#123;<br>\t\t\t\t<span class=\"hljs-keyword\">if</span>(nr.getBeCollectId().equals(pd.getProjectId()))&#123;<br>\t\t\t\t\tflag = <span class=\"hljs-keyword\">true</span>;<br>\t\t\t\t&#125;<br>\t\t\t&#125;<br>\t\t\t<br>\t\t\t<span class=\"hljs-comment\">//查看合作关系</span><br>\t\t\t<span class=\"hljs-keyword\">for</span>(ApplyChart ac : appList)&#123;<br>\t\t\t\t<span class=\"hljs-keyword\">if</span>(pd.getProjectId().equals(ac.getApplyForPerson()))&#123;<br>\t\t\t\t\tptd.setApplyStatus(ac.getApplyStatus());<br>\t\t\t\t&#125;<br>\t\t\t&#125;<br>\t\t\t<br>\t\t\tptd.setIsLike(flag ? <span class=\"hljs-number\">1</span> : <span class=\"hljs-number\">0</span>);<br>\t\t\trsList.add(ptd);<br>\t\t&#125;<br>\t\tpage.setRoot(rsList);<br><br>\t\tList&lt;ProjectMapTotalDTO&gt; lz = <span class=\"hljs-keyword\">this</span>.findProjectListForMapNew(shopSearchParam, user);<br>\t\tpage.setTotal(lz.size());<br>\t\t<br>\t&#125;<br></code></pre></td></tr></table></figure>\n\n<p>看看DTO对象</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.sc.tradmaster.service.shop.impl.dto;<br><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ProjectMapListDTO</span> </span>&#123;<br><br>\t<span class=\"hljs-keyword\">private</span> String projectId;<br>\t<span class=\"hljs-keyword\">private</span> Double fenxiaoMoney;<br>\t<span class=\"hljs-keyword\">private</span> Integer shopCount;<br>\t<br>\t<span class=\"hljs-comment\">//省略set和get方法</span><br>\t<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h4 id=\"DAO核心方法\"><a href=\"#DAO核心方法\" class=\"headerlink\" title=\"DAO核心方法\"></a>DAO核心方法</h4><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">BaseDaoImpl</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">HibernateDaoSupport</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">BaseDao</span></span>&#123;<br><br>\t<span class=\"hljs-meta\">@Resource</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">mySessionFactory</span><span class=\"hljs-params\">(SessionFactory sf)</span></span>&#123;<br>\t\t<span class=\"hljs-keyword\">super</span>.setSessionFactory(sf);<br>\t&#125;<br>\t<br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t * 执行sql组装DTO对象集合</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> sql</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> clazz</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@return</span></span><br><span class=\"hljs-comment\">\t */</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> List <span class=\"hljs-title\">queryDTOBySql</span><span class=\"hljs-params\">(String sql,Class clazz,String[] colums,String[] types)</span> </span>&#123;    <br>\t\tSession session = <span class=\"hljs-keyword\">super</span>.getSessionFactory().getCurrentSession();<br>\t\tSQLQuery query = session.createSQLQuery(sql);<br>\t\t<span class=\"hljs-keyword\">if</span>(colums!=<span class=\"hljs-keyword\">null</span> &amp;&amp; types!=<span class=\"hljs-keyword\">null</span> &amp;&amp; colums.length==types.length)&#123;<br>\t\t\t<span class=\"hljs-keyword\">for</span>(<span class=\"hljs-keyword\">int</span> i=<span class=\"hljs-number\">0</span>;i&lt;colums.length;i++)&#123;<br>\t\t\t\t<span class=\"hljs-keyword\">if</span>(types[i].equals(<span class=\"hljs-string\">\"Integer\"</span>))&#123;<br>\t\t\t\t\tquery.addScalar(colums[i],StandardBasicTypes.INTEGER);<br>\t\t\t\t&#125;<span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(types[i].equals(<span class=\"hljs-string\">\"String\"</span>))&#123;<br>\t\t\t\t\tquery.addScalar(colums[i],StandardBasicTypes.STRING);<br>\t\t\t\t&#125;<span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(types[i].equals(<span class=\"hljs-string\">\"Double\"</span>))&#123;<br>\t\t\t\t\tquery.addScalar(colums[i],StandardBasicTypes.DOUBLE);<br>\t\t\t\t&#125;<span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span>(types[i].equals(<span class=\"hljs-string\">\"Long\"</span>))&#123;<br>\t\t\t\t\tquery.addScalar(colums[i],StandardBasicTypes.LONG);<br>\t\t\t\t&#125;<br>\t\t\t\t<br>\t\t\t&#125;<br>\t\t&#125;<br>\t\tList&lt;Object[]&gt; list = query.setResultTransformer(Transformers.aliasToBean(clazz)).list();<br>        <span class=\"hljs-keyword\">return</span> list;<br>    &#125;<br>   &#125;<br></code></pre></td></tr></table></figure>\n\n<blockquote>\n<p>结语：由于是在工作中用到的代码段，所以显得有些复杂化了，以后有时间的话，使用通俗易懂的方法讲解出来，先留个坑，如果大家遇到这种使用场景无法解决的话，欢迎打扰：<a href=\"mailto:1085143002@qq.com\">1085143002@qq.com</a></p>\n</blockquote>\n","raw":null,"categories":[{"name":"Hibernate","path":"api/categories/Hibernate.json"}],"tags":[{"name":"Hibernate","path":"api/tags/Hibernate.json"}]},{"title":"Spring boot Mybatis 整合（注解版）","slug":"spring-boot-mybatis-annotation","date":"2018-01-18T13:40:00.000Z","updated":"2022-12-01T01:32:39.787Z","comments":true,"top":null,"path":"api/articles/spring-boot-mybatis-annotation.json","excerpt":" [Figure]   之前写过一篇关于springboot 与 mybatis整合的博文，使用了一段时间spring-data-jpa，发现那种方式真的是太爽了，mybatis的xml的映射配置总觉得有点麻烦。接口定义和映射离散在不同的文件中，阅读起来不是很方便。于是，准备使用mybatis的注解方式实现映射。如果喜欢xml方式的可以看我之前的博文： Spring boot Mybatis 整合（完整版）","keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046777967495.jpg","content":"<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046778152150.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<blockquote>\n<p>  之前写过一篇关于springboot 与 mybatis整合的博文，使用了一段时间<a href=\"http://winterchen.com/2017/11/11/springbootdata2/\" target=\"_blank\" rel=\"noopener\">spring-data-jpa</a>，发现那种方式真的是太爽了，mybatis的xml的映射配置总觉得有点麻烦。接口定义和映射离散在不同的文件中，阅读起来不是很方便。于是，准备使用mybatis的注解方式实现映射。如果喜欢xml方式的可以看我之前的博文：<a href=\"http://blog.csdn.net/winter_chen001/article/details/77249029\" target=\"_blank\" rel=\"noopener\"> Spring boot Mybatis 整合（完整版）</a></p>\n</blockquote>\n<a id=\"more\"></a>\n<h3 id=\"源码\"><a href=\"#源码\" class=\"headerlink\" title=\"源码\"></a>源码</h3><p>请前往文章末端查看</p>\n<h3 id=\"开发环境：\"><a href=\"#开发环境：\" class=\"headerlink\" title=\"开发环境：\"></a>开发环境：</h3><hr>\n<ul>\n<li>开发工具：Intellij IDEA 2017.1.3</li>\n<li>JDK : 1.8.0_101</li>\n<li>spring boot 版本 ： 1.5.8.RELEASE</li>\n<li>maven : 3.3.9</li>\n</ul>\n<h3 id=\"拓展：\"><a href=\"#拓展：\" class=\"headerlink\" title=\"拓展：\"></a>拓展：</h3><ul>\n<li>springboot 整合 Mybatis 事务管理</li>\n</ul>\n<h3 id=\"开始\"><a href=\"#开始\" class=\"headerlink\" title=\"开始\"></a>开始</h3><h4 id=\"1-新建一个springboot项目：\"><a href=\"#1-新建一个springboot项目：\" class=\"headerlink\" title=\"1.新建一个springboot项目：\"></a>1.新建一个springboot项目：</h4><p><img    class=\"lazyload\" data-original=\"http://img.blog.csdn.net/20171124094443907?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvV2ludGVyX2NoZW4wMDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">这里写图片描述</span></p>\n<p><img    class=\"lazyload\" data-original=\"http://img.blog.csdn.net/20171124094505295?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvV2ludGVyX2NoZW4wMDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">这里写图片描述</span></p>\n<p><strong>添加依赖</strong><br><img    class=\"lazyload\" data-original=\"http://img.blog.csdn.net/20171124094516207?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvV2ludGVyX2NoZW4wMDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">这里写图片描述</span></p>\n<h4 id=\"2-看一下项目结构\"><a href=\"#2-看一下项目结构\" class=\"headerlink\" title=\"2.看一下项目结构\"></a>2.看一下项目结构</h4><p><img    class=\"lazyload\" data-original=\"http://img.blog.csdn.net/20171124094524448?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvV2ludGVyX2NoZW4wMDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">这里写图片描述</span></p>\n<h4 id=\"3-完整依赖\"><a href=\"#3-完整依赖\" class=\"headerlink\" title=\"3.完整依赖\"></a>3.完整依赖</h4><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">project</span> <span class=\"hljs-attr\">xmlns</span>=<span class=\"hljs-string\">\"http://maven.apache.org/POM/4.0.0\"</span> <span class=\"hljs-attr\">xmlns:xsi</span>=<span class=\"hljs-string\">\"http://www.w3.org/2001/XMLSchema-instance\"</span></span><br><span class=\"hljs-tag\">\t<span class=\"hljs-attr\">xsi:schemaLocation</span>=<span class=\"hljs-string\">\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">modelVersion</span>&gt;</span>4.0.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">modelVersion</span>&gt;</span><br><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.winterchen<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>springboot-mybatis-demo2<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>0.0.1-SNAPSHOT<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">packaging</span>&gt;</span>jar<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">packaging</span>&gt;</span><br><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">name</span>&gt;</span>springboot-mybatis-demo2<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">name</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">description</span>&gt;</span>Demo project for Spring Boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">description</span>&gt;</span><br><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">parent</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-boot-starter-parent<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.5.8.RELEASE<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">relativePath</span>/&gt;</span> <span class=\"hljs-comment\">&lt;!-- lookup parent from repository --&gt;</span><br>\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">parent</span>&gt;</span><br><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">properties</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">project.build.sourceEncoding</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">project.reporting.outputEncoding</span>&gt;</span>UTF-8<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">project.reporting.outputEncoding</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">java.version</span>&gt;</span>1.8<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">java.version</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">properties</span>&gt;</span><br><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependencies</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.mybatis.spring.boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.3.1<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>mysql<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>runtime<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>test<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependencies</span>&gt;</span><br><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">build</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugins</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">plugin</span>&gt;</span><br>\t\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugin</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">plugins</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">build</span>&gt;</span><br><br><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">project</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n\n<h4 id=\"4-配置文件\"><a href=\"#4-配置文件\" class=\"headerlink\" title=\"4.配置文件\"></a>4.配置文件</h4><p>因为习惯性的喜欢使用yml作为配置文件，所以将application.properties替换为application.yml</p>\n<figure class=\"highlight yml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yml\"><span class=\"hljs-attr\">spring:</span><br>  <span class=\"hljs-attr\">datasource:</span><br>     <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">jdbc:mysql://127.0.0.1:3306/mytest</span><br>     <span class=\"hljs-attr\">username:</span> <span class=\"hljs-string\">root</span><br>     <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">root</span><br>     <span class=\"hljs-attr\">driver-class-name:</span> <span class=\"hljs-string\">com.mysql.jdbc.Driver</span><br></code></pre></td></tr></table></figure>\n\n<p>简单且简洁的完成了基本配置，下面看看我们是如何在这个基础下轻松使用Mybatis访问数据库的</p>\n<h3 id=\"使用Mybatis\"><a href=\"#使用Mybatis\" class=\"headerlink\" title=\"使用Mybatis\"></a>使用Mybatis</h3><hr>\n<ul>\n<li><p>在Mysql数据库中创建数据表：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">DATABASE</span> mytest;<br><br><span class=\"hljs-keyword\">USE</span> mytest;<br><br><span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> t_user(<br>  <span class=\"hljs-keyword\">id</span> <span class=\"hljs-built_in\">BIGINT</span> <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> PRIMARY <span class=\"hljs-keyword\">KEY</span> AUTO_INCREMENT,<br>  <span class=\"hljs-keyword\">name</span> <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">255</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> ,<br>  <span class=\"hljs-keyword\">password</span> <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">255</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> ,<br>  phone <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">255</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span><br>) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">INNODB</span> AUTO_INCREMENT=<span class=\"hljs-number\">1000</span> <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">CHARSET</span>=utf8;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>创建映射对象User</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.domain;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * User实体映射类</span><br><span class=\"hljs-comment\"> * Created by Administrator on 2017/11/24.</span><br><span class=\"hljs-comment\"> */</span><br><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">User</span> </span>&#123;<br><br>    <span class=\"hljs-keyword\">private</span> Integer id;<br>    <span class=\"hljs-keyword\">private</span> String name;<br>    <span class=\"hljs-keyword\">private</span> String password;<br>    <span class=\"hljs-keyword\">private</span> String phone;<br><br>\t<span class=\"hljs-comment\">//省略 get 和 set ...</span><br>&#125;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>创建User映射的操作UserMapper，为了后续单元测试验证，实现插入和查询操作</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.mapper;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.domain.User;<br><span class=\"hljs-keyword\">import</span> org.apache.ibatis.annotations.Insert;<br><span class=\"hljs-keyword\">import</span> org.apache.ibatis.annotations.Mapper;<br><span class=\"hljs-keyword\">import</span> org.apache.ibatis.annotations.Param;<br><span class=\"hljs-keyword\">import</span> org.apache.ibatis.annotations.Select;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * User映射类</span><br><span class=\"hljs-comment\"> * Created by Administrator on 2017/11/24.</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-meta\">@Mapper</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">UserMapper</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Select</span>(<span class=\"hljs-string\">\"SELECT * FROM T_USER WHERE PHONE = #&#123;phone&#125;\"</span>)<br>    <span class=\"hljs-function\">User <span class=\"hljs-title\">findUserByPhone</span><span class=\"hljs-params\">(@Param(<span class=\"hljs-string\">\"phone\"</span>)</span> String phone)</span>;<br><br>    <span class=\"hljs-meta\">@Insert</span>(<span class=\"hljs-string\">\"INSERT INTO T_USER(NAME, PASSWORD, PHONE) VALUES(#&#123;name&#125;, #&#123;password&#125;, #&#123;phone&#125;)\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">insert</span><span class=\"hljs-params\">(@Param(<span class=\"hljs-string\">\"name\"</span>)</span> String name, @<span class=\"hljs-title\">Param</span><span class=\"hljs-params\">(<span class=\"hljs-string\">\"password\"</span>)</span> String password, @<span class=\"hljs-title\">Param</span><span class=\"hljs-params\">(<span class=\"hljs-string\">\"phone\"</span>)</span> String phone)</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p><strong>如果想了解更多Mybatis注解的详细：<a href=\"http://blog.csdn.net/winter_chen001/article/details/78623700\" target=\"_blank\" rel=\"noopener\">springboot中使用Mybatis注解配置详解</a></strong></p>\n<ul>\n<li><p>创建springboot 主类：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen;<br><br><span class=\"hljs-keyword\">import</span> org.springframework.boot.SpringApplication;<br><span class=\"hljs-keyword\">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><br><span class=\"hljs-meta\">@SpringBootApplication</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">SpringbootMybatisDemo2Application</span> </span>&#123;<br><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(String[] args)</span> </span>&#123;<br>\t\tSpringApplication.run(SpringbootMybatisDemo2Application<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>, <span class=\"hljs-title\">args</span>)</span>;<br>\t&#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>创建测试单元:</p>\n<ul>\n<li>测试逻辑：插入一条name为”weinterchen”的User，然后根据user的phone进行查询，并判断user的name是否为”winterchen”。</li>\n</ul>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.domain.User;<br><span class=\"hljs-keyword\">import</span> com.winterchen.mapper.UserMapper;<br><span class=\"hljs-keyword\">import</span> org.junit.Assert;<br><span class=\"hljs-keyword\">import</span> org.junit.Test;<br><span class=\"hljs-keyword\">import</span> org.junit.runner.RunWith;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.boot.test.context.SpringBootTest;<br><span class=\"hljs-keyword\">import</span> org.springframework.test.context.junit4.SpringRunner;<br><br><span class=\"hljs-meta\">@RunWith</span>(SpringRunner<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span><br><span class=\"hljs-class\">@<span class=\"hljs-title\">SpringBootTest</span></span><br><span class=\"hljs-class\"><span class=\"hljs-title\">public</span> <span class=\"hljs-title\">class</span> <span class=\"hljs-title\">SpringbootMybatisDemo2ApplicationTests</span> </span>&#123;<br><br><br>\t<span class=\"hljs-meta\">@Autowired</span><br>\t<span class=\"hljs-keyword\">private</span> UserMapper userMapper;<br><br>\t<span class=\"hljs-meta\">@Test</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">test</span><span class=\"hljs-params\">()</span></span>&#123;<br><br>\t\tuserMapper.insert(<span class=\"hljs-string\">\"winterchen\"</span>, <span class=\"hljs-string\">\"123456\"</span>, <span class=\"hljs-string\">\"12345678910\"</span>);<br>\t\tUser u = userMapper.findUserByPhone(<span class=\"hljs-string\">\"12345678910\"</span>);<br>\t\tAssert.assertEquals(<span class=\"hljs-string\">\"winterchen\"</span>, u.getName());<br>\t&#125;<br><br>\t<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n<ul>\n<li>测试结果</li>\n</ul>\n<p><img    class=\"lazyload\" data-original=\"http://img.blog.csdn.net/20171124103725302?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvV2ludGVyX2NoZW4wMDE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">这里写图片描述</span></p>\n<p>说明已经成功了</p>\n<h3 id=\"事务管理（重要）\"><a href=\"#事务管理（重要）\" class=\"headerlink\" title=\"事务管理（重要）\"></a>事务管理（重要）</h3><hr>\n<blockquote>\n<p>我们在开发企业应用时，对于业务人员的一个操作实际是对数据读写的多步操作的结合。由于数据操作在顺序执行的过程中，任何一步操作都有可能发生异常，异常会导致后续操作无法完成，此时由于业务逻辑并未正确的完成，之前成功操作数据的并不可靠，需要在这种情况下进行回退。</p>\n</blockquote>\n<p><strong>为了测试的成功，请把测试的内容进行替换，因为之前测试的时候已经将数据生成了，重复的数据会对测试的结果有影响</strong></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Test</span><br><span class=\"hljs-meta\">@Transactional</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">test</span><span class=\"hljs-params\">()</span></span>&#123;<br><br>\tuserMapper.insert(<span class=\"hljs-string\">\"张三\"</span>, <span class=\"hljs-string\">\"123456\"</span>, <span class=\"hljs-string\">\"18600000000\"</span>);<br>\t<span class=\"hljs-keyword\">int</span> a = <span class=\"hljs-number\">1</span>/<span class=\"hljs-number\">0</span>;<br>\tuserMapper.insert(<span class=\"hljs-string\">\"李四\"</span>, <span class=\"hljs-string\">\"123456\"</span>, <span class=\"hljs-string\">\"13500000000\"</span>);<br>\tUser u = userMapper.findUserByPhone(<span class=\"hljs-string\">\"12345678910\"</span>);<br>\tAssert.assertEquals(<span class=\"hljs-string\">\"winterchen\"</span>, u.getName());<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>只需要在需要事务管理的方法上添加 <code>@Transactional</code> 注解即可，然后我们启动测试，会发现异常之后，数据库中没有产生数据。</p>\n<p>如果大家想对springboot事务管理有更加详细的了解，欢迎大家查看：<a href=\"http://blog.csdn.net/Winter_chen001/article/details/78622679\" target=\"_blank\" rel=\"noopener\"> springboot事务管理详解</a></p>\n<p>源码：<a href=\"https://github.com/WinterChenS/springboot-mybatis-demo2/\" target=\"_blank\" rel=\"noopener\">https://github.com/WinterChenS/springboot-mybatis-demo2/</a></p>\n","raw":null,"categories":[{"name":"Spring Boot","path":"api/categories/Spring Boot.json"}],"tags":[{"name":"Spring Boot","path":"api/tags/Spring Boot.json"},{"name":"mybatis","path":"api/tags/mybatis.json"}]},{"title":"layui完美分页，ajax请求分页（真分页） 【2.0版本】","slug":"layui-page-2.0","date":"2017-10-25T12:55:00.000Z","updated":"2022-12-01T01:32:39.787Z","comments":true,"top":null,"path":"api/articles/layui-page-2.0.json","excerpt":" [Figure] 注意使用的layui版本为：layui-v2.0以上版本，如果v1.0版本请看我另外一篇博客  《layui完美分页，ajax请求分页（真分页）》","keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046774996940.jpg","content":"<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046775186684.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<h3 id=\"注意\"><a href=\"#注意\" class=\"headerlink\" title=\"注意\"></a>注意</h3><p><strong>使用的layui版本为：layui-v2.0以上版本，如果v1.0版本请看我另外一篇博客 <a href=\"https://winterchens.github.io/2017/10/25/layui-page-1.0/\" target=\"_blank\" rel=\"noopener\"> 《layui完美分页，ajax请求分页（真分页）》</a></strong></p>\n<a id=\"more\"></a>\n\n<p>最近因为以为学者在看了我上一篇关于layui分页的博客遇到了问题，原因是因为使用了新版本2.x，导致有一些属性改变了，所以出了这篇新版本的博客，本文是根据上一篇博客改变而成，如有疑问请联系我 email：<a href=\"mailto:1085143002@qq.com\">1085143002@qq.com</a></p>\n<h3 id=\"完整代码：\"><a href=\"#完整代码：\" class=\"headerlink\" title=\"完整代码：\"></a>完整代码：</h3><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">%@</span> <span class=\"hljs-attr\">page</span> <span class=\"hljs-attr\">language</span>=<span class=\"hljs-string\">\"java\"</span> <span class=\"hljs-attr\">contentType</span>=<span class=\"hljs-string\">\"text/html; charset=UTF-8\"</span> <span class=\"hljs-attr\">pageEncoding</span>=<span class=\"hljs-string\">\"UTF-8\"</span>%&gt;</span><br><span class=\"hljs-meta\">&lt;!DOCTYPE <span class=\"hljs-meta-keyword\">html</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">html</span> <span class=\"hljs-attr\">lang</span>=<span class=\"hljs-string\">\"en\"</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">head</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">charset</span>=<span class=\"hljs-string\">\"UTF-8\"</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"renderer\"</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">\"webkit\"</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">http-equiv</span>=<span class=\"hljs-string\">\"X-UA-Compatible\"</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">\"IE=edge,chrome=1\"</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"viewport\"</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">\"width=device-width, initial-scale=1, maximum-scale=1\"</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"apple-mobile-web-app-status-bar-style\"</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">\"black\"</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"apple-mobile-web-app-capable\"</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">\"yes\"</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">meta</span> <span class=\"hljs-attr\">name</span>=<span class=\"hljs-string\">\"format-detection\"</span> <span class=\"hljs-attr\">content</span>=<span class=\"hljs-string\">\"telephone=no\"</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">link</span>  <span class=\"hljs-attr\">rel</span>=<span class=\"hljs-string\">\"icon\"</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">\"static/images/titleLogo.png\"</span>  /&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">title</span>&gt;</span>门店管理后台<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">title</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">link</span> <span class=\"hljs-attr\">rel</span>=<span class=\"hljs-string\">\"stylesheet\"</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">\"static/layui/plugins/layui/css/layui.css\"</span> <span class=\"hljs-attr\">media</span>=<span class=\"hljs-string\">\"all\"</span> /&gt;</span><br>    <span class=\"hljs-comment\">&lt;!-- &lt;link rel=\"stylesheet\" type=\"text/css\" href=\"static/css/reset.css\"&gt;</span><br><span class=\"hljs-comment\">    &lt;link rel=\"stylesheet\" type=\"text/css\" href=\"static/css/commend.css\"&gt; --&gt;</span><br>    <span class=\"hljs-comment\">&lt;!-- &lt;link rel=\"stylesheet\" href=\"static/css/jqpagination.css\" /&gt; --&gt;</span><br>    <span class=\"hljs-comment\">&lt;!-- &lt;link rel=\"stylesheet\" type=\"text/css\" href=\"static/css/shopCustomerManager.css\"&gt; --&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"text/javascript\"</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"static/js/jquery-3.1.1.min.js\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"text/javascript\"</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"static/layui/plugins/layui/layui.js\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br>    <span class=\"hljs-comment\">&lt;!-- &lt;script type=\"text/javascript\" src=\"static/js/jquery.jqpagination.js\"&gt;&lt;/script&gt; --&gt;</span><br>   \t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"text/javascript\"</span>&gt;</span><br><span class=\"javascript\">\t   \t$(<span class=\"hljs-built_in\">document</span>).ready(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>)</span>&#123;</span><br><span class=\"actionscript\">\t   \t\t  <span class=\"hljs-comment\">//ajax请求后台数据</span></span><br>\t\t      getShopCustomerManagePageInfo();<br>\t\t      <br>\t\t<br><span class=\"actionscript\">\t   \t\t  <span class=\"hljs-comment\">//点击搜索时 搜索数据</span></span><br><span class=\"javascript\">\t   \t\t  $(<span class=\"hljs-string\">\"#selectButton\"</span>).click(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>)</span>&#123; </span><br>\t   \t\t\tgetShopCustomerManagePageInfo();<br><span class=\"actionscript\">\t   \t\t\tcurrentPageAllAppoint = <span class=\"hljs-number\">1</span>; <span class=\"hljs-comment\">//当点击搜索的时候，应该回到第一页</span></span><br><span class=\"actionscript\">\t   \t\t\ttoPage();<span class=\"hljs-comment\">//然后进行分页的初始化</span></span><br>\t   \t\t\t<br>\t   \t      &#125;)<br>\t   \t   toPage();<br>\t   \t&#125;);<br>\t   \t<br><span class=\"actionscript\">\t  \t<span class=\"hljs-comment\">//分页参数设置 这些全局变量关系到分页的功能</span></span><br><span class=\"actionscript\">\t   \t<span class=\"hljs-keyword\">var</span> startAllAppoint = <span class=\"hljs-number\">0</span>;<span class=\"hljs-comment\">//开始页数</span></span><br><span class=\"actionscript\">\t   \t<span class=\"hljs-keyword\">var</span> limitAllAppoint = <span class=\"hljs-number\">10</span>;<span class=\"hljs-comment\">//每页显示数据条数</span></span><br><span class=\"actionscript\">\t   \t<span class=\"hljs-keyword\">var</span> currentPageAllAppoint = <span class=\"hljs-number\">1</span>;<span class=\"hljs-comment\">//当前页数</span></span><br><span class=\"actionscript\">\t   \t<span class=\"hljs-keyword\">var</span> dataLength = <span class=\"hljs-number\">0</span>;<span class=\"hljs-comment\">//数据总条数</span></span><br><span class=\"actionscript\">\t   \t<span class=\"hljs-comment\">//ajax请求后台数据</span></span><br><span class=\"actionscript\">\t   \t<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getShopCustomerManagePageInfo</span><span class=\"hljs-params\">()</span></span>&#123;</span><br><span class=\"javascript\">\t   \t\t$.ajax(&#123;</span><br><span class=\"actionscript\">\t   \t\t\ttype:<span class=\"hljs-string\">\"post\"</span>,</span><br><span class=\"javascript\">\t   \t\t\t<span class=\"hljs-keyword\">async</span>:<span class=\"hljs-literal\">false</span>,</span><br><span class=\"actionscript\">\t   \t\t\turl:<span class=\"hljs-string\">\"list_shop_customers_info\"</span>,</span><br><span class=\"javascript\">\t   \t\t\tdata:&#123;<span class=\"hljs-attr\">start</span>:startAllAppoint, <span class=\"hljs-attr\">limit</span>:limitAllAppoint,<span class=\"hljs-attr\">selectValue</span>:$(<span class=\"hljs-string\">\"#selectValue\"</span>).val()&#125;,</span><br><span class=\"actionscript\">\t   \t\t\tsuccess:<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">(data,status)</span></span>&#123;</span><br><span class=\"javascript\">\t   \t\t\t\tdata=<span class=\"hljs-built_in\">eval</span>(<span class=\"hljs-string\">\"(\"</span>+data+<span class=\"hljs-string\">\")\"</span>);</span><br>\t   \t\t\t\tgetShopCustomesInfo(data.root);<br><span class=\"actionscript\">\t   \t\t\t\tstartAllAppoint = data.currentResult;<span class=\"hljs-comment\">//当前页数(后台返回)</span></span><br><span class=\"actionscript\">\t   \t\t\t\tdataLength  = data.total;<span class=\"hljs-comment\">//数据总条数</span></span><br>\t   \t\t\t&#125;<br>\t   \t\t&#125;);<br>\t   \t\t<br>\t   \t&#125;<br>\t   \t<br>\t   <br>\t   \t<br><span class=\"actionscript\">\t   \t<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">getShopCustomesInfo</span><span class=\"hljs-params\">(data)</span></span>&#123;</span><br><span class=\"handlebars\"><span class=\"xml\">\t   \t\tvar s = \"<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">tr</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">th</span>&gt;</span>姓名<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">th</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">th</span>&gt;</span>性别<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">th</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">th</span>&gt;</span>电话<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">th</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">th</span>&gt;</span>备案楼盘<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">th</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">th</span>&gt;</span>已成交<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">th</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">th</span>&gt;</span>归属经纪人<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">th</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">th</span>&gt;</span>添加时间<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">th</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">tr</span>&gt;</span>\";</span></span><br><span class=\"javascript\">\t   \t\t$.each(data,<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">v,o</span>)</span>&#123;</span><br><span class=\"handlebars\"><span class=\"xml\">\t   \t\t\t\ts+='<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">tr</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">td</span>&gt;</span>'+o.cusName+'<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">td</span>&gt;</span>';</span></span><br><span class=\"actionscript\">\t   \t\t\t\ts+=<span class=\"hljs-string\">'&lt;td&gt;'</span>+o.cusSex+<span class=\"hljs-string\">'&lt;/td&gt;'</span>;</span><br><span class=\"actionscript\">\t   \t\t\t\ts+=<span class=\"hljs-string\">'&lt;td&gt;'</span>+o.phone+<span class=\"hljs-string\">'&lt;/td&gt;'</span>;</span><br><span class=\"actionscript\">\t   \t\t\t\ts+=<span class=\"hljs-string\">'&lt;td&gt;'</span>+o.records+<span class=\"hljs-string\">'&lt;/td&gt;'</span>;</span><br><span class=\"actionscript\">\t   \t\t\t\ts+=<span class=\"hljs-string\">'&lt;td&gt;'</span>+o.alreadyDeal+<span class=\"hljs-string\">'&lt;/td&gt;'</span>;</span><br><span class=\"actionscript\">\t   \t\t\t\ts+=<span class=\"hljs-string\">'&lt;td&gt;'</span>+o.theMedi+<span class=\"hljs-string\">'&lt;/td&gt;'</span>;</span><br><span class=\"handlebars\"><span class=\"xml\">\t   \t\t\t\ts+='<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">td</span>&gt;</span>'+o.addTime+'<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">td</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">tr</span>&gt;</span>';</span></span><br>\t   \t\t&#125;);<br><br>\t   \t\tif(data.length&gt;0)&#123;<br><span class=\"javascript\">\t   \t\t\t$(<span class=\"hljs-string\">\"#t_customerInfo\"</span>).html(s);</span><br><span class=\"actionscript\">\t   \t\t&#125;<span class=\"hljs-keyword\">else</span>&#123;</span><br><span class=\"javascript\">\t   \t\t\t$(<span class=\"hljs-string\">\"#page1\"</span>).hide();</span><br><span class=\"handlebars\"><span class=\"xml\">\t   \t\t\t$(\"#t_customerInfo\").html(\"<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">br</span>/&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span> <span class=\"hljs-attr\">style</span>=<span class=\"hljs-string\">'width:10%;height:30px;display:block;margin:0 auto;'</span>&gt;</span>暂无数据<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span>\");</span></span><br>\t   \t\t&#125;<br>\t   \t\t<br>\t   \t\t<br>\t   \t&#125;<br>   \t\t<br>\t   \t<br>\t   \t<br><span class=\"actionscript\">\t   \t<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">toPage</span><span class=\"hljs-params\">()</span></span>&#123;</span><br>\t   \t\t<br><span class=\"actionscript\">\t   \t\tlayui.use([<span class=\"hljs-string\">'form'</span>, <span class=\"hljs-string\">'laypage'</span>, <span class=\"hljs-string\">'layedit'</span>,<span class=\"hljs-string\">'layer'</span>, <span class=\"hljs-string\">'laydate'</span>], <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">()</span> </span>&#123;</span><br><span class=\"actionscript\">\t\t\t\t<span class=\"hljs-keyword\">var</span> form = layui.form(),</span><br>\t\t\t\t\tlayer = layui.layer,<br>\t\t\t\t\tlayedit = layui.layedit,<br>\t\t\t\t\tlaydate = layui.laydate,<br>\t\t\t\t\tlaypage = layui.laypage;<br>\t\t\t\t<br><span class=\"actionscript\">\t\t\t\t<span class=\"hljs-keyword\">var</span> nums = <span class=\"hljs-number\">10</span>;</span><br><span class=\"actionscript\">\t\t\t\t<span class=\"hljs-comment\">//调用分页</span></span><br>\t\t\t\t  laypage(&#123;<br><span class=\"actionscript\">\t\t\t\t    cont: <span class=\"hljs-string\">'paged'</span></span><br><span class=\"actionscript\">\t\t\t\t    ,count: dataLength <span class=\"hljs-comment\">//这个是后台返回的数据的总条数</span></span><br><span class=\"actionscript\">\t\t\t\t    ,limit: limitAllAppoint   <span class=\"hljs-comment\">//每页显示的数据的条数,layui会根据count，limit进行分页的计算</span></span><br>\t\t\t\t    ,curr: currentPageAllAppoint<br><span class=\"actionscript\">\t\t\t\t    ,skip: <span class=\"hljs-literal\">true</span></span><br><span class=\"actionscript\">\t\t\t\t    ,jump: <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">(obj, first)</span></span>&#123;</span><br>\t\t\t\t    \t<br>\t\t\t\t    \tcurrentPageAllAppoint = obj.curr;<br>\t\t\t\t    \tstartAllAppoint = (obj.curr-1)*obj.limit;<br><span class=\"actionscript\">\t\t\t\t      <span class=\"hljs-comment\">//document.getElementById('biuuu_city_list').innerHTML = render(obj, obj.curr);</span></span><br><span class=\"actionscript\">\t\t\t\t      <span class=\"hljs-keyword\">if</span>(!first)&#123; <span class=\"hljs-comment\">//一定要加此判断，否则初始时会无限刷新</span></span><br><span class=\"actionscript\">\t\t\t\t      getShopCustomerManagePageInfo();<span class=\"hljs-comment\">//一定要把翻页的ajax请求放到这里，不然会请求两次。</span></span><br><span class=\"actionscript\">\t\t\t\t          <span class=\"hljs-comment\">//location.href = '?page='+obj.curr;</span></span><br>\t\t\t\t        &#125;<br>\t\t\t\t    &#125;<br>\t\t\t\t  &#125;);<br>\t\t\t\t<br>\t\t\t\t<br>\t\t\t&#125;);<br>\t   \t&#125;;<br>\t   \t<br>   \t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">head</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">body</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"admin-main\"</span>&gt;</span><br>\t<br>\t<br>\t\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">blockquote</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"layui-elem-quote\"</span>&gt;</span><br>\t\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">form</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"layui-form\"</span> <span class=\"hljs-attr\">action</span>=<span class=\"hljs-string\">\"\"</span> &gt;</span><br>\t\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"layui-form-item\"</span>&gt;</span><br>\t\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"layui-input-inline\"</span>&gt;</span><br>\t\t\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">input</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"text\"</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"selectValue\"</span> <span class=\"hljs-attr\">lay-verify</span>=<span class=\"hljs-string\">\"required\"</span> <span class=\"hljs-attr\">placeholder</span>=<span class=\"hljs-string\">\"客户姓名，电话\"</span> <span class=\"hljs-attr\">autocomplete</span>=<span class=\"hljs-string\">\"off\"</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"layui-input\"</span>&gt;</span><br>\t\t\t    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span><br>\t\t\t    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"layui-btn\"</span> <span class=\"hljs-attr\">type</span>=<span class=\"hljs-string\">\"button\"</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"selectButton\"</span>&gt;</span>搜索<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span><br>\t\t\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span><br>\t\t\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">form</span>&gt;</span><br>\t\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">span</span>&gt;</span><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">a</span> <span class=\"hljs-attr\">href</span>=<span class=\"hljs-string\">\"shop_customer_manager_page_info\"</span>&gt;</span>显示所有客户<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">a</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">span</span>&gt;</span><br>\t\t\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">blockquote</span>&gt;</span><br>\t\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">fieldset</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"layui-elem-field\"</span>&gt;</span><br>\t\t\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">legend</span>&gt;</span>客户列表<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">legend</span>&gt;</span><br>\t\t\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"layui-field-box layui-form\"</span>&gt;</span><br>\t\t\t\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">table</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"layui-table admin-table\"</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"t_customerInfo\"</span>&gt;</span><br>\t\t\t\t\t\t\t<br>\t\t\t\t\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">table</span>&gt;</span><br>\t\t\t\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span><br>\t\t\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">fieldset</span>&gt;</span><br>\t\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"admin-table-page\"</span>&gt;</span><br>\t\t\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"paged\"</span> <span class=\"hljs-attr\">class</span>=<span class=\"hljs-string\">\"page\"</span>&gt;</span><br>\t\t\t\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span><br>\t\t\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span><br>\t<br>   <br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">body</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">html</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"java代码：\"><a href=\"#java代码：\" class=\"headerlink\" title=\"java代码：\"></a>java代码：</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t * shop 客户管理 list</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> start</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> limit</span><br><span class=\"hljs-comment\">\t * <span class=\"hljs-doctag\">@param</span> selectValue</span><br><span class=\"hljs-comment\">\t */</span><br>\t<span class=\"hljs-meta\">@ResponseBody</span><br>\t<span class=\"hljs-meta\">@RequestMapping</span>(<span class=\"hljs-string\">\"/list_shop_customers_info\"</span>)<br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> Object <span class=\"hljs-title\">listShopCustomerInfo</span><span class=\"hljs-params\">(Integer start, Integer limit, String selectValue)</span> </span>&#123;<br>\t\tPage page = <span class=\"hljs-keyword\">new</span> Page();<br>\t\tpage.setStart(start);<br>\t\tpage.setLimit(limit);<br>\t\t<span class=\"hljs-comment\">// 获取session中的用户信息</span><br>\t\tUser u = (User) <span class=\"hljs-keyword\">this</span>.request.getSession().getAttribute(<span class=\"hljs-string\">\"userInfo\"</span>);<br>\t\t<span class=\"hljs-comment\">// 获取持久化用户对象</span><br>\t\tUser user = userService.findById(u.getUserId());<br>\t\t<span class=\"hljs-keyword\">if</span> (user != <span class=\"hljs-keyword\">null</span>) &#123;<br>\t\t\tprojectCustomerService.findShopCustomersByUser(user, selectValue, page);<br>\t\t\t<span class=\"hljs-keyword\">return</span> page;<br>\t\t&#125;<br>\t&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"sevice层\"><a href=\"#sevice层\" class=\"headerlink\" title=\"sevice层\"></a>sevice层</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Override</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">findShopCustomersByUser</span><span class=\"hljs-params\">(User user, String selectValue, Page page)</span> </span>&#123;<br>\t\tList cmList = <span class=\"hljs-keyword\">new</span> ArrayList&lt;&gt;();<br>\t\t<span class=\"hljs-keyword\">int</span> total = <span class=\"hljs-number\">0</span>;<br>\t\t<span class=\"hljs-keyword\">if</span>(user!=<span class=\"hljs-keyword\">null</span> &amp;&amp; user.getParentId()!=<span class=\"hljs-keyword\">null</span> &amp;&amp; !user.getParentId().equals(<span class=\"hljs-string\">\"\"</span>))&#123;<br>\t\t\tString hql = <span class=\"hljs-string\">\"from ShopCustomers as model where model.shopId = \"</span> + Integer.parseInt(user.getParentId());<br>\t\t\t<span class=\"hljs-keyword\">if</span>(selectValue!=<span class=\"hljs-keyword\">null</span> &amp;&amp; !selectValue.equals(<span class=\"hljs-string\">\"\"</span>))&#123;<br>\t\t\t\thql+=<span class=\"hljs-string\">\"and model.shopCustomerName like '%\"</span> +selectValue+<span class=\"hljs-string\">\"%' or model.shopCustomerPhone like '%\"</span> +selectValue+<span class=\"hljs-string\">\"%'\"</span>;<br>\t\t\t&#125;<br>\t\t\tList&lt;ShopCustomers&gt; list = baseDao.findByHql(hql,page.getStart(),page.getLimit());<br>\t\t\t<span class=\"hljs-keyword\">for</span>(ShopCustomers sc : list)&#123;<br>\t\t\t\tUser u = (User) baseDao.loadById(User<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>, <span class=\"hljs-title\">sc</span>.<span class=\"hljs-title\">getUserId</span>())</span>;<br>\t\t\t\tString cGRSHql = <span class=\"hljs-string\">\"select count(*) from GuideRecords where shopCustomerId = '\"</span>+sc.getShopCustomerId()+<span class=\"hljs-string\">\"'\"</span>;<br>\t\t\t\tString cDealHql = <span class=\"hljs-string\">\"select count(*) from GuideRecords where shopCustomerId = '\"</span>+sc.getShopCustomerId()+<span class=\"hljs-string\">\"' and isDeal = 1\"</span>;<br>\t\t\t\t<span class=\"hljs-keyword\">int</span> floorCounts = baseDao.countQuery(cGRSHql);<span class=\"hljs-comment\">//备案楼盘数</span><br>\t\t\t\t<span class=\"hljs-keyword\">int</span> dealCounts = baseDao.countQuery(cDealHql);<span class=\"hljs-comment\">//已成交数</span><br>\t\t\t\tCustomerManager cm = <span class=\"hljs-keyword\">new</span> CustomerManager();<br>\t\t\t\tCustomerManager cmObj = cm.createCusManObj(sc,u);<br>\t\t\t\tcmObj.setRecords(floorCounts);<br>\t\t\t\tcmObj.setAlreadyDeal(dealCounts);<br>\t\t\t\tcmList.add(cmObj);<br>\t\t\t&#125;<br>\t\t\tString cHql = <span class=\"hljs-string\">\"select count(*) \"</span>+hql;<br>\t\t\ttotal = baseDao.countQuery(cHql);<br>\t\t&#125;<br>\t\tpage.setRoot(cmList);<br>\t\tpage.setTotal(total);<br>\t&#125;<br></code></pre></td></tr></table></figure>\n<h3 id=\"分页对象\"><a href=\"#分页对象\" class=\"headerlink\" title=\"分页对象\"></a>分页对象</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.sc.tradmaster.utils;<br><br><span class=\"hljs-keyword\">import</span> java.util.List;<br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 分页对象</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> grl 2017-01-05</span><br><span class=\"hljs-comment\"> *</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Page</span> </span>&#123;<br>\t<span class=\"hljs-comment\">/** 总记录数 */</span><br>\t<span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> total;<br>\t<span class=\"hljs-comment\">/** 分页结果 */</span><br>\t<span class=\"hljs-keyword\">private</span> List root;<br>\t<span class=\"hljs-comment\">/** 开始页码 */</span><br>\t<span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> start;<br>\t<span class=\"hljs-comment\">/** 每页多少 */</span><br>\t<span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> limit;<br>\t<span class=\"hljs-comment\">/** 查询条件 */</span><br>\t<span class=\"hljs-keyword\">private</span> String wheres;<br>\t<br>\t<span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> currentPage;\t<span class=\"hljs-comment\">//当前页</span><br>\t<span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> currentResult;\t<span class=\"hljs-comment\">//当前记录起始索引</span><br>\t<span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> totalPage;\t\t<span class=\"hljs-comment\">//总页数</span><br><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">getCurrentPage</span><span class=\"hljs-params\">()</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">if</span>(currentPage&lt;=<span class=\"hljs-number\">0</span>)<br>\t\t\tcurrentPage = <span class=\"hljs-number\">1</span>;<br>\t\t<span class=\"hljs-keyword\">return</span> currentPage;<br>\t&#125;<br><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">setCurrentPage</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> currentPage)</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">this</span>.currentPage = currentPage;<br>\t&#125;<br><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">getCurrentResult</span><span class=\"hljs-params\">()</span> </span>&#123;<br>\t\tcurrentResult = (getCurrentPage()-<span class=\"hljs-number\">1</span>)*getLimit();<br>\t\t<span class=\"hljs-keyword\">if</span>(currentResult&lt;<span class=\"hljs-number\">0</span>)<br>\t\t\tcurrentResult = <span class=\"hljs-number\">0</span>;<br>\t\t<span class=\"hljs-keyword\">return</span> currentResult;<br>\t&#125;<br><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">setCurrentResult</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> currentResult)</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">this</span>.currentResult = currentResult;<br>\t&#125;<br><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">getTotalPage</span><span class=\"hljs-params\">()</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">if</span>(total%limit==<span class=\"hljs-number\">0</span>)<br>\t\t\ttotalPage = total/limit;<br>\t\t<span class=\"hljs-keyword\">else</span><br>\t\t\ttotalPage = total/limit+<span class=\"hljs-number\">1</span>;<br>\t\t<span class=\"hljs-keyword\">return</span> totalPage;<br>\t&#125;<br><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">setTotalPage</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> totalPage)</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">this</span>.totalPage = totalPage;<br>\t&#125;<br><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">getTotal</span><span class=\"hljs-params\">()</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">return</span> total;<br>\t&#125;<br><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">setTotal</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> total)</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">this</span>.total = total;<br>\t&#125;<br><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> List <span class=\"hljs-title\">getRoot</span><span class=\"hljs-params\">()</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">return</span> root;<br>\t&#125;<br><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">setRoot</span><span class=\"hljs-params\">(List root)</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">this</span>.root = root;<br>\t&#125;<br><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">getStart</span><span class=\"hljs-params\">()</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">return</span> start;<br>\t&#125;<br><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">setStart</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> start)</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">this</span>.start = start;<br>\t&#125;<br><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">getLimit</span><span class=\"hljs-params\">()</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">return</span> limit;<br>\t&#125;<br><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">setLimit</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> limit)</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">this</span>.limit = limit;<br>\t&#125;<br><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">getWheres</span><span class=\"hljs-params\">()</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">return</span> wheres;<br>\t&#125;<br><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">setWheres</span><span class=\"hljs-params\">(String wheres)</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">this</span>.wheres = wheres;<br>\t&#125;<br>\t<br>\t<span class=\"hljs-meta\">@Override</span><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">toString</span><span class=\"hljs-params\">()</span> </span>&#123;<br>\t\t<span class=\"hljs-keyword\">return</span> start+<span class=\"hljs-string\">\" \"</span>+total +<span class=\"hljs-string\">\" \"</span> +root;<br>\t&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n<p>如果遇到问题请联系我</p>\n","raw":null,"categories":[{"name":"layui","path":"api/categories/layui.json"}],"tags":[{"name":"layui","path":"api/tags/layui.json"}]}]}