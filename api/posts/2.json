{"total":66,"pageSize":10,"pageCount":7,"data":[{"title":"springboot集成hive实战","slug":"2020-12-01-springboot-hive","date":"2020-12-01T11:30:00.000Z","updated":"2022-12-01T01:32:39.783Z","comments":true,"top":null,"path":"api/articles/2020-12-01-springboot-hive.json","excerpt":null,"keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046754257652.jpg","content":"<p>springboot集成hive实现基本的api调用</p>\n<h2 id=\"maven坐标\"><a href=\"#maven坐标\" class=\"headerlink\" title=\"maven坐标\"></a>maven坐标</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-comment\">&lt;!-- hadoop --&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-common<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-streaming<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-yarn-common<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">exclusions</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">exclusion</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.google.guava<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>guava<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">exclusion</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">exclusions</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-distcp<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>provided<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-mapreduce-client-core<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-hdfs<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-mapreduce-client-jobclient<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>provided<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.alibaba<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>druid<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.2.1<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br>    <span class=\"hljs-comment\">&lt;!-- hive依赖 --&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hive<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hive-jdbc<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>2.3.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br>    <span class=\"hljs-comment\">&lt;!-- 中文分词器 --&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>cn.bestwu<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>ik-analyzers<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>5.1.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"配置：\"><a href=\"#配置：\" class=\"headerlink\" title=\"配置：\"></a>配置：</h2><figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">spring:</span><br>  <span class=\"hljs-attr\">application:</span><br>    <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">hadoop-demo</span><br>  <span class=\"hljs-attr\">datasource:</span><br>    <span class=\"hljs-attr\">hive:</span> <span class=\"hljs-comment\">#hive数据源</span><br>      <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">jdbc:hive2://192.168.150.119:10000/default</span><br>      <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">com.alibaba.druid.pool.DruidDataSource</span><br>      <span class=\"hljs-attr\">username:</span> <span class=\"hljs-string\">winterchen</span><br>      <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">winterchen</span><br>      <span class=\"hljs-attr\">driver-class-name:</span> <span class=\"hljs-string\">org.apache.hive.jdbc.HiveDriver</span><br>    <span class=\"hljs-attr\">common-config:</span> <span class=\"hljs-comment\">#连接池统一配置，应用到所有的数据源</span><br>      <span class=\"hljs-attr\">initialSize:</span> <span class=\"hljs-number\">1</span><br>      <span class=\"hljs-attr\">minIdle:</span> <span class=\"hljs-number\">1</span><br>      <span class=\"hljs-attr\">maxIdle:</span> <span class=\"hljs-number\">5</span><br>      <span class=\"hljs-attr\">maxActive:</span> <span class=\"hljs-number\">50</span><br>      <span class=\"hljs-attr\">maxWait:</span> <span class=\"hljs-number\">10000</span><br>      <span class=\"hljs-attr\">timeBetweenEvictionRunsMillis:</span> <span class=\"hljs-number\">10000</span><br>      <span class=\"hljs-attr\">minEvictableIdleTimeMillis:</span> <span class=\"hljs-number\">300000</span><br>      <span class=\"hljs-attr\">validationQuery:</span> <span class=\"hljs-string\">select</span> <span class=\"hljs-string\">'x'</span><br>      <span class=\"hljs-attr\">testWhileIdle:</span> <span class=\"hljs-literal\">true</span><br>      <span class=\"hljs-attr\">testOnBorrow:</span> <span class=\"hljs-literal\">false</span><br>      <span class=\"hljs-attr\">testOnReturn:</span> <span class=\"hljs-literal\">false</span><br>      <span class=\"hljs-attr\">poolPreparedStatements:</span> <span class=\"hljs-literal\">true</span><br>      <span class=\"hljs-attr\">maxOpenPreparedStatements:</span> <span class=\"hljs-number\">20</span><br>      <span class=\"hljs-attr\">filters:</span> <span class=\"hljs-string\">stat</span><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-meta\">@ConfigurationProperties</span>(prefix = <span class=\"hljs-string\">\"spring.datasource.hive\"</span>, ignoreUnknownFields = <span class=\"hljs-keyword\">false</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HiveJdbcProperties</span> </span>&#123;<br><br>    <span class=\"hljs-keyword\">private</span> String url;<br><br>    <span class=\"hljs-keyword\">private</span> String type;<br><br>    <span class=\"hljs-keyword\">private</span> String username;<br><br>    <span class=\"hljs-keyword\">private</span> String password;<br><br>    <span class=\"hljs-keyword\">private</span> String driverClassName;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-meta\">@ConfigurationProperties</span>(prefix = <span class=\"hljs-string\">\"spring.datasource.common-config\"</span>, ignoreUnknownFields = <span class=\"hljs-keyword\">false</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DataSourceCommonProperties</span> </span>&#123;<br><br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> initialSize = <span class=\"hljs-number\">10</span>;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> minIdle;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> maxIdle;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> maxActive;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> maxWait;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> timeBetweenEvictionRunsMillis;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> minEvictableIdleTimeMillis;<br>    <span class=\"hljs-keyword\">private</span> String validationQuery;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> testWhileIdle;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> testOnBorrow;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> testOnReturn;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> poolPreparedStatements;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> maxOpenPreparedStatements;<br>    <span class=\"hljs-keyword\">private</span> String filters;<br><br>    <span class=\"hljs-keyword\">private</span> String mapperLocations;<br>    <span class=\"hljs-keyword\">private</span> String typeAliasPackage;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Slf</span>4j<br><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-meta\">@EnableConfigurationProperties</span>(&#123;HiveJdbcProperties<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>, <span class=\"hljs-title\">DataSourceCommonProperties</span>.<span class=\"hljs-title\">class</span>&#125;)</span><br><span class=\"hljs-class\"><span class=\"hljs-title\">public</span> <span class=\"hljs-title\">class</span> <span class=\"hljs-title\">HiveDruidConfiguration</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> HiveJdbcProperties hiveJdbcProperties;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> DataSourceCommonProperties dataSourceCommonProperties;<br><br>    <span class=\"hljs-meta\">@Bean</span>(<span class=\"hljs-string\">\"hiveDruidDataSource\"</span>) <span class=\"hljs-comment\">//新建bean实例</span><br>    <span class=\"hljs-meta\">@Qualifier</span>(<span class=\"hljs-string\">\"hiveDruidDataSource\"</span>)<span class=\"hljs-comment\">//标识</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> DataSource <span class=\"hljs-title\">dataSource</span><span class=\"hljs-params\">()</span></span>&#123;<br>        DruidDataSource datasource = <span class=\"hljs-keyword\">new</span> DruidDataSource();<br><br>        <span class=\"hljs-comment\">//配置数据源属性</span><br>        datasource.setUrl(hiveJdbcProperties.getUrl());<br>        datasource.setUsername(hiveJdbcProperties.getUsername());<br>        datasource.setPassword(hiveJdbcProperties.getPassword());<br>        datasource.setDriverClassName(hiveJdbcProperties.getDriverClassName());<br><br>        <span class=\"hljs-comment\">//配置统一属性</span><br>        datasource.setInitialSize(dataSourceCommonProperties.getInitialSize());<br>        datasource.setMinIdle(dataSourceCommonProperties.getMinIdle());<br>        datasource.setMaxActive(dataSourceCommonProperties.getMaxActive());<br>        datasource.setMaxWait(dataSourceCommonProperties.getMaxWait());<br>        datasource.setTimeBetweenEvictionRunsMillis(dataSourceCommonProperties.getTimeBetweenEvictionRunsMillis());<br>        datasource.setMinEvictableIdleTimeMillis(dataSourceCommonProperties.getMinEvictableIdleTimeMillis());<br>        datasource.setValidationQuery(dataSourceCommonProperties.getValidationQuery());<br>        datasource.setTestWhileIdle(dataSourceCommonProperties.isTestWhileIdle());<br>        datasource.setTestOnBorrow(dataSourceCommonProperties.isTestOnBorrow());<br>        datasource.setTestOnReturn(dataSourceCommonProperties.isTestOnReturn());<br>        datasource.setPoolPreparedStatements(dataSourceCommonProperties.isPoolPreparedStatements());<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            datasource.setFilters(dataSourceCommonProperties.getFilters());<br>        &#125; <span class=\"hljs-keyword\">catch</span> (SQLException e) &#123;<br>            log.error(<span class=\"hljs-string\">\"Druid configuration initialization filter error.\"</span>, e);<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> datasource;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>注册jdbcTemplate </p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HiveJdbcConfiguration</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Bean</span>(<span class=\"hljs-string\">\"hiveJdbcTemplate\"</span>)<br>    <span class=\"hljs-meta\">@Qualifier</span>(<span class=\"hljs-string\">\"hiveJdbcTemplate\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> JdbcTemplate <span class=\"hljs-title\">jdbcTemplate</span><span class=\"hljs-params\">(@Qualifier(<span class=\"hljs-string\">\"hiveDruidDataSource\"</span>)</span> DataSource dataSource) </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> JdbcTemplate(dataSource);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"基本api调用\"><a href=\"#基本api调用\" class=\"headerlink\" title=\"基本api调用\"></a>基本api调用</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.service;<br><br><span class=\"hljs-keyword\">import</span> java.util.List;<br><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">HiveService</span> </span>&#123;<br><br>    <span class=\"hljs-function\">Object <span class=\"hljs-title\">select</span><span class=\"hljs-params\">(String hql)</span></span>;<br><br>    <span class=\"hljs-function\">List&lt;String&gt; <span class=\"hljs-title\">listAllTables</span><span class=\"hljs-params\">()</span></span>;<br><br>    <span class=\"hljs-function\">List&lt;String&gt; <span class=\"hljs-title\">describeTable</span><span class=\"hljs-params\">(String tableName)</span></span>;<br><br>    <span class=\"hljs-function\">List&lt;String&gt; <span class=\"hljs-title\">selectFromTable</span><span class=\"hljs-params\">(String tableName)</span></span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.service.impl;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.service.HiveService;<br><span class=\"hljs-keyword\">import</span> lombok.extern.slf4j.Slf4j;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Qualifier;<br><span class=\"hljs-keyword\">import</span> org.springframework.jdbc.core.JdbcTemplate;<br><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Service;<br><span class=\"hljs-keyword\">import</span> org.springframework.util.StringUtils;<br><br><span class=\"hljs-keyword\">import</span> javax.sql.DataSource;<br><span class=\"hljs-keyword\">import</span> java.sql.ResultSet;<br><span class=\"hljs-keyword\">import</span> java.sql.SQLException;<br><span class=\"hljs-keyword\">import</span> java.sql.Statement;<br><span class=\"hljs-keyword\">import</span> java.util.ArrayList;<br><span class=\"hljs-keyword\">import</span> java.util.Collections;<br><span class=\"hljs-keyword\">import</span> java.util.List;<br><br><span class=\"hljs-meta\">@Slf</span>4j<br><span class=\"hljs-meta\">@Service</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HiveServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">HiveService</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-meta\">@Qualifier</span>(<span class=\"hljs-string\">\"hiveJdbcTemplate\"</span>)<br>    <span class=\"hljs-keyword\">private</span> JdbcTemplate hiveJdbcTemplate;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-meta\">@Qualifier</span>(<span class=\"hljs-string\">\"hiveDruidDataSource\"</span>)<br>    <span class=\"hljs-keyword\">private</span> DataSource hiveDruidDataSource;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> Object <span class=\"hljs-title\">select</span><span class=\"hljs-params\">(String hql)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> hiveJdbcTemplate.queryForObject(hql, Object<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> List&lt;String&gt; <span class=\"hljs-title\">listAllTables</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        List&lt;String&gt; result = <span class=\"hljs-keyword\">new</span> ArrayList&lt;&gt;();<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Statement statement = hiveDruidDataSource.getConnection().createStatement();<br>            String sql = <span class=\"hljs-string\">\"show tables\"</span>;<br>            log.info(<span class=\"hljs-string\">\"Running: \"</span> + sql);<br>            ResultSet resultSet = statement.executeQuery(sql);<br>            <span class=\"hljs-keyword\">while</span> (resultSet.next()) &#123;<br>                result.add(resultSet.getString(<span class=\"hljs-number\">1</span>));<br>            &#125;<br>            <span class=\"hljs-keyword\">return</span> result;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (SQLException throwables) &#123;<br>            log.error(throwables.getMessage());<br>        &#125;<br><br>        <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> List&lt;String&gt; <span class=\"hljs-title\">describeTable</span><span class=\"hljs-params\">(String tableName)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(tableName))&#123;<br>            <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>        &#125;<br>        List&lt;String&gt; result = <span class=\"hljs-keyword\">new</span> ArrayList&lt;&gt;();<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Statement statement = hiveDruidDataSource.getConnection().createStatement();<br>            String sql = <span class=\"hljs-string\">\"describe \"</span> + tableName;<br>            log.info(<span class=\"hljs-string\">\"Running\"</span> + sql);<br>            ResultSet resultSet = statement.executeQuery(sql);<br>            <span class=\"hljs-keyword\">while</span> (resultSet.next()) &#123;<br>                result.add(resultSet.getString(<span class=\"hljs-number\">1</span>));<br>            &#125;<br>            <span class=\"hljs-keyword\">return</span> result;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (SQLException throwables) &#123;<br>            log.error(throwables.getMessage());<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> List&lt;String&gt; <span class=\"hljs-title\">selectFromTable</span><span class=\"hljs-params\">(String tableName)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(tableName))&#123;<br>            <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>        &#125;<br>        List&lt;String&gt; result = <span class=\"hljs-keyword\">new</span> ArrayList&lt;&gt;();<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            Statement statement = hiveDruidDataSource.getConnection().createStatement();<br>            String sql = <span class=\"hljs-string\">\"select * from \"</span> + tableName;<br>            log.info(<span class=\"hljs-string\">\"Running\"</span> + sql);<br>            ResultSet resultSet = statement.executeQuery(sql);<br>            <span class=\"hljs-keyword\">int</span> columnCount = resultSet.getMetaData().getColumnCount();<br>            String str = <span class=\"hljs-keyword\">null</span>;<br>            <span class=\"hljs-keyword\">while</span> (resultSet.next()) &#123;<br>                str = <span class=\"hljs-string\">\"\"</span>;<br>                <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">int</span> i = <span class=\"hljs-number\">1</span>; i &lt; columnCount; i++) &#123;<br>                    str += resultSet.getString(i) + <span class=\"hljs-string\">\" \"</span>;<br>                &#125;<br>                str += resultSet.getString(columnCount);<br>                log.info(str);<br>                result.add(str);<br>            &#125;<br>            <span class=\"hljs-keyword\">return</span> result;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (SQLException throwables) &#123;<br>            log.error(throwables.getMessage());<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>hive本身就是基于hadoop的MapReduce的一层封装，所以对于hive的操作都是查询和新增等操作，其他的api请参考jdbctemplate接口</p>\n<p>源码地址: </p>\n<p><a href=\"https://github.com/WinterChenS/springboot-learning-experience/tree/master/spring-boot-hadoop\" target=\"_blank\" rel=\"noopener\">WinterChenS/springboot-learning-experience</a></p>\n","raw":null,"categories":[{"name":"hadoop","path":"api/categories/hadoop.json"}],"tags":[{"name":"hadoop","path":"api/tags/hadoop.json"},{"name":"hive","path":"api/tags/hive.json"},{"name":"springboot","path":"api/tags/springboot.json"}]},{"title":"springboot集成hadoop实战","slug":"2020-12-01-springboot-hadoop-hdfs-mapreduce","date":"2020-12-01T10:43:00.000Z","updated":"2022-12-01T01:32:39.783Z","comments":true,"top":null,"path":"api/articles/2020-12-01-springboot-hadoop-hdfs-mapreduce.json","excerpt":null,"keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046751576454.jpg","content":"<p>springboot集成hadoop实现hdfs增删改查</p>\n<h2 id=\"maven坐标\"><a href=\"#maven坐标\" class=\"headerlink\" title=\"maven坐标\"></a>maven坐标</h2><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-common<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-streaming<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-yarn-common<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">exclusions</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">exclusion</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>com.google.guava<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>                <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>guava<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">exclusion</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">exclusions</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-distcp<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>provided<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-mapreduce-client-core<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-hdfs<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.hadoop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>hadoop-mapreduce-client-jobclient<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>$&#123;hadoop.version&#125;<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>provided<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br><span class=\"hljs-comment\">&lt;!-- 中文分词器 --&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>cn.bestwu<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>ik-analyzers<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>5.1.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h2 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h2><p>hdfs的配置</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">hdfs:</span><br>  <span class=\"hljs-attr\">hdfsPath:</span> <span class=\"hljs-string\">hdfs://bigdata-master:8020</span><br>  <span class=\"hljs-attr\">hdfsName:</span> <span class=\"hljs-string\">bigdata-master</span><br></code></pre></td></tr></table></figure>\n\n<p>将fileSystem配置并注册到spring容器</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Slf</span>4j<br><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HadoopHDFSConfiguration</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;hdfs.hdfsPath&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String hdfsPath;<br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;hdfs.hdfsName&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String hdfsName;<br><br>    <span class=\"hljs-meta\">@Bean</span><br>    <span class=\"hljs-keyword\">public</span> org.apache.hadoop.conf.<span class=\"hljs-function\">Configuration  <span class=\"hljs-title\">getConfiguration</span><span class=\"hljs-params\">()</span></span>&#123;<br>        org.apache.hadoop.conf.Configuration configuration = <span class=\"hljs-keyword\">new</span> org.apache.hadoop.conf.Configuration();<br>        configuration.set(<span class=\"hljs-string\">\"fs.defaultFS\"</span>, hdfsPath);<br>        <span class=\"hljs-keyword\">return</span> configuration;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Bean</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> FileSystem <span class=\"hljs-title\">getFileSystem</span><span class=\"hljs-params\">()</span></span>&#123;<br>        FileSystem fileSystem = <span class=\"hljs-keyword\">null</span>;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            fileSystem = FileSystem.get(<span class=\"hljs-keyword\">new</span> URI(hdfsPath), getConfiguration(), hdfsName);<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            <span class=\"hljs-comment\">// TODO Auto-generated catch block</span><br>            log.error(e.getMessage());<br>        &#125; <span class=\"hljs-keyword\">catch</span> (InterruptedException e) &#123;<br>            <span class=\"hljs-comment\">// TODO Auto-generated catch block</span><br>            log.error(e.getMessage());<br>        &#125; <span class=\"hljs-keyword\">catch</span> (URISyntaxException e) &#123;<br>            <span class=\"hljs-comment\">// TODO Auto-generated catch block</span><br>            log.error(e.getMessage());<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> fileSystem;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"增删改查\"><a href=\"#增删改查\" class=\"headerlink\" title=\"增删改查\"></a>增删改查</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">HDFSService</span> </span>&#123;<br><br>\t\t<span class=\"hljs-comment\">// 创建文件夹</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">makeFolder</span><span class=\"hljs-params\">(String path)</span></span>;<br>\t\t<span class=\"hljs-comment\">// 是否存在文件</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">existFile</span><span class=\"hljs-params\">(String path)</span></span>;<br>\t\t<br>    List&lt;Map&lt;String, Object&gt;&gt; readCatalog(String path);<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">createFile</span><span class=\"hljs-params\">(String path, MultipartFile file)</span></span>;<br><br>    <span class=\"hljs-function\">String <span class=\"hljs-title\">readFileContent</span><span class=\"hljs-params\">(String path)</span></span>;<br><br>    List&lt;Map&lt;String, Object&gt;&gt; listFile(String path);<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">renameFile</span><span class=\"hljs-params\">(String oldName, String newName)</span></span>;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">deleteFile</span><span class=\"hljs-params\">(String path)</span></span>;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">uploadFile</span><span class=\"hljs-params\">(String path, String uploadPath)</span></span>;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">downloadFile</span><span class=\"hljs-params\">(String path, String downloadPath)</span></span>;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">copyFile</span><span class=\"hljs-params\">(String sourcePath, String targetPath)</span></span>;<br><br>    <span class=\"hljs-keyword\">byte</span>[] openFileToBytes(String path);<br><br>    BlockLocation[] getFileBlockLocations(String path);<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br><span class=\"line\">326</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Slf</span>4j<br><span class=\"hljs-meta\">@Service</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">HDFSServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">HDFSService</span> </span>&#123;<br><br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-keyword\">int</span> bufferSize = <span class=\"hljs-number\">1024</span> * <span class=\"hljs-number\">1024</span> * <span class=\"hljs-number\">64</span>;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> FileSystem fileSystem;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">makeFolder</span><span class=\"hljs-params\">(String path)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">boolean</span> target = <span class=\"hljs-keyword\">false</span>;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(path)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>        &#125;<br>        <span class=\"hljs-keyword\">if</span> (existFile(path)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">true</span>;<br>        &#125;<br>        Path src = <span class=\"hljs-keyword\">new</span> Path(path);<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            target = fileSystem.mkdirs(src);<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(e.getMessage());<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> target;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">existFile</span><span class=\"hljs-params\">(String path)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(path))&#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>        &#125;<br>        Path src = <span class=\"hljs-keyword\">new</span> Path(path);<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            <span class=\"hljs-keyword\">return</span> fileSystem.exists(src);<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(e.getMessage());<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-keyword\">public</span> List&lt;Map&lt;String, Object&gt;&gt; readCatalog(String path) &#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(path))&#123;<br>            <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>        &#125;<br>        <span class=\"hljs-keyword\">if</span> (!existFile(path))&#123;<br>            log.error(<span class=\"hljs-string\">\"catalog is not exist!!\"</span>);<br>            <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>        &#125;<br><br>        Path src = <span class=\"hljs-keyword\">new</span> Path(path);<br>        FileStatus[] fileStatuses = <span class=\"hljs-keyword\">null</span>;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            fileStatuses = fileSystem.listStatus(src);<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(e.getMessage());<br>        &#125;<br>        List&lt;Map&lt;String, Object&gt;&gt; result = <span class=\"hljs-keyword\">new</span> ArrayList&lt;&gt;(fileStatuses.length);<br><br>        <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != fileStatuses &amp;&amp; <span class=\"hljs-number\">0</span> &lt; fileStatuses.length) &#123;<br>            <span class=\"hljs-keyword\">for</span> (FileStatus fileStatus : fileStatuses) &#123;<br>                Map&lt;String, Object&gt; cataLogMap = <span class=\"hljs-keyword\">new</span> HashMap&lt;&gt;();<br>                cataLogMap.put(<span class=\"hljs-string\">\"filePath\"</span>, fileStatus.getPath());<br>                cataLogMap.put(<span class=\"hljs-string\">\"fileStatus\"</span>, fileStatus);<br>                result.add(cataLogMap);<br>            &#125;<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> result;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">createFile</span><span class=\"hljs-params\">(String path, MultipartFile file)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">boolean</span> target = <span class=\"hljs-keyword\">false</span>;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(path)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>        &#125;<br>        String fileName = file.getName();<br>        Path newPath = <span class=\"hljs-keyword\">new</span> Path(path + <span class=\"hljs-string\">\"/\"</span> + fileName);<br><br>        FSDataOutputStream outputStream = <span class=\"hljs-keyword\">null</span>;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            outputStream = fileSystem.create(newPath);<br>            outputStream.write(file.getBytes());<br>            target = <span class=\"hljs-keyword\">true</span>;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(e.getMessage());<br>        &#125; <span class=\"hljs-keyword\">finally</span> &#123;<br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != outputStream) &#123;<br>                <span class=\"hljs-keyword\">try</span> &#123;<br>                    outputStream.close();<br>                &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>                    log.error(e.getMessage());<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> target;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">readFileContent</span><span class=\"hljs-params\">(String path)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(path))&#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>        &#125;<br><br>        <span class=\"hljs-keyword\">if</span> (!existFile(path)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>        &#125;<br><br>        Path src = <span class=\"hljs-keyword\">new</span> Path(path);<br><br>        FSDataInputStream inputStream = <span class=\"hljs-keyword\">null</span>;<br>        StringBuilder sb = <span class=\"hljs-keyword\">new</span> StringBuilder();<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            inputStream = fileSystem.open(src);<br>            String lineText = <span class=\"hljs-string\">\"\"</span>;<br>            <span class=\"hljs-keyword\">while</span> ((lineText = inputStream.readLine()) != <span class=\"hljs-keyword\">null</span>) &#123;<br>                sb.append(lineText);<br>            &#125;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(e.getMessage());<br>        &#125; <span class=\"hljs-keyword\">finally</span> &#123;<br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != inputStream) &#123;<br>                <span class=\"hljs-keyword\">try</span> &#123;<br>                    inputStream.close();<br>                &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>                    log.error(e.getMessage());<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> sb.toString();<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-keyword\">public</span> List&lt;Map&lt;String, Object&gt;&gt; listFile(String path) &#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(path)) &#123;<br>            <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>        &#125;<br>        <span class=\"hljs-keyword\">if</span> (!existFile(path)) &#123;<br>            <span class=\"hljs-keyword\">return</span> Collections.emptyList();<br>        &#125;<br>        List&lt;Map&lt;String,Object&gt;&gt; resultList = <span class=\"hljs-keyword\">new</span> ArrayList&lt;&gt;();<br><br>        Path src = <span class=\"hljs-keyword\">new</span> Path(path);<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            RemoteIterator&lt;LocatedFileStatus&gt; fileIterator = fileSystem.listFiles(src, <span class=\"hljs-keyword\">true</span>);<br>            <span class=\"hljs-keyword\">while</span> (fileIterator.hasNext()) &#123;<br>                LocatedFileStatus next = fileIterator.next();<br>                Path filePath = next.getPath();<br>                String fileName = filePath.getName();<br>                Map&lt;String, Object&gt; map = <span class=\"hljs-keyword\">new</span> HashMap&lt;&gt;();<br>                map.put(<span class=\"hljs-string\">\"fileName\"</span>, fileName);<br>                map.put(<span class=\"hljs-string\">\"filePath\"</span>, filePath.toString());<br>                resultList.add(map);<br>            &#125;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(e.getMessage());<br>        &#125;<br><br>        <span class=\"hljs-keyword\">return</span> resultList;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">renameFile</span><span class=\"hljs-params\">(String oldName, String newName)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">boolean</span> target = <span class=\"hljs-keyword\">false</span>;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(oldName) || StringUtils.isEmpty(newName)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>        &#125;<br>        Path oldPath = <span class=\"hljs-keyword\">new</span> Path(oldName);<br>        Path newPath = <span class=\"hljs-keyword\">new</span> Path(newName);<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            target = fileSystem.rename(oldPath, newPath);<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(e.getMessage());<br>        &#125;<br><br>        <span class=\"hljs-keyword\">return</span> target;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">deleteFile</span><span class=\"hljs-params\">(String path)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">boolean</span> target = <span class=\"hljs-keyword\">false</span>;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(path)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>        &#125;<br>        <span class=\"hljs-keyword\">if</span> (!existFile(path)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>        &#125;<br>        Path src = <span class=\"hljs-keyword\">new</span> Path(path);<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            target = fileSystem.deleteOnExit(src);<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(e.getMessage());<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> target;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">uploadFile</span><span class=\"hljs-params\">(String path, String uploadPath)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(path) || StringUtils.isEmpty(uploadPath)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>        &#125;<br><br>        Path clientPath = <span class=\"hljs-keyword\">new</span> Path(path);<br><br>        Path serverPath = <span class=\"hljs-keyword\">new</span> Path(uploadPath);<br><br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            fileSystem.copyFromLocalFile(<span class=\"hljs-keyword\">false</span>,clientPath,serverPath);<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">true</span>;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(e.getMessage(), e);<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">downloadFile</span><span class=\"hljs-params\">(String path, String downloadPath)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(path) || StringUtils.isEmpty(downloadPath)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>        &#125;<br><br>        Path clienPath = <span class=\"hljs-keyword\">new</span> Path(path);<br><br>        Path targetPath = <span class=\"hljs-keyword\">new</span> Path(downloadPath);<br><br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            fileSystem.copyToLocalFile(<span class=\"hljs-keyword\">false</span>,clienPath, targetPath);<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">true</span>;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(e.getMessage());<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">copyFile</span><span class=\"hljs-params\">(String sourcePath, String targetPath)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(sourcePath) || StringUtils.isEmpty(targetPath)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>        &#125;<br><br>        Path oldPath = <span class=\"hljs-keyword\">new</span> Path(sourcePath);<br><br>        Path newPath = <span class=\"hljs-keyword\">new</span> Path(targetPath);<br><br>        FSDataInputStream inputStream = <span class=\"hljs-keyword\">null</span>;<br>        FSDataOutputStream outputStream = <span class=\"hljs-keyword\">null</span>;<br><br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            inputStream = fileSystem.open(oldPath);<br>            outputStream = fileSystem.create(newPath);<br><br>            IOUtils.copyBytes(inputStream,outputStream,bufferSize,<span class=\"hljs-keyword\">false</span>);<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">true</span>;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(e.getMessage());<br>        &#125; <span class=\"hljs-keyword\">finally</span> &#123;<br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != inputStream) &#123;<br>                <span class=\"hljs-keyword\">try</span> &#123;<br>                    inputStream.close();<br>                &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>                    log.error(e.getMessage());<br>                &#125;<br>            &#125;<br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != outputStream) &#123;<br>                <span class=\"hljs-keyword\">try</span> &#123;<br>                    outputStream.close();<br>                &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>                    log.error(e.getMessage());<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">false</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">byte</span>[] openFileToBytes(String path) &#123;<br><br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(path)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>        &#125;<br><br>        <span class=\"hljs-keyword\">if</span> (!existFile(path)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>        &#125;<br><br>        Path src = <span class=\"hljs-keyword\">new</span> Path(path);<br>        <span class=\"hljs-keyword\">byte</span>[] result = <span class=\"hljs-keyword\">null</span>;<br>        FSDataInputStream inputStream = <span class=\"hljs-keyword\">null</span>;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            inputStream = fileSystem.open(src);<br>            result = IOUtils.readFullyToByteArray(inputStream);<br>        &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>            log.error(e.getMessage());<br>        &#125; <span class=\"hljs-keyword\">finally</span> &#123;<br>            <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != inputStream)&#123;<br>                <span class=\"hljs-keyword\">try</span> &#123;<br>                    inputStream.close();<br>                &#125; <span class=\"hljs-keyword\">catch</span> (IOException e) &#123;<br>                    log.error(e.getMessage());<br>                &#125;<br>            &#125;<br>        &#125;<br><br>        <span class=\"hljs-keyword\">return</span> result;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-keyword\">public</span> BlockLocation[] getFileBlockLocations(String path) &#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(path)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>        &#125;<br>        <span class=\"hljs-keyword\">if</span> (!existFile(path)) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>        &#125;<br>        BlockLocation[] blocks = <span class=\"hljs-keyword\">null</span>;<br>        Path src = <span class=\"hljs-keyword\">new</span> Path(path);<br>        <span class=\"hljs-keyword\">try</span>&#123;<br>            FileStatus fileStatus = fileSystem.getFileStatus(src);<br>            blocks = fileSystem.getFileBlockLocations(fileStatus, <span class=\"hljs-number\">0</span>, fileStatus.getLen());<br>        &#125;<span class=\"hljs-keyword\">catch</span>(Exception e)&#123;<br>            log.error(e.getMessage());<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> blocks;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"mapReduce\"><a href=\"#mapReduce\" class=\"headerlink\" title=\"mapReduce\"></a>mapReduce</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.reduce;<br><br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.io.IntWritable;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.io.LongWritable;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.io.Text;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.mapreduce.Reducer;<br><br><span class=\"hljs-keyword\">import</span> java.io.IOException;<br><span class=\"hljs-keyword\">import</span> java.util.ArrayList;<br><span class=\"hljs-keyword\">import</span> java.util.List;<br><br><span class=\"hljs-comment\">/*</span><br><span class=\"hljs-comment\"> * 继承Reducer类需要定义四个输出、输出类型泛型：</span><br><span class=\"hljs-comment\"> * 四个泛型类型分别代表：</span><br><span class=\"hljs-comment\"> * KeyIn        Reducer的输入数据的Key，这里是每行文字中的单词\"hello\"</span><br><span class=\"hljs-comment\"> * ValueIn      Reducer的输入数据的Value，这里是每行文字中的次数</span><br><span class=\"hljs-comment\"> * KeyOut       Reducer的输出数据的Key，这里是每行文字中的单词\"hello\"</span><br><span class=\"hljs-comment\"> * ValueOut     Reducer的输出数据的Value，这里是每行文字中的出现的总次数</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">WordReduce</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">Reducer</span>&lt;<span class=\"hljs-title\">Text</span>, <span class=\"hljs-title\">IntWritable</span>, <span class=\"hljs-title\">Text</span>, <span class=\"hljs-title\">IntWritable</span>&gt; </span>&#123;<br><br>    <span class=\"hljs-keyword\">private</span> IntWritable result = <span class=\"hljs-keyword\">new</span> IntWritable();<br>    <span class=\"hljs-keyword\">private</span> List&lt;String&gt; textList = <span class=\"hljs-keyword\">new</span> ArrayList&lt;&gt;();<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">protected</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">reduce</span><span class=\"hljs-params\">(Text key, Iterable&lt;IntWritable&gt; values, Context context)</span> <span class=\"hljs-keyword\">throws</span> IOException, InterruptedException </span>&#123;<br>        <span class=\"hljs-keyword\">int</span> sum = <span class=\"hljs-number\">0</span>;<br>        <span class=\"hljs-keyword\">for</span> (IntWritable val : values) &#123;<br>            sum += val.get();<br>        &#125;<br>        result.set(sum);<br>        context.write(key, result);<br><br>        String keyStr = key.toString();<br><br>        <span class=\"hljs-comment\">// 使用分词器，内容已经被统计好了，直接输出即可</span><br>        <span class=\"hljs-keyword\">if</span> (textList.contains(keyStr)) &#123;<br>            System.out.println(<span class=\"hljs-string\">\"============ \"</span> + keyStr + <span class=\"hljs-string\">\" 统计分词为: \"</span> + sum + <span class=\"hljs-string\">\" ============\"</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.configuration;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.HadoopDemoApplication;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.mapper.WordMapper;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.reduce.WordReduce;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.conf.Configuration;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.fs.Path;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.io.IntWritable;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.io.Text;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.mapreduce.Job;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.mapreduce.lib.input.FileInputFormat;<br><span class=\"hljs-keyword\">import</span> org.apache.hadoop.mapreduce.lib.output.FileOutputFormat;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Value;<br><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Component;<br><br><span class=\"hljs-keyword\">import</span> javax.annotation.PostConstruct;<br><span class=\"hljs-keyword\">import</span> java.io.IOException;<br><br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ReduceJobsConfiguration</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;hdfs.hdfsPath&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String hdfsPath;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * 获取HDFS配置信息</span><br><span class=\"hljs-comment\">     *</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span></span><br><span class=\"hljs-comment\">     */</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> Configuration <span class=\"hljs-title\">getConfiguration</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        Configuration configuration = <span class=\"hljs-keyword\">new</span> Configuration();<br>        configuration.set(<span class=\"hljs-string\">\"fs.defaultFS\"</span>, hdfsPath);<br>        configuration.set(<span class=\"hljs-string\">\"mapred.job.tracker\"</span>, hdfsPath);<br>        <span class=\"hljs-keyword\">return</span> configuration;<br>    &#125;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * 获取单词统计的配置信息</span><br><span class=\"hljs-comment\">     *</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@param</span> jobName</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@param</span> inputPath</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@param</span> outputPath</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@throws</span> IOException</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@throws</span> ClassNotFoundException</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@throws</span> InterruptedException</span><br><span class=\"hljs-comment\">     */</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">getWordCountJobsConf</span><span class=\"hljs-params\">(String jobName, String inputPath, String outputPath)</span></span><br><span class=\"hljs-function\">            <span class=\"hljs-keyword\">throws</span> IOException, ClassNotFoundException, InterruptedException </span>&#123;<br>        Configuration conf = getConfiguration();<br>        Job job = Job.getInstance(conf, jobName);<br><br>        job.setMapperClass(WordMapper<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br>        job.setCombinerClass(WordReduce<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br>        job.setJarByClass(HadoopDemoApplication<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br>        job.setReducerClass(WordReduce<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br><br>        job.setOutputKeyClass(Text<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br>        job.setOutputValueClass(IntWritable<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br><br>        FileInputFormat.addInputPath(job, <span class=\"hljs-keyword\">new</span> Path(inputPath));<br>        FileOutputFormat.setOutputPath(job, <span class=\"hljs-keyword\">new</span> Path(outputPath));<br>        job.waitForCompletion(<span class=\"hljs-keyword\">true</span>);<br>    &#125;<br><br>    <span class=\"hljs-meta\">@PostConstruct</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">getPath</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        hdfsPath = <span class=\"hljs-keyword\">this</span>.hdfsPath;<br>    &#125;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">getHdfsPath</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> hdfsPath;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">MapReduceService</span> </span>&#123;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">wordCount</span><span class=\"hljs-params\">(String jobName, String inputPath, String outputPath)</span> <span class=\"hljs-keyword\">throws</span> Exception</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.service.impl;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.configuration.ReduceJobsConfiguration;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.service.HDFSService;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.service.MapReduceService;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Service;<br><span class=\"hljs-keyword\">import</span> org.springframework.util.StringUtils;<br><br><span class=\"hljs-meta\">@Service</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MapReduceServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">MapReduceService</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> HDFSService hdfsService;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> ReduceJobsConfiguration reduceJobsConfiguration;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">wordCount</span><span class=\"hljs-params\">(String jobName, String inputPath, String outputPath)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(jobName) || StringUtils.isEmpty(inputPath)) &#123;<br>            <span class=\"hljs-keyword\">return</span>;<br>        &#125;<br>        <span class=\"hljs-comment\">// 输出目录 = output/当前Job,如果输出路径存在则删除，保证每次都是最新的</span><br>        <span class=\"hljs-keyword\">if</span> (hdfsService.existFile(outputPath)) &#123;<br>            hdfsService.deleteFile(outputPath);<br>        &#125;<br>        reduceJobsConfiguration.getWordCountJobsConf(jobName, inputPath, outputPath);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.hadoopdemo.service.impl;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.configuration.ReduceJobsConfiguration;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.service.HDFSService;<br><span class=\"hljs-keyword\">import</span> com.winterchen.hadoopdemo.service.MapReduceService;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Service;<br><span class=\"hljs-keyword\">import</span> org.springframework.util.StringUtils;<br><br><span class=\"hljs-meta\">@Service</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MapReduceServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">MapReduceService</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> HDFSService hdfsService;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> ReduceJobsConfiguration reduceJobsConfiguration;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">wordCount</span><span class=\"hljs-params\">(String jobName, String inputPath, String outputPath)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (StringUtils.isEmpty(jobName) || StringUtils.isEmpty(inputPath)) &#123;<br>            <span class=\"hljs-keyword\">return</span>;<br>        &#125;<br>        <span class=\"hljs-comment\">// 输出目录 = output/当前Job,如果输出路径存在则删除，保证每次都是最新的</span><br>        <span class=\"hljs-keyword\">if</span> (hdfsService.existFile(outputPath)) &#123;<br>            hdfsService.deleteFile(outputPath);<br>        &#125;<br>        reduceJobsConfiguration.getWordCountJobsConf(jobName, inputPath, outputPath);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Slf</span>4j<br><span class=\"hljs-meta\">@Api</span>(tags = <span class=\"hljs-string\">\"map reduce api\"</span>)<br><span class=\"hljs-meta\">@RestController</span><br><span class=\"hljs-meta\">@RequestMapping</span>(<span class=\"hljs-string\">\"/api/v1/map-reduce\"</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">MapReduceController</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> MapReduceService mapReduceService;<br><br>    <span class=\"hljs-meta\">@ApiOperation</span>(<span class=\"hljs-string\">\"count word\"</span>)<br>    <span class=\"hljs-meta\">@PostMapping</span>(<span class=\"hljs-string\">\"/word/count\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> APIResponse <span class=\"hljs-title\">wordCount</span><span class=\"hljs-params\">(</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">            @ApiParam(name = <span class=\"hljs-string\">\"jobName\"</span>, required = <span class=\"hljs-keyword\">true</span>)</span></span><br><span class=\"hljs-function\">            @<span class=\"hljs-title\">RequestParam</span><span class=\"hljs-params\">(name = <span class=\"hljs-string\">\"jobName\"</span>, required = <span class=\"hljs-keyword\">true</span>)</span></span><br><span class=\"hljs-function\">            String jobName,</span><br><span class=\"hljs-function\">            @<span class=\"hljs-title\">ApiParam</span><span class=\"hljs-params\">(name = <span class=\"hljs-string\">\"inputPath\"</span>, required = <span class=\"hljs-keyword\">true</span>)</span></span><br><span class=\"hljs-function\">            @<span class=\"hljs-title\">RequestParam</span><span class=\"hljs-params\">(name = <span class=\"hljs-string\">\"inputPath\"</span>, required = <span class=\"hljs-keyword\">true</span>)</span></span><br><span class=\"hljs-function\">            String inputPath,</span><br><span class=\"hljs-function\">            @<span class=\"hljs-title\">ApiParam</span><span class=\"hljs-params\">(name = <span class=\"hljs-string\">\"outputPath\"</span>, required = <span class=\"hljs-keyword\">true</span>)</span></span><br><span class=\"hljs-function\">            @<span class=\"hljs-title\">RequestParam</span><span class=\"hljs-params\">(name = <span class=\"hljs-string\">\"outputPath\"</span>, required = <span class=\"hljs-keyword\">true</span>)</span></span><br><span class=\"hljs-function\">            String outputPath</span><br><span class=\"hljs-function\">    )</span>&#123;<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            mapReduceService.wordCount(jobName, inputPath, outputPath);<br>            <span class=\"hljs-keyword\">return</span> APIResponse.success();<br>        &#125; <span class=\"hljs-keyword\">catch</span> (Exception e) &#123;<br>            log.error(e.getMessage());<br>            <span class=\"hljs-keyword\">return</span> APIResponse.fail(e.getMessage());<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>以上就是日常开发中能使用到的基本的功能：hdfs的增删改查，以及MapReduce；</p>\n<p>源码地址: </p>\n<p><a href=\"https://github.com/WinterChenS/springboot-learning-experience/tree/master/spring-boot-hadoop\" target=\"_blank\" rel=\"noopener\">WinterChenS/springboot-learning-experience</a></p>\n","raw":null,"categories":[{"name":"hadoop","path":"api/categories/hadoop.json"}],"tags":[{"name":"hadoop","path":"api/tags/hadoop.json"},{"name":"springboot","path":"api/tags/springboot.json"},{"name":"hdfs","path":"api/tags/hdfs.json"}]},{"title":"mapstruct 高级用法之userid转换为username","slug":"2020-11-30-mapstruct-convert-userid-to-username","date":"2020-11-30T10:30:00.000Z","updated":"2022-12-01T01:32:39.783Z","comments":true,"top":null,"path":"api/articles/2020-11-30-mapstruct-convert-userid-to-username.json","excerpt":null,"keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046749906558.jpg","content":"<p>mapstruct的简单用法就不讲了，看完这篇文章能获得什么呢？</p>\n<ul>\n<li>1.普通用法：将userId转换为userName？</li>\n<li>2.高级用法：一劳永逸的将userId转换为userName？</li>\n</ul>\n<p>很多时候在数据库里面只有userid而没有username的冗余信息，在entity转换为dto，vo等模型的时候需要额外的设值，mapstruct可以很方便的进行对象之间的转换，那么接下来我们就开始吧</p>\n<h2 id=\"前提\"><a href=\"#前提\" class=\"headerlink\" title=\"前提\"></a>前提</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/27 4:52 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span> 项目信息</span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@Builder</span><br><span class=\"hljs-meta\">@ToString</span><br><span class=\"hljs-meta\">@ApiModel</span>(<span class=\"hljs-string\">\"项目信息\"</span>)<br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@EqualsAndHashCode</span>(callSuper=<span class=\"hljs-keyword\">false</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ProjectDTO</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">Serializable</span> </span>&#123;<br><br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-keyword\">long</span> serialVersionUID = -<span class=\"hljs-number\">2601073448289463936L</span>;<br><br>\t\t<span class=\"hljs-comment\">// ... 省略部分字段</span><br>\t\t<br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"创建人\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String createUserId;<br>\t\t<br>\t\t<span class=\"hljs-comment\">// 这里一定不能使用String类型，必须要自己包装一个简单的类型，因为mapstruct是根据类型进行转换的</span><br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"创建人名称\"</span>)<br>    <span class=\"hljs-keyword\">private</span> SimpleUserDTO createUserName;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@Builder</span><br><span class=\"hljs-meta\">@ToString</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@ApiModel</span>(<span class=\"hljs-string\">\"基本用户信息\"</span>)<br><span class=\"hljs-meta\">@EqualsAndHashCode</span>(callSuper=<span class=\"hljs-keyword\">false</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">SimpleUserDTO</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">Serializable</span> </span>&#123;<br><br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-keyword\">long</span> serialVersionUID = <span class=\"hljs-number\">6889842645997918707L</span>;<br><br>    <span class=\"hljs-meta\">@ApiModelProperty</span>(<span class=\"hljs-string\">\"用户名\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String userName;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/27 4:52 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span> 项目信息</span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-meta\">@Data</span><br><span class=\"hljs-meta\">@Builder</span><br><span class=\"hljs-meta\">@ToString</span><br><span class=\"hljs-meta\">@NoArgsConstructor</span><br><span class=\"hljs-meta\">@AllArgsConstructor</span><br><span class=\"hljs-meta\">@Document</span>(collection = <span class=\"hljs-string\">\"project\"</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">Project</span> </span>&#123;<br><br>\t\t<span class=\"hljs-comment\">// ... 省略部分字段   </span><br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * 创建人</span><br><span class=\"hljs-comment\">     */</span><br>    <span class=\"hljs-meta\">@CreatedBy</span><br>    <span class=\"hljs-keyword\">private</span> String createUserId;<br><br>    <br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"普通用法\"><a href=\"#普通用法\" class=\"headerlink\" title=\"普通用法\"></a>普通用法</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/28 1:48 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span></span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-meta\">@Mapper</span>(componentModel = <span class=\"hljs-string\">\"spring\"</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">abstract</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ProjectMapping</span></span>&#123;<br>\t\t<br>\t\t<span class=\"hljs-comment\">// 博主这里使用的是mongodb，这里可以换成你对应的查询用户信息的类</span><br>\t\t<span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">protected</span> MongoTemplate mongoTemplate;<br>\t\t<span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">\t\t * 这里的注释主要是指定需要转换的source到target的信息，mapstruct会根据类型进行相应的转换</span><br><span class=\"hljs-comment\">\t\t * 比如 String-&gt; SimpleUserDTO</span><br><span class=\"hljs-comment\">\t\t * 所以我们需要指定属性名称，然后mapstruct会根据属性类型调用方法 SimpleUserDTO toConvertToUserName(String userId) </span><br><span class=\"hljs-comment\">\t\t **/</span><br>    <span class=\"hljs-meta\">@Mappings</span>(&#123;<br>            <span class=\"hljs-meta\">@Mapping</span>(target = <span class=\"hljs-string\">\"createUserName\"</span>, source = <span class=\"hljs-string\">\"createUserId\"</span>)<br>    &#125;)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">abstract</span> ProjectDTO <span class=\"hljs-title\">toConvertToDto</span><span class=\"hljs-params\">(Project project)</span></span>;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">abstract</span> List&lt;ProjectDTO&gt; <span class=\"hljs-title\">toConvertToDtos</span><span class=\"hljs-params\">(List&lt;Project&gt; projects)</span></span>;<br><br>\t\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">protected</span> SimpleUserDTO <span class=\"hljs-title\">toConvertToUserName</span><span class=\"hljs-params\">(String userId)</span> </span>&#123;<br>\t        Query query = <span class=\"hljs-keyword\">new</span> Query(Criteria.where(<span class=\"hljs-string\">\"id\"</span>).is(userId));<br>\t        User user = mongoTemplate.findOne(query, User<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br>\t        <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != user) &#123;<br>\t            SimpleUserDTO result = SimpleUserDTO.builder()<br>\t                    .userName(user.getUserName())<br>\t                    .build();<br>\t            <span class=\"hljs-keyword\">return</span> result;<br>\t        &#125;<br>\t        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<ul>\n<li>注意点：没有使用interface而是使用abstract抽象类，主要原因是因为需要有自己的实现方法来转换userid到username</li>\n</ul>\n<p>我们看看maven编译之后的实现类：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Generated</span>(<br>    value = <span class=\"hljs-string\">\"org.mapstruct.ap.MappingProcessor\"</span>,<br>    date = <span class=\"hljs-string\">\"2020-11-28T16:43:17+0800\"</span>,<br>    comments = <span class=\"hljs-string\">\"version: 1.3.1.Final, compiler: javac, environment: Java 1.8.0_251 (Oracle Corporation)\"</span><br>)<br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ProjectMappingImpl</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">ProjectMapping</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> ProjectDTO <span class=\"hljs-title\">toConvertToDto</span><span class=\"hljs-params\">(Project project)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> ( project == <span class=\"hljs-keyword\">null</span> ) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>        &#125;<br>        ProjectDTOBuilder projectDTO = ProjectDTO.builder();<br>\t\t\t\t<span class=\"hljs-comment\">// 重点看这里，mapstruct生成的实现类会自动调用我们定义的方法</span><br>        projectDTO.createUserName( toConvertToUserName( project.getCreateUserId() ) );<br>        projectDTO.createUserId( project.getCreateUserId() );<br>        <span class=\"hljs-keyword\">return</span> projectDTO.build();<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> List&lt;ProjectDTO&gt; <span class=\"hljs-title\">toConvertToDtos</span><span class=\"hljs-params\">(List&lt;Project&gt; projects)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> ( projects == <span class=\"hljs-keyword\">null</span> ) &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>        &#125;<br><br>        List&lt;ProjectDTO&gt; list = <span class=\"hljs-keyword\">new</span> ArrayList&lt;ProjectDTO&gt;( projects.size() );<br>        <span class=\"hljs-keyword\">for</span> ( Project project : projects ) &#123;<br>            list.add( toConvertToDto( project ) );<br>        &#125;<br><br>        <span class=\"hljs-keyword\">return</span> list;<br>    &#125;<br><br>\t\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">protected</span> SimpleUserDTO <span class=\"hljs-title\">toConvertToUserName</span><span class=\"hljs-params\">(String userId)</span> </span>&#123;<br>\t\t        Query query = <span class=\"hljs-keyword\">new</span> Query(Criteria.where(<span class=\"hljs-string\">\"id\"</span>).is(userId));<br>\t\t        User user = mongoTemplate.findOne(query, User<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br>\t\t        <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != user) &#123;<br>\t\t            SimpleUserDTO result = SimpleUserDTO.builder()<br>\t\t                    .userName(user.getUserName())<br>\t\t                    .build();<br>\t\t            <span class=\"hljs-keyword\">return</span> result;<br>\t\t        &#125;<br>\t\t        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>返回的结果：</p>\n<figure class=\"highlight json\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs json\">&#123;<br>  <span class=\"hljs-attr\">\"code\"</span>: <span class=\"hljs-number\">200</span>,<br>  <span class=\"hljs-attr\">\"data\"</span>: &#123;<br>    <span class=\"hljs-attr\">\"createUserId\"</span>: <span class=\"hljs-string\">\"5fb476444dfa732e47790966\"</span>,<br>    <span class=\"hljs-attr\">\"createUserName\"</span>: &#123;<br>      <span class=\"hljs-attr\">\"userName\"</span>: <span class=\"hljs-string\">\"winter\"</span><br>    &#125;<br>  &#125;,<br>  <span class=\"hljs-attr\">\"message\"</span>: <span class=\"hljs-string\">\"操作成功\"</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"高级用法：一劳永逸型用法\"><a href=\"#高级用法：一劳永逸型用法\" class=\"headerlink\" title=\"高级用法：一劳永逸型用法\"></a>高级用法：一劳永逸型用法</h2><p>所谓的一劳永逸主要是解决每次都要写实现就很烦了，所以就要实现写一次后面都不用实现了，思路是这样的，ProjectMapping抽象类继续往上抽象一层，将上述的转换方法抽到上一层，以后有需要转换userid到username的需求只需要继承那个抽象类（BaseMapping）</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/28 4:31 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span> 基本的mapping</span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">abstract</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">BaseMapping</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">protected</span> MongoTemplate mongoTemplate;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">protected</span> SimpleUserDTO <span class=\"hljs-title\">toConvertToUserName</span><span class=\"hljs-params\">(String userId)</span> </span>&#123;<br>        Query query = <span class=\"hljs-keyword\">new</span> Query(Criteria.where(<span class=\"hljs-string\">\"id\"</span>).is(userId));<br>        User user = mongoTemplate.findOne(query, User<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br>        <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-keyword\">null</span> != user) &#123;<br>            SimpleUserDTO result = SimpleUserDTO.builder()<br>                    .userName(user.getUserName())<br>                    .build();<br>            <span class=\"hljs-keyword\">return</span> result;<br>        &#125;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">null</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@author</span> winterchen</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@version</span> 1.0</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@date</span> 2020/11/28 1:48 下午</span><br><span class=\"hljs-comment\"> * <span class=\"hljs-doctag\">@description</span></span><br><span class=\"hljs-comment\"> **/</span><br><span class=\"hljs-meta\">@Mapper</span>(componentModel = <span class=\"hljs-string\">\"spring\"</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">abstract</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">ProjectMapping</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">BaseMapping</span></span>&#123;<br><br>    <span class=\"hljs-meta\">@Mappings</span>(&#123;<br>            <span class=\"hljs-meta\">@Mapping</span>(target = <span class=\"hljs-string\">\"createUserName\"</span>, source = <span class=\"hljs-string\">\"createUserId\"</span>)<br>    &#125;)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">abstract</span> ProjectDTO <span class=\"hljs-title\">toConvertToDto</span><span class=\"hljs-params\">(Project project)</span></span>;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">abstract</span> List&lt;ProjectDTO&gt; <span class=\"hljs-title\">toConvertToDtos</span><span class=\"hljs-params\">(List&lt;Project&gt; projects)</span></span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>以上就可以使用了，只需要继承这个抽象类就可以，前提是DTO，VO中的属性类型是SimpleUserDTO</p>\n<h2 id=\"拓展\"><a href=\"#拓展\" class=\"headerlink\" title=\"拓展\"></a>拓展</h2><p>按照这种方式其实可以举一反三，以后遇到需要获取源对象内子对象的某个属性到DTO、VO的属性字段也可以使用这种方式</p>\n","raw":null,"categories":[{"name":"springboot","path":"api/categories/springboot.json"}],"tags":[{"name":"mapstruct","path":"api/tags/mapstruct.json"}]},{"title":"站点托管CDN加速的平台vercel使用之组织免费使用","slug":"2020-08-28-vercel-use","date":"2020-08-28T09:29:00.000Z","updated":"2022-12-01T01:32:39.783Z","comments":true,"top":null,"path":"api/articles/2020-08-28-vercel-use.json","excerpt":null,"keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046749195443.jpg","content":"<blockquote>\n<p>vercel是什么？</p>\n</blockquote>\n<h3 id=\"简介\"><a href=\"#简介\" class=\"headerlink\" title=\"简介\"></a>简介</h3><p>vercel是一个站点托管平台，提供CDN加速，同类的平台有Netlify 和 Github Pages，相比之下，vercel国内的访问速度更快，并且提供Production环境和development环境，对于项目开发非常的有用的，并且支持持续集成，一次push或者一次PR会自动化构建发布，发布在development环境，都会生成不一样的链接可供预览。</p>\n<p>但是vercel只是针对个人用户免费，teams是收费的，对于Organization用户来说成本还是挺高的，那么如果在Organization Project在vercel中免费呢？</p>\n<h3 id=\"方案\"><a href=\"#方案\" class=\"headerlink\" title=\"方案\"></a>方案</h3><p>我们可以选择绕过vercel的产品定位策略，vercel提供了CLI生成个人项目，那么我们可以利用github action部署到vercel，下面来讲讲具体的实现方案：</p>\n<p>1.用户将代码push到github；<br>2.触发github action构建，使用vercel的action将当前代码库的文件推送到vercel；<br>3.vercel进行构建部署；</p>\n<h3 id=\"步骤\"><a href=\"#步骤\" class=\"headerlink\" title=\"步骤\"></a>步骤</h3><h4 id=\"创建一个项目\"><a href=\"#创建一个项目\" class=\"headerlink\" title=\"创建一个项目\"></a>创建一个项目</h4><p>如果已经存在仓库，clone该仓库到安装过nodejs的电脑，不存在仓库新建一个项目并且push到github。</p>\n<h4 id=\"安装vercel-cli\"><a href=\"#安装vercel-cli\" class=\"headerlink\" title=\"安装vercel cli\"></a>安装vercel cli</h4><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">npm i -g vercel<br></code></pre></td></tr></table></figure>\n\n<h4 id=\"部署项目\"><a href=\"#部署项目\" class=\"headerlink\" title=\"部署项目\"></a>部署项目</h4><p>因为vercel不支持网页端创建项目，只支持CLI创建项目，所以我们这一步的目的就是创建项目，后续的构建和发布直接使用github action 持续集成部署。</p>\n<p>进入项目根目录执行</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">vercel<br></code></pre></td></tr></table></figure>\n<p>按照需求进行配置相关信息即可创建项目，最重要的是project.json内的项目相关信息</p>\n<p>会打印出创建的项目相关的信息，orgid 和 projectid （非常重要的参数）</p>\n<h4 id=\"获取相关配置\"><a href=\"#获取相关配置\" class=\"headerlink\" title=\"获取相关配置\"></a>获取相关配置</h4><h5 id=\"github\"><a href=\"#github\" class=\"headerlink\" title=\"github\"></a>github</h5><p><a href=\"https://github.com/settings/tokens\" target=\"_blank\" rel=\"noopener\">获取Github Access Token</a></p>\n<h5 id=\"vercel\"><a href=\"#vercel\" class=\"headerlink\" title=\"vercel\"></a>vercel</h5><p>项目根目录运行</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">cat .vercel&#x2F;project.json<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">&#123;&quot;orgId&quot;:&quot;r359XAnYONVAmiXtdxZ22A2E&quot;,&quot;projectId&quot;:&quot;Qma3GdwoiAfJSsbsSydBgaCDh8LJj6wTWvvqpUwrN6J2F3&quot;&#125;<br></code></pre></td></tr></table></figure>\n\n<ol>\n<li><p>Org ID：标示用户的Id，对应project.json中的orgId</p>\n</li>\n<li><p>Project ID：项目的标示，对应project.json中的projectId</p>\n</li>\n<li><p>Vercel Token： <a href=\"https://vercel.com/account/tokens\" target=\"_blank\" rel=\"noopener\">点击Create</a></p>\n</li>\n</ol>\n<h5 id=\"配置github-Secret\"><a href=\"#配置github-Secret\" class=\"headerlink\" title=\"配置github Secret\"></a>配置github Secret</h5><p>github action可以获取Secret参数，一些敏感信息可以设置到Secret中，并且以变量的方式传入到github action的参数中。</p>\n<p>打开github项目的Setting -&gt; Secret，点击 new secret创建三个配置</p>\n<ul>\n<li>VERCEL_TOKEN：上一步的Vercel Token</li>\n<li>ORG_ID：  上一步的Org ID</li>\n<li>PROJECT_ID：上一步的Project ID</li>\n</ul>\n<p>配置好这些参数就可以进行github action脚本的编写了</p>\n<h4 id=\"编写Github-Action脚本\"><a href=\"#编写Github-Action脚本\" class=\"headerlink\" title=\"编写Github Action脚本\"></a>编写Github Action脚本</h4><p>在github中创建action（具体方法自行搜索）</p>\n<p>使用了<code>amondnet/vercel-action@v19.0.1+3</code> 组件</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">- name: Vercel Action<br>      # You may pin to the exact commit or the version.<br>      # uses: amondnet&#x2F;vercel-action@77cb0ce3642a451f7f18d63821c0e26f7adead9a<br>      uses: amondnet&#x2F;vercel-action@v19.0.1+3<br>      with:<br>        # Vercel token<br>        vercel-token: $&#123;&#123; secrets.VERCEL_TOKEN &#125;&#125;<br>        # <br>        # if you want to comment on pr and commit, set token<br>        github-token: $&#123;&#123; secrets.OP_TOKEN &#125;&#125; # optional<br>        # if you want to create github deployment, set true, default: false<br>        github-deployment: false # optional, default is false<br>        # the working directory<br>        working-directory: .&#x2F; # optional<br>        # Vercel CLI 17+, ❗️  The &#96;name&#96; property in vercel.json is deprecated (https:&#x2F;&#x2F;zeit.ink&#x2F;5F)<br>        vercel-project-id: $&#123;&#123; secrets.PROJECT_ID&#125;&#125; # optional<br>        # Vercel CLI 17+, ❗️  The &#96;name&#96; property in vercel.json is deprecated (https:&#x2F;&#x2F;zeit.ink&#x2F;5F)<br>        vercel-org-id: $&#123;&#123; secrets.ORG_ID&#125;&#125; # optional<br>        vercel-args: &#39;--prod&#39; #这是一个关键点，这里执行生产生产环境还是开发环境，默认是测试环境<br></code></pre></td></tr></table></figure>\n\n<h4 id=\"案例\"><a href=\"#案例\" class=\"headerlink\" title=\"案例\"></a>案例</h4><p>完整的案例：<a href=\"https://github.com/sam-bo/blog_back\" target=\"_blank\" rel=\"noopener\">https://github.com/sam-bo/blog_back</a></p>\n<p>案例里面的其它脚本可以忽略，根据实际的情况进行编写。</p>\n<h4 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h4><p>安装上面的步骤，代码提交之后就可以自动构建了，是不是很简单呢？</p>\n<p>vercel在国内的访问速度可以秒杀github pages了，vercel虽然不支持组织，利用这种方式我们可以免费使用。</p>\n","raw":null,"categories":[{"name":"github","path":"api/categories/github.json"}],"tags":[{"name":"share","path":"api/tags/share.json"}]},{"title":"整理了一个资源分享的站点-tool.winterchen.com","slug":"2020-08-26-new-source-site","date":"2020-08-26T09:29:00.000Z","updated":"2022-12-01T01:32:39.783Z","comments":true,"top":null,"path":"api/articles/2020-08-26-new-source-site.json","excerpt":null,"keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046746748232.jpg","content":"<p>花了点时间把所有使用过，并且非常好用的网站整理出来</p>\n<p>主要类别有：游戏，开发工具，设计工具</p>\n<p>后期规划：chrome插件，github开源项目，图片网站等等，如果有好的资源可以留言告诉博主</p>\n<p>网址：<a href=\"https://tools.winterchen.com\" target=\"_blank\" rel=\"noopener\">https://tools.winterchen.com</a></p>\n<iframe src=\"https://tools.winterchen.com\" width=\"700px\" height=\"700px\" frameborder=\"0\" scrolling=\"yes\"> </iframe>","raw":null,"categories":[{"name":"share","path":"api/categories/share.json"}],"tags":[{"name":"share","path":"api/tags/share.json"}]},{"title":"软件分享-免费的网站状态监控平台","slug":"2020-08-25-share-tools","date":"2020-08-24T16:09:00.000Z","updated":"2022-12-01T01:32:39.783Z","comments":true,"top":null,"path":"api/articles/2020-08-25-share-tools.json","excerpt":null,"keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046744211555.jpg","content":"<blockquote>\n<p>有段时间没有更新了，今天分享一下一个很有用的工具：<a href=\"https://uptimerobot.com/\" target=\"_blank\" rel=\"noopener\">uptimerobot</a>,可以用来监控树莓派是否宕机，nacos注册中心是否可用等等</p>\n</blockquote>\n<h4 id=\"主要功能：\"><a href=\"#主要功能：\" class=\"headerlink\" title=\"主要功能：\"></a>主要功能：</h4><ul>\n<li>网站状态监控</li>\n<li>网站状态警报</li>\n</ul>\n<h4 id=\"使用感受\"><a href=\"#使用感受\" class=\"headerlink\" title=\"使用感受\"></a>使用感受</h4><p>免费版有50个站点，最低5分钟检测的限制，一般人足够了，一个有意思的地方就是可以创建一个public的页面并且绑定自己的域名；</p>\n<h4 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h4><p><a href=\"https://stats.winterchen.com\" target=\"_blank\" rel=\"noopener\">https://stats.winterchen.com</a></p>\n<ul>\n<li>以下非截图，为动态网页</li>\n</ul>\n<iframe src=\"https://stats.winterchen.com\" width=\"700px\" height=\"700px\" frameborder=\"0\" scrolling=\"no\"> </iframe>\n\n<p>顺便分享一个技巧，在markdown中嵌入网页：</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs html\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">iframe</span> <span class=\"hljs-attr\">src</span>=<span class=\"hljs-string\">\"https://stats.winterchen.com\"</span> <span class=\"hljs-attr\">width</span>=<span class=\"hljs-string\">\"700px\"</span> <span class=\"hljs-attr\">height</span>=<span class=\"hljs-string\">\"500px\"</span> <span class=\"hljs-attr\">frameborder</span>=<span class=\"hljs-string\">\"0\"</span> <span class=\"hljs-attr\">scrolling</span>=<span class=\"hljs-string\">\"no\"</span>&gt;</span> <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">iframe</span>&gt;</span><br></code></pre></td></tr></table></figure>\n<p>注意事项：</p>\n<ul>\n<li><code>&amp; -&gt; &amp;amp</code></li>\n<li><code>&lt;&gt;&lt;/&gt;</code>直接要留有空格</li>\n</ul>\n","raw":null,"categories":[{"name":"share","path":"api/categories/share.json"}],"tags":[{"name":"share","path":"api/tags/share.json"}]},{"title":"风景摄影-关于夏天的雨","slug":"2020-07-05-summer","date":"2020-07-05T11:35:00.000Z","updated":"2022-12-01T01:32:39.783Z","comments":true,"top":null,"path":"api/articles/2020-07-05-summer.json","excerpt":null,"keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046737321952.jpg","content":"<p>关于夏日雨季的记忆是什么？</p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046738800228.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046740278599.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046742666469.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n","raw":null,"categories":[{"name":"作品","path":"api/categories/作品.json"}],"tags":[{"name":"作品","path":"api/tags/作品.json"}]},{"title":"人像摄影-关于夏天的定义","slug":"2020-07-05-summer-with-rain","date":"2020-07-05T11:30:00.000Z","updated":"2022-12-01T01:32:39.783Z","comments":true,"top":null,"path":"api/articles/2020-07-05-summer-with-rain.json","excerpt":null,"keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046722918768.jpg","content":"<p>梅雨季节还没有过去，这个夏天，有那么一段时间没有拍照了，拉来了小模特，拍了几张</p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046723289468.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046723654508.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046724123957.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/imgrpo/blog/20210804112430.jpeg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/imgrpo/blog/20210804112457.jpeg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/imgrpo/blog/20210804112524.jpeg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/imgrpo/blog/20210804112551.jpeg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046727258633.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/imgrpo/blog/20210804112618.jpeg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046728278404.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046728818616.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/imgrpo/blog/20210804112642.jpeg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046729764562.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046730406720.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/imgrpo/blog/20210804112717.jpeg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046731499985.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046732095635.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046732705756.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046733251120.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/imgrpo/blog/20210804112747.jpeg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/imgrpo/blog/20210804112813.jpeg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n","raw":null,"categories":[{"name":"作品","path":"api/categories/作品.json"}],"tags":[{"name":"作品","path":"api/tags/作品.json"}]},{"title":"一个人的周末","slug":"2020-06-14-sunday","date":"2020-06-14T11:54:00.000Z","updated":"2022-12-01T01:32:39.783Z","comments":true,"top":null,"path":"api/articles/2020-06-14-sunday.json","excerpt":null,"keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/imgrpo/blog/20210804112844.jpeg","content":"<p>这周休息一天，一个人在家无聊透顶，加上有很长一段时间没有拍照，今天一整天把个人摄影作品主页建设完成了，网站包含作品、素材、摄影师等模块，网站使用了github+hexo+github actions等技术，把原有的jenkins自动部署改为了github actions，一个超级好用的新技术，居然一直都没有注意到，以后需要把markdown文档写好提交就会自动发布，具体的教程可以看上一篇博文。</p>\n<p>说回正文，作品收录拍过的一些摄影作品，也算记录一下拍摄技术和审美提高的一个过程，尽管现在拍得一些片子不咋地，这也就是有了两个其它模块的原因，前期可以模仿大师的构图和调色。</p>\n<p>一直喜欢的摄影师滨田英明，独爱他的调色，有一种初夏的感觉，有幸今天找到了他的<a href=\"http://hideakihamada.com\" target=\"_blank\" rel=\"noopener\">个人主页</a>，超级简约有设计感，下午还想着把他的作品全部趴出来呢，结果写了脚本一直卡着，也不知道啥原因，python技术目前有点渣，顺便看了一下这个网站的html，里面很多图片都放在js里面，这是什么意思？难道这个也是静态的？</p>\n<p>滨田英明的作品：</p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046588865258.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046589306166.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046722034494.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046722213554.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046722389722.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p>贴一下大佬的<a href=\"http://hideakihamada.com\" target=\"_blank\" rel=\"noopener\">主页</a></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046449456744.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p>我的个人主页：</p>\n<p>地址：<a href=\"https://photo.winterchen.com\" target=\"_blank\" rel=\"noopener\">https://photo.winterchen.com</a></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046450220996.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046452039277.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046453311374.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n","raw":null,"categories":[{"name":"随笔","path":"api/categories/随笔.json"}],"tags":[{"name":"随笔","path":"api/tags/随笔.json"}]},{"title":"如何使用 GitHub Actions 实现 Hexo 博客的 CICD","slug":"2020-06-13-hexo-deploy-from-github-ci-cd","date":"2020-06-13T14:27:00.000Z","updated":"2022-12-01T01:32:39.783Z","comments":true,"top":null,"path":"api/articles/2020-06-13-hexo-deploy-from-github-ci-cd.json","excerpt":null,"keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046720015079.jpg","content":"<h2 id=\"仓库准备\"><a href=\"#仓库准备\" class=\"headerlink\" title=\"仓库准备\"></a>仓库准备</h2><table>\n<thead>\n<tr>\n<th>项目仓库</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><a href=\"https://github.com/WinterChenS/blog-back\" target=\"_blank\" rel=\"noopener\">https://github.com/WinterChenS/blog-back</a></td>\n<td>用于存放 hexo 生成的项目，可以理解成源码</td>\n</tr>\n<tr>\n<td><a href=\"https://github.com/WinterChenS/WinterChenS.github.io\" target=\"_blank\" rel=\"noopener\">https://github.com/WinterChenS/WinterChenS.github.io</a></td>\n<td>存放 hexo 编译后的静态文件，也是博客页面</td>\n</tr>\n</tbody></table>\n<h2 id=\"秘钥生成\"><a href=\"#秘钥生成\" class=\"headerlink\" title=\"秘钥生成\"></a>秘钥生成</h2><p>Hexo编译之后需要把生成的静态页面代码push到github pages的仓库，也就是 <code>WinterChenS/WinterChenS.github.io</code> ，没有秘钥就没有权限push。</p>\n<blockquote>\n<p>随便找一台电脑或者服务器，生成秘钥：</p>\n</blockquote>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">ssh-keygen -f github-deploy-key # 三次回车即可<br></code></pre></td></tr></table></figure>\n\n<p>以上步骤会生成<code>github-deploy-key</code> 和 <code>github-deploy-key.pub</code> 两个文件。</p>\n<h2 id=\"配置github仓库\"><a href=\"#配置github仓库\" class=\"headerlink\" title=\"配置github仓库\"></a>配置github仓库</h2><h3 id=\"配置blog-back仓库\"><a href=\"#配置blog-back仓库\" class=\"headerlink\" title=\"配置blog-back仓库\"></a>配置blog-back仓库</h3><p>打开 <code>https://github.com/WinterChenS/blog-back/settings/secrets</code> 点击 <code>Add new secrets</code>，分别在:</p>\n<ul>\n<li>Name 输入 <code>HEXO_DEPLOY_KEY</code></li>\n<li>Value 输入前面生成的私有KEY <code>github-deploy-key</code> 的内容</li>\n</ul>\n<h3 id=\"配置WinterChenS-github-io仓库\"><a href=\"#配置WinterChenS-github-io仓库\" class=\"headerlink\" title=\"配置WinterChenS.github.io仓库\"></a>配置WinterChenS.github.io仓库</h3><p>打开 <a href=\"https://github.com/WinterChenS/WinterChenS.github.io/settings/Deploy\" target=\"_blank\" rel=\"noopener\">https://github.com/WinterChenS/WinterChenS.github.io/settings/Deploy</a> keys，点击 Add deploy key，分别在:</p>\n<ul>\n<li>Title 输入 <code>HEXO_DEPLOY_KEY</code></li>\n<li>Key 输入前面生成的公KEY <code>github-deploy-key.pub</code> 的内容名称随意，但要勾选 Allow write access</li>\n</ul>\n<h2 id=\"编写-Action-脚本\"><a href=\"#编写-Action-脚本\" class=\"headerlink\" title=\"编写 Action 脚本\"></a>编写 Action 脚本</h2><p>使用前先要申请，直接打开<code>https://github.com/WinterChenS/WinterChenS.github.io/actions/new</code></p>\n<p>main.yml</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">name: Deploy Blog<br><br>on: [push] # 当有新push时运行<br><br>env:<br>  TZ: Asia&#x2F;Shanghai<br><br>jobs:<br>  build: # 一项叫做build的任务<br><br>    runs-on: ubuntu-latest # 在最新版的Ubuntu系统下运行<br>    <br>    steps:<br>    - name: Checkout # 将仓库内master分支的内容下载到工作目录<br>      uses: actions&#x2F;checkout@v1 # 脚本来自 https:&#x2F;&#x2F;github.com&#x2F;actions&#x2F;checkout<br>      <br>    - name: Use Node.js 10.x # 配置Node环境<br>      uses: actions&#x2F;setup-node@v1 # 配置脚本来自 https:&#x2F;&#x2F;github.com&#x2F;actions&#x2F;setup-node<br>      with:<br>        node-version: &quot;10.x&quot;<br>    <br>    - name: Setup Hexo env<br>      env:<br>        ACTION_DEPLOY_KEY: $&#123;&#123; secrets.HEXO_DEPLOY_KEY &#125;&#125; # 这里是上面WinterChenS.github.io新增的公钥：HEXO_DEPLOY_KEY<br>      run: |<br>        # set up private key for deploy<br>        mkdir -p ~&#x2F;.ssh&#x2F;<br>        echo &quot;$ACTION_DEPLOY_KEY&quot; | tr -d &#39;\\r&#39; &gt; ~&#x2F;.ssh&#x2F;id_rsa # 配置秘钥<br>        chmod 600 ~&#x2F;.ssh&#x2F;id_rsa<br>        ssh-keyscan github.com &gt;&gt; ~&#x2F;.ssh&#x2F;known_hosts<br>        # set git infomation<br>        git config --global user.name &#39;winterchens&#39; # 换成你自己的邮箱和名字<br>        git config --global user.email &#39;1085143002@qq.com&#39;<br>        # install dependencies<br>        npm i -g hexo-cli # 安装hexo<br>        npm i<br>        # 拉取主题代码<br>        rm -rf themes&#x2F;*<br>        git clone https:&#x2F;&#x2F;github.com&#x2F;WinterChenS&#x2F;hexo-theme-diaspora.git themes&#x2F;diaspora<br>        <br>  <br>    - name: Deploy<br>      run: |<br>        # publish<br>        hexo generate &amp;&amp; hexo deploy # 执行部署程序<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"修改blog-back根目录的-config-yml\"><a href=\"#修改blog-back根目录的-config-yml\" class=\"headerlink\" title=\"修改blog-back根目录的_config.yml\"></a>修改blog-back根目录的_config.yml</h2><p>如果你使用的是http，那么需要修改为ssh，已经是ssh就无须修改</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">deploy:<br>  type: git<br>  repo: git@github.com:WinterChenS&#x2F;WinterChenS.github.io.git<br>  branch: master<br></code></pre></td></tr></table></figure>\n\n<p>以后只需要把代码提交到blog-back就可以自动进行编译发布了，是不是很爽</p>\n","raw":null,"categories":[{"name":"github-actions","path":"api/categories/github-actions.json"}],"tags":[{"name":"hexo","path":"api/tags/hexo.json"},{"name":"github","path":"api/tags/github.json"},{"name":"github-actions","path":"api/tags/github-actions.json"}]}]}