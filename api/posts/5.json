{"total":66,"pageSize":10,"pageCount":7,"data":[{"title":"springboot整合mybatis 使用HikariCP连接池","slug":"spring-boot-mybatis-hikaricp","date":"2018-07-25T07:49:00.000Z","updated":"2022-12-01T01:32:39.787Z","comments":true,"top":null,"path":"api/articles/spring-boot-mybatis-hikaricp.json","excerpt":null,"keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046778695396.jpg","content":"<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>Springboot让Java开发更加美好，本节主要讲的是使用Hikari数据库连接池，如果需要使用druid连接池的请看我另外一篇博客，<a href=\"https://blog.csdn.net/winter_chen001/article/details/80010967\" target=\"_blank\" rel=\"noopener\">springboot Mybatis 整合</a>（这篇文章有详细搭建springboot项目的过程，对于刚接触springboot的新手有帮助）。</p>\n<h3 id=\"为什么使用HikariCP\"><a href=\"#为什么使用HikariCP\" class=\"headerlink\" title=\"为什么使用HikariCP\"></a>为什么使用HikariCP</h3><p>在Springboot2.X版本，数据库的连接池官方推荐使用<a href=\"https://github.com/brettwooldridge/HikariCP\" target=\"_blank\" rel=\"noopener\">HikariCP</a>，官方的原话：</p>\n<blockquote>\n<p> Production database connections can also be auto-configured by using a pooling<code>DataSource</code>. Spring Boot uses the following algorithm for choosing a specific implementation:</p>\n<ol>\n<li><p>We prefer<a href=\"https://github.com/brettwooldridge/HikariCP\" target=\"_blank\" rel=\"noopener\">HikariCP</a>for its performance and concurrency. If HikariCP is available, we always choose it.</p>\n</li>\n<li><p>Otherwise, if the Tomcat pooling<code>DataSource</code>is available, we use it.</p>\n</li>\n<li><p>If neither HikariCP nor the Tomcat pooling datasource are available and if<a href=\"https://commons.apache.org/proper/commons-dbcp/\" target=\"_blank\" rel=\"noopener\">Commons DBCP2</a>is available, we use it.</p>\n</li>\n</ol>\n</blockquote>\n<p>意思是说：</p>\n<ol>\n<li><p>我们更喜欢HikariCP的性能和并发性。如果有HikariCP，我们总是选择它</p>\n</li>\n<li><p>否则，如果Tomcat池数据源可用，我们将使用它。</p>\n</li>\n<li><p>如果HikariCP和Tomcat池数据源都不可用，如果Commons DBCP2可用，我们将使用它。</p>\n</li>\n</ol>\n<p>那么如何使用HikariCP呢？</p>\n<p>如果你的springboot版本是2.X，当你使用<code>spring-boot-starter-jdbc</code>或者<code>spring-boot-starter-data-jpa</code>依赖，springboot就会自动引入HikariCP的依赖了。</p>\n<h3 id=\"使用指定的数据库连接池\"><a href=\"#使用指定的数据库连接池\" class=\"headerlink\" title=\"使用指定的数据库连接池\"></a>使用指定的数据库连接池</h3><p>如果你需要使用指定的数据库连接池，那么你需要在<code>application.properties</code>中配置：<code>spring.datasource.type</code></p>\n<h2 id=\"环境\"><a href=\"#环境\" class=\"headerlink\" title=\"环境\"></a>环境</h2><ul>\n<li><p>JDK： 1.8</p>\n</li>\n<li><p>Maven: 3.3.9</p>\n</li>\n<li><p>SpringBoot: 2.0.3.RELEASE</p>\n</li>\n<li><p>开发工具：Intellij IDEA 2017.1.3</p>\n</li>\n</ul>\n<h2 id=\"开始使用\"><a href=\"#开始使用\" class=\"headerlink\" title=\"开始使用\"></a>开始使用</h2><p>本次的配置中我们持久层使用mybatis，使用HikariCP作为数据库连接池。</p>\n<h3 id=\"引入依赖\"><a href=\"#引入依赖\" class=\"headerlink\" title=\"引入依赖\"></a>引入依赖</h3><figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\">      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-boot-starter-web<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">exclusions</span>&gt;</span><br>\t\t<span class=\"hljs-comment\">&lt;!--排除默认的tomcat-jdbc--&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">exclusion</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.apache.tomcat<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t\t\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>tomcat-jdbc<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">exclusion</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">exclusions</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>mysql<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>mysql-connector-java<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>5.1.46<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><span class=\"hljs-comment\">&lt;!-- mybatis一定要使用starter，不然无法自动配置和注入 --&gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.mybatis.spring.boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>1.3.2<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-boot-starter-test<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>\t<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">scope</span>&gt;</span>test<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">scope</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p>以上的依赖就足够了，前面介绍过，只需要导入<code>spring-boot-starter-jdbc</code>依赖springboot就默认使用Hikari作为数据库连接池了。</p>\n<h3 id=\"创建数据表\"><a href=\"#创建数据表\" class=\"headerlink\" title=\"创建数据表\"></a>创建数据表</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">DATABASE</span> mytest;<br><br><span class=\"hljs-keyword\">CREATE</span> <span class=\"hljs-keyword\">TABLE</span> t_user(<br>  userId <span class=\"hljs-built_in\">INT</span> <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> PRIMARY <span class=\"hljs-keyword\">KEY</span> AUTO_INCREMENT,<br>  userName <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">255</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> ,<br>  <span class=\"hljs-keyword\">password</span> <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">255</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span> ,<br>  phone <span class=\"hljs-built_in\">VARCHAR</span>(<span class=\"hljs-number\">255</span>) <span class=\"hljs-keyword\">NOT</span> <span class=\"hljs-literal\">NULL</span><br>) <span class=\"hljs-keyword\">ENGINE</span>=<span class=\"hljs-keyword\">INNODB</span> AUTO_INCREMENT=<span class=\"hljs-number\">1000</span> <span class=\"hljs-keyword\">DEFAULT</span> <span class=\"hljs-keyword\">CHARSET</span>=utf8;<br></code></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"创建实体类\"><a href=\"#创建实体类\" class=\"headerlink\" title=\"创建实体类\"></a>创建实体类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.model;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * Created by Donghua.Chen on 2018/7/25.</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserDomain</span> </span>&#123;<br><br>    <span class=\"hljs-keyword\">private</span> Integer userId;<br><br>    <span class=\"hljs-keyword\">private</span> String userName;<br><br>    <span class=\"hljs-keyword\">private</span> String password;<br><br>    <span class=\"hljs-keyword\">private</span> String phone;<br><br>    <span class=\"hljs-comment\">// @TODO 省略get/set</span><br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"创建Dao以及mapper映射\"><a href=\"#创建Dao以及mapper映射\" class=\"headerlink\" title=\"创建Dao以及mapper映射\"></a>创建Dao以及mapper映射</h3><h4 id=\"创建Dao类\"><a href=\"#创建Dao类\" class=\"headerlink\" title=\"创建Dao类\"></a>创建Dao类</h4><p>创建一个dao的包，并且在这个包下创建一个UserDao</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.dao;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.model.UserDomain;<br><span class=\"hljs-keyword\">import</span> org.apache.ibatis.annotations.Mapper;<br><span class=\"hljs-keyword\">import</span> org.apache.ibatis.annotations.Param;<br><br><span class=\"hljs-keyword\">import</span> java.util.List;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * Created by Donghua.Chen on 2018/7/25.</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-meta\">@Mapper</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">UserDao</span> </span>&#123;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">insert</span><span class=\"hljs-params\">(UserDomain record)</span></span>;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">deleteUserById</span><span class=\"hljs-params\">(@Param(<span class=\"hljs-string\">\"userId\"</span>)</span> Integer userId)</span>;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">updateUser</span><span class=\"hljs-params\">(UserDomain userDomain)</span></span>;<br><br>    <span class=\"hljs-function\">List&lt;UserDomain&gt; <span class=\"hljs-title\">selectUsers</span><span class=\"hljs-params\">()</span></span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>注意：一定不要忘了使用<code>@Mapper</code>注解，如果没有这个注解，spring就无法扫描到这个类，导致项目启动报错。</p>\n<h4 id=\"创建Mapper映射\"><a href=\"#创建Mapper映射\" class=\"headerlink\" title=\"创建Mapper映射\"></a>创建Mapper映射</h4><p>上一步我们创建dao数据库持久层类，由于本文使用的是xml映射的方式，所以我们需要创建一个xml映射文件。</p>\n<p>在<code>resources</code>文件夹下新建一个文件夹<code>mapper</code>：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-meta\">&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;</span><br><span class=\"hljs-meta\">&lt;!DOCTYPE <span class=\"hljs-meta-keyword\">mapper</span> <span class=\"hljs-meta-keyword\">PUBLIC</span> <span class=\"hljs-meta-string\">\"-//mybatis.org//DTD Mapper 3.0//EN\"</span> <span class=\"hljs-meta-string\">\"http://mybatis.org/dtd/mybatis-3-mapper.dtd\"</span> &gt;</span><br><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">mapper</span> <span class=\"hljs-attr\">namespace</span>=<span class=\"hljs-string\">\"com.winterchen.dao.UserDao\"</span> &gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sql</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"BASE_TABLE\"</span>&gt;</span><br>        t_user<br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sql</span>&gt;</span><br><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">sql</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"BASE_COLUMN\"</span>&gt;</span><br>        userId,userName,password,phone<br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">sql</span>&gt;</span><br><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">insert</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"insert\"</span> <span class=\"hljs-attr\">parameterType</span>=<span class=\"hljs-string\">\"com.winterchen.model.UserDomain\"</span>&gt;</span><br>        INSERT INTO<br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">include</span> <span class=\"hljs-attr\">refid</span>=<span class=\"hljs-string\">\"BASE_TABLE\"</span>/&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">trim</span> <span class=\"hljs-attr\">prefix</span>=<span class=\"hljs-string\">\"(\"</span> <span class=\"hljs-attr\">suffix</span>=<span class=\"hljs-string\">\")\"</span> <span class=\"hljs-attr\">suffixOverrides</span>=<span class=\"hljs-string\">\",\"</span>&gt;</span><br>            userName,password,<br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"phone != null\"</span>&gt;</span><br>                phone,<br>            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">trim</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">trim</span> <span class=\"hljs-attr\">prefix</span>=<span class=\"hljs-string\">\"VALUES(\"</span> <span class=\"hljs-attr\">suffix</span>=<span class=\"hljs-string\">\")\"</span> <span class=\"hljs-attr\">suffixOverrides</span>=<span class=\"hljs-string\">\",\"</span>&gt;</span><br>            #&#123;userName, jdbcType=VARCHAR&#125;,#&#123;password, jdbcType=VARCHAR&#125;,<br>            <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"phone != null\"</span>&gt;</span><br>                #&#123;phone, jdbcType=VARCHAR&#125;,<br>            <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">trim</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">insert</span>&gt;</span><br><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">delete</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"deleteUserById\"</span>&gt;</span><br>      DELETE FROM<br>      <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">include</span> <span class=\"hljs-attr\">refid</span>=<span class=\"hljs-string\">\"BASE_TABLE\"</span>/&gt;</span><br>      WHERE<br>      userId = #&#123;userId, jdbcType=INTEGER&#125;<br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">delete</span>&gt;</span><br>    <span class=\"hljs-comment\">&lt;!-- 更新用户信息，为空的字段不进行置空 --&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">update</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"updateUser\"</span> <span class=\"hljs-attr\">parameterType</span>=<span class=\"hljs-string\">\"com.winterchen.model.UserDomain\"</span>&gt;</span><br>        UPDATE<br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">include</span> <span class=\"hljs-attr\">refid</span>=<span class=\"hljs-string\">\"BASE_TABLE\"</span>/&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">set</span>&gt;</span><br>          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"userName != null\"</span>&gt;</span><br>              userName = #&#123;userName, jdbcType=VARCHAR&#125;,<br>          <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"password != null\"</span>&gt;</span><br>              password = #&#123;password, jdbcType=VARCHAR&#125;,<br>          <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>          <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">if</span> <span class=\"hljs-attr\">test</span>=<span class=\"hljs-string\">\"phone != null\"</span>&gt;</span><br>              phone = #&#123;phone, jdbcType=VARCHAR&#125;,<br>          <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">if</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">set</span>&gt;</span><br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">where</span>&gt;</span><br>            userId = #&#123;userId, jdbcType=INTEGER&#125;<br>        <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">where</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">update</span>&gt;</span><br><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">select</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">\"selectUsers\"</span> <span class=\"hljs-attr\">resultType</span>=<span class=\"hljs-string\">\"com.winterchen.model.UserDomain\"</span>&gt;</span><br>        SELECT<br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">include</span> <span class=\"hljs-attr\">refid</span>=<span class=\"hljs-string\">\"BASE_COLUMN\"</span>/&gt;</span><br>        FROM<br>        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">include</span> <span class=\"hljs-attr\">refid</span>=<span class=\"hljs-string\">\"BASE_TABLE\"</span>/&gt;</span><br>    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">select</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">mapper</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p><strong>注意点：</strong> 请将<code>namespace=&quot;com.winterchen.dao.UserDao&quot;</code>改为你自己项目Dao的路径，以及下面方法的一些路径都要改为你自己项目的相关路径。</p>\n<h3 id=\"配置\"><a href=\"#配置\" class=\"headerlink\" title=\"配置\"></a>配置</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">server.port&#x3D;8080<br><br>#### 数据库连接池属性<br>spring.datasource.driver-class-name&#x3D;com.mysql.jdbc.Driver<br>spring.datasource.url&#x3D;jdbc:mysql:&#x2F;&#x2F;127.0.0.1:3306&#x2F;mytest?useSSL&#x3D;false&amp;useUnicode&#x3D;true&amp;characterEncoding&#x3D;utf-8&amp;allowMultiQueries&#x3D;true<br>spring.datasource.username&#x3D;root<br>spring.datasource.password&#x3D;root<br>#自动提交<br>spring.datasource.default-auto-commit&#x3D;true<br>#指定updates是否自动提交<br>spring.datasource.auto-commit&#x3D;true<br>spring.datasource.maximum-pool-size&#x3D;100<br>spring.datasource.max-idle&#x3D;10<br>spring.datasource.max-wait&#x3D;10000<br>spring.datasource.min-idle&#x3D;5<br>spring.datasource.initial-size&#x3D;5<br>spring.datasource.validation-query&#x3D;SELECT 1<br>spring.datasource.test-on-borrow&#x3D;false<br>spring.datasource.test-while-idle&#x3D;true<br># 配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒<br>spring.datasource.time-between-eviction-runs-millis&#x3D;18800<br># 配置一个连接在池中最小生存的时间，单位是毫秒<br>spring.datasource.minEvictableIdleTimeMillis&#x3D;300000<br><br># mybatis对应的映射文件路径<br>mybatis.mapper-locations&#x3D;classpath:mapper&#x2F;*.xml<br># mybatis对应的实体类<br>mybatis.type-aliases-package&#x3D;com.winterchen.model<br></code></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"Service层\"><a href=\"#Service层\" class=\"headerlink\" title=\"Service层\"></a>Service层</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.service;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.model.UserDomain;<br><br><span class=\"hljs-keyword\">import</span> java.util.List;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * Created by Donghua.Chen on 2018/7/25.</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">UserService</span> </span>&#123;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">insert</span><span class=\"hljs-params\">(UserDomain record)</span></span>;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">deleteUserById</span><span class=\"hljs-params\">(Integer userId)</span></span>;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">updateUser</span><span class=\"hljs-params\">(UserDomain userDomain)</span></span>;<br><br>    <span class=\"hljs-function\">List&lt;UserDomain&gt; <span class=\"hljs-title\">selectUsers</span><span class=\"hljs-params\">()</span></span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"Service-实现层\"><a href=\"#Service-实现层\" class=\"headerlink\" title=\"Service 实现层\"></a>Service 实现层</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.service.impl;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.dao.UserDao;<br><span class=\"hljs-keyword\">import</span> com.winterchen.model.UserDomain;<br><span class=\"hljs-keyword\">import</span> com.winterchen.service.UserService;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Service;<br><br><span class=\"hljs-keyword\">import</span> java.util.List;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * Created by Donghua.Chen on 2018/7/25.</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-meta\">@Service</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserServiceImpl</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">UserService</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> UserDao userDao;<span class=\"hljs-comment\">//这里会爆红，请忽略</span><br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">int</span> <span class=\"hljs-title\">insert</span><span class=\"hljs-params\">(UserDomain record)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> userDao.insert(record);<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">deleteUserById</span><span class=\"hljs-params\">(Integer userId)</span> </span>&#123;<br>        userDao.deleteUserById(userId);<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">updateUser</span><span class=\"hljs-params\">(UserDomain userDomain)</span> </span>&#123;<br>        userDao.updateUser(userDomain);<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> List&lt;UserDomain&gt; <span class=\"hljs-title\">selectUsers</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> userDao.selectUsers();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"Controller层\"><a href=\"#Controller层\" class=\"headerlink\" title=\"Controller层\"></a>Controller层</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.controller;<br><br><span class=\"hljs-keyword\">import</span> com.winterchen.model.UserDomain;<br><span class=\"hljs-keyword\">import</span> com.winterchen.service.UserService;<br><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.http.ResponseEntity;<br><span class=\"hljs-keyword\">import</span> org.springframework.web.bind.annotation.*;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * Created by Donghua.Chen on 2018/7/25.</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-meta\">@RestController</span><br><span class=\"hljs-meta\">@RequestMapping</span>(<span class=\"hljs-string\">\"/user\"</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">UserController</span> </span>&#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> UserService userService;<br><br>    <span class=\"hljs-meta\">@PostMapping</span>(<span class=\"hljs-string\">\"\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> ResponseEntity <span class=\"hljs-title\">addUser</span><span class=\"hljs-params\">(</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">            @RequestParam(value = <span class=\"hljs-string\">\"userName\"</span>, required = <span class=\"hljs-keyword\">true</span>)</span></span><br><span class=\"hljs-function\">            String userName,</span><br><span class=\"hljs-function\">            @<span class=\"hljs-title\">RequestParam</span><span class=\"hljs-params\">(value = <span class=\"hljs-string\">\"password\"</span>, required = <span class=\"hljs-keyword\">true</span>)</span></span><br><span class=\"hljs-function\">            String password,</span><br><span class=\"hljs-function\">            @<span class=\"hljs-title\">RequestParam</span><span class=\"hljs-params\">(value = <span class=\"hljs-string\">\"phone\"</span>, required = <span class=\"hljs-keyword\">false</span>)</span></span><br><span class=\"hljs-function\">            String phone</span><br><span class=\"hljs-function\">    )</span>&#123;<br>        UserDomain userDomain = <span class=\"hljs-keyword\">new</span> UserDomain();<br>        userDomain.setUserName(userName);<br>        userDomain.setPassword(password);<br>        userDomain.setPhone(phone);<br>        userService.insert(userDomain);<br>        <span class=\"hljs-keyword\">return</span> ResponseEntity.ok(<span class=\"hljs-string\">\"添加成功\"</span>);<br>    &#125;<br><br>    <span class=\"hljs-meta\">@DeleteMapping</span>(<span class=\"hljs-string\">\"\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> ResponseEntity <span class=\"hljs-title\">deleteUser</span><span class=\"hljs-params\">(@RequestParam(value = <span class=\"hljs-string\">\"userId\"</span>, required = <span class=\"hljs-keyword\">true</span>)</span> Integer userId)</span>&#123;<br><br>        userService.deleteUserById(userId);<br>        <span class=\"hljs-keyword\">return</span> ResponseEntity.ok(<span class=\"hljs-string\">\"删除成功\"</span>);<br>    &#125;<br><br>    <span class=\"hljs-meta\">@PutMapping</span>(<span class=\"hljs-string\">\"\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> ResponseEntity <span class=\"hljs-title\">updateUser</span><span class=\"hljs-params\">(</span></span><br><span class=\"hljs-function\"><span class=\"hljs-params\">            @RequestParam(value = <span class=\"hljs-string\">\"userId\"</span>, required = <span class=\"hljs-keyword\">true</span>)</span></span><br><span class=\"hljs-function\">                    Integer userId,</span><br><span class=\"hljs-function\">            @<span class=\"hljs-title\">RequestParam</span><span class=\"hljs-params\">(value = <span class=\"hljs-string\">\"userName\"</span>, required = <span class=\"hljs-keyword\">false</span>)</span></span><br><span class=\"hljs-function\">                    String userName,</span><br><span class=\"hljs-function\">            @<span class=\"hljs-title\">RequestParam</span><span class=\"hljs-params\">(value = <span class=\"hljs-string\">\"password\"</span>, required = <span class=\"hljs-keyword\">false</span>)</span></span><br><span class=\"hljs-function\">                    String password,</span><br><span class=\"hljs-function\">            @<span class=\"hljs-title\">RequestParam</span><span class=\"hljs-params\">(value = <span class=\"hljs-string\">\"phone\"</span>, required = <span class=\"hljs-keyword\">false</span>)</span></span><br><span class=\"hljs-function\">                    String phone</span><br><span class=\"hljs-function\">    )</span>&#123;<br>        UserDomain userDomain = <span class=\"hljs-keyword\">new</span> UserDomain();<br>        userDomain.setUserId(userId);<br>        userDomain.setUserName(userName);<br>        userDomain.setPassword(password);<br>        userDomain.setPhone(phone);<br>        userService.updateUser(userDomain);<br>        <span class=\"hljs-keyword\">return</span> ResponseEntity.ok(<span class=\"hljs-string\">\"更新成功\"</span>);<br>    &#125;<br><br>    <span class=\"hljs-meta\">@GetMapping</span>(<span class=\"hljs-string\">\"\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> ResponseEntity <span class=\"hljs-title\">getUsers</span><span class=\"hljs-params\">()</span></span>&#123;<br>        <span class=\"hljs-keyword\">return</span> ResponseEntity.ok(userService.selectUsers());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>强行科普一下：</p>\n<ul>\n<li><p><code>@RequestParam</code> 用于将请求参数区数据映射到功能处理方法的参数上，<code>value</code>：参数名字，即入参的请求参数名字，如userName表示请求的参数区中的名字为userName的参数的值将传入，<code>required</code>：是否必须，默认是true，表示请求中一定要有相应的参数，否则将报404错误码；</p>\n</li>\n<li><p><a href=\"https://www.cnblogs.com/shuaifing/p/8119664.html\" target=\"_blank\" rel=\"noopener\">@Controller和@RestController的区别？</a></p>\n</li>\n</ul>\n<h3 id=\"启动类\"><a href=\"#启动类\" class=\"headerlink\" title=\"启动类\"></a>启动类</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen;<br><br><span class=\"hljs-keyword\">import</span> org.springframework.boot.SpringApplication;<br><span class=\"hljs-keyword\">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;<br><br><span class=\"hljs-meta\">@SpringBootApplication</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">SpringBootMybatisHikaricpApplication</span> </span>&#123;<br><br>\t<span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(String[] args)</span> </span>&#123;<br>\t\tSpringApplication.run(SpringBootMybatisHikaricpApplication<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>, <span class=\"hljs-title\">args</span>)</span>;<br>\t&#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n\n<h3 id=\"最终项目结构\"><a href=\"#最终项目结构\" class=\"headerlink\" title=\"最终项目结构\"></a>最终项目结构</h3><p><img    class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046463452426.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">目录结构</span></p>\n<h2 id=\"启动\"><a href=\"#启动\" class=\"headerlink\" title=\"启动\"></a>启动</h2><p>启动项目启动类</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">2018-07-25 15:25:42.970  INFO 22602 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [&#x2F;**] onto handler of type [class org.springframework.web.servlet.resource.ResourceHttpRequestHandler]<br>2018-07-25 15:25:43.380  INFO 22602 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Registering beans for JMX exposure on startup<br>2018-07-25 15:25:43.382  INFO 22602 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Bean with name &#39;dataSource&#39; has been autodetected for JMX exposure<br>2018-07-25 15:25:43.389  INFO 22602 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Located MBean &#39;dataSource&#39;: registering with JMX server as MBean [com.zaxxer.hikari:name&#x3D;dataSource,type&#x3D;HikariDataSource]<br>2018-07-25 15:25:43.450  INFO 22602 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path &#39;&#39;<br>2018-07-25 15:25:43.456  INFO 22602 --- [           main] c.w.SpringBootMybatisHikaricpApplication : Started SpringBootMybatisHikaricpApplication in 6.267 seconds (JVM running for 7.784)<br></code></pre></td></tr></table></figure>\n\n<p>这样的输出表示项目启动成功了！！如果遇到报错启动不了，请回头看看是不是有些地方没有注意到。</p>\n<h2 id=\"测试\"><a href=\"#测试\" class=\"headerlink\" title=\"测试\"></a>测试</h2><p>项目成功启动了，那么可以开始测试了</p>\n<p>推荐使用一个强大的http请求工具：Postman</p>\n<h3 id=\"添加\"><a href=\"#添加\" class=\"headerlink\" title=\"添加\"></a>添加</h3><p><img    class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046463496426.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">添加</span></p>\n<h3 id=\"删除\"><a href=\"#删除\" class=\"headerlink\" title=\"删除\"></a>删除</h3><p><img    class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046463538427.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">删除</span></p>\n<h3 id=\"更新\"><a href=\"#更新\" class=\"headerlink\" title=\"更新\"></a>更新</h3><p><img    class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046463575426.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">更新</span></p>\n<h3 id=\"查找\"><a href=\"#查找\" class=\"headerlink\" title=\"查找\"></a>查找</h3><p><img    class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046463616426.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">查找</span></p>\n<h2 id=\"最后\"><a href=\"#最后\" class=\"headerlink\" title=\"最后\"></a>最后</h2><blockquote>\n<p> 在编程的路上肯定会遇到很多的bug，程序员就是要不断的和bug作斗争，加油，愿你成为真正的大牛。有机会讲讲Hikari如何使用多数据源。</p>\n</blockquote>\n<p>源码地址：<a href=\"https://github.com/WinterChenS/springboot-learning-experience/tree/master/spring-boot-mybatis-hikaricp\" target=\"_blank\" rel=\"noopener\">戳这里</a></p>\n<p>springboot技术交流群：681513531</p>\n<p>个人博客：<a href=\"https://winterchen.com/\" target=\"_blank\" rel=\"noopener\">https://winterchen.com</a></p>\n","raw":null,"categories":[{"name":"Spring Boot","path":"api/categories/Spring Boot.json"}],"tags":[{"name":"Spring Boot","path":"api/tags/Spring Boot.json"},{"name":"mybatis","path":"api/tags/mybatis.json"},{"name":"HikariCP","path":"api/tags/HikariCP.json"}]},{"title":"杭州-夜色","slug":"2018-07-05-hangzhou-night","date":"2018-07-05T07:39:00.000Z","updated":"2022-12-01T01:32:39.783Z","comments":true,"top":null,"path":"api/articles/2018-07-05-hangzhou-night.json","excerpt":null,"keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046520752083.jpg","content":"<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046521010199.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></h2><h2 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046521266081.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></h2><h2 id=\"-2\"><a href=\"#-2\" class=\"headerlink\" title=\"\"></a><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046521681472.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></h2><h2 id=\"-3\"><a href=\"#-3\" class=\"headerlink\" title=\"\"></a><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046522324044.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></h2><p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046522939996.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p>杭州记忆</p>\n","raw":null,"categories":[{"name":"摄影","path":"api/categories/摄影.json"}],"tags":[{"name":"摄影","path":"api/tags/摄影.json"}]},{"title":"初夏-荷","slug":"2018-06-23-summer-after-rain","date":"2018-06-25T12:54:00.000Z","updated":"2022-12-01T01:32:39.783Z","comments":true,"top":null,"path":"api/articles/2018-06-23-summer-after-rain.json","excerpt":null,"keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046634424756.jpg","content":"<p>一场初夏的雨后，天空渐渐放晴，池塘里的荷叶上盛满了雨滴，让我想起了很多年前那个追风的少年，一场暴雨淋湿了未打伞的你，用荷叶做成的雨伞的你，雨中奔跑的你，至今还留在记忆深处，无法忘怀。青春年少，如同这盛夏，又如宋冬野的《安和桥》，我知道那些夏天就像青春一样回不来，代替梦想的也只能是勉为其难，长大以后才发现生活真的是太难了，可即便是这样，还是要咬着牙继续前进啊。<br><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046634563046.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<hr>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046634701349.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></h2><p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046635178310.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<hr>\n<p>无意间看到一个窗台前的一盆花<br><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046635258866.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n","raw":null,"categories":[{"name":"摄影","path":"api/categories/摄影.json"}],"tags":[{"name":"摄影","path":"api/tags/摄影.json"}]},{"title":"九溪十八涧行","slug":"2018-06-17-travel","date":"2018-06-19T08:49:00.000Z","updated":"2022-12-01T01:32:39.783Z","comments":true,"top":null,"path":"api/articles/2018-06-17-travel.json","excerpt":null,"keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046629865358.jpg","content":"<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046629933332.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p>端午放假第一天去了九溪十八涧爬山<br><img    class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046629987797.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">茶庄</span></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046630154296.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"><br>喜欢这种风格的建筑，有点日式风格的感觉</p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046630456340.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"><br><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046630672257.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"><br><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046630956295.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"><br><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046631181831.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"><br>好清静的一个小溪，水很清澈</p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046631392335.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"><br><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046520043310.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"><br>一群小孩子在清澈的溪水中嬉戏打闹，很有童趣</p>\n<h2 id=\"\"><a href=\"#\" class=\"headerlink\" title=\"\"></a><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046632505170.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></h2><h2 id=\"-1\"><a href=\"#-1\" class=\"headerlink\" title=\"\"></a><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046632807355.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></h2><p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046633017320.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<hr>\n<h2 id=\"-2\"><a href=\"#-2\" class=\"headerlink\" title=\"\"></a><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046633147721.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></h2><h2 id=\"-3\"><a href=\"#-3\" class=\"headerlink\" title=\"\"></a><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046633226005.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></h2><h2 id=\"-4\"><a href=\"#-4\" class=\"headerlink\" title=\"\"></a><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046520328089.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></h2><h2 id=\"-5\"><a href=\"#-5\" class=\"headerlink\" title=\"\"></a><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046634109410.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></h2><h2 id=\"-6\"><a href=\"#-6\" class=\"headerlink\" title=\"\"></a><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046634189507.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></h2><p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046634230518.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n","raw":null,"categories":[{"name":"随笔","path":"api/categories/随笔.json"}],"tags":[{"name":"随笔","path":"api/tags/随笔.json"}]},{"title":"犹豫的眼神","slug":"2018-06-09-pretty-gril","date":"2018-06-09T14:18:00.000Z","updated":"2022-12-01T01:32:39.783Z","comments":true,"top":null,"path":"api/articles/2018-06-09-pretty-gril.json","excerpt":"18年的高考昨天结束了，六一买下来人生中第一台单反，捣鼓了几天总算知道了一些技巧，于是今天特地到云栖竹径去拍摄并且爬山，在景点门口等车的时候，看到路旁的茶园有一位优雅漂亮并且眼神中有淡淡的忧郁的妹子，按动快门记录了这一刻，不过这个照片都是后期裁剪了的，因为旁边有一个摄影师在给拍照。","keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://images.unsplash.com/photo-1523364583621-23af08364dc7?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=41ac7c82c76e28433baafbb49deeb4e5&auto=format&fit=crop&w=2098&q=80","content":"<p>18年的高考昨天结束了，六一买下来人生中第一台单反，捣鼓了几天总算知道了一些技巧，于是今天特地到云栖竹径去拍摄并且爬山，在景点门口等车的时候，看到路旁的茶园有一位优雅漂亮并且眼神中有淡淡的忧郁的妹子，按动快门记录了这一刻，不过这个照片都是后期裁剪了的，因为旁边有一个摄影师在给拍照。</p>\n<a id=\"more\"></a>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046629133224.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046629463877.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n","raw":null,"categories":[{"name":"随笔","path":"api/categories/随笔.json"}],"tags":[{"name":"随笔","path":"api/tags/随笔.json"}]},{"title":"springboot2.0 mybatis 使用多数据源","slug":"spring-boot-mybatis-mutil-database","date":"2018-05-30T10:39:00.000Z","updated":"2022-12-01T01:32:39.787Z","comments":true,"top":null,"path":"api/articles/spring-boot-mybatis-mutil-database.json","excerpt":" [Figure] springboot2.0正式版发布之后，很多的组件集成需要变更了，这次将多数据源的使用踩的坑给大家填一填。当前多数据源的主要为主从库，读写分离，动态切换数据源。使用的技术就是AOP进行dao方法的切面，所以大家的方法名开头都需要按照规范进行编写，如：get***、add*** 等等，","keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://images.unsplash.com/photo-1496737018672-b1a6be2e949c?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=f0aa3d84be0ad9a656a27a318f055ee9&auto=format&fit=crop&w=2691&q=80","content":"<p><img    class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046463697426.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">多数据源</span><br>springboot2.0正式版发布之后，很多的组件集成需要变更了，这次将多数据源的使用踩的坑给大家填一填。当前多数据源的主要为主从库，读写分离，动态切换数据源。使用的技术就是AOP进行dao方法的切面，所以大家的方法名开头都需要按照规范进行编写，如：<code>get***</code>、<code>add***</code> 等等，</p>\n<a id=\"more\"></a>\n<h2 id=\"起步基础\"><a href=\"#起步基础\" class=\"headerlink\" title=\"起步基础\"></a>起步基础</h2><p>本次的教程需要有springboot2.0集成mybatis 作为基础：</p>\n<ul>\n<li><p>博客地址：<a href=\"https://blog.csdn.net/Winter_chen001/article/details/80010967\" target=\"_blank\" rel=\"noopener\">springboot2.0 Mybatis 整合 (springboot2.0版本)</a></p>\n</li>\n<li><p>基础项目源码：<a href=\"https://github.com/WinterChenS/springboot2-mybatis-demo\" target=\"_blank\" rel=\"noopener\">https://github.com/WinterChenS/springboot2-mybatis-demo</a></p>\n</li>\n</ul>\n<p>需要以上的步骤作为基础，运行成功之后可就可以开始配置多数据源了</p>\n<h2 id=\"开始动手\"><a href=\"#开始动手\" class=\"headerlink\" title=\"开始动手\"></a>开始动手</h2><h3 id=\"添加依赖\"><a href=\"#添加依赖\" class=\"headerlink\" title=\"添加依赖\"></a>添加依赖</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">&lt;dependency&gt;<br>  &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;<br>  &lt;artifactId&gt;spring-boot-starter-aop&lt;&#x2F;artifactId&gt;<br>&lt;&#x2F;dependency&gt;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"修改启动类\"><a href=\"#修改启动类\" class=\"headerlink\" title=\"修改启动类\"></a>修改启动类</h3><p>修改之前：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@SpringBootApplication</span><br><span class=\"hljs-meta\">@MapperScan</span>(<span class=\"hljs-string\">\"com.winterchen.dao\"</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">SpringBootMybatisMutilDatabaseApplication</span> </span>&#123;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(SpringBootMybatisMutilDatabaseApplication<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>, <span class=\"hljs-title\">args</span>)</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>修改之后：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@SpringBootApplication</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">SpringBootMybatisMutilDatabaseApplication</span> </span>&#123;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">main</span><span class=\"hljs-params\">(String[] args)</span> </span>&#123;<br>        SpringApplication.run(SpringBootMybatisMutilDatabaseApplication<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>, <span class=\"hljs-title\">args</span>)</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>因为改用多数据源，所以dao接口的扫描我们放在配置类中进行</p>\n<h3 id=\"修改项目配置\"><a href=\"#修改项目配置\" class=\"headerlink\" title=\"修改项目配置\"></a>修改项目配置</h3><p>首先我们需要在配置文件中配置多数据源，看一下原本项目的配置：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">spring:</span><br>    <span class=\"hljs-attr\">datasource:</span><br>        <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">mysql_test</span><br>        <span class=\"hljs-comment\">#-----------------start-----------------#  （1）</span><br>        <span class=\"hljs-attr\">type:</span> <span class=\"hljs-string\">com.alibaba.druid.pool.DruidDataSource</span><br>        <span class=\"hljs-comment\">#-----------------end-----------------#</span><br>        <span class=\"hljs-comment\">#druid相关配置</span><br>        <span class=\"hljs-attr\">druid:</span><br>          <span class=\"hljs-comment\">#监控统计拦截的filters</span><br>          <span class=\"hljs-attr\">filters:</span> <span class=\"hljs-string\">stat</span><br>          <span class=\"hljs-comment\">#-----------------start-----------------# （2）</span><br>          <span class=\"hljs-attr\">driver-class-name:</span> <span class=\"hljs-string\">com.mysql.jdbc.Driver</span><br>          <span class=\"hljs-comment\">#基本属性</span><br>          <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">jdbc:mysql://127.0.0.1:3306/mytest?useUnicode=true&amp;characterEncoding=UTF-8&amp;allowMultiQueries=true</span><br>          <span class=\"hljs-attr\">username:</span> <span class=\"hljs-string\">root</span><br>          <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">root</span><br>           <span class=\"hljs-comment\">#-----------------end-----------------#</span><br>          <span class=\"hljs-comment\">#配置初始化大小/最小/最大</span><br>          <span class=\"hljs-attr\">initial-size:</span> <span class=\"hljs-number\">1</span><br>          <span class=\"hljs-attr\">min-idle:</span> <span class=\"hljs-number\">1</span><br>          <span class=\"hljs-attr\">max-active:</span> <span class=\"hljs-number\">20</span><br>          <span class=\"hljs-comment\">#获取连接等待超时时间</span><br>          <span class=\"hljs-attr\">max-wait:</span> <span class=\"hljs-number\">60000</span><br>          <span class=\"hljs-comment\">#间隔多久进行一次检测，检测需要关闭的空闲连接</span><br>          <span class=\"hljs-attr\">time-between-eviction-runs-millis:</span> <span class=\"hljs-number\">60000</span><br>          <span class=\"hljs-comment\">#一个连接在池中最小生存的时间</span><br>          <span class=\"hljs-attr\">min-evictable-idle-time-millis:</span> <span class=\"hljs-number\">300000</span><br>          <span class=\"hljs-attr\">validation-query:</span> <span class=\"hljs-string\">SELECT</span> <span class=\"hljs-string\">'x'</span><br>          <span class=\"hljs-attr\">test-while-idle:</span> <span class=\"hljs-literal\">true</span><br>          <span class=\"hljs-attr\">test-on-borrow:</span> <span class=\"hljs-literal\">false</span><br>          <span class=\"hljs-attr\">test-on-return:</span> <span class=\"hljs-literal\">false</span><br>          <span class=\"hljs-comment\">#打开PSCache，并指定每个连接上PSCache的大小。oracle设为true，mysql设为false。分库分表较多推荐设置为false</span><br>          <span class=\"hljs-attr\">pool-prepared-statements:</span> <span class=\"hljs-literal\">false</span><br>          <span class=\"hljs-attr\">max-pool-prepared-statement-per-connection-size:</span> <span class=\"hljs-number\">20</span><br></code></pre></td></tr></table></figure>\n\n<p>*<em>需要修改的地方: *</em></p>\n<ul>\n<li><p>(1) 需要将 <code>type: com.alibaba.druid.pool.DruidDataSource</code>去除；</p>\n</li>\n<li><p>(2) 将关于数据库的连接信息: <code>driver-class-name</code>、<code>url</code>、<code>username</code> 、<code>password</code>  去除；</p>\n</li>\n</ul>\n<p><strong>修改后：</strong></p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">spring:</span><br>    <span class=\"hljs-attr\">datasource:</span><br>        <span class=\"hljs-attr\">name:</span> <span class=\"hljs-string\">mysql_test</span><br>        <span class=\"hljs-comment\">#-------------- start ----------------# (1)</span><br>        <span class=\"hljs-attr\">master:</span><br>          <span class=\"hljs-comment\">#基本属性--注意，这里的为【jdbcurl】-- 默认使用HikariPool作为数据库连接池</span><br>          <span class=\"hljs-attr\">jdbcurl:</span> <span class=\"hljs-string\">jdbc:mysql://127.0.0.1:3306/mytest?useUnicode=true&amp;characterEncoding=UTF-8&amp;allowMultiQueries=true</span><br>          <span class=\"hljs-attr\">username:</span> <span class=\"hljs-string\">root</span><br>          <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">root</span><br>          <span class=\"hljs-attr\">driver-class-name:</span> <span class=\"hljs-string\">com.mysql.jdbc.Driver</span><br>        <span class=\"hljs-attr\">slave:</span><br>          <span class=\"hljs-comment\">#基本属性--注意，这里为 【url】-- 使用 druid 作为数据库连接池</span><br>          <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">jdbc:mysql://127.0.0.1:3306/mytest?useUnicode=true&amp;characterEncoding=UTF-8&amp;allowMultiQueries=true</span><br>          <span class=\"hljs-attr\">username:</span> <span class=\"hljs-string\">root</span><br>          <span class=\"hljs-attr\">password:</span> <span class=\"hljs-string\">root</span><br>          <span class=\"hljs-attr\">driver-class-name:</span> <span class=\"hljs-string\">com.mysql.jdbc.Driver</span><br>        <span class=\"hljs-attr\">read:</span> <span class=\"hljs-string\">get,select,count,list,query,find</span><br>        <span class=\"hljs-attr\">write:</span> <span class=\"hljs-string\">add,create,update,delete,remove,insert</span><br>        <span class=\"hljs-comment\">#-------------- end ----------------#</span><br>        <span class=\"hljs-comment\">#druid相关配置</span><br>        <span class=\"hljs-attr\">druid:</span><br>          <span class=\"hljs-comment\">#监控统计拦截的filters</span><br>          <span class=\"hljs-attr\">filters:</span> <span class=\"hljs-string\">stat,wall</span><br>          <span class=\"hljs-comment\">#配置初始化大小/最小/最大</span><br>          <span class=\"hljs-attr\">initial-size:</span> <span class=\"hljs-number\">1</span><br>          <span class=\"hljs-attr\">min-idle:</span> <span class=\"hljs-number\">1</span><br>          <span class=\"hljs-attr\">max-active:</span> <span class=\"hljs-number\">20</span><br>          <span class=\"hljs-comment\">#获取连接等待超时时间</span><br>          <span class=\"hljs-attr\">max-wait:</span> <span class=\"hljs-number\">60000</span><br>          <span class=\"hljs-comment\">#间隔多久进行一次检测，检测需要关闭的空闲连接</span><br>          <span class=\"hljs-attr\">time-between-eviction-runs-millis:</span> <span class=\"hljs-number\">60000</span><br>          <span class=\"hljs-comment\">#一个连接在池中最小生存的时间</span><br>          <span class=\"hljs-attr\">min-evictable-idle-time-millis:</span> <span class=\"hljs-number\">300000</span><br>          <span class=\"hljs-attr\">validation-query:</span> <span class=\"hljs-string\">SELECT</span> <span class=\"hljs-string\">'x'</span><br>          <span class=\"hljs-attr\">test-while-idle:</span> <span class=\"hljs-literal\">true</span><br>          <span class=\"hljs-attr\">test-on-borrow:</span> <span class=\"hljs-literal\">false</span><br>          <span class=\"hljs-attr\">test-on-return:</span> <span class=\"hljs-literal\">false</span><br>          <span class=\"hljs-comment\">#打开PSCache，并指定每个连接上PSCache的大小。oracle设为true，mysql设为false。分库分表较多推荐设置为false</span><br>          <span class=\"hljs-attr\">pool-prepared-statements:</span> <span class=\"hljs-literal\">false</span><br>          <span class=\"hljs-attr\">max-pool-prepared-statement-per-connection-size:</span> <span class=\"hljs-number\">20</span><br></code></pre></td></tr></table></figure>\n\n<p>需要修改地方：</p>\n<ul>\n<li>(1) 在如上的配置中添加<code>master</code>、<code>slave</code>两个数据源;</li>\n</ul>\n<p><strong>注意！！</strong>两中数据源中有一处是不一样的，原因是因为<code>master</code>数据源使用 <code>Hikari</code>连接池，<code>slave</code>使用的是<code>druid</code>作为数据库连接池，所以两处的配置分别为：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">master:</span><br>    <span class=\"hljs-attr\">jdbcurl:</span> <span class=\"hljs-string\">jdbc:mysql://127.0.0.1:3306/mytest?useUnicode=true&amp;characterEncoding=UTF-8&amp;allowMultiQueries=true</span><br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">slave:</span><br>    <span class=\"hljs-attr\">url:</span> <span class=\"hljs-string\">jdbc:mysql://127.0.0.1:3306/mytest?useUnicode=true&amp;characterEncoding=UTF-8&amp;allowMultiQueries=true</span><br></code></pre></td></tr></table></figure>\n\n<p>数据库的连接不一样的，如果配置成一样的会在启动的时候报错。</p>\n<p><strong>注意！！</strong></p>\n<p>dao接口方法的方法名规则配置在这里了，当然可以自行更改：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">read:</span> <span class=\"hljs-string\">get,select,count,list,query,find</span><br><span class=\"hljs-attr\">write:</span> <span class=\"hljs-string\">add,create,update,delete,remove,insert</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"创建配置包\"><a href=\"#创建配置包\" class=\"headerlink\" title=\"创建配置包\"></a>创建配置包</h3><p>首先在项目的<code>/src/main/java/com/winterchen/</code>包下创建<code>config</code>包</p>\n<p><img    class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046463787428.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">创建config包</span></p>\n<h3 id=\"创建数据源类型的枚举DatabaseType\"><a href=\"#创建数据源类型的枚举DatabaseType\" class=\"headerlink\" title=\"创建数据源类型的枚举DatabaseType\"></a>创建数据源类型的枚举DatabaseType</h3><p>该枚举类主要用来区分读写</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.config;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 列出数据源类型</span><br><span class=\"hljs-comment\"> * Created by Donghua.Chen on 2018/5/29.</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">enum</span> DatabaseType &#123;<br><br>    master(<span class=\"hljs-string\">\"write\"</span>), slave(<span class=\"hljs-string\">\"read\"</span>);<br><br><br>    DatabaseType(String name) &#123;<br>        <span class=\"hljs-keyword\">this</span>.name = name;<br>    &#125;<br><br>    <span class=\"hljs-keyword\">private</span> String name;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">getName</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> name;<br>    &#125;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">setName</span><span class=\"hljs-params\">(String name)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">this</span>.name = name;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title\">toString</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">\"DatabaseType&#123;\"</span> +<br>                <span class=\"hljs-string\">\"name='\"</span> + name + <span class=\"hljs-string\">'\\''</span> +<br>                <span class=\"hljs-string\">'&#125;'</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"创建线程安全的DatabaseType容器\"><a href=\"#创建线程安全的DatabaseType容器\" class=\"headerlink\" title=\"创建线程安全的DatabaseType容器\"></a>创建线程安全的DatabaseType容器</h3><p>多数据源必须要保证数据源的线程安全的</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">package</span> com.winterchen.config;<br><br><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> * 保存一个线程安全的DatabaseType容器</span><br><span class=\"hljs-comment\"> * Created by Donghua.Chen on 2018/5/29.</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DatabaseContextHolder</span> </span>&#123;<br><br>        <span class=\"hljs-comment\">//用于存放多线程环境下的成员变量</span><br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> ThreadLocal&lt;DatabaseType&gt; contextHolder = <span class=\"hljs-keyword\">new</span> ThreadLocal&lt;&gt;();<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">setDatabaseType</span><span class=\"hljs-params\">(DatabaseType type)</span> </span>&#123;<br>        contextHolder.set(type);<br>    &#125;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> DatabaseType <span class=\"hljs-title\">getDatabaseType</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> contextHolder.get();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"创建动态数据源\"><a href=\"#创建动态数据源\" class=\"headerlink\" title=\"创建动态数据源\"></a>创建动态数据源</h3><p>实现数据源切换的功能就是自定义一个类扩展AbstractRoutingDataSource抽象类，其实该相当于数据源DataSource的路由中介，可以实现在项目运行时根据相应key值切换到对应的数据源DataSource上，有兴趣的同学可以看看它的源码。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DynamicDataSource</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">AbstractRoutingDataSource</span> </span>&#123;<br><br>    <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> Map&lt;DatabaseType, List&lt;String&gt;&gt; METHOD_TYPE_MAP = <span class=\"hljs-keyword\">new</span> HashMap&lt;&gt;();<br><br><br>    <span class=\"hljs-meta\">@Nullable</span><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">protected</span> Object <span class=\"hljs-title\">determineCurrentLookupKey</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        DatabaseType type = DatabaseContextHolder.getDatabaseType();<br>        logger.info(<span class=\"hljs-string\">\"====================dataSource ==========\"</span> + type);<br>        <span class=\"hljs-keyword\">return</span> type;<br>    &#125;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">setMethodType</span><span class=\"hljs-params\">(DatabaseType type, String content)</span> </span>&#123;<br>        List&lt;String&gt; list = Arrays.asList(content.split(<span class=\"hljs-string\">\",\"</span>));<br>        METHOD_TYPE_MAP.put(type, list);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"创建数据源配置类DataSourceConfig\"><a href=\"#创建数据源配置类DataSourceConfig\" class=\"headerlink\" title=\"创建数据源配置类DataSourceConfig\"></a>创建数据源配置类DataSourceConfig</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-meta\">@MapperScan</span>(<span class=\"hljs-string\">\"com.winterchen.dao\"</span>)<br><span class=\"hljs-meta\">@EnableTransactionManagement</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DataSourceConfig</span> </span>&#123;<br><br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> Logger logger = LoggerFactory.getLogger(DataSourceConfig<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> Environment env;  <span class=\"hljs-comment\">// (1)</span><br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> DataSourceProperties properties;  <span class=\"hljs-comment\">// (2)</span><br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.druid.filters&#125;\"</span>)   <span class=\"hljs-comment\">// (3)</span><br>    <span class=\"hljs-keyword\">private</span> String filters;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.druid.initial-size&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> Integer initialSize;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.druid.min-idle&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> Integer minIdle;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.druid.max-active&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> Integer maxActive;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.druid.max-wait&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> Integer maxWait;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.druid.time-between-eviction-runs-millis&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> Long timeBetweenEvictionRunsMillis;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.druid.min-evictable-idle-time-millis&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> Long minEvictableIdleTimeMillis;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.druid.validation-query&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> String validationQuery;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.druid.test-while-idle&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> Boolean testWhileIdle;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.druid.test-on-borrow&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> testOnBorrow;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.druid.test-on-return&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> testOnReturn;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.druid.pool-prepared-statements&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">boolean</span> poolPreparedStatements;<br><br>    <span class=\"hljs-meta\">@Value</span>(<span class=\"hljs-string\">\"$&#123;spring.datasource.druid.max-pool-prepared-statement-per-connection-size&#125;\"</span>)<br>    <span class=\"hljs-keyword\">private</span> Integer maxPoolPreparedStatementPerConnectionSize;<br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * 通过Spring JDBC 快速创建 DataSource</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span></span><br><span class=\"hljs-comment\">     */</span><br>    <span class=\"hljs-meta\">@Bean</span>(name = <span class=\"hljs-string\">\"masterDataSource\"</span>)<br>    <span class=\"hljs-meta\">@Qualifier</span>(<span class=\"hljs-string\">\"masterDataSource\"</span>)<br>    <span class=\"hljs-meta\">@ConfigurationProperties</span>(prefix = <span class=\"hljs-string\">\"spring.datasource.master\"</span>)  <span class=\"hljs-comment\">// (4)</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> DataSource <span class=\"hljs-title\">masterDataSource</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> DataSourceBuilder.create().build();<br>    &#125;<br><br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     * 手动创建DruidDataSource,通过DataSourceProperties 读取配置</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span></span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@throws</span> SQLException</span><br><span class=\"hljs-comment\">     */</span><br>    <span class=\"hljs-meta\">@Bean</span>(name = <span class=\"hljs-string\">\"slaveDataSource\"</span>)<br>    <span class=\"hljs-meta\">@Qualifier</span>(<span class=\"hljs-string\">\"slaveDataSource\"</span>)<br>    <span class=\"hljs-meta\">@ConfigurationProperties</span>(prefix = <span class=\"hljs-string\">\"spring.datasource.slave\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> DataSource <span class=\"hljs-title\">slaveDataSource</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">throws</span> SQLException </span>&#123;<br>        DruidDataSource dataSource = <span class=\"hljs-keyword\">new</span> DruidDataSource();<br>        dataSource.setFilters(filters);<br>        dataSource.setUrl(properties.getUrl());<br>        dataSource.setDriverClassName(properties.getDriverClassName());<br>        dataSource.setUsername(properties.getUsername());<br>        dataSource.setPassword(properties.getPassword());<br>        dataSource.setInitialSize(initialSize);<br>        dataSource.setMinIdle(minIdle);<br>        dataSource.setMaxActive(maxActive);<br>        dataSource.setMaxWait(maxWait);<br>        dataSource.setTimeBetweenEvictionRunsMillis(timeBetweenEvictionRunsMillis);<br>        dataSource.setMinEvictableIdleTimeMillis(minEvictableIdleTimeMillis);<br>        dataSource.setValidationQuery(validationQuery);<br>        dataSource.setTestWhileIdle(testWhileIdle);<br>        dataSource.setTestOnBorrow(testOnBorrow);<br>        dataSource.setTestOnReturn(testOnReturn);<br>        dataSource.setPoolPreparedStatements(poolPreparedStatements);<br>        dataSource.setMaxPoolPreparedStatementPerConnectionSize(maxPoolPreparedStatementPerConnectionSize);<br>        <span class=\"hljs-keyword\">return</span> dataSource;<br>    &#125;<br><br><br>    <span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\">     *  构造多数据源连接池</span><br><span class=\"hljs-comment\">     *  Master 数据源连接池采用 HikariDataSource</span><br><span class=\"hljs-comment\">     *  Slave  数据源连接池采用 DruidDataSource</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@param</span> master</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@param</span> slave</span><br><span class=\"hljs-comment\">     * <span class=\"hljs-doctag\">@return</span></span><br><span class=\"hljs-comment\">     */</span><br>    <span class=\"hljs-meta\">@Bean</span><br>    <span class=\"hljs-meta\">@Primary</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> DynamicDataSource <span class=\"hljs-title\">dataSource</span><span class=\"hljs-params\">(@Qualifier(<span class=\"hljs-string\">\"masterDataSource\"</span>)</span> DataSource master,</span><br><span class=\"hljs-function\">                                        @<span class=\"hljs-title\">Qualifier</span><span class=\"hljs-params\">(<span class=\"hljs-string\">\"slaveDataSource\"</span>)</span> DataSource slave) </span>&#123;<br>        Map&lt;Object, Object&gt; targetDataSources = <span class=\"hljs-keyword\">new</span> HashMap&lt;&gt;();<br>        targetDataSources.put(DatabaseType.master, master);<br>        targetDataSources.put(DatabaseType.slave, slave);<br><br>        DynamicDataSource dataSource = <span class=\"hljs-keyword\">new</span> DynamicDataSource();<br>        dataSource.setTargetDataSources(targetDataSources);<span class=\"hljs-comment\">// 该方法是AbstractRoutingDataSource的方法</span><br>        dataSource.setDefaultTargetDataSource(slave);<span class=\"hljs-comment\">// 默认的datasource设置为myTestDbDataSource</span><br><br>        String read = env.getProperty(<span class=\"hljs-string\">\"spring.datasource.read\"</span>);<br>        dataSource.setMethodType(DatabaseType.slave, read);<br><br>        String write = env.getProperty(<span class=\"hljs-string\">\"spring.datasource.write\"</span>);<br>        dataSource.setMethodType(DatabaseType.master, write);<br><br>        <span class=\"hljs-keyword\">return</span> dataSource;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Bean</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> SqlSessionFactory <span class=\"hljs-title\">sqlSessionFactory</span><span class=\"hljs-params\">(@Qualifier(<span class=\"hljs-string\">\"masterDataSource\"</span>)</span> DataSource myTestDbDataSource,</span><br><span class=\"hljs-function\">                                               @<span class=\"hljs-title\">Qualifier</span><span class=\"hljs-params\">(<span class=\"hljs-string\">\"slaveDataSource\"</span>)</span> DataSource myTestDb2DataSource) <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>        SqlSessionFactoryBean fb = <span class=\"hljs-keyword\">new</span> SqlSessionFactoryBean();<br>        fb.setDataSource(<span class=\"hljs-keyword\">this</span>.dataSource(myTestDbDataSource, myTestDb2DataSource));<br>        fb.setTypeAliasesPackage(env.getProperty(<span class=\"hljs-string\">\"mybatis.type-aliases-package\"</span>));<br>        fb.setMapperLocations(<span class=\"hljs-keyword\">new</span> PathMatchingResourcePatternResolver().getResources(env.getProperty(<span class=\"hljs-string\">\"mybatis.mapper-locations\"</span>)));<br>        <span class=\"hljs-keyword\">return</span> fb.getObject();<br>    &#125;<br><br><br>    <span class=\"hljs-meta\">@Bean</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> DataSourceTransactionManager <span class=\"hljs-title\">transactionManager</span><span class=\"hljs-params\">(DynamicDataSource dataSource)</span> <span class=\"hljs-keyword\">throws</span> Exception </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> DataSourceTransactionManager(dataSource);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>以上的代码中：</p>\n<ul>\n<li><p>(1)  注入类 <code>Environment</code> 可以很方便的获取配置文件中的参数</p>\n</li>\n<li><p>(2)  <code>DataSourceProperties</code>和（4）中的 <code>@ConfigurationProperties(prefix = &quot;spring.datasource.master&quot;)</code>配合使用，将配置文件中的配置数据自动封装到实体类<code>DataSourceProperties</code>中</p>\n</li>\n<li><p>(3) <code>@Value</code>注解同样是指定获取配置文件中的配置;</p>\n</li>\n</ul>\n<p>更详细的配置大家可以参考官方文档。</p>\n<h3 id=\"配置AOP\"><a href=\"#配置AOP\" class=\"headerlink\" title=\"配置AOP\"></a>配置AOP</h3><p>本章的开头已经说过，多数据源动态切换的原理是利用AOP切面进行动态的切换的，当调用<code>dao</code>接口方法时，根据接口方法的方法名开头进行区分读写。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">/**</span><br><span class=\"hljs-comment\"> *</span><br><span class=\"hljs-comment\"> * 动态处理数据源，根据命名区分</span><br><span class=\"hljs-comment\"> * Created by Donghua.Chen on 2018/5/29.</span><br><span class=\"hljs-comment\"> */</span><br><span class=\"hljs-meta\">@Aspect</span><br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-meta\">@EnableAspectJAutoProxy</span>(proxyTargetClass = <span class=\"hljs-keyword\">true</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DataSourceAspect</span> </span>&#123;<br><br><br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> Logger logger = LoggerFactory.getLogger(DataSourceAspect<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br><br>    <span class=\"hljs-meta\">@Pointcut</span>(<span class=\"hljs-string\">\"execution(* com.winterchen.dao.*.*(..))\"</span>)<span class=\"hljs-comment\">//切点</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">aspect</span><span class=\"hljs-params\">()</span> </span>&#123;<br><br>    &#125;<br><br><br>    <span class=\"hljs-meta\">@Before</span>(<span class=\"hljs-string\">\"aspect()\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">before</span><span class=\"hljs-params\">(JoinPoint point)</span> </span>&#123; <span class=\"hljs-comment\">//在指定切点的方法之前执行</span><br>        String className = point.getTarget().getClass().getName();<br>        String method = point.getSignature().getName();<br>        String args = StringUtils.join(point.getArgs(), <span class=\"hljs-string\">\",\"</span>);<br>        logger.info(<span class=\"hljs-string\">\"className:&#123;&#125;, method:&#123;&#125;, args:&#123;&#125; \"</span>, className, method, args);<br>        <span class=\"hljs-keyword\">try</span> &#123;<br>            <span class=\"hljs-keyword\">for</span> (DatabaseType type : DatabaseType.values()) &#123;<br>                List&lt;String&gt; values = DynamicDataSource.METHOD_TYPE_MAP.get(type);<br>                <span class=\"hljs-keyword\">for</span> (String key : values) &#123;<br>                    <span class=\"hljs-keyword\">if</span> (method.startsWith(key)) &#123;<br>                        logger.info(<span class=\"hljs-string\">\"&gt;&gt;&#123;&#125; 方法使用的数据源为:&#123;&#125;&lt;&lt;\"</span>, method, key);<br>                        DatabaseContextHolder.setDatabaseType(type);<br>                        DatabaseType types = DatabaseContextHolder.getDatabaseType();<br>                        logger.info(<span class=\"hljs-string\">\"&gt;&gt;&#123;&#125;方法使用的数据源为:&#123;&#125;&lt;&lt;\"</span>, method, types);<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125; <span class=\"hljs-keyword\">catch</span> (Exception e) &#123;<br>            logger.error(e.getMessage(), e);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>如上可以看到，切点切在<code>dao</code>的接口方法中，根据接口方法的方法名进行匹配数据源，然后将数据源set到用于存放数据源线程安全的容器中；</p>\n<p>完整的项目结构了解一下：</p>\n<p><img    class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046463912428.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">完整项目结构</span></p>\n<h2 id=\"项目启动\"><a href=\"#项目启动\" class=\"headerlink\" title=\"项目启动\"></a>项目启动</h2><p>启动成功：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">2018-05-30 17:27:16.492  INFO 35406 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Located MBean &#39;masterDataSource&#39;: registering with JMX server as MBean [com.zaxxer.hikari:name&#x3D;masterDataSource,type&#x3D;HikariDataSource]<br>2018-05-30 17:27:16.496  INFO 35406 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Located MBean &#39;slaveDataSource&#39;: registering with JMX server as MBean [com.alibaba.druid.pool:name&#x3D;slaveDataSource,type&#x3D;DruidDataSource]<br>2018-05-30 17:27:16.498  INFO 35406 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Located MBean &#39;statFilter&#39;: registering with JMX server as MBean [com.alibaba.druid.filter.stat:name&#x3D;statFilter,type&#x3D;StatFilter]<br>2018-05-30 17:27:16.590  INFO 35406 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path &#39;&#39;<br>2018-05-30 17:27:16.598  INFO 35406 --- [           main] pringBootMybatisMutilDatabaseApplication : Started SpringBootMybatisMutilDatabaseApplication in 11.523 seconds (JVM running for 13.406)<br></code></pre></td></tr></table></figure>\n\n<p>添加用户（write）：</p>\n<p><img    class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046464083964.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">添加用户</span></p>\n<p>日志：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">2018-05-30 17:29:07.347  INFO 35406 --- [nio-8080-exec-1] com.winterchen.config.DataSourceAspect   : className:com.sun.proxy.$Proxy73, method:insert, args:com.winterchen.model.UserDomain@4b5b52dc<br>2018-05-30 17:29:07.350  INFO 35406 --- [nio-8080-exec-1] com.winterchen.config.DataSourceAspect   : &gt;&gt;insert 方法使用的数据源为:insert&lt;&lt;<br>2018-05-30 17:29:07.351  INFO 35406 --- [nio-8080-exec-1] com.winterchen.config.DataSourceAspect   : &gt;&gt;insert方法使用的数据源为:DatabaseType&#123;name&#x3D;&#39;write&#39;&#125;&lt;&lt;<br>2018-05-30 17:29:07.461  INFO 35406 --- [nio-8080-exec-1] com.winterchen.config.DynamicDataSource  : &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;dataSource &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;DatabaseType&#123;name&#x3D;&#39;write&#39;&#125;<br>2018-05-30 17:29:07.462  INFO 35406 --- [nio-8080-exec-1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...<br>2018-05-30 17:29:07.952  INFO 35406 --- [nio-8080-exec-1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.<br></code></pre></td></tr></table></figure>\n\n<p>可以看出使用的就是<code>write</code>数据源，并且该数据源是使用<code>HikariPool</code>作为数据库连接池的</p>\n<p>查询用户（read）：</p>\n<p><img    class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046464129009.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"   ><span class=\"image-caption\">查询用户</span></p>\n<p>日志：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">2018-05-30 17:29:41.616  INFO 35406 --- [nio-8080-exec-2] com.winterchen.config.DataSourceAspect   : className:com.sun.proxy.$Proxy73, method:selectUsers, args:<br>2018-05-30 17:29:41.618  INFO 35406 --- [nio-8080-exec-2] com.winterchen.config.DataSourceAspect   : &gt;&gt;selectUsers 方法使用的数据源为:select&lt;&lt;<br>2018-05-30 17:29:41.618  INFO 35406 --- [nio-8080-exec-2] com.winterchen.config.DataSourceAspect   : &gt;&gt;selectUsers方法使用的数据源为:DatabaseType&#123;name&#x3D;&#39;read&#39;&#125;&lt;&lt;<br>2018-05-30 17:29:41.693  INFO 35406 --- [nio-8080-exec-2] com.winterchen.config.DynamicDataSource  : &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;dataSource &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;DatabaseType&#123;name&#x3D;&#39;read&#39;&#125;<br>2018-05-30 17:29:41.982  INFO 35406 --- [nio-8080-exec-2] com.alibaba.druid.pool.DruidDataSource   : &#123;dataSource-1&#125; inited<br></code></pre></td></tr></table></figure>\n\n<p>可以看出使用的是<code>read</code>数据源。</p>\n<p>源码地址：<a href=\"https://github.com/WinterChenS/springboot-learning-experience/tree/master/spring-boot-mybatis-mutil-database\" target=\"_blank\" rel=\"noopener\">戳这里</a></p>\n<p>springboot技术交流群：681513531</p>\n","raw":null,"categories":[{"name":"Spring Boot","path":"api/categories/Spring Boot.json"}],"tags":[{"name":"Spring Boot","path":"api/tags/Spring Boot.json"},{"name":"mybatis","path":"api/tags/mybatis.json"}]},{"title":"如何在CentOS 7上安装和配置Nginx","slug":"centos7-install-nginx","date":"2018-05-30T01:53:00.000Z","updated":"2022-12-01T01:32:39.787Z","comments":true,"top":null,"path":"api/articles/centos7-install-nginx.json","excerpt":" [Figure] 如何在centOS7中安装和配置nginx呢？","keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://images.unsplash.com/photo-1526740048776-83b7bbf6860d?ixlib=rb-0.3.5&s=61f5e69ba90a009c860fa2d47ce5da3d&auto=format&fit=crop&w=2104&q=80","content":"<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046765480328.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p>如何在centOS7中安装和配置nginx呢？</p>\n<a id=\"more\"></a>\n<h2 id=\"1-安装CentOS-7-EPEL仓库\"><a href=\"#1-安装CentOS-7-EPEL仓库\" class=\"headerlink\" title=\"1.安装CentOS 7 EPEL仓库\"></a>1.安装CentOS 7 EPEL仓库</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">sudo yum install epel-release<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"2-安装Nginx\"><a href=\"#2-安装Nginx\" class=\"headerlink\" title=\"2.安装Nginx\"></a>2.安装Nginx</h2><p>现在Nginx存储库已经安装在您的服务器上，使用以下<code>yum</code>命令安装Nginx ：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">sudo yum install nginx<br></code></pre></td></tr></table></figure>\n\n<p>在对提示回答yes后，Nginx将在服务器上完成安装。</p>\n<h2 id=\"3-启动Nginx\"><a href=\"#3-启动Nginx\" class=\"headerlink\" title=\"3.启动Nginx\"></a>3.启动Nginx</h2><p>Nginx不会自行启动。要运行Nginx，请输入：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">sudo systemctl start nginx<br></code></pre></td></tr></table></figure>\n\n<p>如果您正在运行防火墙，请运行以下命令以允许HTTP和HTTPS通信：</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">sudo firewall-cmd --permanent --zone&#x3D;public --add-service&#x3D;http <br>sudo firewall-cmd --permanent --zone&#x3D;public --add-service&#x3D;https<br>sudo firewall-cmd --reload<br></code></pre></td></tr></table></figure>\n\n<p>打开浏览器输入ip地址看到nginx的首页就说明你启动成功了</p>\n<h2 id=\"4-设置开机启动\"><a href=\"#4-设置开机启动\" class=\"headerlink\" title=\"4.设置开机启动\"></a>4.设置开机启动</h2><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">sudo systemctl enable nginx<br></code></pre></td></tr></table></figure>\n\n<h2 id=\"5-配置nginx\"><a href=\"#5-配置nginx\" class=\"headerlink\" title=\"5.配置nginx\"></a>5.配置nginx</h2><p>使用<code>yum</code>进行安装的nginx的配置文件在<code>/etc/nginx/nginx.conf</code></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">vim &#x2F;etc&#x2F;nginx&#x2F;nginx.conf<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"nginx-conf\"><a href=\"#nginx-conf\" class=\"headerlink\" title=\"nginx.conf:\"></a>nginx.conf:</h3><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\"># For more information on configuration, see:<br>#   * Official English Documentation: http:&#x2F;&#x2F;nginx.org&#x2F;en&#x2F;docs&#x2F;<br>#   * Official Russian Documentation: http:&#x2F;&#x2F;nginx.org&#x2F;ru&#x2F;docs&#x2F;<br><br>user nginx;<br><br>#nginx进程数，建议设置为等于CPU总核心数。<br>worker_processes auto;<br><br>#全局错误日志定义类型，[ debug | info | notice | warn | error | crit ]<br>error_log &#x2F;var&#x2F;log&#x2F;nginx&#x2F;error.log;<br>pid &#x2F;run&#x2F;nginx.pid;#进程pid文件<br><br># Load dynamic modules. See &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;README.dynamic.<br>include &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;modules&#x2F;*.conf;<br><br>events &#123;<br>    #单个进程最大连接数（最大连接数&#x3D;连接数*进程数）<br>    #根据硬件调整，和前面工作进程配合起来用，尽量大，但是别把cpu跑到100%就行。每个进程允许的最多连接数，理论上每台nginx服务器的最大连接数为。\t<br>    worker_connections 1024;<br>&#125;<br><br>#设定http服务器，利用它的反向代理功能提供负载均衡支持<br>http &#123;<br>    log_format  main  &#39;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#39;<br>                      &#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;<br>                      &#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#39;;<br><br>    access_log  &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log  main;<br><br>\t\t#开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，对于普通应用设为 on，如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络I&#x2F;O处理速度，降低系统的负载。注意：如果图片显示不正常把这个改成off。<br>    #sendfile指令指定 nginx 是否调用sendfile 函数（zero copy 方式）来输出文件，对于普通应用，必须设为on。如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络IO处理速度，降低系统uptime。<br>    sendfile            on;<br>    <br>    #此选项允许或禁止使用socke的TCP_CORK的选项，此选项仅在使用sendfile的时候使用<br>    tcp_nopush          on;<br>    tcp_nodelay         on;<br>    <br>    #长连接超时时间，单位是秒<br>    keepalive_timeout   65;<br>    types_hash_max_size 2048;<br><br>    include             &#x2F;etc&#x2F;nginx&#x2F;mime.types;<br>    default_type        application&#x2F;octet-stream;<br><br>    # Load modular configuration files from the &#x2F;etc&#x2F;nginx&#x2F;conf.d directory.<br>    # See http:&#x2F;&#x2F;nginx.org&#x2F;en&#x2F;docs&#x2F;ngx_core_module.html#include<br>    # for more information.<br>    include &#x2F;etc&#x2F;nginx&#x2F;conf.d&#x2F;*.conf;<br>\t<br>  \t#虚拟主机的配置<br>    server &#123;<br>    \t\t#监听端口<br>        listen       80 default_server;<br>        listen       [::]:80 default_server;<br>        <br>        #域名可以有多个，用空格隔开<br>        server_name  luischen.cn;<br>       # root         &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html;<br>       # 重定向至https（按照需求）<br>        rewrite ^(.*)$  https:&#x2F;&#x2F;$host$1 permanent;<br>        # Load configuration files for the default server block.<br>        include &#x2F;etc&#x2F;nginx&#x2F;default.d&#x2F;*.conf;<br><br>        location &#x2F; &#123;<br>        &#125;<br><br>        error_page 404 &#x2F;404.html;<br>            location &#x3D; &#x2F;40x.html &#123;<br>        &#125;<br><br>        error_page 500 502 503 504 &#x2F;50x.html;<br>            location &#x3D; &#x2F;50x.html &#123;<br>        &#125;<br>    &#125;<br><br># Settings for a TLS enabled server.<br><br>    server &#123;<br>    \t\t# 监听433端口<br>        listen       443 ssl http2 default_server;<br>        listen       [::]:443 ssl http2 default_server;<br>        server_name  luischen.cn;<br>        #root         &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html;<br>\t\t\t\t# ssl证书<br>        ssl_certificate &quot;&#x2F;etc&#x2F;nginx&#x2F;1_luischen.cn_bundle.crt&quot;;<br>        ssl_certificate_key &quot;&#x2F;etc&#x2F;nginx&#x2F;2_luischen.cn.key&quot;;<br>        ssl_session_cache shared:SSL:1m;<br>        ssl_session_timeout  10m;<br>        ssl_ciphers HIGH:!aNULL:!MD5;<br>        ssl_prefer_server_ciphers on;<br>        <br>        #以下是一些反向代理的配置，可选。<br>        proxy_set_header X-Forwarded-Host $host;<br>        proxy_set_header X-Forwarded-Server $host;<br>        #后端的Web服务器可以通过X-Forwarded-For获取用户真实IP<br>        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br>        proxy_set_header Host $host;<br>#        # Load configuration files for the default server block.<br>#        include &#x2F;etc&#x2F;nginx&#x2F;default.d&#x2F;*.conf;<br>#\t\t\t\t\t<br>        location &#x2F; &#123;<br>         # 需要代理的端口-也就是nginx指向本地的端口<br>         proxy_pass http:&#x2F;&#x2F;127.0.0.1:8091;<br>         # 超时时间<br>         proxy_connect_timeout 600;<br>         proxy_read_timeout 600;<br>        &#125;<br>        <br>        error_page 404 &#x2F;404.html;<br>            location &#x3D; &#x2F;40x.html &#123;<br>        &#125;<br><br>        error_page 500 502 503 504 &#x2F;50x.html;<br>            location &#x3D; &#x2F;50x.html &#123;<br>        &#125;<br>    &#125;<br> &#125;<br></code></pre></td></tr></table></figure>\n\n\n<h2 id=\"6-nginx启动和停止命令\"><a href=\"#6-nginx启动和停止命令\" class=\"headerlink\" title=\"6.nginx启动和停止命令\"></a>6.nginx启动和停止命令</h2><p>启动</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">sudo systemctl start nginx<br></code></pre></td></tr></table></figure>\n\n<p>停止</p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plain\">sudo systemctl stop nginx<br></code></pre></td></tr></table></figure>\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","raw":null,"categories":[{"name":"Linux","path":"api/categories/Linux.json"}],"tags":[{"name":"Linux","path":"api/tags/Linux.json"},{"name":"nginx","path":"api/tags/nginx.json"},{"name":"centos7","path":"api/tags/centos7.json"}]},{"title":"当springMVC上下文尚未初始化的时候如何@Autowired注入对象呢？","slug":"spring-autowired","date":"2018-05-30T01:45:00.000Z","updated":"2022-12-01T01:32:39.787Z","comments":true,"top":null,"path":"api/articles/spring-autowired.json","excerpt":" [Figure] 一个问题困扰了我一天，场景是这样的：公司有一个独立的SSO用户权限验证中心，我负责的是公司的一个其他的独立项目；每次用户session过期或者未登录的时候跳统一登录页面；用户成功登录之后都会回调，回调的信息中有用户的userAccount；此时需要根据用户的userAccount获取用户的详细信息；权限系统提供了一个获取用户的接口；","keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046776553776.jpg","content":"<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046776701619.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p>一个问题困扰了我一天，场景是这样的：</p>\n<ul>\n<li>公司有一个独立的SSO用户权限验证中心，我负责的是公司的一个其他的独立项目；</li>\n<li>每次用户session过期或者未登录的时候跳统一登录页面；</li>\n<li>用户成功登录之后都会回调，回调的信息中有用户的userAccount；</li>\n<li>此时需要根据用户的userAccount获取用户的详细信息；</li>\n<li>权限系统提供了一个获取用户的接口；<a id=\"more\"></a>\n\n</li>\n</ul>\n<p>遇到的问题：</p>\n<ul>\n<li>使用的是shrio进行系统权限的控制，当用户在SSO登录页面成功登录之后会回调到shrio的配置类中；</li>\n<li>需要在shrio的配置类中调用根据用户账号获取用户信息的接口：</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">IecWepmShiroAuthService</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">AbstractShiroAuthService</span>&lt;<span class=\"hljs-title\">SessionUser</span>&gt; <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">EnvironmentAware</span> </span>&#123;<br><br>\t<span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> TenantUserCloudService tenantUserCloudService;<br>&#125;<br>```\t<br><br>调用的就是这么一个接口<br><br>```java<br><span class=\"hljs-meta\">@CloudServiceClient</span>(<span class=\"hljs-string\">\"gap-service-tenant-auth\"</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">interface</span> <span class=\"hljs-title\">TenantUserCloudService</span> </span>&#123;<br><br>\t<span class=\"hljs-meta\">@RequestMapping</span>(<br>        value = &#123;<span class=\"hljs-string\">\"/tenant/user/by-emp-no\"</span>&#125;,<br>        method = &#123;RequestMethod.GET&#125;<br>    )<br>    <span class=\"hljs-function\">APIResponse&lt;TenantUser&gt; <span class=\"hljs-title\">getTenantUserByEmpNo</span><span class=\"hljs-params\">(@RequestParam(name = <span class=\"hljs-string\">\"tenantId\"</span>,required = <span class=\"hljs-keyword\">true</span>)</span> Integer var1, @<span class=\"hljs-title\">RequestParam</span><span class=\"hljs-params\">(name = <span class=\"hljs-string\">\"empNo\"</span>,required = <span class=\"hljs-keyword\">true</span>)</span> String var2)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>如果按照下面的代码进行注入，那么由于shrio的初始化要先与springMVC，所以导致找不到相关处理的类；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><br><span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> TenantUserCloudService tenantUserCloudService;<br></code></pre></td></tr></table></figure>\n\n<p>解决的思路就是：</p>\n<ul>\n<li>首先不进行<code>tenantUserCloudService</code>的初始化，只有在调用该接口的时候进行初始化；</li>\n<li>创建一个类实现<code>ApplicationContextAware</code>接口，实现这个接口可以很方便的从spring容器中获取bean；</li>\n<li>机制就是<strong>当调用这个接口的时候才从spring容器中获取这个bean</strong>；</li>\n</ul>\n<p>创建一个类实现<code>ApplicationContextAware</code>接口：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//相当于给一个bean进行代理</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">DelegateBean</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">ApplicationContextAware</span> </span>&#123;<br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> Logger logger = LoggerFactory.getLogger(DelegateBean<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br>    <span class=\"hljs-keyword\">protected</span> ApplicationContext applicationContext;<br>    <span class=\"hljs-keyword\">protected</span> Object target;<br>    <span class=\"hljs-keyword\">protected</span> String targetBeanName;<br>    <span class=\"hljs-keyword\">protected</span> Class targetBeanType;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">DelegateBean</span><span class=\"hljs-params\">(String targetBeanName)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">this</span>.targetBeanName = targetBeanName;<br>    &#125;<br>\t<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">DelegateBean</span><span class=\"hljs-params\">(Class targetBeanType)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">this</span>.targetBeanType = targetBeanType;<br>    &#125;<br>\t<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">DelegateBean</span><span class=\"hljs-params\">(ApplicationContext applicationContext, String targetBeanName)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">this</span>.applicationContext = applicationContext;<br>        <span class=\"hljs-keyword\">this</span>.targetBeanName = targetBeanName;<br>    &#125;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">DelegateBean</span><span class=\"hljs-params\">(ApplicationContext applicationContext, Class targetBeanType)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">this</span>.applicationContext = applicationContext;<br>        <span class=\"hljs-keyword\">this</span>.targetBeanType = targetBeanType;<br>    &#125;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">setApplicationContext</span><span class=\"hljs-params\">(ApplicationContext applicationContext)</span> <span class=\"hljs-keyword\">throws</span> BeansException </span>&#123;<br>        <span class=\"hljs-keyword\">this</span>.applicationContext = applicationContext;<br>    &#125;<br>\t<span class=\"hljs-comment\">//当调用这个方法的时候才从spring容器中获取bean；</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> Object <span class=\"hljs-title\">target</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        Assert.notNull(<span class=\"hljs-keyword\">this</span>.applicationContext, <span class=\"hljs-string\">\"A DelegateBean should be managed by ApplicationContext or pass ApplicationContext though constructor arg\"</span>);<br>        <span class=\"hljs-keyword\">if</span>(<span class=\"hljs-keyword\">this</span>.target == <span class=\"hljs-keyword\">null</span>) &#123;<br>            <span class=\"hljs-keyword\">synchronized</span>(<span class=\"hljs-keyword\">this</span>) &#123;<br>                <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">this</span>.target != <span class=\"hljs-keyword\">null</span>?<span class=\"hljs-keyword\">this</span>.target:(<span class=\"hljs-keyword\">this</span>.target = <span class=\"hljs-keyword\">this</span>.doGetBeanFromApplicationContext());<br>            &#125;<br>        &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">this</span>.target;<br>        &#125;<br>    &#125;<br><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">protected</span> Object <span class=\"hljs-title\">doGetBeanFromApplicationContext</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">this</span>.targetBeanName != <span class=\"hljs-keyword\">null</span>?<span class=\"hljs-keyword\">this</span>.applicationContext.getBean(<span class=\"hljs-keyword\">this</span>.targetBeanName):(<span class=\"hljs-keyword\">this</span>.targetBeanType != <span class=\"hljs-keyword\">null</span>?<span class=\"hljs-keyword\">this</span>.applicationContext.getBean(<span class=\"hljs-keyword\">this</span>.targetBeanType):<span class=\"hljs-keyword\">null</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>只是这样配置还是不够的，我们需要在spring初始化的时候将这个代理bean交给spring容器进行管理；</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">IecWepmAutoConfiguration</span></span>&#123;<br><br>\t<span class=\"hljs-meta\">@Bean</span><br>    <span class=\"hljs-meta\">@Qualifier</span>(<span class=\"hljs-string\">\"tenantUserCloudService\"</span>)<br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> DelegateBean <span class=\"hljs-title\">tenantUserCloudService</span><span class=\"hljs-params\">()</span></span>&#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> DelegateBean(TenantUserCloudService<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>然后再shrio的类中我们需要进行这样的使用：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">IecWepmShiroAuthService</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title\">AbstractShiroAuthService</span>&lt;<span class=\"hljs-title\">SessionUser</span>&gt; <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title\">EnvironmentAware</span> </span>&#123;<br>\t<span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-meta\">@Qualifier</span>(<span class=\"hljs-string\">\"tenantUserCloudService\"</span>)<br>    <span class=\"hljs-keyword\">private</span> DelegateBean tenantUserCloudService;<br>\t<br>\t<span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> SessionUser <span class=\"hljs-title\">doLogin</span><span class=\"hljs-params\">(String userAccount, String userPwd)</span> </span>&#123;<br>        <br>        <span class=\"hljs-comment\">//根据用户编号获取用户信息,调用target()是关键，只有在调用这个方法的时候才会从spring容器中获取信息</span><br>        APIResponse&lt;TenantUser&gt; tenantUserByEmpNo = ((TenantUserCloudService) tenantUserCloudService.target())<br>                .getTenantUserByEmpNo(TENANT_ID, userAccount);<br>        <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-string\">\"success\"</span>.equals(tenantUserByEmpNo.getCode()) &amp;&amp; <span class=\"hljs-keyword\">null</span> != tenantUserByEmpNo.getData())&#123;<br>            userAccount = tenantUserByEmpNo.getData().getDomainAccountList().get(<span class=\"hljs-number\">0</span>).getDomainAccount();<br>        &#125;<br>        UserInfoDto userInfo = userService.getUserByAccount(userAccount);<br>        SessionUser sessionUser = <span class=\"hljs-keyword\">new</span> SessionUser();<br>        sessionUser.setUserId(Integer.valueOf(userAccount));<br>        AuthUtils.setSessionUser(sessionUser);<br>        <span class=\"hljs-comment\">// todo 返回的SessionUser 就是保存在session里的对象 通过 SessionUser sessionUser = (SessionUser) AuthUtils.getSessionUser(); 进行获取</span><br>        <span class=\"hljs-keyword\">return</span> sessionUser;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n<p>关键： <strong>以上的思路最主要的就是，在shrio初始化的时候仅仅只是初始化一个空壳，只有当使用那个bean的时候才从spring容器中获取bean并且注入，这样的好处就是当当前bean的声明周期还未开始的时候预留一个位置，当使用的时候才从spring容器中注入，这样不会导致项目启动的时候就会找不到bean</strong>；</p>\n","raw":null,"categories":[{"name":"spring","path":"api/categories/spring.json"}],"tags":[{"name":"spring","path":"api/tags/spring.json"}]},{"title":"springboot 中 @ConditionalOnExpression注解 在特定情况下使用相关配置或者实例化bean","slug":"spring-boot-conditional-on-expression","date":"2018-05-30T01:20:00.000Z","updated":"2022-12-01T01:32:39.787Z","comments":true,"top":null,"path":"api/articles/spring-boot-conditional-on-expression.json","excerpt":" [Figure] 在开发中会遇到一些需求：在配置文件中设置一个enable，当这个配置为true的时候，才进行相关的配置类的初始化。","keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046777237348.jpg","content":"<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046777524470.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p>在开发中会遇到一些需求：在配置文件中设置一个enable，当这个配置为true的时候，才进行相关的配置类的初始化。</p>\n<a id=\"more\"></a>\n\n\n<p>示例：</p>\n<p>需要实例化的bean，请不要加@Component注解</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">TestBean</span> </span>&#123;<br>  <br>  <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">TestBean</span><span class=\"hljs-params\">()</span></span>&#123;<br>    <br>  &#125;<br>  <br>  <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">doSomeThing</span><span class=\"hljs-params\">()</span></span>&#123;<br>    <br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n\n<p>配置类：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-meta\">@ConditionalOnExpression</span>(<span class=\"hljs-string\">\"$&#123;test.enabled:true&#125;\"</span>)<br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-class\"><span class=\"hljs-keyword\">class</span> <span class=\"hljs-title\">TestConfiguration</span> </span>&#123;<br>    <span class=\"hljs-meta\">@Bean</span><br>    <span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> TestBean <span class=\"hljs-title\">testBean</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> TestBean();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n\n\n<p>配置文件：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">test.enabled:</span> <span class=\"hljs-literal\">true</span><br></code></pre></td></tr></table></figure>\n\n<p>这个bean只有在<code>test.enabled: true</code>的时候才会进行初始化。</p>\n","raw":null,"categories":[{"name":"spring","path":"api/categories/spring.json"}],"tags":[{"name":"spring","path":"api/tags/spring.json"}]},{"title":"Java源码之旅(1) - ArrayList","slug":"java-source-code-arraylist","date":"2018-05-26T01:45:00.000Z","updated":"2022-12-01T01:32:39.787Z","comments":true,"top":null,"path":"api/articles/java-source-code-arraylist.json","excerpt":" [Figure]  技术在学习中成长，源码的世界没有你想象的那么复杂","keywords":"java,spring,springboot,springcloud,mybatis,jQuery,html,css","cover":"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046773390686.jpg","content":"<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046773582634.jpg\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<blockquote>\n<p> 技术在学习中成长，源码的世界没有你想象的那么复杂</p>\n</blockquote>\n<a id=\"more\"></a>\n<h2 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h2><p>2018年的五月，开始java的源码学习之旅，从简单的角度去理解java的源码，前几天在学习交流中正好看了一下java集合的源码，才发现源码并没有想象中的那么难以理解，所以，源码之旅从java的集合类开始咯。</p>\n<p>本章的源码版本为：<code>JDK1.8</code></p>\n<h2 id=\"类的关系\"><a href=\"#类的关系\" class=\"headerlink\" title=\"类的关系\"></a>类的关系</h2><p>要理解<code>ArrayList</code>的源码，我们就需要从它的关系开始，<code>ArrayList</code>继承了<code>AbstractList</code>，实现了<code>List</code>接口，我们从UML图可以看出：</p>\n<p><img   class=\"lazyload\" data-original=\"https://cdn.jsdelivr.net/gh/WinterChenS/img/posts/1628046462618337.png\" src=\"data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==\"  alt=\"\"></p>\n<p>虚线箭头表示实现接口，实线箭头表示继承关系</p>\n<h2 id=\"ArrayList简介\"><a href=\"#ArrayList简介\" class=\"headerlink\" title=\"ArrayList简介\"></a>ArrayList简介</h2><p><code>ArrayList</code>是<code>java</code>中最常用的集合类了，说到<code>ArrayList</code>，我们不得不说说<code>LinkedList</code>，因为他们都是从<code>Collection</code>派生而来的，都是用来存放对象的序列的集合类，<code>ArrayList</code>相比与<code>LinkedList</code>有什么优劣呢？</p>\n<ul>\n<li><p><code>ArrayList</code>:</p>\n<ul>\n<li><p>优点：<strong>随机访问元素的速度快</strong></p>\n</li>\n<li><p>缺点：<strong>从中间插入和移除元素比较慢</strong></p>\n</li>\n</ul>\n</li>\n<li><p><code>LinkedList</code>：</p>\n<ul>\n<li><p>优点：<strong>从中间插入和移除元素速度快</strong></p>\n</li>\n<li><p>缺点：<strong>随机访问元素的速度比较慢</strong></p>\n</li>\n</ul>\n</li>\n</ul>\n<p>接下来我们就从源码的角度去理解一下为什么有这些优缺点。</p>\n<h2 id=\"源码分析\"><a href=\"#源码分析\" class=\"headerlink\" title=\"源码分析\"></a>源码分析</h2><h3 id=\"ArrayList的初始化\"><a href=\"#ArrayList的初始化\" class=\"headerlink\" title=\"ArrayList的初始化\"></a>ArrayList的初始化</h3><p><code>ArrayList</code>有三个构造方法</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-comment\">//默认初始容量</span><br><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-keyword\">int</span> DEFAULT_CAPACITY = <span class=\"hljs-number\">10</span>;<br><span class=\"hljs-comment\">//空的元素数组</span><br><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> Object[] EMPTY_ELEMENTDATA = &#123;&#125;;<br><span class=\"hljs-comment\">//初始容量空的元素数组</span><br><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;<br><span class=\"hljs-comment\">// 存放元素的数组</span><br><span class=\"hljs-keyword\">transient</span> Object[] elementData; <span class=\"hljs-comment\">// non-private to simplify nested class access</span><br><span class=\"hljs-comment\">//数组的大小</span><br><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">int</span> size;<br><br><span class=\"hljs-comment\">// 空参的构造方法</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">ArrayList</span><span class=\"hljs-params\">()</span> </span>&#123;<br>        <span class=\"hljs-keyword\">this</span>.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA; <span class=\"hljs-comment\">// -- (1)</span><br>    &#125;<br><br><span class=\"hljs-comment\">//指定初始容量的构造方法</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">ArrayList</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> initialCapacity)</span> </span>&#123;<br>        <span class=\"hljs-keyword\">if</span> (initialCapacity &gt; <span class=\"hljs-number\">0</span>) &#123;<br>            <span class=\"hljs-keyword\">this</span>.elementData = <span class=\"hljs-keyword\">new</span> Object[initialCapacity]; <span class=\"hljs-comment\">// -- (2)</span><br>        &#125; <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">if</span> (initialCapacity == <span class=\"hljs-number\">0</span>) &#123;<br>            <span class=\"hljs-keyword\">this</span>.elementData = EMPTY_ELEMENTDATA; <span class=\"hljs-comment\">// -- (3)</span><br>        &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>            <span class=\"hljs-keyword\">throw</span> <span class=\"hljs-keyword\">new</span> IllegalArgumentException(<span class=\"hljs-string\">\"Illegal Capacity: \"</span>+<br>                                               initialCapacity);<br>        &#125;<br>    &#125;<br><br><span class=\"hljs-comment\">//初始化给定一个集合的构造函数</span><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-title\">ArrayList</span><span class=\"hljs-params\">(Collection&lt;? extends E&gt; c)</span> </span>&#123;<br>        elementData = c.toArray();    <span class=\"hljs-comment\">// -- (4)</span><br>        <span class=\"hljs-keyword\">if</span> ((size = elementData.length) != <span class=\"hljs-number\">0</span>) &#123;<br>            <span class=\"hljs-comment\">// c.toArray might (incorrectly) not return Object[] (see 6260652)</span><br>            <span class=\"hljs-keyword\">if</span> (elementData.getClass() != Object[]<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span><br><span class=\"hljs-class\">                <span class=\"hljs-title\">elementData</span> </span>= Arrays.copyOf(elementData, size, Object[]<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span>;  <span class=\"hljs-comment\">// -- (5)</span><br>        &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>            <span class=\"hljs-comment\">// replace with empty array.</span><br>            <span class=\"hljs-keyword\">this</span>.elementData = EMPTY_ELEMENTDATA;<br>        &#125;<br>    &#125;<br></code></pre></td></tr></table></figure>\n\n<p>从源码中我们可以看出，<code>ArrayList</code>其实底层使用的是<code>数组</code>，<code>transient Object[] elementData</code> 这个变量就是用来存放对象的一个数组。</p>\n<ul>\n<li><p><code>ArrayList</code>的空参构造函数：也就是默认的构造函数，当<code>new ArrayList()</code>的时候调用这个方法，可以看出将<code>elementData</code>变量地址指向了<code>DEFAULTCAPACITY_EMPTY_ELEMENTDATA</code>这个<strong>初始容量为10，并且为空的元素数组</strong>;如步骤<code>(1)</code></p>\n</li>\n<li><p><code>ArrayList</code>的指定大小的构造函数：当初始化一个指定大小的<code>new ArrayList(int)</code>的时候调用该方法，这个方法首先对<code>initialCapacity</code>参数进行判断，<strong>如果大于0</strong>，那么创建一个指定大小的数组<code>(2)</code>；<strong>如果等于0</strong>,创建一个空的数组<code>(3)</code>；否则就判处异常；</p>\n</li>\n<li><p>初始化给定一个集合的构造函数：如果初始化的时候，给定一个集合对象，那么将这个集合转换为数组 <code>(4)</code>，然后对这个数组的长度进行判断，如果数组不等于0，那么调用<code>Arrays.copyOf(elementData, size, Object[].class)</code>方法<code>(5)</code>，这个方法是一个<strong>核心方法</strong>，这个方法就是初始化一个大小为等于当前数组的一个新的数组，然后将对象<code>copy</code>到新的数组中，然后将内存地址指定给<code>elementData</code>，从下面的<code>Arrays.copyOf</code>的源码可以看出来。</p>\n</li>\n</ul>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> &lt;T,U&gt; T[] copyOf(U[] original, <span class=\"hljs-keyword\">int</span> newLength, Class&lt;? extends T[]&gt; newType) &#123;<br>        <span class=\"hljs-meta\">@SuppressWarnings</span>(<span class=\"hljs-string\">\"unchecked\"</span>)<br>        T[] copy = ((Object)newType == (Object)Object[]<span class=\"hljs-class\">.<span class=\"hljs-keyword\">class</span>)</span><br>            ? (T[]) new Object[newLength]<br>            : (T[]) Array.newInstance(newType.getComponentType(), newLength);<br>        System.arraycopy(original, <span class=\"hljs-number\">0</span>, copy, <span class=\"hljs-number\">0</span>,<br>                         Math.min(original.length, newLength));<br>        <span class=\"hljs-keyword\">return</span> copy;<br>    &#125;<br></code></pre></td></tr></table></figure>\n\n<p><code>copyOf</code>方法首先判断两个对象的类型，如果类型一致，那么直接创建一个同大小的数组；如果类型不一致，则调用<code>Array.newInstance</code>指定类型进行初始化这个数组，当然，大小也是一致的; 最后调用<code>System.arraycopy</code>将参数数组<code>copy</code>到新的目标并返回。</p>\n<h3 id=\"ArrayList的常用方法之-add\"><a href=\"#ArrayList的常用方法之-add\" class=\"headerlink\" title=\"ArrayList的常用方法之 add\"></a>ArrayList的常用方法之 add</h3><p>我们先看一下源码：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">boolean</span> <span class=\"hljs-title\">add</span><span class=\"hljs-params\">(E e)</span> </span>&#123;<br>        ensureCapacityInternal(size + <span class=\"hljs-number\">1</span>);  <span class=\"hljs-comment\">// Increments modCount!! -- (1)</span><br>        elementData[size++] = e;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">true</span>;<br>    &#125;<br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">add</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> index, E element)</span> </span>&#123;<br>        rangeCheckForAdd(index);<span class=\"hljs-comment\">//-- (2)</span><br><br>        ensureCapacityInternal(size + <span class=\"hljs-number\">1</span>);  <span class=\"hljs-comment\">// Increments modCount!!</span><br>        System.arraycopy(elementData, index, elementData, index + <span class=\"hljs-number\">1</span>,<br>                         size - index); <span class=\"hljs-comment\">//-- (3)</span><br>        elementData[index] = element;<br>        size++;<br>    &#125;<br></code></pre></td></tr></table></figure>\n\n<p>ArrayList有两个add方法，第一个方法就是按顺序将对象插入到尾部，第二个方法就是从中间插入对象。</p>\n<p><code>add(E e)</code> 方法首先会判断数组的容量是否超过极限<code>ensureCapacityInternal(size + 1)</code>，这个方法首先会进行容量的判断，如果超过了极限，创建一个新的数组，大小是旧数组1.5倍，然后将旧数组中的对象全部拷贝到新的数组<code>(1)</code>，等下会详细解析这个方法。最后将参数对象插入到数组中，返回true。</p>\n<p><code>add(int index, E element)</code>首先会调用<code>rangeCheckForAdd(index)</code>进行index的是否越界的验证<code>(2)</code>，然后调用上一个方法中一样的判断容量是否超过极限的方法，下一步就是一个核心的方法<code>System.arraycopy</code>，这个方法我们在<code>ArrayList初始化中</code>已经讲过了，但是这里不太一样：</p>\n<ul>\n<li><p><code>elementData</code> : 源数组</p>\n</li>\n<li><p><code>index</code>：源数组起始位置</p>\n</li>\n<li><p><code>elementData</code>：目标数组</p>\n</li>\n<li><p><code>index + 1</code>：目标数组起始位置</p>\n</li>\n<li><p><code>size - index</code>：复制数组元素数目</p>\n</li>\n</ul>\n<p>从源码中可以看出，当我们往一个ArrayList中间插入一个对象的时候，index索引处后面的索引往后移动一位，最后把索引为index空出来，并将element赋值给它。这样一来我们并不知道要插入哪个位置，所以会进行匹配那么它的时间赋值度就为n。</p>\n<p>接下来看一下<code>ensureCapacityInternal(size + 1)</code>这个方法的调用链：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">ensureCapacityInternal</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> minCapacity)</span> </span>&#123;<br>  <span class=\"hljs-keyword\">if</span> (elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA) &#123;<br>    minCapacity = Math.max(DEFAULT_CAPACITY, minCapacity);<br>  &#125;<br><br>  ensureExplicitCapacity(minCapacity);<br>&#125;<br><br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">ensureExplicitCapacity</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> minCapacity)</span> </span>&#123;<br>  modCount++;<br><br>  <span class=\"hljs-comment\">// overflow-conscious code</span><br>  <span class=\"hljs-keyword\">if</span> (minCapacity - elementData.length &gt; <span class=\"hljs-number\">0</span>)<br>    grow(minCapacity);<br>&#125;<br><br><span class=\"hljs-function\"><span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title\">grow</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> minCapacity)</span> </span>&#123;<br>  <span class=\"hljs-comment\">// overflow-conscious code</span><br>  <span class=\"hljs-keyword\">int</span> oldCapacity = elementData.length;<br>  <span class=\"hljs-keyword\">int</span> newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class=\"hljs-number\">1</span>);<span class=\"hljs-comment\">//oldCapacity &gt;&gt; 1 就是除以2</span><br>  <span class=\"hljs-keyword\">if</span> (newCapacity - minCapacity &lt; <span class=\"hljs-number\">0</span>)<br>    newCapacity = minCapacity;<br>  <span class=\"hljs-keyword\">if</span> (newCapacity - MAX_ARRAY_SIZE &gt; <span class=\"hljs-number\">0</span>)<br>    newCapacity = hugeCapacity(minCapacity);<br>  <span class=\"hljs-comment\">// minCapacity is usually close to size, so this is a win:</span><br>  elementData = Arrays.copyOf(elementData, newCapacity);<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p><code>ensureCapacityInternal(int minCapacity)</code>方法中判断当前数组中的元素是否为空，如果为空则给定一个最大的值，然后调用<code>ensureExplicitCapacity(minCapacity)</code>，这个方法主要是判数组容量是否超过极限，如果超过极限调用<code>grow(int minCapacity)</code>，这个方法就是扩容方法，该方法会创建一个比原数组大1.5倍的新数组，然后将原数组中的所有对象<code>copy</code>到新的数组中。</p>\n<h3 id=\"ArrayList的常用方法之-remove\"><a href=\"#ArrayList的常用方法之-remove\" class=\"headerlink\" title=\"ArrayList的常用方法之 remove\"></a>ArrayList的常用方法之 remove</h3><p><code>remove</code>方法其实跟从中间插入对象的<code>add</code>方法有很大的相似之处，如果我们删除某一个元素，将<code>index</code>开始后面的所有对象都往前移动一位，底层方法其实是复制一遍，所以删除一个对象的复杂度和从中间插入一个对象是差不多的。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> E <span class=\"hljs-title\">remove</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> index)</span> </span>&#123;<br>        rangeCheck(index);<br><br>        modCount++;<br>        E oldValue = elementData(index);<br><br>        <span class=\"hljs-keyword\">int</span> numMoved = size - index - <span class=\"hljs-number\">1</span>;<br>        <span class=\"hljs-keyword\">if</span> (numMoved &gt; <span class=\"hljs-number\">0</span>)<br>            System.arraycopy(elementData, index+<span class=\"hljs-number\">1</span>, elementData, index,<br>                             numMoved);<br>        elementData[--size] = <span class=\"hljs-keyword\">null</span>; <span class=\"hljs-comment\">// clear to let GC do its work</span><br><br>        <span class=\"hljs-keyword\">return</span> oldValue;<br>    &#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"ArrayList的常用方法之-get\"><a href=\"#ArrayList的常用方法之-get\" class=\"headerlink\" title=\"ArrayList的常用方法之 get\"></a>ArrayList的常用方法之 get</h3><p><code>ArrayList</code>的<code>get</code>方法非常直观的就能理解了，废话不多说，直接看代码:</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-function\"><span class=\"hljs-keyword\">public</span> E <span class=\"hljs-title\">get</span><span class=\"hljs-params\">(<span class=\"hljs-keyword\">int</span> index)</span> </span>&#123;<br>  rangeCheck(index);<br><br>  <span class=\"hljs-keyword\">return</span> elementData(index);<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>检查index合法性，然后从数组中取出对象并返回，是不是很简单呢？</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>本章列举了一些ArrayList常用的方法，了解到ArrayList底层其实是一个对象数组，以及从中间插入对象和移除对象比较慢的原因，从这些方法出发，理解ArrayList其他的方法会很简单了。下一章讲一讲LinkedList的源码。</p>\n","raw":null,"categories":[{"name":"java源码","path":"api/categories/java源码.json"}],"tags":[{"name":"java源码","path":"api/tags/java源码.json"}]}]}